{%- liquid
  assign p = product
  if p == blank
    break
  endif

  assign s = section.settings
  assign v = p.selected_or_first_available_variant
  if v == blank
    assign v = p.variants.first
  endif

  assign on_sale = false
  if v.compare_at_price and v.compare_at_price > v.price
    assign on_sale = true
  endif
-%}

<script type="application/ld+json">
  {{ p | structured_data }}
</script>

<section
  id="MainProductCompact-{{ section.id }}"
  class="qtm-compact"
  style="
    padding-top: {{ s.padding_top }}px;
    padding-bottom: {{ s.padding_bottom }}px;
    --qtm-gap: {{ s.gap }}px;
  "
>

  <div class="qtm-compact__grid {% if s.desktop_media_position == 'right' %}media-right{% endif %}">

    <!-- MEDIA -->
    <div class="qtm-compact__media">
      {% if p.featured_image %}
        {{
          p.featured_image
          | image_url: width: 2000
          | image_tag:
            loading: 'eager',
            class: 'qtm-compact__img',
            alt: p.featured_image.alt | default: p.title | escape
        }}
      {% else %}
        <div class="qtm-compact__placeholder"></div>
      {% endif %}
    </div>

    <!-- DETAILS -->
    <div class="qtm-compact__details">

      <form
        method="post"
        action="/cart/add"
        enctype="multipart/form-data"
        id="ProductForm-{{ section.id }}"
        class="qtm-compact__form"
      >

        <input type="hidden" name="id" value="{{ v.id }}">

        {% for block in section.blocks %}
          {% case block.type %}

            {% when 'title' %}
              <h1 class="qtm-compact__title" {{ block.shopify_attributes }}>
                {{ p.title }}
              </h1>

            {% when 'price' %}
              <div class="qtm-compact__price" {{ block.shopify_attributes }}>
                {% if on_sale %}
                  <span class="sale">{{ v.price | money }}</span>
                  <span class="compare"><s>{{ v.compare_at_price | money }}</s></span>
                {% else %}
                  <span>{{ v.price | money }}</span>
                {% endif %}
              </div>

            {% when 'variant_picker' %}
              {% unless p.has_only_default_variant %}
                <div class="qtm-compact__variants" {{ block.shopify_attributes }}>
                  {% for option in p.options_with_values %}
                    <div class="option">
                      <label>{{ option.name }}</label>
                      <select name="options[{{ option.name | escape }}]">
                        {% for value in option.values %}
                          <option value="{{ value | escape }}"
                            {% if option.selected_value == value %}selected{% endif %}>
                            {{ value }}
                          </option>
                        {% endfor %}
                      </select>
                    </div>
                  {% endfor %}
                </div>
              {% endunless %}

            {% when 'quantity' %}
              <div class="qtm-compact__qty" {{ block.shopify_attributes }}>
                <label>Quantity</label>
                <input
                  type="number"
                  name="quantity"
                  value="1"
                  min="1"
                >
              </div>

            {% when 'buy_buttons' %}
              <div class="qtm-compact__buy" {{ block.shopify_attributes }}>
                <button
                  type="submit"
                  class="qtm-compact__atc"
                  {% unless v.available %}disabled{% endunless %}
                >
                  {% if v.available %}
                    Add to cart
                  {% else %}
                    Sold out
                  {% endif %}
                </button>
              </div>

            {% when 'description' %}
              {% if p.description != blank %}
                <div class="qtm-compact__desc rte" {{ block.shopify_attributes }}>
                  {{ p.description }}
                </div>
              {% endif %}

            {% when 'accordion' %}
              <details class="qtm-compact__accordion" {{ block.shopify_attributes }}>
                <summary>{{ block.settings.heading }}</summary>
                <div class="rte">
                  {{ block.settings.content }}
                </div>
              </details>

            {% when 'spacer' %}
              <div style="height: {{ block.settings.height }}px;" {{ block.shopify_attributes }}></div>

          {% endcase %}
        {% endfor %}

      </form>
    </div>

  </div>
</section>

<style>
.qtm-compact__grid {
  display: grid;
  gap: var(--qtm-gap);
}

@media (min-width: 750px) {
  .qtm-compact__grid {
    grid-template-columns: 1.1fr 0.9fr;
  }
  .qtm-compact__grid.media-right {
    grid-template-columns: 0.9fr 1.1fr;
  }
  .qtm-compact__grid.media-right .qtm-compact__media { order: 2; }
  .qtm-compact__grid.media-right .qtm-compact__details { order: 1; }
}

.qtm-compact__img {
  width: 100%;
  border-radius: 12px;
}

.qtm-compact__placeholder {
  aspect-ratio: 1 / 1;
  background: #f3f3f3;
  border-radius: 12px;
}

.qtm-compact__details {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.qtm-compact__title {
  margin: 0;
  font-size: 34px;
}

.qtm-compact__price {
  font-size: 20px;
  font-weight: 600;
}

.qtm-compact__price .compare {
  opacity: 0.6;
  margin-left: 10px;
}

.qtm-compact__atc {
  height: 48px;
  border-radius: 12px;
  width: 100%;
}

.qtm-compact__accordion {
  border: 1px solid rgba(0,0,0,.1);
  border-radius: 12px;
  padding: 12px;
}
</style>

{% schema %}
{
  "name": "Main Product - Compact",
  "settings": [
    {
      "type": "select",
      "id": "desktop_media_position",
      "label": "Desktop media position",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Gap",
      "min": 0,
      "max": 60,
      "step": 4,
      "default": 16
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 24
    }
  ],
  "blocks": [
    { "type": "title", "name": "Title" },
    { "type": "price", "name": "Price" },
    { "type": "variant_picker", "name": "Variant picker" },
    { "type": "quantity", "name": "Quantity" },
    { "type": "buy_buttons", "name": "Buy buttons" },
    { "type": "description", "name": "Description" },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        { "type": "text", "id": "heading", "label": "Heading", "default": "Details" },
        { "type": "richtext", "id": "content", "label": "Content", "default": "<p>Add content here.</p>" }
      ]
    },
    {
      "type": "spacer",
      "name": "Spacer",
      "settings": [
        { "type": "range", "id": "height", "label": "Height", "min": 4, "max": 80, "step": 4, "default": 16 }
      ]
    }
  ],
  "presets": [
    {
      "name": "Main Product - Compact",
      "category": "Products",
      "blocks": [
        { "type": "title" },
        { "type": "price" },
        { "type": "variant_picker" },
        { "type": "quantity" },
        { "type": "buy_buttons" },
        { "type": "description" }
      ]
    }
  ]
}
{% endschema %}

