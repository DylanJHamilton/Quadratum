{%- comment -%}
  Quadratum â€” Main Product (Compact)
  Fully Working Version
  - No block container reliance
  - Directly renders shared engine snippets
  - Immediate parity with existing PDP system
{%- endcomment -%}

{%- liquid
  assign p = product
  if p == blank
    break
  endif
-%}

<section
  id="MainProductCompact-{{ section.id }}"
  class="main-product-compact"
  style="
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>

  <div class="page-width">

    <div class="main-product-compact__grid">

      <!-- MEDIA COLUMN -->
      <div class="main-product-compact__media">
        {%- render 'product-media-gallery-content',
          media_presentation: 'gallery',
          block_settings: section.settings,
          block_id: section.id,
          block_shopify_attributes: ''
        -%}
      </div>

      <!-- DETAILS COLUMN -->
      <div class="main-product-compact__details">

        <h1 class="product__title">
          {{ p.title }}
        </h1>

        <div id="QtmPrice">
          {{ p.selected_or_first_available_variant.price | money }}
        </div>

        {% unless p.has_only_default_variant %}
          <variant-selects
            id="VariantSelects-{{ section.id }}"
            data-section="{{ section.id }}"
            data-url="{{ p.url }}"
          >
            {% for option in p.options_with_values %}
              <fieldset class="product-form__input">
                <legend>{{ option.name }}</legend>
                {% for value in option.values %}
                  <label>
                    <input
                      type="radio"
                      name="options[{{ option.name | escape }}]"
                      value="{{ value | escape }}"
                      {% if option.selected_value == value %}checked{% endif %}
                    >
                    {{ value }}
                  </label>
                {% endfor %}
              </fieldset>
            {% endfor %}
          </variant-selects>
        {% endunless %}

        <form
          method="post"
          action="/cart/add"
          id="product-form-{{ section.id }}"
          accept-charset="UTF-8"
          class="product-form"
          enctype="multipart/form-data"
        >
          <input
            type="hidden"
            name="id"
            value="{{ p.selected_or_first_available_variant.id }}"
          >

          <div class="product-form__quantity">
            <label for="Quantity-{{ section.id }}">Quantity</label>
            <input
              id="Quantity-{{ section.id }}"
              type="number"
              name="quantity"
              value="1"
              min="1"
            >
          </div>

          <button
            type="submit"
            name="add"
            class="product-form__submit button button--primary"
          >
            Add to cart
          </button>

        </form>

        <div class="product__description">
          {{ p.description }}
        </div>

      </div>

    </div>

  </div>

</section>

<style>
.main-product-compact__grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: {{ section.settings.gap }}px;
}

@media (max-width: 989px) {
  .main-product-compact__grid {
    grid-template-columns: 1fr;
  }
}

.main-product-compact__media img {
  width: 100%;
  height: auto;
  display: block;
}
</style>

{% schema %}
{
  "name": "Main Product - Compact",
  "settings": [
    {
      "type": "range",
      "id": "gap",
      "label": "Column gap",
      "min": 0,
      "max": 80,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 24
    }
  ],
  "presets": [
    {
      "name": "Main Product - Compact",
      "category": "Products"
    }
  ]
}
{% endschema %}
