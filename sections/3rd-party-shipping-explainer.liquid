{% comment %}
  Quadratum — 3P / Ops: Fulfillment Workflow Timeline
  File: sections/3p-fulfillment-timeline.liquid

  • Pure content timeline (no forms, no integrations)
  • Layouts: horizontal (desktop) / vertical / stacked
  • Mobile always vertical for readability
  • Scoped CSS + max-width fallback (does NOT rely on q-section__inner--lg existing)
  • A11y: aria-label on section + per-step aria-label
{% endcomment %}

{%- assign s = section.settings -%}

{%- if s.enable_section -%}
  {%- assign steps = section.blocks | where: 'type', 'timeline_step' -%}

  {%- assign max_w = '72rem' -%}
  {%- if s.max_width == 'sm' -%}{%- assign max_w = '48rem' -%}{%- endif -%}
  {%- if s.max_width == 'md' -%}{%- assign max_w = '60rem' -%}{%- endif -%}

  {%- assign card_shadow = s.card_shadow | default: 'md' -%}
  {%- assign shadow_css = '0 10px 30px rgba(0,0,0,.08)' -%}
  {%- if card_shadow == 'none' -%}{%- assign shadow_css = 'none' -%}{%- endif -%}
  {%- if card_shadow == 'sm' -%}{%- assign shadow_css = '0 6px 18px rgba(0,0,0,.08)' -%}{%- endif -%}
  {%- if card_shadow == 'lg' -%}{%- assign shadow_css = '0 16px 44px rgba(0,0,0,.12)' -%}{%- endif -%}

<section
  id="q-ft-{{ section.id }}"
  class="q-section q-section--bg-{{ s.background_style }} q-fulfillment-timeline q-fulfillment-timeline--{{ s.layout_variant }}"
  aria-label="{{ s.aria_label | escape }}"
>
  <div
    class="q-section__inner q-fulfillment-timeline__inner q-align-{{ s.align }}"
    style="
      --q-ft-max: {{ max_w }};
      --q-ft-pad-y: 56px;
      --q-ft-pad-x: 24px;

      --q-ft-gap: var(--q-space-lg, 24px);
      --q-ft-gap-sm: var(--q-space-md, 16px);

      --q-ft-radius: {{ s.card_radius | default: 16 }}px;
      --q-ft-border: {{ s.card_border_w | default: 1 }}px;

      --q-ft-rail-w: 2px;
      --q-ft-marker: 32px;

      --q-ft-card-bg: {{ s.card_bg | default: '#ffffff' }};
      --q-ft-card-border: {{ s.card_border_color | default: '#e5e7eb' }};
      --q-ft-card-shadow: {{ shadow_css }};

      --q-ft-text: {{ s.text_color | default: '#111111' }};
      --q-ft-muted: {{ s.muted_text_color | default: '#6b7280' }};
      --q-ft-rail: {{ s.rail_color | default: '#d1d5db' }};

      --q-ft-accent: {{ s.accent_color | default: '#111827' }};
      --q-ft-accent-bg: {{ s.accent_color | default: '#111827' | color_modify: 'alpha', 0.07 }};
      --q-ft-accent-border: {{ s.accent_color | default: '#111827' | color_modify: 'alpha', 0.24 }};
    "
  >
    {%- if s.show_divider -%}
      <div class="q-section__divider"></div>
    {%- endif -%}

    <header class="q-fulfillment-timeline__header">
      <p class="q-kicker">{{ s.kicker | escape }}</p>
      <h2 class="q-heading q-heading--section">{{ s.heading | escape }}</h2>
      <div class="q-text q-text--muted">{{ s.body }}</div>

      {%- if s.show_lead_time and s.lead_time_value != blank -%}
        <div class="q-ft-pill" role="note">
          <span class="q-ft-pill__label">{{ s.lead_time_label | escape }}</span>
          <span class="q-ft-pill__value">{{ s.lead_time_value | escape }}</span>
        </div>
      {%- endif -%}
    </header>

    {%- if steps.size > 0 -%}
      <div class="q-timeline-wrap">
        <ol class="q-timeline q-timeline--connect-{{ s.connector_style }}" role="list">
          {%- for block in steps -%}
            {%- assign b = block.settings -%}
            <li
              class="q-timeline__item{% if b.is_key_step %} q-timeline__item--highlight{% endif %}"
              aria-label="{{ s.sr_label_prefix | escape }} {{ forloop.index }}: {{ b.step_title | escape }}"
              {{ block.shopify_attributes }}
            >
              <div class="q-timeline__index" aria-hidden="true">
                {%- if s.show_step_index -%}
                  <span class="q-timeline__badge">{{ forloop.index }}</span>
                {%- else -%}
                  <span class="q-timeline__dot"></span>
                {%- endif -%}
              </div>

              <div class="q-timeline__card">
                <h3 class="q-heading q-heading--sm q-timeline__title">{{ b.step_title | escape }}</h3>

                {%- if s.show_step_duration and b.step_duration != blank -%}
                  <p class="q-timeline__duration">{{ b.step_duration | escape }}</p>
                {%- endif -%}

                <div class="q-text q-timeline__body">{{ b.step_body }}</div>
              </div>
            </li>
          {%- endfor -%}
        </ol>
      </div>
    {%- endif -%}

  </div>

  <style>
    /* ===== Container + header ===== */
    #q-ft-{{ section.id }} .q-fulfillment-timeline__inner{
      max-width: var(--q-ft-max);
      margin: 0 auto;
      padding: var(--q-ft-pad-y) var(--q-ft-pad-x);
      color: var(--q-ft-text);
    }
    #q-ft-{{ section.id }} .q-align-center{ text-align:center; }
    #q-ft-{{ section.id }} .q-align-center .q-ft-pill{ margin-left:auto; margin-right:auto; }
    #q-ft-{{ section.id }} .q-fulfillment-timeline__header{
      display: grid;
      gap: 10px;
      margin-bottom: var(--q-ft-gap);
    }
    #q-ft-{{ section.id }} .q-kicker{ margin:0; color: var(--q-ft-muted); font-weight: 600; }
    #q-ft-{{ section.id }} .q-heading{ margin:0; }
    #q-ft-{{ section.id }} .q-text{ margin:0; }
    #q-ft-{{ section.id }} .q-text--muted{ color: var(--q-ft-muted); }

    /* ===== Lead time pill (premium, not default HTML) ===== */
    #q-ft-{{ section.id }} .q-ft-pill{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      width: fit-content;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--q-ft-card-border);
      background: color-mix(in srgb, var(--q-ft-card-bg) 92%, var(--q-ft-muted) 8%);
      box-shadow: 0 4px 16px rgba(0,0,0,.06);
      margin-top: 8px;
    }
    #q-ft-{{ section.id }} .q-ft-pill__label{
      font-size: 0.92rem;
      color: var(--q-ft-muted);
      font-weight: 600;
    }
    #q-ft-{{ section.id }} .q-ft-pill__value{
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--q-ft-text);
    }

    /* ===== Timeline base (MOBILE FIRST = vertical) ===== */
    #q-ft-{{ section.id }} .q-timeline-wrap{ width: 100%; }
    #q-ft-{{ section.id }} .q-timeline{
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: var(--q-ft-gap);
      position: relative;
    }

    /* vertical item layout */
    #q-ft-{{ section.id }} .q-timeline__item{
      display: grid;
      grid-template-columns: var(--q-ft-marker) 1fr;
      column-gap: var(--q-ft-gap-sm);
      align-items: start;
      position: relative;
    }

    #q-ft-{{ section.id }} .q-timeline__index{
      width: var(--q-ft-marker);
      height: var(--q-ft-marker);
      display: grid;
      place-items: center;
      position: relative;
      z-index: 2;
    }
    #q-ft-{{ section.id }} .q-timeline__badge{
      width: var(--q-ft-marker);
      height: var(--q-ft-marker);
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-weight: 800;
      font-size: 0.9rem;
      background: var(--q-ft-card-bg);
      border: 1px solid var(--q-ft-card-border);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
    }
    #q-ft-{{ section.id }} .q-timeline__dot{
      width: 12px; height: 12px;
      border-radius: 999px;
      background: var(--q-ft-card-bg);
      border: 2px solid var(--q-ft-rail);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
    }

    /* vertical connectors (scoped) */
    #q-ft-{{ section.id }} .q-timeline--connect-line .q-timeline__item:not(:last-child)::before,
    #q-ft-{{ section.id }} .q-timeline--connect-dots .q-timeline__item:not(:last-child)::before{
      content:"";
      position: absolute;
      left: calc(var(--q-ft-marker) / 2);
      top: var(--q-ft-marker);
      bottom: calc(var(--q-ft-gap) * -1);
      width: var(--q-ft-rail-w);
      transform: translateX(-50%);
      background: var(--q-ft-rail);
      z-index: 1;
    }
    #q-ft-{{ section.id }} .q-timeline--connect-dots .q-timeline__item:not(:last-child)::before{
      background: repeating-linear-gradient(
        to bottom,
        var(--q-ft-rail) 0px,
        var(--q-ft-rail) 6px,
        transparent 6px,
        transparent 14px
      );
    }
    #q-ft-{{ section.id }} .q-timeline--connect-none .q-timeline__item::before{ content:none !important; }

    /* cards */
    #q-ft-{{ section.id }} .q-timeline__card{
      background: var(--q-ft-card-bg);
      border: var(--q-ft-border) solid var(--q-ft-card-border);
      border-radius: var(--q-ft-radius);
      padding: 18px 18px;
      box-shadow: var(--q-ft-card-shadow);
      min-width: 0;
    }
    #q-ft-{{ section.id }} .q-timeline__title{ margin: 0 0 6px 0; }
    #q-ft-{{ section.id }} .q-timeline__duration{
      margin: 0 0 10px 0;
      color: var(--q-ft-muted);
      font-weight: 650;
      font-size: 0.95rem;
    }
    #q-ft-{{ section.id }} .q-timeline__body{ color: var(--q-ft-text); }
    #q-ft-{{ section.id }} .q-timeline__body p{ margin: 0; }
    #q-ft-{{ section.id }} .q-timeline__body p + p{ margin-top: 10px; }

    /* highlight step */
    #q-ft-{{ section.id }} .q-timeline__item--highlight .q-timeline__card{
      border-color: var(--q-ft-accent-border);
      background: var(--q-ft-accent-bg);
    }
    #q-ft-{{ section.id }} .q-timeline__item--highlight .q-timeline__badge{
      border-color: var(--q-ft-accent-border);
    }

    /* ===== STACKED variant ===== */
    #q-ft-{{ section.id }}.q-fulfillment-timeline--stacked .q-timeline{
      gap: var(--q-ft-gap-sm);
    }
    #q-ft-{{ section.id }}.q-fulfillment-timeline--stacked .q-timeline__item{
      grid-template-columns: 1fr;
    }
    #q-ft-{{ section.id }}.q-fulfillment-timeline--stacked .q-timeline__index{
      width: auto;
      height: auto;
      justify-content: start;
      margin-bottom: 10px;
    }
    #q-ft-{{ section.id }}.q-fulfillment-timeline--stacked .q-timeline__badge{
      width: 34px; height: 34px;
    }

    /* ===== HORIZONTAL variant (desktop only) ===== */
    @media (min-width: 900px){
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline-wrap{
        overflow-x: auto;
        padding-bottom: 8px;
      }
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline{
        grid-auto-flow: column;
        grid-auto-columns: minmax(240px, 1fr);
        gap: var(--q-ft-gap-sm);
        display: grid;
        padding-top: 46px; /* room for badges + rail */
        position: relative;
      }

      /* horizontal rail ONLY here (prevents full-viewport bleed) */
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline--connect-line::before,
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline--connect-dots::before{
        content:"";
        position:absolute;
        left: calc(var(--q-ft-marker) / 2);
        right: calc(var(--q-ft-marker) / 2);
        top: calc(46px - (var(--q-ft-marker) / 2));
        height: var(--q-ft-rail-w);
        background: var(--q-ft-rail);
        z-index: 1;
      }
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline--connect-dots::before{
        background: repeating-linear-gradient(
          to right,
          var(--q-ft-rail) 0px,
          var(--q-ft-rail) 10px,
          transparent 10px,
          transparent 18px
        );
      }
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline--connect-none::before{ content:none !important; }

      /* horizontal items: badge above card */
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline__item{
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        row-gap: 12px;
      }
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline__index{
        margin: 0 auto;
      }

      /* hide vertical connectors in horizontal layout */
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline__item::before{
        content:none !important;
      }

      /* nicer scrollbar */
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline-wrap::-webkit-scrollbar{ height: 10px; }
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline-wrap::-webkit-scrollbar-thumb{
        background: color-mix(in srgb, var(--q-ft-muted) 22%, transparent);
        border-radius: 999px;
      }
      #q-ft-{{ section.id }}.q-fulfillment-timeline--horizontal .q-timeline-wrap::-webkit-scrollbar-track{
        background: transparent;
      }
    }
  </style>
</section>
{%- endif -%}


{% schema %}
{
  "name": "3P - Fulfillment Timeline",
  "class": "q-section-wrap q-section-wrap--fulfillment-timeline",
  "settings": [
    { "type": "checkbox", "id": "enable_section", "label": "Enable section", "default": true },
    { "type": "text", "id": "aria_label", "label": "Section aria-label", "default": "Fulfillment workflow timeline" },

    { "type": "text", "id": "kicker", "label": "Kicker", "default": "How your order moves" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "From order to delivery" },
    { "type": "richtext", "id": "body", "label": "Intro text", "default": "<p>Here’s what to expect once you place your order, from initial processing to final delivery.</p>" },

    { "type": "checkbox", "id": "show_lead_time", "label": "Show current typical lead time", "default": true },
    { "type": "text", "id": "lead_time_label", "label": "Lead time label", "default": "Current typical lead time" },
    { "type": "text", "id": "lead_time_value", "label": "Lead time value", "default": "4–6 weeks from order to delivery" },

    { "type": "select", "id": "layout_variant", "label": "Timeline layout", "default": "horizontal",
      "options": [
        { "value": "horizontal", "label": "Horizontal rail on desktop, vertical on mobile" },
        { "value": "vertical", "label": "Vertical stacked timeline" },
        { "value": "stacked", "label": "Steps as stacked cards (no connectors)" }
      ]
    },

    { "type": "select", "id": "align", "label": "Content alignment", "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },

    { "type": "select", "id": "background_style", "label": "Background style", "default": "surface",
      "options": [
        { "value": "surface", "label": "Surface" },
        { "value": "contrast", "label": "Contrast" },
        { "value": "brand", "label": "Brand" }
      ]
    },

    { "type": "select", "id": "max_width", "label": "Max content width", "default": "lg",
      "options": [
        { "value": "sm", "label": "sm" },
        { "value": "md", "label": "md" },
        { "value": "lg", "label": "lg" }
      ]
    },

    { "type": "checkbox", "id": "show_divider", "label": "Show top divider", "default": false },

    { "type": "checkbox", "id": "show_step_index", "label": "Show step numbers", "default": true },
    { "type": "checkbox", "id": "show_step_duration", "label": "Show per-step timeframe", "default": true },

    { "type": "select", "id": "connector_style", "label": "Connector style", "default": "line",
      "options": [
        { "value": "line", "label": "Solid line between steps" },
        { "value": "dots", "label": "Dotted connector" },
        { "value": "none", "label": "No connector (cards only)" }
      ]
    },

    { "type": "text", "id": "sr_label_prefix", "label": "Screen reader label prefix", "default": "Fulfillment step" },

    { "type": "header", "content": "Style" },
    { "type": "range", "id": "card_radius", "label": "Card radius (px)", "min": 0, "max": 28, "step": 1, "default": 16 },
    { "type": "range", "id": "card_border_w", "label": "Card border width (px)", "min": 0, "max": 3, "step": 1, "default": 1 },
    { "type": "select", "id": "card_shadow", "label": "Card shadow", "default": "md",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" }
      ]
    },
    { "type": "color", "id": "card_bg", "label": "Card background", "default": "#ffffff" },
    { "type": "color", "id": "card_border_color", "label": "Card border color", "default": "#e5e7eb" },
    { "type": "color", "id": "rail_color", "label": "Connector color", "default": "#d1d5db" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#111111" },
    { "type": "color", "id": "muted_text_color", "label": "Muted text color", "default": "#6b7280" },
    { "type": "color", "id": "accent_color", "label": "Highlight accent color", "default": "#111827" }
  ],
  "blocks": [
    {
      "type": "timeline_step",
      "name": "Timeline step",
      "limit": 10,
      "settings": [
        { "type": "text", "id": "step_title", "label": "Step title", "default": "Order placed" },
        { "type": "richtext", "id": "step_body", "label": "Step description", "default": "<p>Describe what happens in this step.</p>" },
        { "type": "text", "id": "step_duration", "label": "Estimated timeframe", "default": "1–2 business days" },
        { "type": "checkbox", "id": "is_key_step", "label": "Highlight this step", "default": false }
      ]
    }
  ],
  "presets": [
    {
      "name": "3rd Party - Fulfillment Workflow Timeline",
      "category": "3rd Party Integrations",
      "blocks": [
        { "type": "timeline_step", "settings": { "step_title": "Order placed", "step_duration": "Same day", "step_body": "<p>Once your order is submitted, it enters our fulfillment queue and you’ll receive a confirmation with the next steps.</p>", "is_key_step": false } },
        { "type": "timeline_step", "settings": { "step_title": "Order review & confirmation", "step_duration": "1–2 business days", "step_body": "<p>We review details like options, delivery location, and any special requirements. If anything needs clarification, we’ll reach out.</p>", "is_key_step": false } },
        { "type": "timeline_step", "settings": { "step_title": "Production & preparation", "step_duration": "2–4 weeks", "step_body": "<p>Your build is produced or prepared for shipment. Lead time varies by season, customization level, and current production volume.</p>", "is_key_step": true } },
        { "type": "timeline_step", "settings": { "step_title": "Shipping & transit", "step_duration": "3–7 business days", "step_body": "<p>Once the item ships, it moves through carrier transit. Timing can vary by distance, route availability, and weather conditions.</p>", "is_key_step": false } },
        { "type": "timeline_step", "settings": { "step_title": "Delivery & setup", "step_duration": "Scheduled with you", "step_body": "<p>We coordinate delivery timing based on your location and access needs. For larger items, site readiness can affect the final delivery window.</p>", "is_key_step": false } }
      ]
    }
  ]
}
{% endschema %}
