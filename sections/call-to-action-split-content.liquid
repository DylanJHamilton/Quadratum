{% comment %}
  Quadratum — Call To Action – Split Content (Enhanced)
  • Stackable mid-page CTA: side-by-side media + content (not a hero)
  • Layouts: media-left/right, mobile stacked; ratios: 40/60, 50/50, 60/40
  • Emphasis modes: Accent bar / Soft gradient
  • CTA variants: Solid / Outline / Link
  • Extras: Offer badge + subtext, optional trust note, subtle reveal motion
  • A11y: role=region (label falls back to heading), alt text, heading level
  • Tokens: theme tokens for colors/spacing/type; background only on root
  • Self-contained: NO external snippet dependencies
{% endcomment %}

{% assign s = section.settings %}

{% liquid
  # Ratios
  assign col_l = '1fr'
  assign col_r = '1fr'
  case s.ratio
    when '40-60'
      assign col_l = '2fr'
      assign col_r = '3fr'
    when '50-50'
      assign col_l = '1fr'
      assign col_r = '1fr'
    when '60-40'
      assign col_l = '3fr'
      assign col_r = '2fr'
  endcase

  # Order
  assign media_left = true
  if s.media_position == 'right'
    assign media_left = false
  endif

  # Spacing tokens
  assign pad_y_units = s.pad_y | default: 48
  assign pad_y_rem = pad_y_units | divided_by: 100.0

  # Background tokens
  assign root_bg = s.bg_color | default: 'transparent'
  assign ovc = s.bg_overlay_color | default: '#000000'
  assign ovo_pct = s.bg_overlay_opacity | default: 0
  assign ovo = ovo_pct | divided_by: 100.0

  # A11y
  assign region_label = s.region_label | default: s.heading | default: 'Promotional content'
  assign hlevel = s.heading_level | default: 'h2'

  # Alignment
  assign align_css = 'flex-start'
  assign text_align = 'left'
  if s.text_align == 'center'
    assign align_css = 'center'
    assign text_align = 'center'
  elsif s.text_align == 'end'
    assign align_css = 'flex-end'
    assign text_align = 'right'
  endif
%}

<section id="section-{{ section.id }}"
  class="q-cta-split-content"
  role="region"
  aria-label="{{ region_label | escape }}"
  style="
    --q-pad-y: {{ pad_y_rem }}rem;
    --q-col-left: {{ col_l }};
    --q-col-right: {{ col_r }};
    --q-align: {{ align_css }};
    --q-bg: {{ root_bg }};
  "
>
  <div class="q-root"
    {% if s.bg_image != blank %}
      style="--q-bg-img:url('{{ s.bg_image | image_url: width: 2048 }}'); --q-ovc: {{ ovc }}; --q-ovo: {{ ovo }};"
    {% endif %}
  >
    <div class="q-grid {% if media_left %}q-media-left{% else %}q-media-right{% endif %}">
      <!-- Media -->
      <div class="q-media">
        {% if s.media_type == 'image' %}
          {% if s.image != blank %}
            {{ s.image
              | image_url: width: 2048
              | image_tag:
                widths: '640,960,1280,1536,2048',
                sizes: '(min-width: 768px) 50vw, 100vw',
                loading: 'lazy',
                class: 'q-img',
                alt: s.image_alt | default: '' }}
          {% endif %}
        {% elsif s.media_type == 'video' %}
          {% if s.video_hosted != nil %}
            <video class="q-video"
                   playsinline muted loop
                   {% unless settings.reduce_motion_mode %}autoplay{% endunless %}
                   {% if s.video_poster != blank %}poster="{{ s.video_poster | image_url: width: 1536 }}"{% endif %}>
              <source src="{{ s.video_hosted | video_url }}" type="video/mp4">
            </video>
          {% endif %}
        {% elsif s.media_type == 'video_url' %}
          {% if s.video_external != blank %}
            <div class="q-embed">
              <iframe
                src="{{ s.video_external | escape }}"
                title="{{ s.heading | default: 'Video' | escape }}"
                loading="lazy"
                allow="autoplay; encrypted-media; picture-in-picture"
                allowfullscreen
                referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
          {% endif %}
        {% endif %}
      </div>

      <!-- Content -->
      <div class="q-content">
        <div class="q-inner" style="align-items: var(--q-align); text-align: {{ text_align }};">
          {% if s.show_offer %}
            <div class="q-offer">
              {% if s.offer_badge != blank %}<span class="q-offer-badge">{{ s.offer_badge }}</span>{% endif %}
              {% if s.offer_subtext != blank %}<span class="q-offer-sub">{{ s.offer_subtext }}</span>{% endif %}
            </div>
          {% endif %}

          {% if s.kicker != blank %}
            <p class="q-kicker">{{ s.kicker }}</p>
          {% endif %}

          {% if s.heading != blank %}
            {% if hlevel == 'h1' %}
              <h1 class="q-heading">{{ s.heading }}</h1>
            {% else %}
              <h2 class="q-heading">{{ s.heading }}</h2>
            {% endif %}
          {% endif %}

          {% if s.subheading != blank %}
            <p class="q-body">{{ s.subheading }}</p>
          {% endif %}

          <div class="q-ctas">
            <a class="q-btn q-btn--primary{% if s.cta_style == 'outline' %} q-btn--outline{% elsif s.cta_style == 'link' %} q-btn--link{% endif %}"
               href="{{ s.primary_link | default: '/collections/all' }}"
               data-cta="primary"
               aria-label="{{ s.primary_label | default: 'Shop the Collection' | escape }}">
              <span>{{ s.primary_label | default: 'Shop the Collection' }}</span>
            </a>
            {% if s.secondary_link != blank or s.secondary_label != blank %}
              <a class="q-btn q-btn--secondary"
                 href="{{ s.secondary_link | default: '/pages/about' }}"
                 data-cta="secondary"
                 aria-label="{{ s.secondary_label | default: 'Learn More' | escape }}">
                <span>{{ s.secondary_label | default: 'Learn More' }}</span>
              </a>
            {% endif %}

            {% if s.show_trust and s.trust_text != blank %}
              <div class="q-trust" aria-live="polite">{{ s.trust_text }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    #section-{{ section.id }} { position: relative; }
    #section-{{ section.id }} .q-root{
      position: relative;
      background-color: var(--q-bg);
      padding-block: var(--q-pad-y);
      overflow: clip;
    }
    {% if s.bg_image != blank %}
    #section-{{ section.id }} .q-root::before{
      content:""; position:absolute; inset:0; z-index:0;
      background-image: var(--q-bg-img);
      background-size: cover; background-position: center; background-repeat: no-repeat;
    }
    #section-{{ section.id }} .q-root::after{
      content:""; position:absolute; inset:0; z-index:0;
      background-color: var(--q-ovc, transparent);
      opacity: var(--q-ovo, 0);
    }
    {% endif %}

    #section-{{ section.id }} .q-grid{
      position: relative; z-index: 1;
      display: grid; gap: 0;
      grid-template-columns: var(--q-col-left) var(--q-col-right);
      align-items: stretch;
      max-width: {{ settings.container_lg | default: 1152 }}px;
      margin-inline: auto;
    }
    @media (max-width: 767.98px){
      #section-{{ section.id }} .q-grid{ grid-template-columns: 1fr; }
    }

    /* Order swap */
    #section-{{ section.id }} .q-media-left .q-media{ order: 1; }
    #section-{{ section.id }} .q-media-left .q-content{ order: 2; }
    #section-{{ section.id }} .q-media-right .q-media{ order: 2; }
    #section-{{ section.id }} .q-media-right .q-content{ order: 1; }

    /* Media */
    #section-{{ section.id }} .q-media{ min-height: 280px; }
    #section-{{ section.id }} .q-img{ width:100%; height:100%; object-fit:cover; display:block; }
    #section-{{ section.id }} .q-video{ width:100%; height:100%; object-fit:cover; display:block; }
    #section-{{ section.id }} .q-embed{ position:relative; width:100%; padding-top:56.25%; }
    #section-{{ section.id }} .q-embed iframe{
      position:absolute; inset:0; width:100%; height:100%; border:0; display:block;
    }

    /* Content */
    #section-{{ section.id }} .q-content{ display:flex; align-items:center; justify-content: var(--q-align); position: relative; }
    #section-{{ section.id }} .q-inner{
      padding: 1.25rem;
      max-width: 58ch;
      width: 100%;
      opacity: 0; transform: translateY(8px);
      animation: q-cta-fade-up .4s ease forwards;
    }
    @media (min-width: 768px){
      #section-{{ section.id }} .q-inner{ padding: 2rem; }
    }
    @media (prefers-reduced-motion: reduce){
      #section-{{ section.id }} .q-inner{ opacity:1; transform:none; animation:none; }
    }
    @keyframes q-cta-fade-up{ to { opacity:1; transform:none; } }

    /* Emphasis modes */
    {% if s.highlight_mode == 'bar' %}
    #section-{{ section.id }} .q-content::before{
      content:""; position:absolute; left:0; top:0; bottom:0; width:4px;
      background: {{ s.highlight_color | default: settings.color_primary | default: '#2563eb' }};
      border-radius: 2px;
    }
    {% elsif s.highlight_mode == 'gradient' %}
    #section-{{ section.id }} .q-content::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background: linear-gradient(90deg,
        {{ s.highlight_color | default: settings.color_primary | default: '#2563eb' }}1a 0%,
        transparent 42%);
    }
    {% endif %}

    /* Offer row */
    #section-{{ section.id }} .q-offer{
      display:flex; align-items:center; gap:.5rem; margin: 0 0 .5rem 0;
    }
    #section-{{ section.id }} .q-offer-badge{
      display:inline-flex; align-items:center; padding:.25rem .5rem;
      font-weight:700; font-size:.76rem; letter-spacing:.02em; text-transform:uppercase;
      color: {{ settings.text_on_color | default: '#ffffff' }};
      background: {{ s.highlight_color | default: settings.color_primary | default: '#2563eb' }};
      border-radius: 999px;
    }
    #section-{{ section.id }} .q-offer-sub{
      color: {{ settings.text_muted | default: '#6b7280' }};
      font-size:.9rem; font-weight:600;
    }

    /* Type */
    #section-{{ section.id }} .q-kicker{
      margin:0 0 .25rem 0; font-weight:600; letter-spacing:.04em; text-transform:uppercase;
      color: {{ settings.text_muted | default: '#6b7280' }};
      font-size: .9rem;
    }
    #section-{{ section.id }} .q-heading{
      margin:0 0 .5rem 0; line-height:1.2; font-weight:700;
      color: {{ settings.text_base | default: '#111111' }};
      font-family: var(--font-heading, inherit);
      font-size: calc({{ settings.type_h2_size | default: 200 }} * 0.01rem);
    }
    #section-{{ section.id }} .q-body{
      margin:0 0 1rem 0; line-height:1.6;
      color: {{ settings.text_muted | default: '#6b7280' }};
      font-size: 1rem;
    }

    /* Buttons (tokenized) */
    #section-{{ section.id }} .q-ctas{ display:flex; gap:.75rem; flex-wrap:wrap; align-items:center; }
    #section-{{ section.id }} .q-btn{
      appearance:none; text-decoration:none; display:inline-flex; align-items:center; justify-content:center;
      padding:.75rem 1.125rem; border-radius: {{ settings.button_radius | default: 12 }}px;
      border-width: {{ settings.button_border_width | default: 1 }}px; border-style: solid;
      transition: transform .12s ease, opacity .12s ease;
      font-weight: 600;
    }
    #section-{{ section.id }} .q-btn--primary{
      background: {{ settings.color_primary | default: '#2563eb' }};
      color: {{ settings.text_on_color | default: '#ffffff' }};
      border-color: transparent;
    }
    #section-{{ section.id }} .q-btn--secondary{
      background: transparent;
      color: {{ settings.color_secondary | default: '#111827' }};
      border-color: currentColor;
    }
    #section-{{ section.id }} .q-btn--outline{
      background: transparent;
      color: {{ settings.color_secondary | default: '#111827' }};
      border-color: currentColor;
    }
    #section-{{ section.id }} .q-btn--link{
      background: transparent; border-color: transparent; padding: .25rem 0;
      color: {{ settings.color_secondary | default: '#111827' }};
      font-weight: 700;
    }
    #section-{{ section.id }} .q-btn--link span{ position:relative; padding-right:1.25rem; }
    #section-{{ section.id }} .q-btn--link span::after{
      content:"→"; position:absolute; right:0; top:0; transform: translateX(0);
      transition: transform .15s ease;
    }
    #section-{{ section.id }} .q-btn:focus-visible{ outline:2px solid rgba(0,0,0,.45); outline-offset:2px; }
    #section-{{ section.id }} .q-btn:hover{ opacity: calc({{ settings.button_hover_opacity | default: 92 }} / 100); }
    #section-{{ section.id }} .q-btn:active{ transform: scale(calc({{ settings.button_active_scale | default: 98 }} / 100)); }
    #section-{{ section.id }} .q-btn--link:hover span::after{ transform: translateX(2px); }

    /* Trust line */
    #section-{{ section.id }} .q-trust{
      margin-top:.5rem; font-size:.9rem; color: {{ settings.text_muted | default: '#6b7280' }};
    }
  </style>
</section>

{% schema %}
{
  "name": "CTA – Split Content",
  "tag": "section",
  "class": "q-cta-split-content",
  "settings": [
    { "type": "header", "content": "Content" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "New Arrival" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Effortless Style Meets Function." },
    { "type": "select", "id": "heading_level", "label": "Heading level", "default": "h2", "options": [
      { "value": "h1", "label": "H1" },
      { "value": "h2", "label": "H2" }
    ]},
    { "type": "textarea", "id": "subheading", "label": "Body text", "default": "Experience design that adapts to your lifestyle — simple, clean, and modern." },
    { "type": "select", "id": "text_align", "label": "Text alignment", "default": "start", "options": [
      { "value": "start", "label": "Start" },
      { "value": "center", "label": "Center" },
      { "value": "end", "label": "End" }
    ]},

    { "type": "header", "content": "Primary CTA" },
    { "type": "text", "id": "primary_label", "label": "Primary label", "default": "Shop the Collection" },
    { "type": "url", "id": "primary_link", "label": "Primary link" },

    { "type": "header", "content": "Secondary CTA (optional)" },
    { "type": "text", "id": "secondary_label", "label": "Secondary label", "default": "Learn More" },
    { "type": "url", "id": "secondary_link", "label": "Secondary link" },

    { "type": "header", "content": "Media" },
    { "type": "select", "id": "media_type", "label": "Media type", "default": "image", "options": [
      { "value": "image", "label": "Image" },
      { "value": "video_url", "label": "YouTube/Vimeo" },
      { "value": "video", "label": "Hosted video" }
    ]},
    { "type": "image_picker", "id": "image", "label": "Image" },
    { "type": "text", "id": "image_alt", "label": "Image alt text", "default": "Lifestyle imagery" },
    { "type": "video_url", "id": "video_external", "label": "Video URL (YouTube/Vimeo)", "accept": ["youtube", "vimeo"] },
    { "type": "video", "id": "video_hosted", "label": "Hosted video" },
    { "type": "image_picker", "id": "video_poster", "label": "Video poster (optional)" },

    { "type": "header", "content": "Layout" },
    { "type": "select", "id": "media_position", "label": "Media position", "default": "left", "options": [
      { "value": "left", "label": "Media left" },
      { "value": "right", "label": "Media right" }
    ]},
    { "type": "select", "id": "ratio", "label": "Column ratio", "default": "50-50", "options": [
      { "value": "40-60", "label": "40 / 60" },
      { "value": "50-50", "label": "50 / 50" },
      { "value": "60-40", "label": "60 / 40" }
    ]},
    { "type": "range", "id": "pad_y", "label": "Section padding top/bottom (rem ×100)", "min": 0, "max": 96, "step": 2, "default": 48 },

    { "type": "header", "content": "Section Background" },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#f6f7f8" },
    { "type": "image_picker", "id": "bg_image", "label": "Background image (optional)" },
    { "type": "color", "id": "bg_overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "bg_overlay_opacity", "label": "Overlay opacity (%)", "min": 0, "max": 90, "step": 1, "default": 12 },

    { "type": "header", "content": "CTA Enhancements" },
    { "type": "select", "id": "cta_style", "label": "Primary CTA style", "default": "solid", "options": [
      { "value": "solid", "label": "Solid (brand)" },
      { "value": "outline", "label": "Outline" },
      { "value": "link", "label": "Link (text + arrow)" }
    ]},
    { "type": "select", "id": "highlight_mode", "label": "Emphasis style", "default": "none", "options": [
      { "value": "none", "label": "None" },
      { "value": "bar", "label": "Accent bar (content side)" },
      { "value": "gradient", "label": "Soft gradient (content side)" }
    ]},
    { "type": "color", "id": "highlight_color", "label": "Emphasis color", "default": "#2563eb" },

    { "type": "checkbox", "id": "show_offer", "label": "Show offer row", "default": false },
    { "type": "text", "id": "offer_badge", "label": "Offer badge", "default": "Limited Time" },
    { "type": "text", "id": "offer_subtext", "label": "Offer subtext", "default": "Free shipping today only" },

    { "type": "checkbox", "id": "show_trust", "label": "Show trust note", "default": false },
    { "type": "text", "id": "trust_text", "label": "Trust note", "default": "Over 5,000 happy customers" },

    { "type": "header", "content": "Accessibility" },
    { "type": "text", "id": "region_label", "label": "Region label", "default": "Promotional content" }
  ],
  "presets": [
    {
      "name": "Call To Action – Split Content",
      "category": "Call To Action",
      "settings": {
        "kicker": "New Arrival",
        "heading": "Effortless Style Meets Function.",
        "subheading": "Experience design that adapts to your lifestyle — simple, clean, and modern.",
        "primary_label": "Shop the Collection",
        "primary_link": "/collections/all",
        "secondary_label": "Learn More",
        "secondary_link": "/pages/about",
        "media_type": "image",
        "media_position": "left",
        "ratio": "50-50",
        "pad_y": 48,
        "bg_color": "#f6f7f8",
        "bg_overlay_opacity": 12,
        "cta_style": "solid",
        "highlight_mode": "bar",
        "highlight_color": "#2563eb",
        "show_offer": true,
        "offer_badge": "Limited Time",
        "offer_subtext": "Free shipping today only",
        "show_trust": true,
        "trust_text": "Over 5,000 happy customers"
      }
    }
  ]
}
{% endschema %}
