{% comment %}
  Quadratum — 3rd Party: Referral / Rewards Program CTA
  File: sections/3p-referral-rewards-cta.liquid

  - Frontend CTA only (no app logic)
  - Fully styleable via section settings + theme token fallbacks
  - Preset category must be: 3rd Party Integrations
{% endcomment %}

{%- assign s = section.settings -%}

{%- if s.enable_section -%}

  {%- assign pad_y = s.padding_y | default: 56 | divided_by: 10.0 -%}
  {%- assign pad_x = s.padding_x | default: 24 | divided_by: 10.0 -%}

  {%- assign radius = s.card_radius | default: 16 -%}

  {%- assign cols = s.benefit_columns_desktop | default: '2' -%}

  {%- assign heading_fs = 'clamp(1.35rem, 2.2vw, 2.0rem)' -%}
  {%- case s.heading_size -%}
    {%- when 'sm' -%}{%- assign heading_fs = 'clamp(1.2rem, 1.8vw, 1.6rem)' -%}
    {%- when 'lg' -%}{%- assign heading_fs = 'clamp(1.6rem, 2.7vw, 2.4rem)' -%}
    {%- else -%}{%- assign heading_fs = 'clamp(1.35rem, 2.2vw, 2.0rem)' -%}
  {%- endcase -%}

  {%- assign shadow_css = '0 10px 30px rgba(0,0,0,.08)' -%}
  {%- case s.card_shadow -%}
    {%- when 'none' -%}{%- assign shadow_css = 'none' -%}
    {%- when 'sm' -%}{%- assign shadow_css = '0 2px 10px rgba(0,0,0,.06)' -%}
    {%- when 'lg' -%}{%- assign shadow_css = '0 18px 55px rgba(0,0,0,.12)' -%}
    {%- else -%}{%- assign shadow_css = '0 10px 30px rgba(0,0,0,.08)' -%}
  {%- endcase -%}

  {%- comment -%}
    Theme-token fallbacks:
    - If your Quadratum global vars differ, you can adjust these once centrally later.
  {%- endcomment -%}
  {%- assign v_bg        = 'var(--q-surface, #ffffff)' -%}
  {%- assign v_card_bg   = 'var(--q-surface, #ffffff)' -%}
  {%- assign v_text      = 'var(--q-text, #111111)' -%}
  {%- assign v_muted     = 'var(--q-muted, #6b7280)' -%}
  {%- assign v_accent    = 'var(--q-primary, #111111)' -%}
  {%- assign v_border    = 'var(--q-border, #e5e7eb)' -%}
  {%- assign v_highlight = 'var(--q-soft, #f3f4f6)' -%}

  {%- if s.use_custom_colors -%}
    {%- assign v_bg        = s.custom_bg_color -%}
    {%- assign v_card_bg   = s.custom_card_bg_color -%}
    {%- assign v_text      = s.custom_text_color -%}
    {%- assign v_muted     = s.custom_muted_text_color -%}
    {%- assign v_accent    = s.custom_accent_color -%}
    {%- assign v_border    = s.custom_border_color -%}
    {%- assign v_highlight = s.custom_highlight_bg_color -%}
  {%- endif -%}

  {%- assign has_primary = false -%}
  {%- if s.primary_button_label != blank and s.primary_button_url != blank -%}
    {%- assign has_primary = true -%}
  {%- endif -%}

  {%- assign has_secondary = false -%}
  {%- if s.secondary_button_label != blank and s.secondary_button_url != blank -%}
    {%- assign has_secondary = true -%}
  {%- endif -%}

  {%- assign has_actions = false -%}
  {%- if has_primary or has_secondary -%}
    {%- assign has_actions = true -%}
  {%- endif -%}

<section
  class="q-section q-section--referral-cta q-section--bg-{{ s.background_style }} q-referral-cta q-referral-cta--{{ s.layout_style }} q-referral-cta--program-{{ s.program_type }}"
  aria-label="{{ s.aria_label | escape }}"
  style="
    --q-ref-pad-y: {{ pad_y }}rem;
    --q-ref-pad-x: {{ pad_x }}rem;
    --q-ref-radius: {{ radius }}px;
    --q-ref-heading-fs: {{ heading_fs }};
    --q-ref-shadow: {{ shadow_css }};
    --q-ref-cols: {{ cols }};
    --q-ref-bg: {{ v_bg }};
    --q-ref-card-bg: {{ v_card_bg }};
    --q-ref-text: {{ v_text }};
    --q-ref-muted: {{ v_muted }};
    --q-ref-accent: {{ v_accent }};
    --q-ref-border: {{ v_border }};
    --q-ref-highlight: {{ v_highlight }};
  "
>
  <div class="q-section__inner q-section__inner--{{ s.max_width }} q-referral-cta__inner q-align-{{ s.align }}">

    {%- assign wrap_card = false -%}
    {%- if s.layout_style == 'card' -%}{%- assign wrap_card = true -%}{%- endif -%}

    {%- if wrap_card -%}
      <div class="q-referral-cta__card{% if s.show_border %} is-bordered{% endif %}">
    {%- endif -%}

      <div class="q-referral-cta__grid{% if s.layout_style == 'hero' %} is-hero{% endif %}">
        <div class="q-referral-cta__content">

          {%- if s.show_badge and s.badge_text != blank -%}
            <div class="q-referral-cta__badge">
              <span class="q-referral-cta__badge-pill">{{ s.badge_text | escape }}</span>
            </div>
          {%- endif -%}

          {%- if s.kicker != blank -%}
            <p class="q-referral-cta__kicker">{{ s.kicker | escape }}</p>
          {%- endif -%}

          {%- if s.heading != blank -%}
            <h2 class="q-referral-cta__heading">{{ s.heading | escape }}</h2>
          {%- endif -%}

          {%- if s.body != blank -%}
            <div class="q-referral-cta__body">
              {{ s.body }}
            </div>
          {%- endif -%}

          {%- if s.reward_highlight != blank -%}
            <p class="q-referral-cta__highlight">{{ s.reward_highlight | escape }}</p>
          {%- endif -%}

          {%- assign benefit_blocks = section.blocks | where: 'type', 'benefit' -%}
          {%- if benefit_blocks.size > 0 -%}
            <div class="q-referral-cta__benefits" role="list">
              {%- for block in benefit_blocks -%}
                {%- assign b = block.settings -%}
                <div class="q-referral-cta__benefit" role="listitem" {{ block.shopify_attributes }}>
                  <div class="q-referral-cta__benefit-icon" aria-hidden="true">
                    <span data-icon="{{ b.icon_hint | escape }}"></span>
                  </div>
                  <div class="q-referral-cta__benefit-copy">
                    {%- if b.title != blank -%}
                      <h3 class="q-referral-cta__benefit-title">{{ b.title | escape }}</h3>
                    {%- endif -%}
                    {%- if b.body != blank -%}
                      <p class="q-referral-cta__benefit-body">{{ b.body | escape }}</p>
                    {%- endif -%}
                  </div>
                </div>
              {%- endfor -%}
            </div>
          {%- endif -%}

        </div>

        {%- if has_actions -%}
          <div class="q-referral-cta__actions">
            {%- if has_primary -%}
              <a
                href="{{ s.primary_button_url }}"
                class="q-btn q-btn--primary q-referral-cta__btn q-referral-cta__btn--primary"
                {% if s.open_in_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
              >
                <span>{{ s.primary_button_label | escape }}</span>
              </a>
            {%- endif -%}

            {%- if has_secondary -%}
              <a
                href="{{ s.secondary_button_url }}"
                class="q-btn q-btn--secondary q-btn--ghost q-referral-cta__btn q-referral-cta__btn--secondary"
                {% if s.open_in_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
              >
                <span>{{ s.secondary_button_label | escape }}</span>
              </a>
            {%- endif -%}
          </div>
        {%- endif -%}

      </div>

    {%- if wrap_card -%}
      </div>
    {%- endif -%}

  </div>

  <style>
    /* ===== Scoped styles (Quadratum-grade defaults) ===== */
    .q-section--referral-cta{
      padding: var(--q-ref-pad-y) var(--q-ref-pad-x);
      color: var(--q-ref-text);
    }

    /* Alignment helpers */
    .q-section--referral-cta .q-align-left{ text-align:left; }
    .q-section--referral-cta .q-align-center{ text-align:center; }

    /* Card wrapper (only in card layout) */
    .q-section--referral-cta .q-referral-cta__card{
      background: var(--q-ref-card-bg);
      border-radius: var(--q-ref-radius);
      box-shadow: var(--q-ref-shadow);
      padding: clamp(1rem, 2vw, 1.5rem);
      position: relative;
      overflow: hidden;
      border: 1px solid transparent;
    }
    .q-section--referral-cta .q-referral-cta__card.is-bordered{
      border-color: var(--q-ref-border);
      box-shadow: none;
    }

    /* Layout grid */
    .q-section--referral-cta .q-referral-cta__grid{
      display: grid;
      gap: clamp(1rem, 2.5vw, 1.75rem);
      align-items: start;
    }
    @media (min-width: 900px){
      .q-section--referral-cta .q-referral-cta__grid{
        grid-template-columns: 1.3fr .7fr;
        gap: clamp(1.25rem, 3vw, 2.25rem);
      }
      .q-section--referral-cta.q-referral-cta--strip .q-referral-cta__grid{
        grid-template-columns: 1.4fr .6fr;
      }
      .q-section--referral-cta.q-referral-cta--hero .q-referral-cta__grid.is-hero{
        grid-template-columns: 1.35fr .65fr;
      }
    }

    /* Hero spacing bump */
    .q-section--referral-cta.q-referral-cta--hero{
      padding-top: calc(var(--q-ref-pad-y) * 1.15);
      padding-bottom: calc(var(--q-ref-pad-y) * 1.15);
    }

    /* Badge / kicker / headings */
    .q-section--referral-cta .q-referral-cta__badge{ margin-bottom: .35rem; }
    .q-section--referral-cta .q-referral-cta__badge-pill{
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: .35rem .65rem;
      border-radius: 999px;
      background: var(--q-ref-highlight);
      border: 1px solid var(--q-ref-border);
      color: var(--q-ref-text);
      font-size: .85rem;
      line-height: 1;
      font-weight: 600;
    }

    .q-section--referral-cta .q-referral-cta__kicker{
      margin: 0 0 .35rem 0;
      color: var(--q-ref-muted);
      font-weight: 700;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: .78rem;
    }

    .q-section--referral-cta .q-referral-cta__heading{
      margin: 0 0 .6rem 0;
      font-size: var(--q-ref-heading-fs);
      line-height: 1.1;
      letter-spacing: -0.02em;
    }

    .q-section--referral-cta .q-referral-cta__body{
      color: var(--q-ref-muted);
      margin: 0;
    }
    .q-section--referral-cta .q-referral-cta__body p{ margin: 0 0 .75rem 0; }
    .q-section--referral-cta .q-referral-cta__body p:last-child{ margin-bottom: 0; }

    .q-section--referral-cta .q-referral-cta__highlight{
      margin: .85rem 0 0 0;
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .5rem .7rem;
      border-radius: 999px;
      background: var(--q-ref-highlight);
      border: 1px solid var(--q-ref-border);
      color: var(--q-ref-text);
      font-weight: 650;
      font-size: .95rem;
    }

    /* Benefits grid */
    .q-section--referral-cta .q-referral-cta__benefits{
      margin-top: 1rem;
      display: grid;
      gap: .75rem;
      grid-template-columns: 1fr;
    }
    @media (min-width: 700px){
      .q-section--referral-cta .q-referral-cta__benefits{
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (min-width: 1050px){
      .q-section--referral-cta .q-referral-cta__benefits{
        grid-template-columns: repeat(var(--q-ref-cols), minmax(0, 1fr));
      }
    }

    .q-section--referral-cta .q-referral-cta__benefit{
      display: grid;
      grid-template-columns: 36px 1fr;
      gap: .75rem;
      align-items: start;
      padding: .9rem .95rem;
      border-radius: calc(var(--q-ref-radius) * .75);
      background: rgba(255,255,255,.0);
      border: 1px solid var(--q-ref-border);
    }

    .q-section--referral-cta .q-referral-cta__benefit-icon{
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: color-mix(in srgb, var(--q-ref-accent) 14%, transparent);
      border: 1px solid color-mix(in srgb, var(--q-ref-accent) 25%, var(--q-ref-border));
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .q-section--referral-cta .q-referral-cta__benefit-icon span{
      display:block;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--q-ref-accent);
      opacity: .9;
    }

    .q-section--referral-cta .q-referral-cta__benefit-title{
      margin: 0 0 .2rem 0;
      font-size: 1rem;
      line-height: 1.2;
      font-weight: 750;
      letter-spacing: -0.01em;
    }
    .q-section--referral-cta .q-referral-cta__benefit-body{
      margin: 0;
      color: var(--q-ref-muted);
      font-size: .92rem;
      line-height: 1.35;
    }

    /* Actions */
    .q-section--referral-cta .q-referral-cta__actions{
      display: flex;
      flex-direction: column;
      gap: .6rem;
      align-items: stretch;
      justify-content: flex-start;
    }
    @media (min-width: 900px){
      .q-section--referral-cta .q-referral-cta__actions{
        align-items: {% if s.align == 'center' %}center{% else %}flex-start{% endif %};
      }
    }

    /* Button sizing + optional full-width mobile */
    .q-section--referral-cta .q-referral-cta__btn{
      width: 100%;
      justify-content: center;
      text-align: center;
      white-space: normal;
    }
    @media (min-width: 700px){
      .q-section--referral-cta .q-referral-cta__btn{
        width: auto;
        min-width: 14rem;
      }
    }
    {% if s.buttons_full_width_mobile == false %}
      .q-section--referral-cta .q-referral-cta__btn{ width: auto; }
    {% endif %}

    /* Strip layout: feels “intentional” */
    .q-section--referral-cta.q-referral-cta--strip{
      background: var(--q-ref-bg);
    }

    /* Program type nuance (subtle accent) */
    .q-section--referral-cta.q-referral-cta--program-referral .q-referral-cta__highlight{
      border-color: color-mix(in srgb, var(--q-ref-accent) 30%, var(--q-ref-border));
    }
    .q-section--referral-cta.q-referral-cta--program-loyalty .q-referral-cta__badge-pill{
      border-color: color-mix(in srgb, var(--q-ref-accent) 30%, var(--q-ref-border));
    }
    .q-section--referral-cta.q-referral-cta--program-hybrid .q-referral-cta__benefit-icon{
      background: color-mix(in srgb, var(--q-ref-accent) 18%, transparent);
    }
  </style>
</section>

{% endif %}

{% schema %}
{
  "name": "3rd Party - Referral CTA",
  "class": "q-section q-section--referral-cta",
  "settings": [
    { "type": "checkbox", "id": "enable_section", "label": "Enable section", "default": true },
    { "type": "text", "id": "aria_label", "label": "Section aria-label", "default": "Referral and rewards program" },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Refer friends. Earn rewards." },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Share the love, get rewarded" },
    { "type": "richtext", "id": "body", "label": "Body text", "default": "<p>Invite your friends and earn exclusive rewards, discounts, or store credit every time they make a purchase.</p>" },
    { "type": "text", "id": "reward_highlight", "label": "Reward highlight", "default": "Get $10 for every successful referral." },

    { "type": "header", "content": "Buttons" },
    { "type": "text", "id": "primary_button_label", "label": "Primary button label", "default": "Join rewards program" },
    { "type": "url", "id": "primary_button_url", "label": "Primary button link"},
    { "type": "text", "id": "secondary_button_label", "label": "Secondary button label", "default": "Already a member? Sign in" },
    { "type": "url", "id": "secondary_button_url", "label": "Secondary button link" },
    { "type": "checkbox", "id": "open_in_new_tab", "label": "Open links in a new tab", "default": false },

    { "type": "header", "content": "Layout" },
    {
      "type": "select",
      "id": "program_type",
      "label": "Program emphasis",
      "default": "referral",
      "options": [
        { "value": "referral", "label": "Referral program" },
        { "value": "loyalty", "label": "Loyalty / points program" },
        { "value": "hybrid", "label": "Both referral and loyalty" }
      ]
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Layout style",
      "default": "card",
      "options": [
        { "value": "card", "label": "Card" },
        { "value": "strip", "label": "Strip" },
        { "value": "hero", "label": "Hero" }
      ]
    },
    {
      "type": "select",
      "id": "align",
      "label": "Content alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background style",
      "default": "brand_soft",
      "options": [
        { "value": "surface", "label": "Surface" },
        { "value": "contrast", "label": "Contrast" },
        { "value": "brand", "label": "Brand solid" },
        { "value": "brand_soft", "label": "Brand soft / tint" }
      ]
    },
    {
      "type": "select",
      "id": "max_width",
      "label": "Max content width",
      "default": "md",
      "options": [
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" }
      ]
    },
    { "type": "checkbox", "id": "show_border", "label": "Show subtle border", "default": false },

    { "type": "checkbox", "id": "show_badge", "label": "Show program badge pill", "default": true },
    { "type": "text", "id": "badge_text", "label": "Program badge text", "default": "Members get more" },

    { "type": "header", "content": "Design controls" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors (overrides theme)", "default": false },

    { "type": "color", "id": "custom_bg_color", "label": "Background color", "default": "#ffffff" },
    { "type": "color", "id": "custom_card_bg_color", "label": "Card background color", "default": "#ffffff" },
    { "type": "color", "id": "custom_text_color", "label": "Text color", "default": "#111111" },
    { "type": "color", "id": "custom_muted_text_color", "label": "Muted text color", "default": "#6b7280" },
    { "type": "color", "id": "custom_accent_color", "label": "Accent color", "default": "#111111" },
    { "type": "color", "id": "custom_border_color", "label": "Border color", "default": "#e5e7eb" },
    { "type": "color", "id": "custom_highlight_bg_color", "label": "Highlight background", "default": "#f3f4f6" },

    { "type": "range", "id": "padding_y", "label": "Section padding Y (rem ×10)", "min": 0, "max": 120, "step": 2, "default": 56 },
    { "type": "range", "id": "padding_x", "label": "Section padding X (rem ×10)", "min": 0, "max": 120, "step": 2, "default": 24 },

    { "type": "range", "id": "card_radius", "label": "Card radius (px)", "min": 0, "max": 32, "step": 1, "default": 16 },
    {
      "type": "select",
      "id": "card_shadow",
      "label": "Card shadow",
      "default": "md",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" }
      ]
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "md",
      "options": [
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" }
      ]
    },
    {
      "type": "select",
      "id": "benefit_columns_desktop",
      "label": "Benefit columns (desktop)",
      "default": "2",
      "options": [
        { "value": "2", "label": "2 columns" },
        { "value": "3", "label": "3 columns" },
        { "value": "4", "label": "4 columns" }
      ]
    },
    { "type": "checkbox", "id": "buttons_full_width_mobile", "label": "Buttons full-width on mobile", "default": true }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Benefit bullet",
      "limit": 4,
      "settings": [
        { "type": "text", "id": "title", "label": "Benefit title", "default": "Earn rewards on every referral" },
        { "type": "text", "id": "body", "label": "Short description", "default": "Share your unique link and earn rewards when friends complete their first purchase." },
        { "type": "text", "id": "icon_hint", "label": "Icon hint (optional)", "default": "star" }
      ]
    }
  ],
  "presets": [
    {
      "name": "3rd Party - Referral & Rewards CTA",
      "category": "3rd Party Integrations",
      "blocks": [
        {
          "type": "benefit",
          "settings": {
            "title": "Give $10, get $10",
            "body": "Your friend gets a reward on their first order and you earn store credit.",
            "icon_hint": "gift"
          }
        },
        {
          "type": "benefit",
          "settings": {
            "title": "Members-only perks",
            "body": "Unlock exclusive discounts, early access, and special offers as you refer.",
            "icon_hint": "sparkles"
          }
        }
      ]
    }
  ]
}
{% endschema %}
