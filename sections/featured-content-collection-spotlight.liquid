{% comment %}
  Quadratum — Featured · Collection Highlights
  Editorial storytelling module (manual 2–6 collections)
  Reuses: collection-card snippet (no forks)

  PATCH:
  - Adds per-card CTA style: block.settings.cta_style -> snippet param cta_style
  - Adds global CTA style: section.settings.global_cta_style
{% endcomment %}

{% liquid
  assign requested_layout = section.settings.layout
  assign blocks = section.blocks | where: 'type', 'collection'
  assign count = blocks.size

  assign layout = requested_layout
  if layout == 'split' and count < 3
    assign layout = 'grid'
  endif

  assign anim = section.settings.animation
%}

<section
  class="q-section q-collection-highlights q-layout--{{ layout }} q-anim--{{ anim }}"
  style="
    --q-ch-pad-y: {{ section.settings.pad_y }}px;
    --q-ch-pad-x: {{ section.settings.pad_x }}px;
    --q-ch-maxw: {{ section.settings.max_width }}px;
    --q-ch-gap: {{ section.settings.gap }}px;
    --q-ch-radius: {{ section.settings.radius }}px;

    --q-ch-kicker-size: {{ section.settings.kicker_size }}px;
    --q-ch-heading-size: {{ section.settings.heading_size }}px;
    --q-ch-desc-size: {{ section.settings.desc_size }}px;

    --q-ch-card-title-size: {{ section.settings.card_title_size }}px;
    --q-ch-card-subtitle-size: {{ section.settings.card_subtitle_size }}px;
    --q-ch-card-body-size: {{ section.settings.card_body_size }}px;

    --q-ch-media-ratio: {{ section.settings.media_ratio }}%;
    --q-ch-media-fit: {{ section.settings.media_fit }};
    --q-ch-overlay-opacity: {{ section.settings.overlay_opacity | times: 0.01 }};

    {% if section.settings.use_custom_colors %}
      --q-ch-bg: {{ section.settings.bg_color }};
      --q-ch-text: {{ section.settings.text_color }};
      --q-ch-muted: {{ section.settings.muted_color }};
      --q-ch-accent: {{ section.settings.accent_color }};
      --q-ch-surface: {{ section.settings.surface_color }};
      --q-ch-border: {{ section.settings.border_color }};
      --q-ch-shadow-strength: {{ section.settings.shadow_strength }};
    {% endif %}
  "
>
  <style>
    /* ===============================
      Quadratum: Collection Highlights (scoped)
      - Drives snippet vars: --q-cc-media-auto, --q-cc-title-size, --q-cc-meta-size
      - Targets correct snippet classes: .q-collection-card__*
    =============================== */

    .q-collection-highlights{
      background: var(--q-ch-bg, var(--q-bg, transparent));
      color: var(--q-ch-text, var(--q-text, inherit));
      padding: var(--q-ch-pad-y) var(--q-ch-pad-x);

      /* Drive existing snippet variables (no fork) */
      --q-cc-media-auto: var(--q-ch-media-ratio);
      --q-cc-title-size: var(--q-ch-card-title-size);
      --q-cc-meta-size: var(--q-ch-card-subtitle-size);
    }

    .q-collection-highlights .q-ch__inner{
      max-width: var(--q-ch-maxw);
      margin: 0 auto;
    }

    .q-collection-highlights .q-section-header{
      margin-bottom: calc(var(--q-ch-gap) * 0.9);
    }

    .q-collection-highlights .q-kicker{
      font-size: var(--q-ch-kicker-size);
      color: var(--q-ch-muted, var(--q-muted, currentColor));
      margin: 0 0 6px;
    }

    .q-collection-highlights .q-heading{
      font-size: var(--q-ch-heading-size);
      line-height: 1.12;
      margin: 0 0 8px;
      letter-spacing: -0.01em;
    }

    .q-collection-highlights .q-description{
      font-size: var(--q-ch-desc-size);
      color: var(--q-ch-muted, var(--q-muted, currentColor));
      max-width: 72ch;
    }

    .q-collection-highlights__body{ display:block; }

    /* Split layout */
    .q-collection-highlights.q-layout--split .q-split{
      display:grid;
      grid-template-columns: 1.55fr 1fr;
      gap: var(--q-ch-gap);
      align-items: stretch;
    }
    .q-collection-highlights.q-layout--split .q-split__supporting{
      display:grid;
      gap: var(--q-ch-gap);
      grid-auto-rows: 1fr;
    }

    /* Grid layout */
    .q-collection-highlights.q-layout--grid .q-grid{
      display:grid;
      gap: var(--q-ch-gap);
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    @media (max-width: 989px){
      .q-collection-highlights.q-layout--split .q-split{ grid-template-columns: 1fr; }
      .q-collection-highlights.q-layout--grid .q-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 749px){
      .q-collection-highlights.q-layout--grid .q-grid{ grid-template-columns: 1fr; }
    }

    /* Carousel layout (CSS scroll snap) */
    .q-collection-highlights.q-layout--carousel .q-carousel{
      display:flex;
      gap: var(--q-ch-gap);
      overflow-x: auto;
      padding-bottom: 6px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .q-collection-highlights.q-layout--carousel .q-carousel > *{
      scroll-snap-align: start;
      flex: 0 0 auto;
      width: min(420px, 85vw);
    }

    /* Footer */
    .q-collection-highlights .q-section-footer{
      margin-top: calc(var(--q-ch-gap) * 1.0);
    }

    /* Card radius + media */
    .q-collection-highlights .q-collection-card{
      border-radius: var(--q-ch-radius);
    }
    .q-collection-highlights .q-collection-card__media{
      border-radius: var(--q-ch-radius);
      overflow: hidden;
    }
    .q-collection-highlights .q-collection-card__img{
      object-fit: var(--q-ch-media-fit);
    }

    /* Overlay opacity control */
    .q-collection-highlights .q-collection-card__overlay-inner{
      background: rgba(0,0,0,var(--q-ch-overlay-opacity));
    }

    /* Animation */
    @media (prefers-reduced-motion: reduce){
      .q-collection-highlights *{
        animation: none !important;
        transition: none !important;
      }
    }

    .q-collection-highlights.q-anim--fade .q-ch__anim{ animation: qchFade 520ms ease both; }
    .q-collection-highlights.q-anim--rise .q-ch__anim{ animation: qchRise 560ms ease both; }
    .q-collection-highlights.q-anim--zoom .q-ch__anim{ animation: qchZoom 560ms ease both; }

    @keyframes qchFade { from { opacity: 0 } to { opacity: 1 } }
    @keyframes qchRise { from { opacity: 0; transform: translateY(12px) } to { opacity: 1; transform: translateY(0) } }
    @keyframes qchZoom { from { opacity: 0; transform: scale(0.985) } to { opacity: 1; transform: scale(1) } }

    /* Ensure CTA link behaves like a true button */
    .q-collection-highlights .q-collection-card__cta-link{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .4rem;
      width: 100%;
      min-height: 44px;
      text-decoration: none;
    }
    .q-collection-highlights .q-collection-card__cta-link:focus-visible{
      outline: none;
      box-shadow: 0 0 0 3px rgba(0,0,0,.18);
    }
  </style>

  <div class="q-ch__inner q-ch__anim">
    {% if section.settings.show_header %}
      <header class="q-section-header">
        {% if section.settings.kicker != blank %}
          <p class="q-kicker">{{ section.settings.kicker }}</p>
        {% endif %}
        <h2 class="q-heading">{{ section.settings.heading }}</h2>
        {% if section.settings.description != blank %}
          <div class="q-description rte">{{ section.settings.description }}</div>
        {% endif %}
      </header>
    {% endif %}

    <div class="q-collection-highlights__body">
      {% if layout == 'carousel' %}
        <div class="q-carousel">
          {% for block in blocks %}
            {% assign c = block.settings.collection %}
            {% if c != blank %}
              {% render 'collection-card',
                collection: c,
                subtitle: block.settings.subtitle,
                body: block.settings.body,
                cta_label: block.settings.cta_label,
                cta_style: block.settings.cta_style,
                featured: false,
                modifier: 'editorial'
              %}
            {% endif %}
          {% endfor %}
        </div>

      {% elsif layout == 'split' %}
        {% assign hero = blocks.first %}
        {% assign supporting = blocks | slice: 1, 2 %}

        <div class="q-split">
          {% if hero.settings.collection != blank %}
            {% render 'collection-card',
              collection: hero.settings.collection,
              subtitle: hero.settings.subtitle,
              body: hero.settings.body,
              cta_label: hero.settings.cta_label,
              cta_style: hero.settings.cta_style,
              featured: true,
              modifier: 'editorial'
            %}
          {% endif %}

          <div class="q-split__supporting">
            {% for block in supporting %}
              {% if block.settings.collection != blank %}
                {% render 'collection-card',
                  collection: block.settings.collection,
                  subtitle: block.settings.subtitle,
                  body: block.settings.body,
                  cta_label: block.settings.cta_label,
                  cta_style: block.settings.cta_style,
                  featured: false,
                  modifier: 'editorial'
                %}
              {% endif %}
            {% endfor %}
          </div>
        </div>

      {% else %}
        <div class="q-grid">
          {% for block in blocks %}
            {% if block.settings.collection != blank %}
              {% render 'collection-card',
                collection: block.settings.collection,
                subtitle: block.settings.subtitle,
                body: block.settings.body,
                cta_label: block.settings.cta_label,
                cta_style: block.settings.cta_style,
                featured: false,
                modifier: 'editorial'
              %}
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>

    {% if section.settings.show_global_cta and section.settings.global_cta_link != blank %}
      <footer class="q-section-footer">
        <a href="{{ section.settings.global_cta_link }}" class="q-button q-button--{{ section.settings.global_cta_style }}">
          {{ section.settings.global_cta_label }}
        </a>
      </footer>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Featured Collection",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Layout mode",
      "default": "split",
      "options": [
        { "value": "split", "label": "Split row (featured + supporting)" },
        { "value": "grid", "label": "Uniform grid" },
        { "value": "carousel", "label": "Carousel (scroll-snap)" }
      ]
    },
    {
      "type": "select",
      "id": "animation",
      "label": "Entrance animation",
      "default": "none",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "fade", "label": "Fade" },
        { "value": "rise", "label": "Rise" },
        { "value": "zoom", "label": "Zoom" }
      ]
    },

    { "type": "header", "content": "Header content" },
    { "type": "checkbox", "id": "show_header", "label": "Show section header", "default": true },
    { "type": "text", "id": "kicker", "label": "Kicker" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Explore Our Collections" },
    { "type": "richtext", "id": "description", "label": "Description" },

    { "type": "header", "content": "Global CTA" },
    { "type": "checkbox", "id": "show_global_cta", "label": "Show global CTA", "default": false },
    { "type": "text", "id": "global_cta_label", "label": "Global CTA label", "default": "View all collections" },
    { "type": "url", "id": "global_cta_link", "label": "Global CTA link" },
    {
      "type": "select",
      "id": "global_cta_style",
      "label": "Global CTA style",
      "default": "primary",
      "options": [
        { "value": "primary", "label": "Primary" },
        { "value": "secondary", "label": "Secondary" },
        { "value": "outline", "label": "Outline" },
        { "value": "ghost", "label": "Ghost" },
        { "value": "link", "label": "Link" }
      ]
    },

    { "type": "header", "content": "Layout + spacing" },
    { "type": "range", "id": "max_width", "label": "Max width", "min": 960, "max": 1600, "step": 20, "default": 1240 },
    { "type": "range", "id": "pad_y", "label": "Padding Y", "min": 0, "max": 120, "step": 4, "default": 32 },
    { "type": "range", "id": "pad_x", "label": "Padding X", "min": 0, "max": 80, "step": 4, "default": 20 },
    { "type": "range", "id": "gap", "label": "Gap", "min": 8, "max": 48, "step": 2, "default": 18 },
    { "type": "range", "id": "radius", "label": "Card radius", "min": 0, "max": 28, "step": 2, "default": 16 },

    { "type": "header", "content": "Typography" },
    { "type": "range", "id": "kicker_size", "label": "Kicker size", "min": 10, "max": 20, "step": 1, "default": 12 },
    { "type": "range", "id": "heading_size", "label": "Heading size", "min": 20, "max": 64, "step": 1, "default": 36 },
    { "type": "range", "id": "desc_size", "label": "Description size", "min": 12, "max": 22, "step": 1, "default": 15 },
    { "type": "range", "id": "card_title_size", "label": "Card title size", "min": 14, "max": 34, "step": 1, "default": 20 },
    { "type": "range", "id": "card_subtitle_size", "label": "Card subtitle size", "min": 11, "max": 20, "step": 1, "default": 13 },
    { "type": "range", "id": "card_body_size", "label": "Card body size", "min": 12, "max": 22, "step": 1, "default": 14 },

    { "type": "header", "content": "Media" },
    { "type": "range", "id": "media_ratio", "label": "Media ratio (%)", "min": 60, "max": 160, "step": 1, "default": 90 },
    {
      "type": "select",
      "id": "media_fit",
      "label": "Media fit",
      "default": "cover",
      "options": [
        { "value": "cover", "label": "Cover" },
        { "value": "contain", "label": "Contain" }
      ]
    },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity (%)", "min": 0, "max": 60, "step": 1, "default": 18 },

    { "type": "header", "content": "Colors" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors", "default": false },
    { "type": "color", "id": "bg_color", "label": "Background color" },
    { "type": "color", "id": "text_color", "label": "Text color" },
    { "type": "color", "id": "muted_color", "label": "Muted text color" },
    { "type": "color", "id": "accent_color", "label": "Accent color" },
    { "type": "color", "id": "surface_color", "label": "Card surface color" },
    { "type": "color", "id": "border_color", "label": "Border color" },
    { "type": "range", "id": "shadow_strength", "label": "Shadow strength", "min": 0, "max": 1, "step": 0.1, "default": 0.2 }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        { "type": "collection", "id": "collection", "label": "Collection" },
        { "type": "text", "id": "subtitle", "label": "Subtitle" },
        { "type": "textarea", "id": "body", "label": "Body copy" },
        { "type": "text", "id": "cta_label", "label": "CTA label", "default": "Shop collection" },
        {
          "type": "select",
          "id": "cta_style",
          "label": "CTA style",
          "default": "primary",
          "options": [
            { "value": "primary", "label": "Primary" },
            { "value": "secondary", "label": "Secondary" },
            { "value": "outline", "label": "Outline" },
            { "value": "ghost", "label": "Ghost" },
            { "value": "link", "label": "Link" }
          ]
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    { "name": "Featured · Collection Highlights", "category": "Featured Content" }
  ]
}
{% endschema %}
