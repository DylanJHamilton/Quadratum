{% comment %}
  Quadratum • Split Banner (Pro)
  Tailwind fix:
  - Replaced dynamic Tailwind classes with inline styles:
    * bg-[{{ s.section_bg }}]  -> style="background-color: ..."
    * text-{{ s.text_alignment }} -> style="text-align: ..."
    * min-h-[*] tokens -> style="min-height: ..."
{% endcomment %}

{% liquid
  assign s = section.settings

  assign dir_classes = 'md:flex-row'
  if s.image_position == 'right'
    assign dir_classes = 'md:flex-row-reverse'
  endif

  assign mobile_order_img = 'order-1'
  assign mobile_order_content = 'order-2'
  if s.mobile_image_first == false
    assign mobile_order_img = 'order-2'
    assign mobile_order_content = 'order-1'
  endif

  assign container_pad = ''
  if s.container_mode == 'contained'
    assign container_pad = 'px-4 md:px-6'
  endif

  assign max_w = s.content_max_w | default: 'max-w-3xl'
  assign heading_level = s.heading_level | default: 'h2'

  assign visibility_classes = ''
  if s.hide_on_mobile
    assign visibility_classes = visibility_classes | append: ' hidden md:block'
  endif
  if s.hide_on_desktop
    assign visibility_classes = visibility_classes | append: ' md:hidden'
  endif

  # Map min_height select tokens to real CSS values (now using valid Liquid case/when)
  assign min_h_value = '60vh'
  case s.min_height
    when 'min-h-[40vh]'
      assign min_h_value = '40vh'
    when 'min-h-[50vh]'
      assign min_h_value = '50vh'
    when 'min-h-[60vh]'
      assign min_h_value = '60vh'
    when 'min-h-[75vh]'
      assign min_h_value = '75vh'
  endcase

  # Text alignment via inline style (avoid dynamic Tailwind classes)
  assign text_align_value = 'left'
  case s.text_alignment
    when 'center'
      assign text_align_value = 'center'
    when 'right'
      assign text_align_value = 'right'
  endcase

  assign desc_id = 'split-desc-' | append: section.id
%}

<section id="{{ s.anchor_id | default: 'section-' | append: section.id }}"
         class="q-split-banner{{ visibility_classes }}"
         role="region"
         aria-label="{{ s.region_label | default: 'Promotional banner' }}"
         data-q-observe="reveal"
         style="min-height: {{ min_h_value }}; background-color: {{ s.section_bg | default: 'transparent' }};">

  <div class="w-full mx-auto {{ container_pad }}">
    <div class="flex flex-col {{ dir_classes }} items-stretch gap-0">

      <div class="w-full md:w-1/2 relative {{ mobile_order_img }}">
        {% if s.mobile_image != blank %}
          <div class="md:hidden">
            {{ s.mobile_image
              | image_url: width: 1536
              | image_tag:
                widths: '640,960,1280,1536',
                sizes: '100vw',
                loading: 'eager',
                fetchpriority: 'high',
                class: 'w-full h-full object-cover',
                alt: s.mobile_image_alt | default: '' }}
          </div>
          <div class="hidden md:block">
            {{ s.image
              | image_url: width: 2048
              | image_tag:
                widths: '960,1280,1536,2048',
                sizes: '(min-width: 768px) 50vw, 100vw',
                loading: 'eager',
                fetchpriority: 'high',
                class: 'w-full h-full object-cover',
                alt: s.image_alt | default: '' }}
          </div>
        {% else %}
          {% if s.image != blank %}
            {{ s.image
              | image_url: width: 2048
              | image_tag:
                widths: '640,960,1280,1536,2048',
                sizes: '(min-width: 768px) 50vw, 100vw',
                loading: 'eager',
                fetchpriority: 'high',
                class: 'w-full h-full object-cover',
                alt: s.image_alt | default: '' }}
          {% endif %}
        {% endif %}

        {% if s.image_caption != blank %}
          <figcaption class="absolute bottom-2 right-2 text-[11px] bg-black/40 text-white px-2 py-1 rounded">
            {{ s.image_caption }}
          </figcaption>
        {% endif %}
      </div>

      <div class="w-full md:w-1/2 flex {{ mobile_order_content }}">
        <div class="flex flex-col justify-center w-full {{ max_w }} {{ s.content_pad_y | default: 'py-12 md:py-16' }} {{ s.content_pad_x | default: 'px-6 md:px-10' }}"
             style="background-color: {{ s.content_bg_color }}; text-align: {{ text_align_value }};">

          {%- if s.kicker != blank -%}
            <p class="uppercase tracking-wide mb-2 font-semibold text-{{ s.kicker_size | default: 'sm' }}" style="color: {{ s.kicker_color | default: '#111827' }};">
              {{ s.kicker }}
            </p>
          {%- endif -%}

          {%- if s.heading != blank -%}
            {%- case heading_level -%}
              {%- when 'h1' -%}
                <h1 class="font-bold mb-3 text-{{ s.heading_size | default: '3xl' }}" style="color: {{ s.heading_color | default: '#111827' }};">{{ s.heading }}</h1>
              {%- else -%}
                <h2 class="font-bold mb-3 text-{{ s.heading_size | default: '3xl' }}" style="color: {{ s.heading_color | default: '#111827' }};">{{ s.heading }}</h2>
            {%- endcase -%}
          {%- endif -%}

          {%- if s.subheading != blank -%}
            <p id="{{ desc_id }}" class="mb-6 text-{{ s.subheading_size | default: 'base' }}" style="color: {{ s.subheading_color | default: '#374151' }};">{{ s.subheading }}</p>
          {%- endif -%}

          {%- if s.show_rating -%}
            <div class="mb-4 flex items-center gap-2" aria-label="Rating">
              {% liquid
                assign full_stars = s.rating | default: 5 | plus: 0
                if full_stars > 5
                  assign full_stars = 5
                endif
              %}
              <div class="flex">
                {% for i in (1..5) %}
                  {% if i <= full_stars %}
                    <span class="inline-block w-4 h-4" aria-hidden="true">★</span>
                  {% else %}
                    <span class="inline-block w-4 h-4 opacity-30" aria-hidden="true">★</span>
                  {% endif %}
                {% endfor %}
              </div>
              <span class="text-sm">{{ s.rating_count | default: 128 }} reviews</span>
            </div>
          {%- endif -%}

          {%- if section.blocks.size > 0 -%}
            <div class="mt-2 flex flex-wrap gap-3" {% if s.subheading != blank %}aria-describedby="{{ desc_id }}"{% endif %}>
              {%- for block in section.blocks -%}
                {%- assign b = block.settings -%}

                {% assign outline_flag = '' %}
                {% if b.button_mode == 'outline' %}
                  {% assign outline_flag = 'true' %}
                {% endif %}

                {% assign btn_size = b.size | default: 'md' %}
                {% assign pad_y = 12 %}
                {% assign pad_x = 20 %}
                {% if btn_size == 'sm' %}
                  {% assign pad_y = 10 %}{% assign pad_x = 16 %}
                {% elsif btn_size == 'lg' %}
                  {% assign pad_y = 14 %}{% assign pad_x = 24 %}
                {% endif %}

                <a href="{{ b.link | default: '#' }}"
                   {% if b.new_tab %}target="_blank" rel="noopener"{% endif %}
                   aria-label="{{ b.aria_label | default: b.label | escape }}"
                   class="inline-flex items-center gap-2 transition duration-300 ease-in-out font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-black/40"
                   style="
                     {% if outline_flag == 'true' %}
                       color: {{ b.text_color }};
                       background-color: transparent;
                       border-style: solid;
                       border-color: {{ b.border_color }};
                       border-width: {{ b.border_width }}px;
                     {% else %}
                       color: {{ b.text_color }};
                       background-color: {{ b.bg_color }};
                     {% endif %}
                     border-radius: {{ b.radius }}px;
                     padding-left: {{ pad_x }}px;
                     padding-right: {{ pad_x }}px;
                     padding-top: {{ pad_y }}px;
                     padding-bottom: {{ pad_y }}px;
                   "
                   {{ block.shopify_attributes }}>
                  {% if b.icon != blank %}<span class="inline-block" aria-hidden="true">{{ b.icon }}</span>{% endif %}
                  <span>{{ b.label }}</span>
                </a>
              {%- endfor -%}
            </div>
          {%- endif -%}

          {%- assign has_badges = false -%}
          {%- for block in section.blocks -%}
            {%- if block.type == 'badge' -%}{% assign has_badges = true %}{% endif -%}
          {%- endfor -%}
          {% if has_badges %}
            <div class="mt-6 flex flex-wrap items-center gap-3 text-xs opacity-80">
              {% for block in section.blocks %}
                {% if block.type == 'badge' %}
                  {% assign bb = block.settings %}
                  <span class="inline-flex items-center gap-2" {{ block.shopify_attributes }}>
                    {% if bb.badge_icon != blank %}<span class="inline-block" aria-hidden="true">{{ bb.badge_icon }}</span>{% endif %}
                    <span>{{ bb.badge_text }}</span>
                  </span>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Split Banner • Pro",
  "tag": "section",
  "class": "q-split-banner",
  "settings": [
    { "type": "header", "content": "About this section" },
    { "type": "paragraph", "content": "Two-column banner with an image and a content panel. Add multiple buttons and optional badges. The content side can have its own background color. Mobile image override and mobile order controls included." },

    { "type": "header", "content": "Media" },
    { "type": "image_picker", "id": "image", "label": "Desktop image" },
    { "type": "text", "id": "image_alt", "label": "Image alt text (desktop)" },
    { "type": "image_picker", "id": "mobile_image", "label": "Mobile image (optional)" },
    { "type": "text", "id": "mobile_image_alt", "label": "Image alt text (mobile)" },
    { "type": "text", "id": "image_caption", "label": "Image caption (optional)" },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image position (desktop)",
      "options": [{ "value": "left", "label": "Left" }, { "value": "right", "label": "Right" }],
      "default": "left"
    },
    {
      "type": "checkbox",
      "id": "mobile_image_first",
      "label": "Show image above content on mobile",
      "default": true
    },

    { "type": "header", "content": "Layout & spacing" },
    {
      "type": "select",
      "id": "min_height",
      "label": "Minimum height",
      "default": "min-h-[60vh]",
      "options": [
        { "value": "min-h-[40vh]", "label": "40% viewport" },
        { "value": "min-h-[50vh]", "label": "50% viewport" },
        { "value": "min-h-[60vh]", "label": "60% viewport" },
        { "value": "min-h-[75vh]", "label": "75% viewport" }
      ]
    },
    {
      "type": "select",
      "id": "container_mode",
      "label": "Container",
      "default": "contained",
      "options": [
        { "value": "contained", "label": "Contained (side padding)" },
        { "value": "full", "label": "Full-bleed (edge to edge)" }
      ]
    },
    {
      "type": "select",
      "id": "content_max_w",
      "label": "Content width",
      "default": "max-w-3xl",
      "options": [
        { "value": "max-w-2xl", "label": "Narrow" },
        { "value": "max-w-3xl", "label": "Comfort" },
        { "value": "max-w-4xl", "label": "Wide" }
      ]
    },
    { "type": "text", "id": "content_pad_y", "label": "Content vertical padding (Tailwind utilities)", "default": "py-12 md:py-16" },
    { "type": "text", "id": "content_pad_x", "label": "Content horizontal padding (Tailwind utilities)", "default": "px-6 md:px-10" },

    { "type": "header", "content": "Content panel" },
    { "type": "color", "id": "content_bg_color", "label": "Content background color", "default": "#ffffff" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Featured" },
    { "type": "color", "id": "kicker_color", "label": "Kicker color", "default": "#111827" },
    { "type": "select", "id": "kicker_size", "label": "Kicker size", "options": [
      { "value": "sm", "label": "Small" }, { "value": "base", "label": "Normal" }, { "value": "lg", "label": "Large" }], "default": "sm"
    },

    { "type": "text", "id": "heading", "label": "Heading", "default": "Discover the collection" },
    { "type": "select", "id": "heading_level", "label": "Heading level", "default": "h2", "options": [{ "value": "h1", "label": "H1 (page headline)" }, { "value": "h2", "label": "H2 (section headline)" }] },
    { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#111827" },
    { "type": "select", "id": "heading_size", "label": "Heading size", "options": [
      { "value": "2xl", "label": "2XL" }, { "value": "3xl", "label": "3XL" }, { "value": "4xl", "label": "4XL" }], "default": "3xl"
    },

    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Crafted for style. Built for performance." },
    { "type": "color", "id": "subheading_color", "label": "Subheading color", "default": "#374151" },
    { "type": "select", "id": "subheading_size", "label": "Subheading size", "options": [
      { "value": "base", "label": "Base" }, { "value": "lg", "label": "Large" }, { "value": "xl", "label": "XL" }], "default": "base"
    },

    { "type": "header", "content": "Social proof (optional)" },
    { "type": "checkbox", "id": "show_rating", "label": "Show rating stars", "default": false },
    { "type": "range", "id": "rating", "label": "Rating (0–5)", "min": 0, "max": 5, "step": 1, "default": 5 },
    { "type": "number", "id": "rating_count", "label": "Review count", "default": 128 },

    { "type": "header", "content": "Alignment & visibility" },
    { "type": "select", "id": "text_alignment", "label": "Text alignment", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }], "default": "left"
    },
    { "type": "text", "id": "anchor_id", "label": "Optional anchor ID", "default": "features" },
    { "type": "text", "id": "region_label", "label": "Accessible region label", "default": "Promotional banner" },
    { "type": "checkbox", "id": "hide_on_mobile", "label": "Hide on mobile", "default": false },
    { "type": "checkbox", "id": "hide_on_desktop", "label": "Hide on desktop", "default": false },

    { "type": "header", "content": "Section background (rarely needed)" },
    { "type": "text", "id": "section_bg", "label": "Section background (Tailwind arbitrary color)", "default": "transparent", "info": "Advanced: sets background of the outer section. Use CSS color or Tailwind arbitrary color syntax." }
  ],
  "blocks": [
    {
      "type": "button",
      "name": "Button",
      "settings": [
        { "type": "text", "id": "label", "label": "Label", "default": "Shop now" },
        { "type": "url", "id": "link", "label": "Link", "default": "/collections/all" },
        { "type": "text", "id": "aria_label", "label": "ARIA label", "default": "Shop now" },
        {
          "type": "select",
          "id": "size",
          "label": "Size",
          "default": "md",
          "options": [{ "value": "sm", "label": "Small" }, { "value": "md", "label": "Medium" }, { "value": "lg", "label": "Large" }]
        },
        { "type": "checkbox", "id": "new_tab", "label": "Open in new tab", "default": false },
        { "type": "select", "id": "button_mode", "label": "Style", "options": [
          { "value": "solid", "label": "Solid" }, { "value": "outline", "label": "Outline" }], "default": "solid"
        },
        { "type": "text", "id": "icon", "label": "Icon (SVG/HTML)" },
        { "type": "color", "id": "bg_color", "label": "Background (solid)", "default": "#111111" },
        { "type": "color", "id": "text_color", "label": "Text color", "default": "#ffffff" },
        { "type": "color", "id": "border_color", "label": "Border color (outline)", "default": "#111111" },
        { "type": "range", "id": "border_width", "label": "Border width (outline)", "min": 0, "max": 8, "step": 1, "default": 1 },
        { "type": "range", "id": "radius", "label": "Radius", "min": 0, "max": 50, "step": 2, "default": 6 }
      ]
    },
    {
      "type": "badge",
      "name": "Badge",
      "settings": [
        { "type": "text", "id": "badge_text", "label": "Badge text", "default": "Free shipping over $50" },
        { "type": "text", "id": "badge_icon", "label": "Icon (SVG/HTML)" }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [
    { "name": "Split Banner • Pro", "category": "Banner", "blocks": [{ "type": "button" }, { "type": "button" }, { "type": "badge" }] }
  ]
}
{% endschema %}
