{% comment %}
  Quadratum â€¢ Multipurpose Banner Content
  - Inner content area for each slide
  - Handles text, typography, CTAs, optional card/panel background (+ image)
  - Supports featured product and an optional 3-column info row
  - Supports extra product blocks (scoped by parent_slide) in a responsive grid
{% endcomment %}

{% liquid
  assign kicker            = kicker | default: ''
  assign heading           = heading | default: ''
  assign heading_level     = heading_level | default: 'h2'
  assign paragraph         = paragraph | default: ''
  assign cta_text          = cta_text | default: ''
  assign cta_link          = cta_link | default: ''
  assign cta_variant       = cta_variant | default: 'luxury'
  assign cta2_text         = cta2_text | default: ''
  assign cta2_link         = cta2_link | default: ''
  assign cta2_variant      = cta2_variant | default: 'outline'
  assign c_style           = c_style | default: 'none'
  assign c_color           = c_color | default: 'rgba(255,255,255,0.9)'
  assign slide_id          = slide.id | default: ''

  assign inner_layout      = slide.settings.content_inner_layout | default: 'stack'
  assign cols_setting      = slide.settings.extra_grid_cols | default: 1
  assign gap_setting       = slide.settings.extra_grid_gap | default: 16
%}

<div
  class="q-mpb-content{% if c_style != 'none' %} q-mpb-content--{{ c_style }}{% endif %}"
  style="
    {% if c_style != 'none' %}background: {{ c_color }};{% endif %}
    {% if slide.settings.content_bg_image %}
      background-image: url('{{ slide.settings.content_bg_image | image_url: width: 1600 }}');
      background-size: {{ slide.settings.content_bg_image_mode | default: 'cover' }};
      background-repeat: {% if slide.settings.content_bg_image_mode == 'repeat' %}repeat{% else %}no-repeat{% endif %};
      background-position: center;
    {% endif %}
  "
>
  <div class="q-mpb-content-inner">
    {% if kicker != blank %}
      <p class="q-mpb-kicker" {% if slide.settings.kicker_color %}style="color: {{ slide.settings.kicker_color }}"{% endif %}>
        {{ kicker | escape }}
      </p>
    {% endif %}

    {% if heading != blank %}
      <{{ heading_level }} class="q-mpb-heading" {% if slide.settings.heading_color %}style="color: {{ slide.settings.heading_color }}"{% endif %}>
        {{ heading }}
      </{{ heading_level }}>
    {% endif %}

    {% if paragraph != blank %}
      <p class="q-mpb-paragraph" {% if slide.settings.paragraph_color %}style="color: {{ slide.settings.paragraph_color }}"{% endif %}>
        {{ paragraph }}
      </p>
    {% endif %}

    {% if cta_link != blank or cta2_link != blank %}
      <div class="q-mpb-ctas">
        {% if cta_link != blank and cta_text != blank %}
          <a href="{{ cta_link }}" class="q-btn q-btn--{{ cta_variant }}" aria-label="{{ cta_text | escape }}">{{ cta_text }}</a>
        {% endif %}
        {% if cta2_link != blank and cta2_text != blank %}
          <a href="{{ cta2_link }}" class="q-btn q-btn--{{ cta2_variant }}" aria-label="{{ cta2_text | escape }}">{{ cta2_text }}</a>
        {% endif %}
      </div>
    {% endif %}

    {%- comment -%} Featured product (optional) {%- endcomment -%}
    {% if slide.settings.featured_product %}
      {% assign fp = all_products[slide.settings.featured_product] %}
      {% if fp %}
        <div class="q-mpb-featured">
          <a class="q-mpb-featured__media" href="{{ fp.url }}">
            {% if fp.featured_image %}
              <img src="{{ fp.featured_image | image_url: width: 480 }}" alt="{{ fp.title | escape }}" loading="lazy">
            {% endif %}
          </a>
          <div class="q-mpb-featured__info">
            <a href="{{ fp.url }}" class="q-mpb-featured__title">{{ fp.title }}</a>
            {% if slide.settings.featured_product_show_price %}
              <div class="q-mpb-featured__price">{{ fp.price | money }}</div>
            {% endif %}
            <a href="{{ fp.url }}" class="q-btn q-btn--elegant">
              {{ slide.settings.featured_product_cta | default: 'View product' }}
            </a>
          </div>
        </div>
      {% endif %}
    {% endif %}

    {%- comment -%} 3-column content row (optional) {%- endcomment -%}
    {% if inner_layout == 'columns-3' %}
      {% assign info_cols = content_blocks | where: 'type','content_column' | where: 'settings.parent_slide', slide_id %}
      {% if info_cols.size > 0 %}
        <div class="q-mpb-columns q-mpb-columns--3">
          {% for c in info_cols %}
            <div class="q-mpb-col">
              {% if c.settings.icon %}
                <img class="q-mpb-col__icon" src="{{ c.settings.icon | image_url: width: 160 }}" alt="" loading="lazy">
              {% endif %}
              {% if c.settings.title != blank %}<div class="q-mpb-col__title">{{ c.settings.title }}</div>{% endif %}
              {% if c.settings.text != blank %}<div class="q-mpb-col__text">{{ c.settings.text }}</div>{% endif %}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}

    {%- comment -%} Product blocks grid (scoped to this slide) {%- endcomment -%}
    {% assign linked_products = content_blocks | where: 'type', 'product' | where: 'settings.parent_slide', slide_id %}
    {% if linked_products.size > 0 %}
      <div class="q-mpb-extra" style="--q-cols: {{ cols_setting }}; --q-gap: {{ gap_setting }}px;">
        {% for pblock in linked_products %}
          {% assign p = all_products[pblock.settings.product] %}
          {% if p %}
            <div class="q-mpb-product-card">
              {% if p.featured_image %}
                <div class="q-mpb-product-card__img">
                  <a href="{{ p.url }}">
                    <img src="{{ p.featured_image | image_url: width: 320 }}" alt="{{ p.title | escape }}" loading="lazy">
                  </a>
                </div>
              {% endif %}
              <div class="q-mpb-product-card__info">
                <a href="{{ p.url }}" class="q-mpb-product-card__title">{{ p.title }}</a>
                {% if pblock.settings.show_price %}
                  <div class="q-mpb-product-card__price">{{ p.price | money }}</div>
                {% endif %}
                {% if pblock.settings.show_button %}
                  <a href="{{ p.url }}" class="q-btn q-btn--sm q-btn--outline">{{ pblock.settings.button_text }}</a>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

<style>
/* Ensure content is above overlays (buttons clickable) */
.q-mpb-content { position: relative; z-index: 3; pointer-events: auto; }
.q-mpb-overlay { pointer-events: none !important; }
.q-mpb-content-inner { display: flex; flex-direction: column; gap: 1rem; }

/* CTAs */
.q-mpb-ctas { display: flex; flex-wrap: wrap; gap: .75rem; margin-top: 1rem; }
.q-btn { text-decoration: none; padding: .8em 1.6em; border-radius: .4em; font-weight: 600; line-height: 1.2; }
.q-btn--luxury { background: var(--color-primary, #111); color:#fff; }
.q-btn--elegant { background: var(--color-accent, #333); color:#fff; }
.q-btn--outline { background: transparent; border: 1px solid currentColor; color: inherit; }
.q-btn--sm { padding: .55em 1.1em; }

/* Featured product */
.q-mpb-featured {
  display:grid; grid-template-columns: 140px 1fr; gap:16px;
  padding:14px; border-radius:14px; background: rgba(255,255,255,.92);
  box-shadow: 0 10px 24px rgba(0,0,0,.08); margin-top: 1rem;
}
.q-mpb-featured__media img { width:100%; height:100%; object-fit:cover; border-radius:12px; display:block; }
.q-mpb-featured__title { font-weight:700; text-decoration:none; color:inherit; display:block; margin-bottom:6px; }
.q-mpb-featured__price { opacity:.9; margin-bottom:.5rem; }
@media (max-width: 767px){ .q-mpb-featured { grid-template-columns: 1fr; } }

/* 3-column info row */
.q-mpb-columns { display:grid; gap:20px; margin-top:1.25rem; }
.q-mpb-columns--3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
.q-mpb-col { background: rgba(255,255,255,.85); border-radius:12px; padding:16px; backdrop-filter: saturate(120%) blur(4px); }
.q-mpb-col__icon { width:48px; height:48px; object-fit:contain; display:block; margin-bottom:8px; }
.q-mpb-col__title { font-weight:700; margin-bottom:6px; }
.q-mpb-col__text { opacity:.85; line-height:1.5; }
@media (max-width: 767px){ .q-mpb-columns--3 { grid-template-columns: 1fr; } }

/* Product blocks grid */
.q-mpb-extra {
  display: grid;
  grid-template-columns: repeat(var(--q-cols, 1), minmax(0,1fr));
  gap: var(--q-gap, 16px);
  margin-top: 1.25rem;
}
.q-mpb-product-card {
  display: grid;
  grid-template-columns: 80px 1fr;
  gap: 14px; align-items: center;
  padding: 12px 16px; background: rgba(255,255,255,.9);
  border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,.05);
  backdrop-filter: saturate(120%) blur(2px);
}
.q-mpb-product-card__img img { width: 80px; height: 80px; object-fit: cover; border-radius: 10px; display: block; }
.q-mpb-product-card__title { font-weight: 600; color: inherit; text-decoration: none; display:block; }
.q-mpb-product-card__price { font-size: .95rem; opacity: .85; }
@media (max-width: 767px){ .q-mpb-extra { grid-template-columns: 1fr !important; } }
</style>
