{%- comment -%}
  Emits global design tokens as CSS variables.
  Requires settings IDs from your settings_schema.json.
{%- endcomment -%}

/* Root tokens (light mode defaults) */
:root {
  /* Colors */
  --c-primary: {{ settings.color_primary | default: '#2563eb' }};
  --c-secondary: {{ settings.color_secondary | default: '#111827' }};
  --c-accent: {{ settings.color_accent | default: '#10b981' }};
  --c-success: {{ settings.color_success | default: '#16a34a' }};
  --c-warning: {{ settings.color_warning | default: '#f59e0b' }};
  --c-danger:  {{ settings.color_error   | default: '#dc2626' }};

  --c-bg:      {{ settings.bg_base     | default: '#ffffff' }};
  --c-surface: {{ settings.bg_contrast | default: '#f6f7f8' }};
  --c-text:    {{ settings.text_base   | default: '#111111' }};
  --c-muted:   {{ settings.text_muted  | default: '#6b7280' }};
  --c-oncolor: {{ settings.text_on_color | default: '#ffffff' }};

  /* Badges */
  --badge-sale-bg: {{ settings.badge_sale_bg | default: '#dc2626' }};
  --badge-sale-text: {{ settings.badge_sale_text | default: '#ffffff' }};
  --badge-new-bg: {{ settings.badge_new_bg | default: '#2563eb' }};
  --badge-new-text: {{ settings.badge_new_text | default: '#ffffff' }};
  --badge-low-bg: {{ settings.badge_low_stock_bg | default: '#f59e0b' }};
  --badge-low-text: {{ settings.badge_low_stock_text | default: '#111111' }};

  /* Typography */
  --font-head: "{{ settings.font_heading.family | default: 'Inter' }}", {{ settings.font_heading.fallback_families | default: 'system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial' }};
  --font-body: "{{ settings.font_body.family | default: 'Inter' }}", {{ settings.font_body.fallback_families | default: 'system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial' }};

  --fs-body: {{ settings.type_body_size | default: 100 | divided_by: 100.0 }}rem;
  --lh-body: {{ settings.body_line_height | default: 160 | divided_by: 100.0 }};
  --ls-head: {{ settings.headings_letterspacing | default: 0 | divided_by: 1000.0 }}em;

  --fs-h1: {{ settings.type_h1_size | default: 240 | divided_by: 100.0 }}rem;
  --fs-h2: {{ settings.type_h2_size | default: 200 | divided_by: 100.0 }}rem;
  --fs-h3: {{ settings.type_h3_size | default: 180 | divided_by: 100.0 }}rem;
  --fs-h4: {{ settings.type_h4_size | default: 160 | divided_by: 100.0 }}rem;
  --fs-h5: {{ settings.type_h5_size | default: 140 | divided_by: 100.0 }}rem;
  --fs-h6: {{ settings.type_h6_size | default: 120 | divided_by: 100.0 }}rem;

  --tt-head: {% if settings.headings_uppercase %}uppercase{% else %}none{% endif %};
  --tt-btn:  {% if settings.buttons_uppercase %}uppercase{% else %}none{% endif %};

  /* Layout / spacing */
  --container-sm: {{ settings.container_sm | default: 720 }}px;
  --container-md: {{ settings.container_md | default: 960 }}px;
  --container-lg: {{ settings.container_lg | default: 1152 }}px;
  --container-xl: {{ settings.container_xl | default: 1440 }}px;

  --space-sm: {{ settings.space_sm | default: 12 | divided_by: 100.0 }}rem;
  --space-md: {{ settings.space_md | default: 16 | divided_by: 100.0 }}rem;
  --space-lg: {{ settings.space_lg | default: 24 | divided_by: 100.0 }}rem;

  --section-pt: {{ settings.section_padding_top | default: 48 | divided_by: 100.0 }}rem;
  --section-pb: {{ settings.section_padding_bottom | default: 48 | divided_by: 100.0 }}rem;

  /* Buttons (use decimals to avoid calc/percent headaches) */
  --btn-radius: {{ settings.button_radius | default: 12 }}px;
  --btn-border-w: {{ settings.button_border_width | default: 1 }}px;
  --btn-hover: {{ settings.button_hover_opacity | default: 92 | divided_by: 100.0 }}; /* 0.0–1.0 */
  --btn-active: {{ settings.button_active_scale | default: 98 | divided_by: 100.0 }};  /* 0.95–1.0 */
  --btn-gap: 0.5rem;
  /* size defaults (md) */
  --btn-py: 0.75rem;
  --btn-px: 1rem;

  /* Semantic button tokens (can be overridden in scope) */
  --btn-bg: var(--c-primary);
  --btn-text: var(--c-oncolor);
  --btn-border: var(--c-primary);
}

/* Optional dark theme overrides */
{% if settings.enable_dark_mode %}
[data-theme="dark"] {
  --c-bg:      {{ settings.dark_bg_base     | default: '#0b0b0c' }};
  --c-surface: {{ settings.dark_bg_contrast | default: '#151517' }};
  --c-text:    {{ settings.dark_text_base   | default: '#fafafa' }};
  --c-muted:   {{ settings.dark_text_muted  | default: '#9ca3af' }};
  --c-oncolor: {{ settings.dark_text_on_color | default: '#0b0b0c' }};
}
{% endif %}

/* Button component reads variables only (no hardcoded colors) */
.btn {
  display:inline-flex; align-items:center; justify-content:center;
  gap:var(--btn-gap);
  padding:var(--btn-py) var(--btn-px);
  border-radius:var(--btn-radius);
  border:var(--btn-border-w) solid var(--btn-border);
  background:var(--btn-bg);
  color:var(--btn-text);
  text-transform:var(--tt-btn);
  transition:transform .12s ease, opacity .12s ease, box-shadow .12s ease;
}
.btn:hover { opacity: var(--btn-hover); }
.btn:active { transform: scale(var(--btn-active)); }
.btn:focus-visible { outline:2px solid currentColor; outline-offset:2px; }

/* Variants map semantic tokens, still overridable in scope */
.btn--solid  { --btn-bg: var(--c-primary); --btn-text: var(--c-oncolor); --btn-border: var(--c-primary); }
.btn--outline{ --btn-bg: transparent;     --btn-text: var(--c-primary); --btn-border: var(--c-primary); }
.btn--ghost  { --btn-bg: transparent;     --btn-text: var(--c-primary); --btn-border: transparent; }

/* Sizes */
.btn--sm { --btn-py: 0.5rem;  --btn-px: 0.75rem; }
.btn--md { --btn-py: 0.75rem; --btn-px: 1rem; }
.btn--lg { --btn-py: 1rem;    --btn-px: 1.25rem; }

/* Headings/Body usage example vars (optional) */
.h1 { font-family: var(--font-head); font-size: var(--fs-h1); letter-spacing: var(--ls-head); text-transform: var(--tt-head); }
.h2 { font-family: var(--font-head); font-size: var(--fs-h2); letter-spacing: var(--ls-head); text-transform: var(--tt-head); }
body { font-family: var(--font-body); font-size: var(--fs-body); line-height: var(--lh-body); color: var(--c-text); background: var(--c-bg); }

/* Merchant custom CSS (raw, not escaped) */
{% if settings.custom_css and settings.custom_css != blank %}
{{ settings.custom_css }}
{% endif %}
<script>
  try {
    var pref = localStorage.getItem('theme');
    var sys = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    if (document.body.hasAttribute('data-theme')) {
      document.body.setAttribute('data-theme', pref||sys);
    }
  } catch(e){}
</script>
