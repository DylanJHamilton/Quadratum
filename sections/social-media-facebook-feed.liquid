{%- comment -%}
  Quadratum — Social Media: Facebook Basic Feed
  File: sections/social-facebook-basic.liquid
  Root: .q-social-facebook-basic

  Purpose:
  Simple, low-maintenance Facebook Page embed using the official Page Plugin.
  • No Graph API
  • No tokens/secret keys
  • Reads from global Integrations where possible
{%- endcomment -%}

{%- assign s = section.settings -%}
{%- assign g = settings -%}

{%- comment %}
  Global integrations / tokens
{%- endcomment -%}
{%- assign fb_url_global   = g.social_url_facebook -%}
{%- assign fb_page_id_glob = g.fb_page_id -%}
{%- assign feed_radius     = g.feed_card_radius | default: 16 -%}

{%- comment %}
  Effective Facebook Page URL:
  1. Section-level URL
  2. Global social_url_facebook
  3. Derived from fb_page_id
{%- endcomment -%}
{%- assign fb_page_url = s.facebook_page_url | default: fb_url_global -%}
{%- if fb_page_url == blank and fb_page_id_glob != blank -%}
  {%- assign fb_page_url = 'https://www.facebook.com/' | append: fb_page_id_glob -%}
{%- endif -%}

{%- assign heading_id = section.id | append: '-heading' -%}
{%- assign embed_width = s.embed_width | default: 500 -%}

<section
  id="{{ section.id }}"
  class="q-social-facebook-basic"
  data-section-type="social-facebook-basic"
  role="region"
  style="--q-radius-feed: {{ feed_radius }}px;"
  {% if s.heading != blank %}
    aria-labelledby="{{ heading_id }}"
  {% else %}
    aria-label="Facebook feed"
  {% endif %}
>
  <div class="q-layer">
    {%- if s.layout_style == 'full_bleed' -%}
      <div class="q-container q-container--full">
    {%- else -%}
      <div class="q-container" style="max-width: {{ s.max_width }}px;">
    {%- endif -%}

        {%- if s.heading != blank or s.body != blank -%}
          <div class="q-social-header">
            {%- if s.heading != blank -%}
              <h2 class="q-heading" id="{{ heading_id }}">{{ s.heading | escape }}</h2>
            {%- endif -%}
            {%- if s.body != blank -%}
              <p class="q-body">{{ s.body }}</p>
            {%- endif -%}
          </div>
        {%- endif -%}

        <div
          class="q-social-embed-wrap{% if s.embed_alignment == 'left' %} is-align-left{% elsif s.embed_alignment == 'right' %} is-align-right{% else %} is-align-center{% endif %}"
          style="max-width: {{ embed_width | plus: 24 }}px;"
          {% if fb_page_url != blank %}
            aria-label="Facebook feed from {{ fb_page_url | replace: 'https://', '' | replace: 'http://', '' | escape }}"
          {% else %}
            aria-label="Facebook feed placeholder"
          {% endif %}
        >
          {%- if fb_page_url != blank -%}
            {%- comment %}
              Build Page Plugin iframe URL
            {%- endcomment -%}
            {%- if s.show_posts -%}
              {%- assign tabs_param = 'timeline' -%}
            {%- else -%}
              {%- assign tabs_param = '' -%}
            {%- endif -%}

            {%- if s.show_cover -%}
              {%- assign hide_cover_param = 'false' -%}
            {%- else -%}
              {%- assign hide_cover_param = 'true' -%}
            {%- endif -%}

            {%- if s.show_facepile -%}
              {%- assign show_facepile_param = 'true' -%}
            {%- else -%}
              {%- assign show_facepile_param = 'false' -%}
            {%- endif -%}

            {%- assign encoded_url = fb_page_url | url_encode -%}

            <iframe
              title="Facebook Page plugin"
              class="q-facebook-iframe"
              width="{{ embed_width }}"
              height="{{ s.embed_height }}"
              src="https://www.facebook.com/plugins/page.php?href={{ encoded_url }}{% if tabs_param != '' %}&tabs={{ tabs_param }}{% endif %}&width={{ embed_width }}&height={{ s.embed_height }}&hide_cover={{ hide_cover_param }}&show_facepile={{ show_facepile_param }}&adapt_container_width=true"
              style="border:none; overflow:hidden; width:100%;"
              scrolling="no"
              frameborder="0"
              allow="encrypted-media; picture-in-picture; clipboard-write"
              loading="lazy"
            ></iframe>

            <p class="q-social-fallback-link">
              <a href="{{ fb_page_url }}" target="_blank" rel="noopener noreferrer">
                Open our Facebook page in a new tab
              </a>
            </p>
          {%- else -%}
            <p class="q-social-placeholder">
              Add your Facebook Page URL in this section or in
              <strong>Theme Settings → Integrations</strong>
              to show your Facebook feed here.
            </p>
          {%- endif -%}
        </div>
      </div>
  </div>

  <style>
    /* ===== Quadratum — Social Media: Facebook Basic Feed (scoped) ===== */
    .q-social-facebook-basic {
      background: var(--bg_root, #ffffff);
      color: var(--text_base, #111827);
    }

    .q-social-facebook-basic .q-layer {
      padding-block: var(--q-section-pad-y, 3rem);
      padding-inline: var(--q-section-pad-x, 1.25rem);
    }

    .q-social-facebook-basic .q-container {
      margin-inline: auto;
      width: 100%;
      max-width: var(--q-section-max-w, 72rem);
    }

    .q-social-facebook-basic .q-container--full {
      max-width: none !important;
    }

    .q-social-facebook-basic .q-social-header {
      margin-bottom: var(--space-lg, 1.5rem);
      max-width: 40rem;
    }

    .q-social-facebook-basic .q-heading {
      margin: 0 0 0.5rem 0;
      font-size: var(--text-2xl, 1.5rem);
      line-height: 1.15;
    }

    .q-social-facebook-basic .q-body {
      margin: 0;
      color: var(--text_muted, #4b5563);
      font-size: var(--text-base, 1rem);
      line-height: 1.6;
    }

    .q-social-facebook-basic .q-social-embed-wrap {
      border-radius: var(--q-radius-feed, 16px);
      overflow: hidden;
      background: var(--q-surface, var(--bg_contrast, #f3f4f6));
      padding: var(--space-md, 1rem);
      margin-inline: auto; /* default center */
    }

    .q-social-facebook-basic .q-social-embed-wrap.is-align-left {
      margin-inline-start: 0;
      margin-inline-end: auto;
    }

    .q-social-facebook-basic .q-social-embed-wrap.is-align-center {
      margin-inline: auto;
    }

    .q-social-facebook-basic .q-social-embed-wrap.is-align-right {
      margin-inline-start: auto;
      margin-inline-end: 0;
    }

    .q-social-facebook-basic .q-facebook-iframe {
      width: 100%;
      max-width: 100%;
      min-height: 200px;
      display: block;
    }

    .q-social-facebook-basic .q-social-fallback-link {
      margin-top: 0.75rem;
      font-size: 0.875rem;
      color: var(--text_muted, #6b7280);
    }

    .q-social-facebook-basic .q-social-fallback-link a {
      color: var(--color_primary, #2563eb);
      text-decoration: underline;
    }

    .q-social-facebook-basic .q-social-placeholder {
      margin: 0;
      font-size: 0.9375rem;
      color: var(--text_muted, #6b7280);
    }

    @media (max-width: 639.98px) {
      .q-social-facebook-basic .q-layer {
        padding-inline: 1rem;
      }
    }
  </style>
</section>

{% schema %}
{
  "name": "Social Media - FB Basic",
  "tag": "section",
  "class": "q-social-facebook-basic",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Follow us on Facebook"
    },
    {
      "type": "textarea",
      "id": "body",
      "label": "Body",
      "default": "Stay connected with our latest updates, news, and offers on Facebook."
    },

    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Layout style",
      "default": "contained",
      "options": [
        { "value": "contained", "label": "Contained" },
        { "value": "full_bleed", "label": "Full bleed" }
      ]
    },
    {
      "type": "range",
      "id": "max_width",
      "label": "Max width (px)",
      "min": 768,
      "max": 1440,
      "step": 16,
      "default": 1152
    },
    {
      "type": "select",
      "id": "embed_alignment",
      "label": "Embed alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },

    {
      "type": "header",
      "content": "Facebook Page"
    },
    {
      "type": "url",
      "id": "facebook_page_url",
      "label": "Facebook Page URL (optional)",
      "info": "If left blank, the theme's Integrations → Facebook URL will be used."
    },
    {
      "type": "range",
      "id": "embed_width",
      "label": "Embed width (px)",
      "min": 320,
      "max": 500,
      "step": 10,
      "default": 500
    },
    {
      "type": "range",
      "id": "embed_height",
      "label": "Embed height (px)",
      "min": 200,
      "max": 900,
      "step": 20,
      "default": 520
    },
    {
      "type": "checkbox",
      "id": "show_cover",
      "label": "Show cover photo",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_facepile",
      "label": "Show friend faces",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_posts",
      "label": "Show timeline posts",
      "default": true
    },

    {
      "type": "header",
      "content": "Performance"
    },
    {
      "type": "checkbox",
      "id": "lazyload_embed",
      "label": "Lazy-load Facebook embed (HTML loading attribute only)",
      "default": true,
      "info": "The iframe itself uses loading=\"lazy\"; no extra JS is required."
    }
  ],
  "presets": [
    {
      "name": "Social Media - FB Basic",
      "category": "Social Media"
    }
  ]
}
{% endschema %}

{% javascript %}{% endjavascript %}
