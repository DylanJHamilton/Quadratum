{% comment %}
  Quadratum • Web3 Banner (Hero + Slideshow)
  - Hero or Slideshow
  - Slide background: image_picker OR https URL (background_image_url)
  - Overlay, glow, motion (reduced-motion safe)
  - Side media (image or MP4)
  - Defensive defaults everywhere
{% endcomment %}

{% assign s = section.settings %}

{% assign visibility_classes = '' %}
{% if s.hide_on_mobile %}{% assign visibility_classes = visibility_classes | append: ' hidden md:block' %}{% endif %}
{% if s.hide_on_desktop %}{% assign visibility_classes = visibility_classes | append: ' md:hidden' %}{% endif %}

{% assign sizes_media  = '(min-width: 1024px) 50vw, 100vw' %}
{% assign widths_media = '640,750,828,960,1080,1280,1440,1600' %}
{% assign just_x = 'justify-start' %}
{% if s.content_align_x == 'center' %}{% assign just_x = 'justify-center' %}{% endif %}
{% if s.content_align_x == 'end' %}{% assign just_x = 'justify-end' %}{% endif %}
{% assign align_y = 'items-start' %}
{% if s.content_align_y == 'center' %}{% assign align_y = 'items-center' %}{% endif %}
{% if s.content_align_y == 'end' %}{% assign align_y = 'items-end' %}{% endif %}

{%- comment -%} Content wrapper centering {%- endcomment -%}
{% assign cw = s.content_max_w | default: '72ch' %}
{% assign content_wrap_style = 'max-width: ' | append: cw | append: ';' %}
{% if s.text_align == 'text-center' %}{% assign content_wrap_style = content_wrap_style | append: ' margin-left:auto; margin-right:auto;' %}{% endif %}

<section
  id="{{ s.anchor_id | default: 'section-' | append: section.id }}"
  class="q-web3-banner{{ visibility_classes }}"
  role="region"
  aria-label="{{ s.region_label | default: 'Web3 promotion' }}"
  style="margin-top: {{ s.margin_top | default: 0 }}px; margin-bottom: {{ s.margin_bottom | default: 0 }}px;"
>
  <div
    class="mx-auto{% if s.pad_x == 'contained' and s.width_mode != 'full' %} px-4 md:px-6{% endif %}"
    style="
      {% if s.width_mode == 'theme' %}
        max-width: {{ settings.container_lg | default: 1152 }}px;
      {% elsif s.width_mode == 'custom' %}
        max-width: {{ s.custom_max_w | default: 1440 }}px;
      {% elsif s.width_mode == 'full' %}
        max-width:none; width:100vw; margin-left:50%; transform:translateX(-50%);
      {% endif %}
    "
  >

    {%- if s.layout_mode == 'slideshow' -%}

    <!-- NOTE: intentionally NOT a .q-card so it does not inherit card padding/gutters -->
    <div
      class="relative w-full q-slideshow {% if s.scroll_reveal %}q-reveal{% endif %}"
      aria-roledescription="carousel"
      aria-label="{{ s.carousel_label | default: 'Slideshow banner' }}"
      aria-live="polite"
      data-q-slideshow
      data-autoplay="{{ s.ss_autoplay | default: true }}"
      data-interval="{{ s.ss_interval | default: 8 }}"
      style="
        {% if s.card_container %}border-radius: {{ s.card_radius | default: 36 }}px; overflow:hidden;{% endif %}
        {% if s.card_container and s.card_border_width > 0 %}border: {{ s.card_border_width | default: 0 }}px solid {{ s.card_border_color | default: '#0000001a' }};{% endif %}
        {% if s.card_container and s.card_shadow %}box-shadow: 0 20px 60px rgba(0,0,0,.25);{% endif %}
        min-height: {{ s.min_height_vh | default: 65 }}vh;
        background-color: transparent;
        {% if s.center_card_full %}max-width: {{ s.center_card_max_w | default: 1800 }}px; margin-left:auto; margin-right:auto;{% endif %}
      "
    >
      <!-- viewport strictly controls overflow; track slides horizontally -->
      <div class="q-viewport relative w-full h-full overflow-hidden">
        <div class="q-slides q-track will-change-transform" data-q-slides>
          {%- assign slide_total = 0 -%}
          {%- for blk in section.blocks -%}{% if blk.type == 'slide' %}{% assign slide_total = slide_total | plus: 1 %}{% endif %}{%- endfor -%}

          {%- assign slide_index = 0 -%}
          {%- for block in section.blocks -%}
            {%- if block.type == 'slide' -%}
              {%- assign slide_index = slide_index | plus: 1 -%}
              {%- assign b = block.settings -%}

              {%- comment -%} Background resolver (picker OR https URL) {%- endcomment -%}
              {% assign bg_src = '' %}
              {% if b.background_image != blank %}
                {% assign bg_src = b.background_image | image_url: width: 2400 %}
              {% elsif b.background_image_url != blank %}
                {% assign raw_bg = b.background_image_url | strip %}
                {% if raw_bg contains 'shopify://shop_images/' %}
                  {% assign bg_src = raw_bg | split: '/' | last | file_img_url: '2400x' %}
                {% else %}
                  {% assign bg_src = raw_bg %}
                {% endif %}
              {% endif %}

              <div
                class="q-slide relative"
                role="group"
                aria-roledescription="slide"
                aria-label="{{ slide_index }} / {{ slide_total }}"
                aria-hidden="{% if slide_index == 1 %}false{% else %}true{% endif %}"
                {{ block.shopify_attributes }}
                style="
                  flex: 0 0 100%;
                  width: 100%;
                  min-height: {{ s.min_height_vh | default: 65 }}vh;
                  {% if bg_src != blank %}
                    background-image:url('{{ bg_src | strip }}');
                    background-size:cover;
                    background-position: {{ b.bg_position | default: 'center' }};
                    background-repeat:no-repeat;
                  {% else %}
                    background-color: {{ s.bg_fallback_color | default: '#0b0b12' }};
                  {% endif %}
                "
              >
                {% assign ov = b.overlay_opacity | default: s.overlay_opacity | default: 35 %}
                <div class="absolute inset-0 z-[2]" style="background-color: {{ b.overlay_color | default: s.overlay_color | default: '#000000' }}; opacity: {{ ov | times: 0.01 }};"></div>

                <div class="relative h-full w-full z-[3]">
                  <div class="h-full w-full flex {{ just_x }} {{ align_y }}">
                    <div class="q-slide-inner {{ s.text_align | default: 'text-left' }}"
                         style="{{ content_wrap_style }} padding-top: {{ s.padding_top | default: 96 }}px; padding-bottom: {{ s.padding_bottom | default: 96 }}px; padding-left: clamp(1rem,6vw,4rem); padding-right: clamp(1rem,6vw,4rem); max-width: clamp(32rem, 44vw, 48rem);">
                      {% if b.kicker != blank %}
                        <p class="text-sm font-semibold tracking-wide uppercase" style="color: {{ b.kicker_color | default: s.kicker_color | default: '#e5e7eb' }};">{{ b.kicker }}</p>
                      {% endif %}
                      {% if b.heading != blank %}
                        <h2 class="q-heading font-semibold leading-tight" style="color: {{ b.heading_color | default: s.heading_color | default: '#ffffff' }};">{{ b.heading | escape }}</h2>
                      {% endif %}
                      {% if b.subheading != blank %}
                        <p class="mt-3 text-base md:text-lg" style="color: {{ b.subheading_color | default: s.subheading_color | default: '#f3f4f6' }};">{{ b.subheading }}</p>
                      {% endif %}
                      <div class="mt-5 flex flex-wrap gap-3 {% if s.cta_align == 'center' %}justify-center{% elsif s.cta_align == 'right' %}justify-end{% else %}justify-start{% endif %}">
                        {% if b.cta_text != blank and b.cta_link != blank %}
                          <a href="{{ b.cta_link }}" class="q-btn q-btn--{{ s.button_fx | default: 'neon' }}" aria-label="{{ b.cta_aria_label | default: b.cta_text | escape }}" style="--q-btn-radius: {{ s.button_radius | default: 12 }}px; --q-btn-border-w: {{ s.button_border_width | default: 1 }}px;">{{ b.cta_text }}</a>
                        {% endif %}
                        {% if b.cta2_text != blank and b.cta2_link != blank %}
                          <a href="{{ b.cta2_link }}" class="q-btn q-btn--secondary" aria-label="{{ b.cta2_aria_label | default: b.cta2_text | escape }}" style="--q-btn-radius: {{ s.button_radius | default: 12 }}px; --q-btn-border-w: 1px;">{{ b.cta2_text }}</a>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>

      {% if s.ss_show_arrows %}
        <button type="button" class="q-ss-arrow q-ss-prev" data-q-prev aria-label="{{ 'general.previous' | t | default: 'Previous slide' }}"></button>
        <button type="button" class="q-ss-arrow q-ss-next" data-q-next aria-label="{{ 'general.next' | t | default: 'Next slide' }}"></button>
      {% endif %}
      {% if s.ss_show_dots %}
        <div class="q-ss-dots" data-q-dots aria-label="{{ 'general.slideshow_dots' | t | default: 'Slide navigation' }}"></div>
      {% endif %}
      {% if s.ss_autoplay %}
        <button type="button" class="q-ss-pp" data-q-pp aria-pressed="false" aria-label="Pause autoplay"></button>
      {% endif %}
    </div>

    {%- else -%}
    {%- comment -%} HERO {%- endcomment -%}

    {% assign hero_bg = '' %}
    {% if s.background_image != blank %}
      {% assign hero_bg = s.background_image | image_url: width: 2240 %}
    {% elsif s.background_url != blank %}
      {% assign raw_bg = s.background_url | strip %}
      {% if raw_bg contains 'shopify://shop_images/' %}
        {% assign hero_bg = raw_bg | split: '/' | last | file_img_url: '2240x' %}
      {% else %}
        {% assign hero_bg = raw_bg %}
      {% endif %}
    {% endif %}

    {% assign has_media = false %}
    {% if s.media_video != blank or s.media_image != blank %}{% assign has_media = true %}{% endif %}

    <div
      class="q-card group relative w-full will-change-transform {% if s.scroll_reveal %}q-reveal{% endif %}"
      data-parallax="{{ s.enable_parallax | default: true }}"
      data-parallax-strength="{{ s.parallax_strength | default: 12 }}"
      data-tilt="{{ s.tilt_hover | default: true }}"
      data-tilt-max="{{ s.tilt_max | default: 8 }}"
      data-cursor-glow="{{ s.cursor_reactive_glow | default: true }}"
      style="
        {% if s.card_container %}border-radius: {{ s.card_radius | default: 36 }}px; overflow:hidden;{% endif %}
        {% if s.card_container and s.card_border_width > 0 %}border: {{ s.card_border_width | default: 0 }}px solid {{ s.card_border_color | default: '#0000001a' }};{% endif %}
        {% if s.card_container and s.card_shadow %}box-shadow: 0 20px 60px rgba(0,0,0,.25);{% endif %}
        min-height: {{ s.min_height_vh | default: 60 }}vh;
        background-color: {% if hero_bg == blank %}{{ s.bg_fallback_color | default: '#0b0b12' }}{% else %}transparent{% endif %};
        transform-style: preserve-3d;
        {% if hero_bg != blank %}background-image: url('{{ hero_bg | strip }}'); background-size: cover; background-position: center;{% endif %}
        {% if s.center_card_full %}max-width: {{ s.center_card_max_w | default: 1800 }}px; margin-left:auto; margin-right:auto;{% endif %}
      "
    >
      <div class="absolute inset-0 z-[2]" aria-hidden="true"
           style="background-color: {{ s.overlay_color | default: '#000000' }}; opacity: {{ s.overlay_opacity | default: 45 | times: 0.01 }}; {% if s.overlay_blur_px > 0 %}backdrop-filter: blur({{ s.overlay_blur_px }}px);{% endif %}"></div>

      <div aria-hidden="true" class="absolute inset-0 z-[2]" style="{% if s.animate_glow %}animation: qGlow 16s linear infinite alternate;{% endif %}"></div>

      {% if s.cursor_reactive_glow %}
        <div class="q-cursor-glow pointer-events-none absolute -inset-40 opacity-0 transition-opacity duration-300 z-[4]" aria-hidden="true" style="border-radius: inherit;"></div>
      {% endif %}

      <div class="relative z-[3]">
        <div class="{% if s.card_inner_pad == 'comfortable' %}px-6 md:px-10{% elsif s.card_inner_pad == 'cozy' %}px-5 md:px-8{% else %}px-4 md:px-6{% endif %}">
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8"
               style="padding-top: {{ s.padding_top | default: 96 }}px; padding-bottom: {{ s.padding_bottom | default: 96 }}px;">

            {% assign media_first = false %}
            {% if s.media_position == 'left' %}{% assign media_first = true %}{% endif %}

            {% assign media_cols = 5 %}{% assign content_cols = 7 %}
            {% if s.media_width == '6' %}{% assign media_cols = 6 %}{% assign content_cols = 6 %}{% endif %}
            {% if s.media_width == '7' %}{% assign media_cols = 7 %}{% assign content_cols = 5 %}{% endif %}

            {% assign media_col_class = 'lg:col-span-' | append: media_cols %}
            {% assign content_col_class = 'lg:col-span-' | append: content_cols %}

            {% if has_media and media_first %}
              <div class="col-span-1 {{ media_col_class }}">
                {% if s.media_video != blank %}
                  <video class="w-full h-auto rounded-2xl object-cover" autoplay muted loop playsinline preload="none" {% if s.media_poster != blank %}poster="{{ s.media_poster | image_url: width: 1280 }}"{% endif %}><source src="{{ s.media_video }}" type="video/mp4"></video>
                {% elsif s.media_image != blank %}
                  {{ s.media_image | image_url: width: 1600 | image_tag: widths: widths_media, sizes: sizes_media, loading: 'lazy', class: 'w-full h-auto object-cover rounded-2xl', alt: s.media_alt | default: 'Artwork' }}
                {% endif %}
              </div>
            {% endif %}

            <div class="col-span-1 {{ content_col_class }}">
              <div class="flex {{ just_x }} {{ align_y }} {{ s.text_align | default: 'text-left' }}">
                <div class="w-full" style="{{ content_wrap_style }}">
                  {% if s.kicker != blank %}<p class="text-sm font-semibold tracking-wide uppercase" style="color: {{ s.kicker_color | default: '#e5e7eb' }};">{{ s.kicker }}</p>{% endif %}
                  {% if s.heading != blank %}
                    {% assign heading_color = s.heading_color | default: '#ffffff' %}
                    {% if s.heading_level == 'h1' %}
                      <h1 class="mt-1 q-heading font-semibold leading-tight" style="color: {{ heading_color }}; {% if s.text_shadow %}text-shadow: 0 1px 2px rgba(0,0,0,.35);{% endif %}">{{ s.heading | escape }}</h1>
                    {% else %}
                      <h2 class="mt-1 q-heading font-semibold leading-tight" style="color: {{ heading_color }}; {% if s.text_shadow %}text-shadow: 0 1px 2px rgba(0,0,0,.35);{% endif %}">{{ s.heading | escape }}</h2>
                    {% endif %}
                  {% endif %}
                  {% if s.subheading != blank %}
                    <p class="mt-3 text-base md:text-lg {% if s.hide_sub_mobile %}hidden md:block{% endif %}" style="color: {{ s.subheading_color | default: '#f3f4f6' }}; {% if s.text_shadow %}text-shadow: 0 1px 1px rgba(0,0,0,.25);{% endif %}">{{ s.subheading }}</p>
                  {% endif %}

                  {% if s.bullets_enable %}
                    <ul class="mt-4 space-y-2">
                      {% for block in section.blocks %}
                        {% if block.type == 'bullet' %}
                          {% assign b = block.settings %}
                          <li class="flex items-start gap-3" {{ block.shopify_attributes }}>
                            {% if b.icon == 'bolt' %}
                              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" style="min-width:16px; min-height:16px; margin-top:2px; color:#38bdf8;"><path d="M11.3 1L3 11h5l-.8 8L15 9h-5l1.3-8z"/></svg>
                            {% elsif b.icon == 'shield' %}
                              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" style="min-width:16px; min-height:16px; margin-top:2px; color:#10b981;"><path d="M10 2l7 3v5c0 5-3.5 7.5-7 8-3.5-.5-7-3-7-8V5l7-3z"/></svg>
                            {% else %}
                              <span style="display:inline-block; width:8px; height:8px; border-radius:9999px; background-color: var(--color-primary, {{ settings.color_accent | default: '#10b981' }}); margin-top:6px;"></span>
                            {% endif %}
                            <span class="text-sm md:text-base" style="color: {{ s.bullet_text_color | default: '#e5e7eb' }};">{{ b.text }}</span>
                          </li>
                        {% endif %}
                      {% endfor %}
                    </ul>
                  {% endif %}

                  {% assign has_secondary = false %}
                  {% assign href2 = s.cta2_link %}
                  {% if href2 == blank and s.cta2_collection %}{% assign href2 = s.cta2_collection.url %}{% endif %}
                  {% if href2 == blank and s.cta2_product %}{% assign href2 = s.cta2_product.url %}{% endif %}
                  {% if href2 == blank and s.cta2_article %}{% assign href2 = s.cta2_article.url %}{% endif %}
                  {% if s.cta2_text != blank and href2 != blank %}{% assign has_secondary = true %}{% endif %}

                  {% assign cta_justify = 'justify-start' %}
                  {% if s.cta_align == 'center' %}{% assign cta_justify = 'justify-center' %}{% endif %}
                  {% if s.cta_align == 'right' %}{% assign cta_justify = 'justify-end' %}{% endif %}

                  <div class="mt-5 flex flex-wrap gap-3 {{ cta_justify }}">
                    <button type="button" class="q-btn q-btn--{{ s.button_fx | default: 'neon' }} {% if s.cta_full_width_mobile %}w-full sm:w-auto{% endif %}" style="--q-btn-radius: {{ s.button_radius | default: 12 }}px; --q-btn-border-w: {{ s.button_border_width | default: 1 }}px;" data-cta="primary" data-q-wallet-connect aria-label="{{ s.cta_aria_label | default: s.cta_text | escape }}">{{ s.cta_text | default: 'Shop now' }}</button>
                    {% if has_secondary %}
                      <a href="{{ href2 }}" class="q-btn q-btn--secondary {% if s.cta_full_width_mobile %}w-full sm:w-auto{% endif %}" style="--q-btn-radius: {{ s.button_radius | default: 12 }}px; --q-btn-border-w: 1px;" aria-label="{{ s.cta2_aria_label | default: s.cta2_text | escape }}">{{ s.cta2_text }}</a>
                    {% endif %}
                  </div>

                  {% if s.disclaimer != blank %}<p class="mt-3 text-xs" style="color:#cbd5e1">{{ s.disclaimer }}</p>{% endif %}
                </div>
              </div>
            </div>

            {% if has_media and media_first == false %}
              <div class="col-span-1 {{ media_col_class }}">
                {% if s.media_video != blank %}
                  <video class="w-full h-auto rounded-2xl object-cover" autoplay muted loop playsinline preload="none" {% if s.media_poster != blank %}poster="{{ s.media_poster | image_url: width: 1280 }}"{% endif %}><source src="{{ s.media_video }}" type="video/mp4"></video>
                {% elsif s.media_image != blank %}
                  {{ s.media_image | image_url: width: 1600 | image_tag: widths: widths_media, sizes: sizes_media, loading: 'lazy', class: 'w-full h-auto object-cover rounded-2xl', alt: s.media_alt | default: 'Artwork' }}
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {%- endif -%}
  </div>

  <script>
  (function(){
    var root = document.getElementById({{ s.anchor_id | default: 'section-' | append: section.id | json }});
    if(!root) return;
    var reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // --- Slideshow ---
    (function(){
      var slider = root.querySelector('[data-q-slideshow]');
      if(!slider) return;

      var viewport = slider.querySelector('.q-viewport');
      var track    = slider.querySelector('[data-q-slides]');
      var slides   = Array.prototype.slice.call(slider.querySelectorAll('.q-slide'));
      if(!slides.length || !track || !viewport) return;

      // Layout: no peeking, 100% width slides
      track.style.display = 'flex';
      track.style.gap = '0px';
      track.style.transition = 'transform .5s ease';
      viewport.style.overflow = 'hidden';

      function sizeTrack(){
        slides.forEach(function(s){
          s.style.flex = '0 0 100%';
          s.style.minWidth = '100%';
          s.style.width = '100%';
          s.style.boxSizing = 'border-box';
        });
      }

      var idx = 0, timer = null;
      var autoplay = (String(slider.dataset.autoplay) === 'true') && !reduce;
      var interval = Math.max(parseInt(slider.dataset.interval||'8',10), 3) * 1000;

      var dotsWrap = slider.querySelector('[data-q-dots]');
      var dots = [];

      function update(){
        track.style.transform = 'translate3d(' + (-idx * 100) + '%,0,0)';
        slides.forEach(function(s,i){ s.setAttribute('aria-hidden', i===idx ? 'false':'true'); });
        if(dots.length){
          dots.forEach(function(b,i){ b.classList.toggle('is-active', i===idx); b.setAttribute('aria-pressed', i===idx?'true':'false'); });
        }
      }
      function go(n){
        var max = slides.length;
        if(max === 0) return;
        idx = (n%max+max)%max;
        update();
      }
      function next(){ go(idx+1); }
      function prev(){ go(idx-1); }

      if(dotsWrap){
        dotsWrap.innerHTML='';
        slides.forEach(function(_,i){
          var b = document.createElement('button');
          b.type = 'button';
          b.setAttribute('data-q-dot', i);
          b.setAttribute('aria-label', 'Go to slide '+(i+1));
          b.addEventListener('click', function(){ go(i); stopAuto(); });
          dotsWrap.appendChild(b);
          dots.push(b);
        });
      }

      var bPrev = slider.querySelector('[data-q-prev]');
      var bNext = slider.querySelector('[data-q-next]');
      if(bPrev){ bPrev.addEventListener('click', function(){ prev(); stopAuto(); }); }
      if(bNext){ bNext.addEventListener('click', function(){ next(); stopAuto(); }); }

      var pp = slider.querySelector('[data-q-pp]');
      function startAuto(){ if(!autoplay) return; stopAuto(); timer = setInterval(next, interval); if(pp){ pp.setAttribute('aria-pressed','false'); pp.setAttribute('aria-label','Pause autoplay'); pp.classList.remove('is-paused'); } }
      function stopAuto(){ if(timer){ clearInterval(timer); timer=null; } if(pp){ pp.setAttribute('aria-pressed','true'); pp.setAttribute('aria-label','Start autoplay'); pp.classList.add('is-paused'); } }
      if(pp){ pp.addEventListener('click', function(){ if(timer){ stopAuto(); } else { startAuto(); } }); }

      slider.setAttribute('tabindex','0');
      slider.addEventListener('keydown', function(e){ if(e.key === 'ArrowRight'){ next(); stopAuto(); } if(e.key === 'ArrowLeft'){ prev(); stopAuto(); } });

      slider.addEventListener('mouseenter', stopAuto);
      slider.addEventListener('mouseleave', startAuto);
      slider.addEventListener('focusin', stopAuto);
      slider.addEventListener('focusout', startAuto);

      window.addEventListener('resize', function(){ sizeTrack(); update(); }, { passive:true });

      sizeTrack();
      update();
      startAuto();
    })();

    // --- Effects (guarded) ---
    (function(){
      {% if s.scroll_reveal %}
      if(!reduce){
        var reveals = root.querySelectorAll('.q-reveal');
        if(reveals.length){
          var io = new IntersectionObserver(function(entries){
            entries.forEach(function(ent){ if(ent.isIntersecting){ ent.target.classList.add('is-revealed'); io.unobserve(ent.target); } });
          }, { threshold: 0.2 });
          reveals.forEach(function(el){ io.observe(el); });
        }
      }
      {% endif %}

      {% if s.enable_parallax %}
      if(!reduce){
        var card = root.querySelector('.q-card');
        if(card){
          var str = parseFloat({{ s.parallax_strength | default: 12 | json }});
          var rafId=null;
          function onScroll(){
            if(rafId) return;
            rafId = requestAnimationFrame(function(){
              var rect = card.getBoundingClientRect();
              var mid = window.innerHeight * 0.5;
              var delta = (rect.top + rect.height*0.5) - mid;
              var offset = Math.max(Math.min(delta / 20, 50), -50);
              card.style.backgroundPosition = 'center calc(50% + ' + (offset/str) + 'px)';
              rafId = null;
            });
          }
          document.addEventListener('scroll', onScroll, { passive:true });
          onScroll();
        }
      }
      {% endif %}

      {% if s.tilt_hover %}
      if(!reduce){
        var card2 = root.querySelector('.q-card');
        if(card2){
          var maxDeg = parseFloat({{ s.tilt_max | default: 8 | json }});
          var rect, cx, cy;
          function enter(){ rect = card2.getBoundingClientRect(); cx = rect.left + rect.width/2; cy = rect.top + rect.height/2; card2.style.transition = 'transform 200ms ease'; }
          function move(e){ var dx=(e.clientX-cx)/(rect.width/2), dy=(e.clientY-cy)/(rect.height/2); card2.style.transform='rotateX('+(-dy*maxDeg).toFixed(2)+'deg) rotateY('+(dx*maxDeg).toFixed(2)+'deg)'; }
          function leave(){ card2.style.transition = 'transform 250ms ease'; card2.style.transform='rotateX(0deg) rotateY(0deg)'; }
          card2.addEventListener('mouseenter', enter);
          card2.addEventListener('mousemove', move);
          card2.addEventListener('mouseleave', leave);
        }
      }
      {% endif %}

      {% if s.cursor_reactive_glow %}
      if(!reduce){
        var glow = root.querySelector('.q-cursor-glow');
        if(glow){
          function updateGlow(e){
            var r = root.getBoundingClientRect();
            var x = e.clientX - r.left, y = e.clientY - r.top;
            glow.style.opacity = '1';
            glow.style.background = 'radial-gradient(160px 120px at '+x+'px '+y+'px, rgba(99,102,241,.28), rgba(16,185,129,.15) 40%, transparent 70%)';
          }
          root.addEventListener('mousemove', updateGlow);
          root.addEventListener('mouseleave', function(){ glow.style.opacity = '0'; });
        }
      }
      {% endif %}

      {% if s.button_magnet %}
      if(!reduce){
        var primary = root.querySelector('.q-btn[data-cta="primary"]');
        if(primary){
          function pmove(e){ var r = primary.getBoundingClientRect(); var px = e.clientX - (r.left + r.width/2); var py = e.clientY - (r.top + r.height/2); primary.style.transform = 'translate('+(px/24)+'px,'+(py/24)+'px)'; }
          function preset(){ primary.style.transform = 'translate(0,0)'; }
          primary.addEventListener('mousemove', pmove);
          primary.addEventListener('mouseleave', preset);
        }
      }
      {% endif %}
    })();
  })();
  </script>

  <style>
/* ========================================================================== */
/*  Q-WEB3-BANNER — FINAL FIXED STYLESHEET                                    */
/*  - Full bleed slideshow                                                    */
/*  - Controls remain inside the banner                                       */
/*  - Hero keeps its rhythm                                                   */
/* ========================================================================== */

/* Heading & hover */
.q-web3-banner .q-heading{
  font-size: calc({{ settings.type_h1_size | default: 240 }} * 1%);
  letter-spacing: {{ settings.headings_letterspacing | default: 0 }}em;
  text-transform: {% if settings.headings_uppercase %}uppercase{% else %}none{% endif %};
}
.q-web3-banner .q-card:hover{
  box-shadow: 0 24px 90px rgba(16,185,129,.22), 0 10px 40px rgba(99,102,241,.18);
}

/* Buttons */
.q-web3-banner .q-btn{
  --btn-bg: {{ s.button_bg_color | default: settings.color_accent }};
  --btn-fg: {{ s.button_text_color | default: settings.text_on_color }};
  --btn-bd: {{ s.button_border_color | default: settings.color_accent }};
  border-radius: var(--q-btn-radius, {{ settings.button_radius | default: 12 }}px);
  border-width: var(--q-btn-border-w, {{ settings.button_border_width | default: 1 }}px);
  border-style: solid;
  display:inline-flex;align-items:center;justify-content:center;padding:.75rem 1.25rem;font-weight:600;
  text-transform:{% if settings.buttons_uppercase %}uppercase{% else %}none{% endif %};
  transition: transform .12s ease, box-shadow .2s ease, opacity .2s ease, background-position .25s ease;
  color:var(--btn-fg); position:relative; isolation:isolate; background: var(--btn-bg);
}
.q-web3-banner .q-btn--secondary{ border-color:var(--btn-bd); background:transparent; color:var(--btn-fg); }
.q-web3-banner .q-btn--neon{ border-color:transparent; box-shadow:0 8px 24px rgba(16,185,129,.25),0 0 0 rgba(99,102,241,0); }
.q-web3-banner .q-btn--neon:hover{
  opacity:{% raw %}{{{% endraw %} settings.button_hover_opacity | default: 92 {% raw %}}}{% endraw %}%;
  box-shadow:0 12px 36px rgba(16,185,129,.35),0 0 24px rgba(99,102,241,.35);
  transform:scale({% raw %}{{{% endraw %} settings.button_active_scale | default: 98 | times: 0.01 {% raw %}}}{% endraw %});
}

/* Reveal FX */
.q-web3-banner .q-cursor-glow{ mix-blend-mode:screen; filter:blur(12px); }
.q-web3-banner .q-reveal{opacity:0;transform:translate3d(0,12px,0) scale(.98);}
.q-web3-banner .q-reveal.is-revealed{opacity:1;transform:none;transition:opacity .6s ease, transform .6s ease;}

/* ========================================================================== */
/* FULL-BLEED SLIDESHOW                                                       */
/* ========================================================================== */

.q-web3-banner .q-slideshow{
  position: relative;
  overflow: hidden;              /* keeps arrows/dots inside */
  width: 100%;
  height: 100%;
  background: transparent;
  padding: 0 !important;
  border: none !important;
}

.q-web3-banner .q-viewport{ position:relative; width:100%; height:100%; overflow:hidden; }

.q-web3-banner .q-slides{
  display:flex;
  gap:0;
  width:100%;
  height:100%;
  transition: transform .5s ease;
  will-change: transform;
}

.q-web3-banner .q-slide{
  flex:0 0 100%;
  min-width:100%;
  width:100%;
  height:100%;
  box-sizing:border-box;
  background-repeat:no-repeat !important;
  background-size:cover !important;
  background-position:center !important;
}

/* ========================================================================== */
/* SLIDESHOW CONTROLS (kept inside banner)                                    */
/* ========================================================================== */

.q-web3-banner .q-ss-arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:44px; height:44px;
  border-radius:9999px; border:none; cursor:pointer;
  background:rgba(0,0,0,.35);
  box-shadow:0 2px 10px rgba(0,0,0,.25);
  z-index:30;
}
.q-web3-banner .q-ss-prev{ left:24px; }
.q-web3-banner .q-ss-next{ right:24px; }
.q-web3-banner .q-ss-arrow:after{
  content:''; display:block; width:10px; height:10px; border-top:2px solid #fff; border-right:2px solid #fff;
  position:absolute; top:50%; left:50%; transform:translate(-35%,-50%) rotate(225deg);
}
.q-web3-banner .q-ss-next:after{ transform:translate(-65%,-50%) rotate(45deg); }

.q-web3-banner .q-ss-dots{
  position:absolute; left:50%; transform:translateX(-50%);
  bottom:24px; display:flex; gap:8px; background:rgba(0,0,0,.25);
  padding:6px 10px; border-radius:9999px; z-index:30;
}
.q-web3-banner [data-q-dot]{ width:10px; height:10px; border-radius:9999px; background:#ffffff55; border:none; cursor:pointer; }
.q-web3-banner [data-q-dot].is-active{ background:#ffffff; }

.q-web3-banner .q-ss-pp{
  position:absolute; right:24px; bottom:24px;
  width:40px; height:40px; border-radius:9999px; border:none; background:rgba(0,0,0,.25);
  cursor:pointer; z-index:30;
}
.q-web3-banner .q-ss-pp:before, .q-web3-banner .q-ss-pp:after{ content:''; position:absolute; top:12px; width:6px; height:16px; background:#fff; border-radius:2px; }
.q-web3-banner .q-ss-pp:before{ left:13px; } .q-web3-banner .q-ss-pp:after{ right:13px; }
.q-web3-banner .q-ss-pp.is-paused:before{
  left:16px; width:0; height:0; border-top:8px solid transparent; border-bottom:8px solid transparent; border-left:12px solid #fff; background:transparent;
}
.q-web3-banner .q-ss-pp.is-paused:after{ display:none; }

/* ========================================================================== */
/* HERO CARD RHYTHM (non-slideshow)                                           */
/* ========================================================================== */
.q-web3-banner .q-card{ padding-top:6rem; padding-bottom:6rem; }
@media (min-width:768px){
  .q-web3-banner .q-card{ padding-left:3rem; padding-right:3rem; }
}

/* Animation + Motion */
@keyframes qGlow{
  0%{ transform: translate3d(-2%,-1%,0) scale(1.02); filter:saturate(1); }
  100%{ transform: translate3d(2%,1%,0) scale(1.04); filter:saturate(1.05); }
}
@media (prefers-reduced-motion: reduce){
  .q-web3-banner .q-reveal{opacity:1!important;transform:none!important;}
  .q-web3-banner [style*="qGlow"]{ animation:none!important; }
  .q-web3-banner .q-card{ transform:none!important; }
}

/* Mobile */
@media (max-width:768px){
  .q-web3-banner .q-heading{ font-size: clamp(1.75rem, 7vw, 2.25rem); line-height: 1.15; }
  .q-web3-banner .q-card{ padding:3.5rem 1rem; }
  .q-web3-banner .q-ss-arrow{ display:none; }
}
  </style>

  <noscript><style>.q-web3-banner .q-reveal{opacity:1 !important;transform:none !important;}</style></noscript>
</section>

{% schema %}
{
  "name": "Web3 Banner",
  "settings": [
    { "type": "header", "content": "Layout" },
    { "type": "select", "id": "layout_mode", "label": "Layout mode", "default": "slideshow", "options": [
      { "value": "hero", "label": "Hero (single)" },
      { "value": "slideshow", "label": "Slideshow" }
    ]},

    { "type": "header", "content": "Width & container" },
    { "type": "select", "id": "width_mode", "label": "Width mode", "default": "full", "options": [
      { "value": "theme", "label": "Theme container" },
      { "value": "custom", "label": "Custom max-width" },
      { "value": "full", "label": "Full bleed" }
    ]},
    { "type": "range", "id": "custom_max_w", "label": "Custom max-width (px)", "min": 960, "max": 1920, "step": 10, "default": 1440 },

    { "type": "select", "id": "pad_x", "label": "Page side padding", "default": "contained", "options": [
      { "value": "contained", "label": "Contained (px-4 md:px-6)" },
      { "value": "none", "label": "None" }
    ]},

    { "type": "checkbox", "id": "center_card_full", "label": "Center the main card (all width modes)", "default": true },
    { "type": "range", "id": "center_card_max_w", "label": "Max width when centered (px)", "min": 960, "max": 2200, "step": 20, "default": 1800 },

    { "type": "checkbox", "id": "card_container", "label": "Use rounded card container", "default": true },
    { "type": "range", "id": "card_radius", "label": "Card corner radius", "min": 0, "max": 64, "step": 1, "default": 36 },
    { "type": "checkbox", "id": "card_shadow", "label": "Card shadow", "default": true },
    { "type": "color", "id": "card_border_color", "label": "Card border color", "default": "#0000001a" },
    { "type": "range", "id": "card_border_width", "label": "Card border width", "min": 0, "max": 4, "step": 1, "default": 0 },

    { "type": "header", "content": "Content alignment" },
    { "type": "select", "id": "content_align_x", "label": "Horizontal align", "default": "start", "options": [
      { "value": "start", "label": "Start/Left" }, { "value": "center", "label": "Center" }, { "value": "end", "label": "End/Right" }
    ]},
    { "type": "select", "id": "content_align_y", "label": "Vertical align", "default": "center", "options": [
      { "value": "start", "label": "Top" }, { "value": "center", "label": "Center" }, { "value": "end", "label": "Bottom" }
    ]},

    { "type": "header", "content": "Hero content" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "New" },
    { "type": "color", "id": "kicker_color", "label": "Kicker color", "default": "#e5e7eb" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Redefine workouts with our activewear" },
    { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#ffffff" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Exclusive drops and early access." },
    { "type": "color", "id": "subheading_color", "label": "Subheading color", "default": "#f3f4f6" },
    { "type": "checkbox", "id": "text_shadow", "label": "Subtle text shadow over busy images", "default": true },
    { "type": "select", "id": "heading_level", "label": "Heading level", "default": "h1", "options": [
      { "value": "h1", "label": "H1" }, { "value": "h2", "label": "H2" }
    ]},
    { "type": "checkbox", "id": "hide_sub_mobile", "label": "Hide subheading on mobile", "default": false },
    { "type": "select", "id": "text_align", "label": "Text alignment", "default": "text-left", "options": [
      { "value": "text-left", "label": "Left" }, { "value": "text-center", "label": "Center" }, { "value": "text-right", "label": "Right" }
    ]},
    { "type": "text", "id": "content_max_w", "label": "Max text width (e.g. 72ch)", "default": "72ch" },

    { "type": "header", "content": "Hero buttons" },
    { "type": "text", "id": "cta_text", "label": "Primary button", "default": "Shop now" },
    { "type": "text", "id": "cta_aria_label", "label": "Primary button ARIA label", "default": "Shop now" },
    { "type": "text", "id": "cta2_text", "label": "Secondary button text", "default": "View collection" },
    { "type": "url", "id": "cta2_link", "label": "Secondary URL" },
    { "type": "collection", "id": "cta2_collection", "label": "…or link to collection" },
    { "type": "product", "id": "cta2_product", "label": "…or link to product" },
    { "type": "article", "id": "cta2_article", "label": "…or link to article" },
    { "type": "select", "id": "cta_align", "label": "CTA alignment", "default": "left", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "checkbox", "id": "cta_full_width_mobile", "label": "Full-width buttons on mobile", "default": true },

    { "type": "header", "content": "Media (hero optional)" },
    { "type": "image_picker", "id": "media_image", "label": "Side image" },
    { "type": "text", "id": "media_alt", "label": "Media alt", "default": "Artwork" },
    { "type": "text", "id": "media_video", "label": "Side video URL (MP4)" },
    { "type": "image_picker", "id": "media_poster", "label": "Side video poster" },
    { "type": "select", "id": "media_position", "label": "Media position", "default": "right", "options": [
      { "value": "left", "label": "Left" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "select", "id": "media_width", "label": "Media width (desktop)", "default": "5", "options": [
      { "value": "5", "label": "5/12" }, { "value": "6", "label": "1/2" }, { "value": "7", "label": "7/12" }
    ]},

    { "type": "header", "content": "Background & overlay (hero)" },
    { "type": "image_picker", "id": "background_image", "label": "Background image" },
    { "type": "url", "id": "background_url", "label": "Background image URL (remote)" },
    { "type": "text", "id": "bg_image_alt", "label": "Background image alt", "default": "Decorative background" },
    { "type": "color", "id": "bg_fallback_color", "label": "Background fallback (no image)", "default": "#0b0b12" },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "default": 45 },
    { "type": "range", "id": "overlay_blur_px", "label": "Overlay blur (px)", "min": 0, "max": 20, "step": 1, "default": 0 },

    { "type": "header", "content": "Gradient / glow (hero)" },
    { "type": "color", "id": "gradient_top", "label": "Gradient top", "default": "#0b0b12" },
    { "type": "color", "id": "gradient_bottom", "label": "Gradient bottom", "default": "#12121a" },
    { "type": "color", "id": "glow_color_1", "label": "Glow color 1", "default": "rgba(76, 29, 149, 0.35)" },
    { "type": "color", "id": "glow_color_2", "label": "Glow color 2", "default": "rgba(3, 105, 161, 0.30)" },
    { "type": "color", "id": "glow_color_3", "label": "Glow color 3", "default": "rgba(16, 185, 129, 0.25)" },
    { "type": "checkbox", "id": "animate_glow", "label": "Subtle glow animation", "default": true },

    { "type": "header", "content": "Motion & FX (hero)" },
    { "type": "checkbox", "id": "scroll_reveal", "label": "Reveal on scroll", "default": true },
    { "type": "range", "id": "parallax_strength", "label": "Parallax strength", "min": 6, "max": 30, "step": 1, "default": 12 },
    { "type": "checkbox", "id": "enable_parallax", "label": "Parallax background on scroll", "default": true },
    { "type": "checkbox", "id": "tilt_hover", "label": "Tilt card on hover", "default": true },
    { "type": "range", "id": "tilt_max", "label": "Tilt max degrees", "min": 2, "max": 20, "step": 1, "default": 8 },
    { "type": "checkbox", "id": "cursor_reactive_glow", "label": "Cursor reactive glow", "default": true },

    { "type": "header", "content": "Button FX" },
    { "type": "select", "id": "button_fx", "label": "Primary button style", "default": "neon", "options": [
      { "value": "neon", "label": "Neon glow" }, { "value": "gradient", "label": "Animated gradient" }
    ]},
    { "type": "checkbox", "id": "button_magnet", "label": "Magnetic hover (primary button)", "default": true },
    { "type": "select", "id": "button_mode", "label": "Fallback primary style (if overriding colors)", "default": "solid", "options": [
      { "value": "solid", "label": "Solid" }, { "value": "outline", "label": "Outline" }
    ]},
    { "type": "color", "id": "button_bg_color", "label": "Primary background (override)", "default": "#10b981" },
    { "type": "color", "id": "button_text_color", "label": "Primary text color (override)", "default": "#ffffff" },
    { "type": "color", "id": "button_border_color", "label": "Secondary/outline border", "default": "#ffffff" },
    { "type": "range", "id": "button_border_width", "label": "Outline border width", "min": 0, "max": 6, "step": 1, "default": 1 },
    { "type": "range", "id": "button_radius", "label": "Button corner radius", "min": 0, "max": 36, "step": 1, "default": 12 },

    { "type": "header", "content": "Layout controls" },
    { "type": "range", "id": "min_height_vh", "label": "Min height (vh)", "min": 40, "max": 100, "step": 5, "default": 65 },
    { "type": "range", "id": "padding_top", "label": "Padding top (px)", "min": 0, "max": 240, "step": 8, "default": 96 },
    { "type": "range", "id": "padding_bottom", "label": "Padding bottom (px)", "min": 0, "max": 240, "step": 8, "default": 96 },

    { "type": "header", "content": "Slideshow controls" },
    { "type": "text", "id": "carousel_label", "label": "Accessible carousel label", "default": "Slideshow banner" },
    { "type": "checkbox", "id": "ss_show_arrows", "label": "Show arrows", "default": true },
    { "type": "checkbox", "id": "ss_show_dots", "label": "Show dots", "default": true },
    { "type": "checkbox", "id": "ss_autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "ss_interval", "label": "Autoplay interval (s)", "min": 3, "max": 15, "step": 1, "default": 8 }
  ],
  "blocks": [
    {
      "type": "bullet",
      "name": "Bullet (hero)",
      "settings": [
        { "type": "select", "id": "icon", "label": "Icon", "default": "dot", "options": [
          { "value": "dot", "label": "Dot" }, { "value": "bolt", "label": "Bolt" }, { "value": "shield", "label": "Shield" }
        ]},
        { "type": "text", "id": "text", "label": "Text", "default": "Holder-only discount & early access" }
      ]
    },
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "background_image", "label": "Background image (picker)" },
        { "type": "url", "id": "background_image_url", "label": "Background image URL (https)", "info": "Use this for remote CDN images. For Shopify files, use the picker above." },
        { "type": "select", "id": "bg_position", "label": "Background position", "default": "center", "options": [
          { "value": "center", "label": "Center" }, { "value": "left", "label": "Left" }, { "value": "right", "label": "Right" }, { "value": "top", "label": "Top" }, { "value": "bottom", "label": "Bottom" }
        ]},
        { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
        { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "default": 35 },

        { "type": "text", "id": "kicker", "label": "Kicker" },
        { "type": "color", "id": "kicker_color", "label": "Kicker color", "default": "#e5e7eb" },

        { "type": "text", "id": "heading", "label": "Heading" },
        { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#ffffff" },

        { "type": "textarea", "id": "subheading", "label": "Subheading" },
        { "type": "color", "id": "subheading_color", "label": "Subheading color", "default": "#f3f4f6" },

        { "type": "text", "id": "cta_text", "label": "Primary button label" },
        { "type": "url", "id": "cta_link", "label": "Primary button link" },
        { "type": "text", "id": "cta_aria_label", "label": "Primary button ARIA label" },

        { "type": "text", "id": "cta2_text", "label": "Secondary button label" },
        { "type": "url", "id": "cta2_link", "label": "Secondary button link" },
        { "type": "text", "id": "cta2_aria_label", "label": "Secondary button ARIA label" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Web3 Banner (Hero/Slideshow)",
      "category": "Banner",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" }
      ],
      "settings": {
        "layout_mode": "slideshow",
        "width_mode": "full",
        "center_card_full": true,
        "center_card_max_w": 1800,
        "card_container": true,
        "card_radius": 36,
        "card_shadow": true,
        "ss_show_arrows": true,
        "ss_show_dots": true,
        "ss_autoplay": true,
        "ss_interval": 8
      }
    }
  ]
}
{% endschema %}
