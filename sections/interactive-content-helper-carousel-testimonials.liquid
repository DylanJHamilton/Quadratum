{% comment %}
  Quadratum — Interactive · Carousel — Testimonials & Reviews
  File: sections/interactive-content-helper-carousel-testimonials-reviews.liquid

  Uses the SAME canonical carousel engine as Media/Logos:
  - assets/interactive-content-carousel-media.js

  Section-specific styling:
  - assets/interactive-content-carousel-testimonials-reviews.css

  Dependency:
  - snippets/testimonial-card.liquid (DO NOT MODIFY)
{% endcomment %}

{%- liquid
  assign blocks = section.blocks | where: 'type', 'testimonial'
  assign count = blocks.size
  if count == 0
    break
  endif

  assign layout = section.settings.layout

  assign show_header = section.settings.show_header
  assign source_label = section.settings.source_label
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading

  assign show_rating = section.settings.show_rating_stars
  assign show_badge = section.settings.show_platform_badge
  assign show_avatar = section.settings.show_avatar
  assign show_role = section.settings.show_role_or_location
  assign make_link = section.settings.show_link_to_full_review

  assign spv_d = section.settings.slides_per_view_desktop
  assign spv_t = section.settings.slides_per_view_tablet
  assign spv_m = section.settings.slides_per_view_mobile
  assign peek = section.settings.mobile_peek_pct

  assign autoplay = section.settings.autoplay
  assign autoplay_speed = section.settings.autoplay_speed
  assign loop = section.settings.loop
  assign show_arrows = section.settings.show_arrows
  assign show_dots = section.settings.show_dots
  assign pause_hover = section.settings.pause_on_hover
  assign pause_focus = section.settings.pause_on_focus

  assign use_custom = section.settings.use_custom_colors

  assign should_init = true
  if count == 1
    assign should_init = false
  endif
  if autoplay == false and show_arrows == false and show_dots == false
    assign should_init = false
  endif

  if count < 2
    assign show_arrows = false
    assign show_dots = false
  endif
-%}

{{ 'interactive-content-carousel-testimonials.css' | asset_url | stylesheet_tag }}
<script src="{{ 'interactive-content-carousel-media.js' | asset_url }}" defer></script>
<script src="{{ 'interactive-content-carousel-testimonials.js' | asset_url }}" defer></script>


<section
  class="q-trust-carousel q-trust-carousel--{{ layout }}"
  style="
    --q-tr-maxw: {{ section.settings.max_width }}px;
    --q-tr-pad-y: {{ section.settings.pad_y }}px;
    --q-tr-pad-x: {{ section.settings.pad_x }}px;
    --q-tr-gap: {{ section.settings.gap }}px;

    /* Card token forwarding (matches your testimonial-card vars) */
    --q-tm-radius: {{ section.settings.radius }}px;
    --q-tm-shadow-strength: {{ section.settings.shadow_strength }};

    /* Carousel sizing */
    --q-tr-spv-d: {{ spv_d }};
    --q-tr-spv-t: {{ spv_t }};
    --q-tr-spv-m: {{ spv_m }};
    --q-tr-peek: {{ peek }}%;
    --q-tr-arrow-gutter: {{ section.settings.arrows_gutter_px }}px;
    --q-tr-arrow-inset: {{ section.settings.arrows_inset_px }}px;

    {%- if use_custom -%}
      --q-tr-bg: {{ section.settings.bg }};
      --q-tr-text: {{ section.settings.text }};
      --q-tr-muted: {{ section.settings.muted }};
      --q-tr-accent: {{ section.settings.accent }};
      --q-tr-surface: {{ section.settings.surface }};
      --q-tr-border: {{ section.settings.border }};

      /* forward to testimonial-card token vars */
      --q-tm-surface: {{ section.settings.surface }};
      --q-tm-text: {{ section.settings.text }};
      --q-tm-muted: {{ section.settings.muted }};
      --q-tm-accent: {{ section.settings.accent }};
      --q-tm-border: {{ section.settings.border }};
    {%- endif -%}
  "
>
  <div class="q-tr-inner">
    {%- if show_header -%}
      <header class="q-tr-header">
        {%- if source_label != blank -%}<div class="q-tr-source">{{ source_label }}</div>{%- endif -%}
        {%- if heading != blank -%}<h2 class="q-tr-heading">{{ heading }}</h2>{%- endif -%}
        {%- if subheading != blank -%}<p class="q-tr-subheading">{{ subheading }}</p>{%- endif -%}
      </header>
    {%- endif -%}

    <div
      class="q-carousel q-tr-shell"
      {% if should_init %}
        data-q-carousel
        data-loop="{{ loop }}"
        data-autoplay="{{ autoplay }}"
        data-autoplay-speed="{{ autoplay_speed }}"
        data-show-arrows="{{ show_arrows }}"
        data-show-dots="{{ show_dots }}"
        data-pause-hover="{{ pause_hover }}"
        data-pause-focus="{{ pause_focus }}"
        data-type="testimonials"
      {% endif %}
    >
      <div class="q-tr-viewport-wrap">
        <div class="q-carousel__viewport" tabindex="0" aria-label="Testimonials carousel">
          <div class="q-carousel__track">
            {%- for block in blocks -%}
              {%- liquid
                assign quote = block.settings.quote
                assign name = block.settings.name
                assign role = block.settings.role_or_location
                assign rating = block.settings.rating
                assign avatar = block.settings.avatar_image

                assign platform = block.settings.platform
                assign custom_badge_label = block.settings.platform_label
                assign custom_badge_icon = block.settings.platform_icon

                assign url = block.settings.link_to_full_review
                assign aria = block.settings.link_aria_label

                assign slide_tag = 'div'
                if make_link and url != blank
                  assign slide_tag = 'a'
                endif
              -%}

              <{{ slide_tag }}
                class="q-carousel__slide q-tr-slide"
                {% if slide_tag == 'a' %}
                  href="{{ url }}"
                  aria-label="{{ aria | default: 'Read full review' }}"
                {% else %}
                  role="group"
                {% endif %}
                {{ block.shopify_attributes }}
              >
                {% render 'testimonial-card',
                  variant: 'standard',
                  align: section.settings.align,
                  quote: quote,
                  name: name,
                  role: role,
                  avatar: avatar,
                  rating: rating,
                  platform: platform,
                  custom_badge_label: custom_badge_label,
                  custom_badge_icon: custom_badge_icon,
                  show_rating: show_rating,
                  show_badge: show_badge,
                  show_context: false,
                  show_featured_product: false,
                  show_featured_product_preview: false
                %}
              </{{ slide_tag }}>
            {%- endfor -%}
          </div>
        </div>
      </div>

      {%- if should_init and show_arrows -%}
        <div class="q-carousel__arrows" aria-hidden="false">
          <button class="q-carousel__btn q-carousel__btn--prev" type="button" aria-label="Previous testimonial" data-q-carousel-prev>
            <span aria-hidden="true">‹</span>
          </button>
          <button class="q-carousel__btn q-carousel__btn--next" type="button" aria-label="Next testimonial" data-q-carousel-next>
            <span aria-hidden="true">›</span>
          </button>
        </div>
      {%- endif -%}

      {%- if should_init and show_dots -%}
        <div class="q-carousel__dots" data-q-carousel-dots></div>
      {%- endif -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Interactive Testimonials",
  "tag": "section",
  "class": "q-section q-trust-carousel-section",
  "settings": [
    { "type": "header", "content": "Header" },
    { "type": "checkbox", "id": "show_header", "label": "Show header", "default": true },
    { "type": "text", "id": "source_label", "label": "Source label", "default": "What our customers say" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Trusted by real customers" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Short, authentic reviews that help new shoppers feel confident." },

    { "type": "header", "content": "Layout" },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "default": "single",
      "options": [
        { "value": "single", "label": "Single" },
        { "value": "two_up", "label": "Two-up" }
      ]
    },
    {
      "type": "select",
      "id": "align",
      "label": "Card alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },

    { "type": "header", "content": "Display toggles" },
    { "type": "checkbox", "id": "show_rating_stars", "label": "Show rating stars", "default": true },
    { "type": "checkbox", "id": "show_platform_badge", "label": "Show platform badge", "default": false },
    { "type": "checkbox", "id": "show_avatar", "label": "Show avatar", "default": true },
    { "type": "checkbox", "id": "show_role_or_location", "label": "Show role/location", "default": true },
    { "type": "checkbox", "id": "show_link_to_full_review", "label": "Make cards link to full review", "default": false },

    { "type": "header", "content": "Carousel settings" },
    { "type": "range", "id": "slides_per_view_desktop", "label": "Desktop slides per view", "min": 1, "max": 3, "step": 1, "default": 1 },
    { "type": "range", "id": "slides_per_view_tablet", "label": "Tablet slides per view", "min": 1, "max": 3, "step": 1, "default": 1 },
    { "type": "range", "id": "slides_per_view_mobile", "label": "Mobile slides per view", "min": 1, "max": 3, "step": 1, "default": 1 },
    { "type": "range", "id": "mobile_peek_pct", "label": "Mobile peek (%)", "min": 0, "max": 40, "step": 1, "default": 16 },

    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_speed", "label": "Autoplay speed (ms)", "min": 1500, "max": 9000, "step": 100, "default": 4000 },
    { "type": "checkbox", "id": "loop", "label": "Loop", "default": true },
    { "type": "checkbox", "id": "show_arrows", "label": "Show arrows", "default": true },
    { "type": "checkbox", "id": "show_dots", "label": "Show dots", "default": false },
    { "type": "checkbox", "id": "pause_on_hover", "label": "Pause on hover", "default": true },
    { "type": "checkbox", "id": "pause_on_focus", "label": "Pause on focus", "default": true },

    { "type": "header", "content": "Arrow positioning" },
    { "type": "range", "id": "arrows_gutter_px", "label": "Arrow gutter outside content (px)", "min": 0, "max": 140, "step": 4, "default": 64 },
    { "type": "range", "id": "arrows_inset_px", "label": "Arrow inset from section edges (px)", "min": 0, "max": 80, "step": 4, "default": 24 },

    { "type": "header", "content": "Layout & framing" },
    { "type": "range", "id": "max_width", "label": "Max width (px)", "min": 960, "max": 1800, "step": 20, "default": 1400 },
    { "type": "range", "id": "pad_y", "label": "Padding Y (px)", "min": 0, "max": 140, "step": 4, "default": 64 },
    { "type": "range", "id": "pad_x", "label": "Padding X (px)", "min": 0, "max": 80, "step": 4, "default": 24 },
    { "type": "range", "id": "gap", "label": "Gap (px)", "min": 8, "max": 48, "step": 2, "default": 18 },
    { "type": "range", "id": "radius", "label": "Radius (px)", "min": 0, "max": 40, "step": 2, "default": 16 },
    { "type": "range", "id": "shadow_strength", "label": "Shadow strength", "min": 0, "max": 1, "step": 0.1, "default": 0.2 },

    { "type": "header", "content": "Colors (scoped)" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors", "default": false },
    { "type": "color", "id": "bg", "label": "Background", "default": "#FFFFFF" },
    { "type": "color", "id": "text", "label": "Text", "default": "#111111" },
    { "type": "color", "id": "muted", "label": "Muted", "default": "#6B7280" },
    { "type": "color", "id": "accent", "label": "Accent", "default": "#111111" },
    { "type": "color", "id": "surface", "label": "Surface", "default": "#FFFFFF" },
    { "type": "color", "id": "border", "label": "Border", "default": "#E6E6E6" }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "richtext", "id": "quote", "label": "Quote", "default": "<p>We swapped to Quadratum and immediately saw higher add-to-carts. It’s fast, clean, and feels premium.</p>" },
        { "type": "text", "id": "name", "label": "Name", "default": "Jordan M." },
        { "type": "text", "id": "role_or_location", "label": "Role/location", "default": "Verified customer" },
        { "type": "image_picker", "id": "avatar_image", "label": "Avatar image" },
        { "type": "range", "id": "rating", "label": "Rating", "min": 0, "max": 5, "step": 1, "default": 5 },

        {
          "type": "select",
          "id": "platform",
          "label": "Platform",
          "default": "google",
          "options": [
            { "value": "google", "label": "Google" },
            { "value": "facebook", "label": "Facebook" },
            { "value": "yelp", "label": "Yelp" },
            { "value": "trustpilot", "label": "Trustpilot" },
            { "value": "custom", "label": "Custom" },
            { "value": "none", "label": "None" }
          ]
        },
        { "type": "text", "id": "platform_label", "label": "Custom badge label (platform = custom)", "default": "Verified" },
        { "type": "image_picker", "id": "platform_icon", "label": "Custom badge icon (platform = custom)" },

        { "type": "url", "id": "link_to_full_review", "label": "Link to full review" },
        { "type": "text", "id": "link_aria_label", "label": "Link aria-label", "default": "Read full review" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Interactive · Carousel — Testimonials & Reviews",
      "category": "Interactive Content Helpers"
    }
  ]
}
{% endschema %}
