{% comment %}
  Quadratum • Boxed-in Content Banner
  - Centered “boxed” promo with optional media (image/video), overlay, text, bullets and CTAs.
  - Controls: media position, media width, padding, background image/overlay, outline/solid buttons.
  - A11y: labeled region, reduced-motion friendly, focus-visible rings.
  - Perf: responsive images with sane width set; no mixed quotes in image_tag.
  - Analytics: optional events via dataLayer + custom event.
{% endcomment %}

{% assign s = section.settings %}

{%- comment -%} Container padding for contained mode {%- endcomment -%}
{% assign container_pad = '' %}
{% if s.container_mode == 'contained' %}
  {% assign container_pad = 'px-4 md:px-6' %}
{% endif %}

{%- comment -%} Visibility toggles {%- endcomment -%}
{% assign visibility_classes = '' %}
{% if s.hide_on_mobile %}{% assign visibility_classes = visibility_classes | append: ' hidden md:block' %}{% endif %}
{% if s.hide_on_desktop %}{% assign visibility_classes = visibility_classes | append: ' md:hidden' %}{% endif %}

{%- comment -%} Media width (desktop) {%- endcomment -%}
{% assign media_w = s.media_width | default: '6' %}
{% case media_w %}
  {% when '4' %}{% assign media_cols = 4 %}{% assign content_cols = 8 %}
  {% when '5' %}{% assign media_cols = 5 %}{% assign content_cols = 7 %}
  {% when '6' %}{% assign media_cols = 6 %}{% assign content_cols = 6 %}
  {% when '7' %}{% assign media_cols = 7 %}{% assign content_cols = 5 %}
  {% else %}{% assign media_cols = 6 %}{% assign content_cols = 6 %}
{% endcase %}

{%- comment -%} Build class strings for grid {%- endcomment -%}
{% assign media_col_class = 'lg:col-span-' | append: media_cols %}
{% assign content_col_class = 'lg:col-span-' | append: content_cols %}

<section
  id="{{ s.anchor_id | default: 'section-' | append: section.id }}"
  class="relative {{ s.pad_y | default: 'py-12 md:py-16' }}{{ visibility_classes }}"
  role="region"
  aria-label="{{ s.region_label | default: 'Promotional content' }}"
>
  <div class="mx-auto max-w-screen-xl {{ container_pad }}">
    <div class="relative overflow-hidden rounded-2xl bg-card ring-1 ring-border">
      {%- if s.box_background_image != blank -%}
        {%- assign sizes_bg = '100vw' -%}
        {%- assign widths_bg = '960,1280,1600,1920' -%}
        <div class="absolute inset-0 -z-10">
          {{ s.box_background_image
            | image_url: width: 1920
            | image_tag:
              widths: widths_bg,
              sizes: sizes_bg,
              loading: 'eager',
              fetchpriority: 'high',
              class: 'absolute inset-0 w-full h-full object-cover',
              alt: s.box_bg_alt }}
          <div class="absolute inset-0" aria-hidden="true"
               style="background-color: {{ s.overlay_color }}; opacity: {{ s.overlay_opacity | divided_by: 100.0 }};">
          </div>
        </div>
      {%- endif -%}

      <div class="{{ s.pad_box | default: 'p-6 md:p-10' }}">
        {% if s.kicker != blank or s.heading != blank or s.subheading != blank %}
          <div class="mb-6 md:mb-8 {{ s.header_align | default: 'text-center' }}">
            {% if s.kicker != blank %}
              <p class="text-sm font-semibold tracking-wide uppercase text-muted-foreground">{{ s.kicker }}</p>
            {% endif %}
            {% if s.heading != blank %}
              <h2 class="mt-2 text-2xl md:text-4xl font-semibold leading-tight text-foreground">{{ s.heading | escape }}</h2>
            {% endif %}
            {% if s.subheading != blank %}
              <p class="mt-3 text-base md:text-lg text-muted-foreground">{{ s.subheading }}</p>
            {% endif %}
          </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8 items-center">
          {%- comment -%} SAFE boolean flag for media ordering {%- endcomment -%}
          {% assign media_first = false %}
          {% if s.media_position == 'left' %}
            {% assign media_first = true %}
          {% endif %}

          {% if media_first %}
            {% render 'boxed-content-media', s: s, media_col_class: media_col_class %}
          {% endif %}

          <div class="col-span-1 {{ content_col_class }}">
            <div class="{{ s.content_align | default: 'text-left' }}">
              {% if s.content_kicker != blank %}
                <p class="text-sm font-semibold tracking-wide uppercase text-muted-foreground">{{ s.content_kicker }}</p>
              {% endif %}
              {% if s.content_heading != blank %}
                <h3 class="mt-1 text-xl md:text-2xl font-semibold text-foreground">{{ s.content_heading | escape }}</h3>
              {% endif %}
              {% if s.content_text != blank %}
                <div class="mt-3 prose prose-sm md:prose-base max-w-none text-foreground/90">
                  {{ s.content_text }}
                </div>
              {% endif %}

              {% assign bullet_blocks = section.blocks | where: 'type', 'bullet' %}
              {% if bullet_blocks.size > 0 %}
                <ul class="mt-4 space-y-2">
                  {% for block in bullet_blocks %}
                    {% assign b = block.settings %}
                    <li class="flex items-start gap-3" {{ block.shopify_attributes }}>
                      {% case b.icon %}
                        {% when 'check' %}<svg class="mt-1 h-4 w-4 text-emerald-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M16.707 5.293a1 1 0 010 1.414l-7.5 7.5a1 1 0 01-1.414 0l-3-3a1 1 0 011.414-1.414L8.5 12.086l6.793-6.793a1 1 0 011.414 0z"/></svg>
                        {% when 'star' %}<svg class="mt-1 h-4 w-4 text-amber-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.802 2.036a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.802-2.036a1 1 0 00-1.176 0l-2.802 2.036c-.785.57-1.84-.197-1.54-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.88 8.72c-.783-.57-.38-1.81.588-1.81h3.462a1 1 0 00.95-.69l1.07-3.292z"/></svg>
                        {% when 'bolt' %}<svg class="mt-1 h-4 w-4 text-sky-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M11.3 1L3 11h5l-.8 8L15 9h-5l1.3-8z"/></svg>
                        {% else %}<span class="mt-1 inline-block h-2 w-2 rounded-full bg-primary"></span>
                      {% endcase %}
                      <span class="text-sm md:text-base text-foreground/90">{{ b.text }}</span>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}

              {% assign has_cta1 = false %}
              {% if s.cta_text != blank and s.cta_link != blank %}{% assign has_cta1 = true %}{% endif %}
              {% assign has_cta2 = false %}
              {% if s.cta2_text != blank and s.cta2_link != blank %}{% assign has_cta2 = true %}{% endif %}

              {% if has_cta1 or has_cta2 %}
                <div class="mt-5 flex flex-wrap gap-3 {% if s.cta_group_align == 'left' %}justify-start{% elsif s.cta_group_align == 'right' %}justify-end{% else %}justify-start{% endif %}">
                  {% if has_cta1 %}
                    <a href="{{ s.cta_link }}"
                       data-cta="primary"
                       class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 transition
                              {% if s.button_mode == 'outline' %}border bg-transparent{% else %}bg-primary text-primary-foreground hover:opacity-90{% endif %}"
                       style="{% if s.button_mode == 'outline' %}color: {{ s.button_text_color }}; border-color: {{ s.button_border_color }}; border-width: {{ s.button_border_width }}px;{% else %}color: {{ s.button_text_color }}; background-color: {{ s.button_bg_color }};{% endif %} border-radius: {{ s.button_radius }}px;"
                       aria-label="{{ s.cta_aria_label | default: s.cta_text | escape }}">
                      {{ s.cta_text }}
                    </a>
                  {% endif %}
                  {% if has_cta2 %}
                    <a href="{{ s.cta2_link }}"
                       data-cta="secondary"
                       class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 transition
                              {% if s.button_mode == 'outline' %}border bg-transparent{% else %}border border-input bg-background hover:bg-accent hover:text-accent-foreground{% endif %}"
                       style="{% if s.button_mode == 'outline' %}color: {{ s.button_text_color }}; border-color: {{ s.button_border_color }}; border-width: {{ s.button_border_width }}px;{% else %}color: {{ s.button_text_color }};{% endif %} border-radius: {{ s.button_radius }}px;"
                       aria-label="{{ s.cta2_aria_label | default: s.cta2_text | escape }}">
                      {{ s.cta2_text }}
                    </a>
                  {% endif %}
                </div>
              {% endif %}
            </div>
          </div>

          {% unless media_first %}
            {% render 'boxed-content-media', s: s, media_col_class: media_col_class %}
          {% endunless %}
        </div>
      </div>
    </div>
  </div>

  {% if s.send_events %}
    <script>
      (function(){
        var root = document.getElementById('{{ s.anchor_id | default: 'section-' | append: section.id }}');
        if(!root) return;
        root.addEventListener('click', function(e){
          var a = e.target.closest('a[data-cta]');
          if(!a) return;
          var payload = { component: 'boxed_content_banner', cta_type: a.getAttribute('data-cta'), href: a.getAttribute('href') };
          window.dispatchEvent(new CustomEvent('quadratum:cta', { detail: payload }));
          if(window.dataLayer && Array.isArray(window.dataLayer)){
            window.dataLayer.push({ event: 'quadratum_cta', component: payload.component, cta_type: payload.cta_type, href: payload.href });
          }
        });
      })();
    </script>
  {% endif %}
</section>

{% render 'tw-safelist-banners' %}

{% schema %}
{
  "name": "Boxed-in Content Banner",
  "tag": "section",
  "class": "q-boxed-banner",
  "settings": [
    { "type": "header", "content": "Header" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Featured" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Built for conversions" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "A concise supporting line that nudges action." },

    { "type": "header", "content": "Layout" },
    { "type": "select", "id": "media_position", "label": "Media position", "default": "left", "options": [
      { "value": "left", "label": "Left" },
      { "value": "right", "label": "Right" }
    ]},
    { "type": "select", "id": "media_width", "label": "Media width (desktop)", "default": "6", "options": [
      { "value": "4", "label": "1/3" },
      { "value": "5", "label": "5/12" },
      { "value": "6", "label": "1/2" },
      { "value": "7", "label": "7/12" }
    ]},
    { "type": "select", "id": "header_align", "label": "Header alignment", "default": "text-center", "options": [
      { "value": "text-left", "label": "Left" },
      { "value": "text-center", "label": "Center" },
      { "value": "text-right", "label": "Right" }
    ]},
    { "type": "select", "id": "content_align", "label": "Body alignment", "default": "text-left", "options": [
      { "value": "text-left", "label": "Left" },
      { "value": "text-center", "label": "Center" },
      { "value": "text-right", "label": "Right" }
    ]},

    { "type": "header", "content": "Box background" },
    { "type": "image_picker", "id": "box_background_image", "label": "Background image (optional)" },
    { "type": "text", "id": "box_bg_alt", "label": "Background image alt", "default": "Decorative background" },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "default": 20, "unit": "%" },

    { "type": "header", "content": "Padding & container" },
    { "type": "select", "id": "pad_box", "label": "Inner padding", "default": "p-6 md:p-10", "options": [
      { "value": "p-6 md:p-8", "label": "Small" },
      { "value": "p-6 md:p-10", "label": "Medium" },
      { "value": "p-8 md:p-12", "label": "Large" }
    ]},
    { "type": "select", "id": "pad_y", "label": "Vertical section padding", "default": "py-12 md:py-16", "options": [
      { "value": "py-8 md:py-12", "label": "Small" },
      { "value": "py-12 md:py-16", "label": "Medium" },
      { "value": "py-16 md:py-24", "label": "Large" }
    ]},
    { "type": "select", "id": "container_mode", "label": "Container", "default": "contained", "options": [
      { "value": "contained", "label": "Contained (side padding)" },
      { "value": "full", "label": "Full-bleed (edge to edge)" }
    ]},

    { "type": "header", "content": "Primary content" },
    { "type": "text", "id": "content_kicker", "label": "Content kicker", "default": "Why choose us" },
    { "type": "text", "id": "content_heading", "label": "Content heading", "default": "Made to sell, built to last" },
    { "type": "richtext", "id": "content_text", "label": "Content text", "default": "<p>Use this area for persuasive copy: your value prop, differentiators, and guarantees.</p>" },

    { "type": "header", "content": "Buttons (global)" },
    { "type": "select", "id": "cta_group_align", "label": "Button alignment", "default": "left", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "select", "id": "button_mode", "label": "Button style", "default": "solid", "options": [
      { "value": "solid", "label": "Solid" },
      { "value": "outline", "label": "Outline" }
    ]},
    { "type": "text", "id": "cta_text", "label": "Primary button text", "default": "Shop now" },
    { "type": "url", "id": "cta_link", "label": "Primary button URL" },
    { "type": "text", "id": "cta_aria_label", "label": "Primary button ARIA label", "default": "Shop now" },
    { "type": "text", "id": "cta2_text", "label": "Secondary button text", "default": "Learn more" },
    { "type": "url", "id": "cta2_link", "label": "Secondary button URL" },
    { "type": "text", "id": "cta2_aria_label", "label": "Secondary button ARIA label", "default": "Learn more" },

    { "type": "header", "content": "Visibility & analytics" },
    { "type": "text", "id": "anchor_id", "label": "Optional anchor ID" },
    { "type": "text", "id": "region_label", "label": "Accessible region label", "default": "Promotional content" },
    { "type": "checkbox", "id": "hide_on_mobile", "label": "Hide on mobile", "default": false },
    { "type": "checkbox", "id": "hide_on_desktop", "label": "Hide on desktop", "default": false },
    { "type": "checkbox", "id": "send_events", "label": "Send analytics events on clicks", "default": false }
  ],
  "blocks": [
    {
      "type": "bullet",
      "name": "Bullet",
      "settings": [
        { "type": "select", "id": "icon", "label": "Icon", "default": "check", "options": [
          { "value": "dot", "label": "Dot" },
          { "value": "check", "label": "Check" },
          { "value": "star", "label": "Star" },
          { "value": "bolt", "label": "Bolt" }
        ]},
        { "type": "text", "id": "text", "label": "Text", "default": "Fast, free shipping & returns" }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [
    {
      "name": "Boxed content • Media left",
      "category": "Banner"
    }
  ]
}
{% endschema %}
