{% comment %}
  Quadratum — Interactive · Carousel — Media & Logos
  File: sections/interactive-content-helper-carousel-media-logos.liquid

  Assets:
  - assets/interactive-content-carousel-media.css
  - assets/interactive-content-carousel-media.js

  Link behavior (“everything can be links”, safely):
  - If link_url is set: slide becomes a full-card <a> (images + logos).
  - Video slides:
      - If link_url is set: render a video TEASER (poster + play badge) as a full-card link
        to avoid nested interactive elements (iframe inside <a>).
      - If link_url is NOT set: render inline embed (v1).
{% endcomment %}

{%- liquid
  assign blocks = section.blocks | where: 'type', 'slide'
  assign count = blocks.size
  if count == 0
    break
  endif

  assign type = section.settings.carousel_type

  assign show_header = section.settings.show_header
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading

  assign spv_d = section.settings.slides_per_view_desktop
  assign spv_t = section.settings.slides_per_view_tablet
  assign spv_m = section.settings.slides_per_view_mobile
  assign peek = section.settings.mobile_peek_pct

  assign autoplay = section.settings.autoplay
  assign autoplay_speed = section.settings.autoplay_speed
  assign loop = section.settings.loop

  assign show_arrows = section.settings.show_arrows
  assign show_dots = section.settings.show_dots

  assign controls_mode = section.settings.controls_mode
  if controls_mode == 'autonomous'
    assign show_arrows = false
    assign show_dots = false
  endif

  assign pause_hover = section.settings.pause_on_hover
  assign pause_focus = section.settings.pause_on_focus

  assign should_init = true
  if count == 1 and autoplay == false and show_arrows == false and show_dots == false
    assign should_init = false
  endif

  assign use_custom = section.settings.use_custom_colors

  assign logo_minw = section.settings.logo_min_width
  assign logo_maxh = section.settings.logo_max_height

  assign arrows_inset = section.settings.arrows_inset_px
  assign arrows_offset_y = section.settings.arrows_offset_y_px
-%}

{{ 'interactive-content-carousel-media.css' | asset_url | stylesheet_tag }}
<script src="{{ 'interactive-content-carousel-media.js' | asset_url }}" defer></script>

<section
  class="q-carousel-ml q-carousel-ml--{{ type }}"
  style="
    --q-ml-maxw: {{ section.settings.max_width }}px;
    --q-ml-pad-y: {{ section.settings.pad_y }}px;
    --q-ml-pad-x: {{ section.settings.pad_x }}px;
    --q-ml-gap: {{ section.settings.gap }}px;
    --q-ml-radius: {{ section.settings.radius }}px;
    --q-ml-shadow: {{ section.settings.shadow_strength }};
    --q-ml-spv-d: {{ spv_d }};
    --q-ml-spv-t: {{ spv_t }};
    --q-ml-spv-m: {{ spv_m }};
    --q-ml-peek: {{ peek }}%;
    --q-ml-logo-minw: {{ logo_minw }}px;
    --q-ml-logo-maxh: {{ logo_maxh }}px;

    /* Arrow layout */
    --q-ml-arrow-inset: {{ arrows_inset }}px;
    --q-ml-arrow-offset-y: {{ arrows_offset_y }}px;

    {%- if use_custom -%}
      --q-ml-bg: {{ section.settings.bg }};
      --q-ml-text: {{ section.settings.text }};
      --q-ml-muted: {{ section.settings.muted }};
      --q-ml-accent: {{ section.settings.accent }};
      --q-ml-surface: {{ section.settings.surface }};
      --q-ml-border: {{ section.settings.border }};

      /* Explicit controls */
      --q-ml-arrow-bg: {{ section.settings.arrow_bg }};
      --q-ml-arrow-fg: {{ section.settings.arrow_fg }};
      --q-ml-arrow-border: {{ section.settings.arrow_border }};

      --q-ml-dot: {{ section.settings.dot }};
      --q-ml-dot-active: {{ section.settings.dot_active }};
      --q-ml-dot-border: {{ section.settings.dot_border }};
    {%- endif -%}
  "
>
  <div class="q-ml-inner">
    {%- if show_header -%}
      <header class="q-ml-header">
        {%- if heading != blank -%}<h2 class="q-ml-heading">{{ heading }}</h2>{%- endif -%}
        {%- if subheading != blank -%}<p class="q-ml-subheading">{{ subheading }}</p>{%- endif -%}
      </header>
    {%- endif -%}

    <div
      class="q-carousel"
      {% if should_init %}
        data-q-carousel
        data-loop="{{ loop }}"
        data-autoplay="{{ autoplay }}"
        data-autoplay-speed="{{ autoplay_speed }}"
        data-show-arrows="{{ show_arrows }}"
        data-show-dots="{{ show_dots }}"
        data-pause-hover="{{ pause_hover }}"
        data-pause-focus="{{ pause_focus }}"
        data-type="{{ type }}"
        data-logo-minw="{{ logo_minw }}"
      {% endif %}
    >
      <div class="q-carousel__viewport" tabindex="0" aria-label="Carousel">
        <div class="q-carousel__track">
          {%- for block in blocks -%}
            {%- liquid
              assign img = block.settings.image
              assign url = block.settings.link_url
              assign aria = block.settings.link_aria_label
              assign caption = block.settings.caption

              assign media_type = block.settings.media_type
              assign embed = block.settings.video_embed_code
              assign vurl = block.settings.video_url

              assign alt_logo = block.settings.logo_alt_label

              assign is_video = false
              if type == 'media'
                if media_type == 'video_embed'
                  if embed != blank or vurl != blank
                    assign is_video = true
                  endif
                endif
              endif

              assign video_is_linked = false
              if is_video
                if url != blank
                  assign video_is_linked = true
                endif
              endif

              assign slide_tag = 'div'
              if url != blank
                assign slide_tag = 'a'
              endif

              if video_is_linked
                assign slide_tag = 'a'
              endif
            -%}

            <{{ slide_tag }}
              class="q-carousel__slide"
              {% if slide_tag == 'a' %}
                href="{{ url }}"
                aria-label="{{ aria | default: 'Open link' }}"
              {% else %}
                role="group"
              {% endif %}
              {{ block.shopify_attributes }}
            >
              <div class="q-ml-card">
                {%- if type == 'logos' -%}
                  {%- if img != blank -%}
                    {{ img
                      | image_url: width: 600
                      | image_tag:
                        class: 'q-ml-logo',
                        loading: 'lazy',
                        alt: alt_logo
                    }}
                  {%- else -%}
                    <div class="q-ml-logo q-ml-logo--placeholder" aria-label="{{ alt_logo }}"></div>
                  {%- endif -%}

                {%- else -%}
                  {%- if is_video -%}
                    {%- if video_is_linked -%}
                      <div class="q-ml-media q-ml-media--video-teaser" aria-hidden="false">
                        {%- if img != blank -%}
                          <div class="q-ml-video-teaser">
                            {{ img
                              | image_url: width: 1800
                              | image_tag:
                                class: 'q-ml-image q-ml-image--teaser',
                                loading: 'lazy',
                                alt: alt_logo
                            }}
                            <span class="q-ml-play" aria-hidden="true">▶</span>
                          </div>
                        {%- else -%}
                          <div class="q-ml-image q-ml-image--placeholder" aria-hidden="true"></div>
                        {%- endif -%}
                      </div>
                    {%- else -%}
                      <div class="q-ml-media q-ml-media--video" data-q-carousel-video>
                        <div class="q-ml-ratio">
                          {%- if embed != blank -%}
                            <div class="q-ml-embed">{{ embed }}</div>
                          {%- elsif vurl != blank -%}
                            <iframe
                              class="q-ml-embed"
                              src="{{ vurl }}"
                              loading="lazy"
                              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                              allowfullscreen
                              title="{{ aria | default: 'Video' }}"
                            ></iframe>
                          {%- endif -%}
                        </div>
                      </div>
                    {%- endif -%}
                  {%- else -%}
                    <div class="q-ml-media">
                      {%- if img != blank -%}
                        {{ img
                          | image_url: width: 1800
                          | image_tag:
                            class: 'q-ml-image',
                            loading: 'lazy',
                            alt: alt_logo
                        }}
                      {%- else -%}
                        <div class="q-ml-image q-ml-image--placeholder" aria-hidden="true"></div>
                      {%- endif -%}
                    </div>
                  {%- endif -%}

                  {%- if caption != blank -%}
                    <div class="q-ml-caption">{{ caption }}</div>
                  {%- endif -%}
                {%- endif -%}
              </div>
            </{{ slide_tag }}>
          {%- endfor -%}
        </div>
      </div>

      {%- if should_init and show_arrows -%}
        <div class="q-carousel__arrows" aria-hidden="false">
          <button class="q-carousel__btn q-carousel__btn--prev" type="button" aria-label="Previous slide" data-q-carousel-prev>
            <span aria-hidden="true">‹</span>
          </button>
          <button class="q-carousel__btn q-carousel__btn--next" type="button" aria-label="Next slide" data-q-carousel-next>
            <span aria-hidden="true">›</span>
          </button>
        </div>
      {%- endif -%}

      {%- if should_init and show_dots -%}
        <div class="q-carousel__dots" data-q-carousel-dots></div>
      {%- endif -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Interactive Media Slides",
  "tag": "section",
  "class": "q-section q-carousel-section",
  "settings": [
    {
      "type": "select",
      "id": "carousel_type",
      "label": "Carousel type",
      "default": "media",
      "options": [
        { "value": "media", "label": "Media" },
        { "value": "logos", "label": "Logos" }
      ]
    },

    { "type": "header", "content": "Header" },
    { "type": "checkbox", "id": "show_header", "label": "Show header", "default": false },
    { "type": "text", "id": "heading", "label": "Heading", "default": "As seen in" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Partners, press, and brands that trust us." },

    { "type": "header", "content": "Slides per view" },
    { "type": "range", "id": "slides_per_view_desktop", "label": "Desktop slides per view", "min": 1, "max": 10, "step": 1, "default": 4 },
    { "type": "range", "id": "slides_per_view_tablet", "label": "Tablet slides per view", "min": 1, "max": 8, "step": 1, "default": 2 },
    { "type": "range", "id": "slides_per_view_mobile", "label": "Mobile slides per view", "min": 1, "max": 4, "step": 1, "default": 1 },
    { "type": "range", "id": "mobile_peek_pct", "label": "Mobile peek (%)", "info": "Adds a partial next-slide peek to imply scrollability.", "min": 0, "max": 40, "step": 1, "default": 18 },

    { "type": "header", "content": "Motion & controls" },
    {
      "type": "select",
      "id": "controls_mode",
      "label": "Controls mode",
      "default": "standard",
      "options": [
        { "value": "standard", "label": "Standard (optional arrows/dots)" },
        { "value": "autonomous", "label": "Autonomous (no arrows/dots)" }
      ]
    },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_speed", "label": "Autoplay speed (ms)", "min": 1500, "max": 9000, "step": 100, "default": 4000 },
    { "type": "checkbox", "id": "loop", "label": "Loop", "default": true },
    { "type": "checkbox", "id": "show_arrows", "label": "Show arrows", "default": true },
    { "type": "checkbox", "id": "show_dots", "label": "Show dots", "default": false },
    { "type": "checkbox", "id": "pause_on_hover", "label": "Pause on hover", "default": true },
    { "type": "checkbox", "id": "pause_on_focus", "label": "Pause on focus", "default": true },

    { "type": "header", "content": "Arrows positioning" },
    { "type": "range", "id": "arrows_inset_px", "label": "Arrows inset from edges (px)", "min": 0, "max": 80, "step": 2, "default": 28 },
    { "type": "range", "id": "arrows_offset_y_px", "label": "Arrows vertical offset (px)", "info": "Negative moves up, positive moves down.", "min": -60, "max": 60, "step": 2, "default": 0 },

    { "type": "header", "content": "Logos mode constraints" },
    { "type": "range", "id": "logo_min_width", "label": "Logo min width (px)", "min": 80, "max": 240, "step": 5, "default": 120 },
    { "type": "range", "id": "logo_max_height", "label": "Logo max height (px)", "min": 32, "max": 96, "step": 2, "default": 56 },

    { "type": "header", "content": "Layout & framing" },
    { "type": "range", "id": "max_width", "label": "Max width (px)", "min": 960, "max": 1800, "step": 20, "default": 1400 },
    { "type": "range", "id": "pad_y", "label": "Padding Y (px)", "min": 0, "max": 140, "step": 4, "default": 48 },
    { "type": "range", "id": "pad_x", "label": "Padding X (px)", "min": 0, "max": 80, "step": 4, "default": 20 },
    { "type": "range", "id": "gap", "label": "Gap (px)", "min": 8, "max": 48, "step": 2, "default": 16 },
    { "type": "range", "id": "radius", "label": "Radius (px)", "min": 0, "max": 40, "step": 2, "default": 16 },
    { "type": "range", "id": "shadow_strength", "label": "Shadow strength", "min": 0, "max": 5, "step": 1, "default": 0 },

    { "type": "header", "content": "Colors (scoped)" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors", "default": true },
    { "type": "color", "id": "bg", "label": "Background", "default": "#FFFFFF" },
    { "type": "color", "id": "text", "label": "Text", "default": "#111111" },
    { "type": "color", "id": "muted", "label": "Muted", "default": "#6b7280" },
    { "type": "color", "id": "accent", "label": "Accent", "default": "#ff4da6" },
    { "type": "color", "id": "surface", "label": "Surface", "default": "#ffffff" },
    { "type": "color", "id": "border", "label": "Border", "default": "transparent" },

    { "type": "header", "content": "Arrow controls" },
    { "type": "color", "id": "arrow_bg", "label": "Arrow background", "default": "#111111" },
    { "type": "color", "id": "arrow_fg", "label": "Arrow icon color", "default": "#ffffff" },
    { "type": "color", "id": "arrow_border", "label": "Arrow border color", "default": "transparent" },

    { "type": "header", "content": "Dots" },
    { "type": "color", "id": "dot", "label": "Dot (inactive)", "default": "#ffd1e8" },
    { "type": "color", "id": "dot_active", "label": "Dot (active)", "default": "#ff4da6" },
    { "type": "color", "id": "dot_border", "label": "Dot border", "default": "transparent" }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image", "info": "For video teaser (linked video), this is the poster image." },
        { "type": "url", "id": "link_url", "label": "Link URL" },
        { "type": "text", "id": "link_aria_label", "label": "Link aria-label", "default": "Open link" },
        { "type": "text", "id": "caption", "label": "Caption (media)" },

        {
          "type": "select",
          "id": "media_type",
          "label": "Media type",
          "default": "image",
          "options": [
            { "value": "image", "label": "Image" },
            { "value": "video_embed", "label": "Video embed" }
          ]
        },
        { "type": "textarea", "id": "video_embed_code", "label": "Video embed code" },
        { "type": "url", "id": "video_url", "label": "Video URL (fallback)"},

        { "type": "text", "id": "logo_alt_label", "label": "Logo alt label (logos)", "default": "Acme Co." }
      ]
    }
  ],
  "max_blocks": 30,
  "presets": [
    {
      "name": "Interactive Content Helpers - Carousel — Media & Logos",
      "category": "Interactive Content Helpers"
    },
    {
      "name": "Interactive Content Helpers - Carousel — Autonomous Strip",
      "category": "Interactive Content Helpers",
      "settings": {
        "controls_mode": "autonomous",
        "autoplay": true,
        "show_arrows": false,
        "show_dots": false
      }
    }
  ]
}
{% endschema %}
