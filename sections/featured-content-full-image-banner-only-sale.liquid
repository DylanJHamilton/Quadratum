{%- comment -%}
  Quadratum — Featured · Full Image Sale Banner
  Full-bleed, image-only promotional banner (responsive assets)
{%- endcomment -%}

{%- liquid
  assign s = section.settings

  assign img_desktop = s.image_desktop
  assign img_laptop  = s.image_laptop
  assign img_tablet  = s.image_tablet
  assign img_mobile  = s.image_mobile

  comment
    Ultimate fallback chain:
    Desktop -> Laptop -> Tablet -> Mobile
  endcomment
  assign img_base = img_desktop
  if img_base == blank
    assign img_base = img_laptop
  endif
  if img_base == blank
    assign img_base = img_tablet
  endif
  if img_base == blank
    assign img_base = img_mobile
  endif

  comment
    Breakpoint fallbacks:
    Desktop: img_desktop_f (desktop -> base)
    Laptop:  img_laptop_f  (laptop -> desktop_f)
    Tablet:  img_tablet_f  (tablet -> laptop_f)
    Mobile:  img_mobile_f  (mobile -> tablet_f)
  endcomment
  assign img_desktop_f = img_desktop | default: img_base
  assign img_laptop_f  = img_laptop  | default: img_desktop_f
  assign img_tablet_f  = img_tablet  | default: img_laptop_f
  assign img_mobile_f  = img_mobile  | default: img_tablet_f

  assign has_image = false
  if img_base != blank
    assign has_image = true
  endif

  assign is_link = false
  if s.link_url != blank
    assign is_link = true
  endif

  assign overlay_opacity = s.overlay_opacity | times: 0.01
-%}

<section
  class="q-section q-sale-banner"
  style="
    --q-bg: {{ s.bg_color }};
    --q-border: {{ s.border_color }};
    --q-pad-y: {{ s.pad_y }}px;
    --q-pad-x: {{ s.pad_x }}px;
    --q-maxw: {{ s.max_width }}px;
    --q-radius: {{ s.radius }}px;
    --q-overlay-color: {{ s.overlay_color }};
    --q-overlay-opacity: {{ overlay_opacity }};
    --q-banner-h-desktop: {{ s.height_desktop }}px;
    --q-banner-h-laptop: {{ s.height_laptop }}px;
    --q-banner-h-tablet: {{ s.height_tablet }}px;
    --q-banner-h-mobile: {{ s.height_mobile }}px;
    --q-object-fit: {{ s.image_fit }};
    --q-object-position: {{ s.image_position }};
  "
>
  <div class="q-sale-banner__outer {% if s.full_bleed %}is-bleed{% else %}is-contained{% endif %}">
    <div
      class="q-sale-banner__card {% if s.height_mode == 'fixed' %}is-fixed{% endif %}"
      style="
        {% if s.shadow_strength > 0 %}
          box-shadow: 0 14px 34px rgba(0,0,0,{{ s.shadow_strength }});
        {% endif %}
      "
    >

      {%- if has_image -%}

        {%- if is_link -%}
          <a href="{{ s.link_url }}" class="q-sale-banner__link" aria-label="{{ s.link_label }}">
        {%- endif -%}

        <picture class="q-sale-banner__media">
          {%- if img_desktop_f != blank -%}
            <source
              media="(min-width: 1200px)"
              srcset="
                {{ img_desktop_f | image_url: width: 2400 }} 2400w,
                {{ img_desktop_f | image_url: width: 1800 }} 1800w,
                {{ img_desktop_f | image_url: width: 1400 }} 1400w
              "
              sizes="100vw"
            >
          {%- endif -%}

          {%- if img_laptop_f != blank -%}
            <source
              media="(min-width: 990px)"
              srcset="
                {{ img_laptop_f | image_url: width: 1800 }} 1800w,
                {{ img_laptop_f | image_url: width: 1400 }} 1400w,
                {{ img_laptop_f | image_url: width: 1200 }} 1200w
              "
              sizes="100vw"
            >
          {%- endif -%}

          {%- if img_tablet_f != blank -%}
            <source
              media="(min-width: 750px)"
              srcset="
                {{ img_tablet_f | image_url: width: 1400 }} 1400w,
                {{ img_tablet_f | image_url: width: 1100 }} 1100w,
                {{ img_tablet_f | image_url: width: 900 }} 900w
              "
              sizes="100vw"
            >
          {%- endif -%}

          {%- if img_mobile_f != blank -%}
            <source
              media="(max-width: 749px)"
              srcset="
                {{ img_mobile_f | image_url: width: 900 }} 900w,
                {{ img_mobile_f | image_url: width: 700 }} 700w,
                {{ img_mobile_f | image_url: width: 500 }} 500w
              "
              sizes="100vw"
            >
          {%- endif -%}

          <img
            src="{{ img_base | image_url: width: 2400 }}"
            width="{{ img_base.width }}"
            height="{{ img_base.height }}"
            class="q-sale-banner__img"
            alt=""
            loading="lazy"
            decoding="async"
          >
        </picture>

        {%- if s.overlay_enable -%}
          <div class="q-sale-banner__overlay" aria-hidden="true"></div>
        {%- endif -%}

        {%- if is_link -%}
          </a>
        {%- endif -%}

      {%- else -%}
        <div class="q-sale-banner__empty" role="status" aria-live="polite">
          Add at least one image to display this banner.
        </div>
      {%- endif -%}

    </div>
  </div>

  {% style %}
    .q-sale-banner{
      background: var(--q-bg);
      padding-block: var(--q-pad-y);
      padding-inline: var(--q-pad-x);
    }

    .q-sale-banner__outer.is-contained{
      max-width: var(--q-maxw);
      margin-inline: auto;
    }

    .q-sale-banner__card{
      position: relative;
      overflow: hidden;
      border-radius: var(--q-radius);
      border: 1px solid var(--q-border);
      background: var(--q-bg);
    }

    .q-sale-banner__media{ display:block; width:100%; }
    .q-sale-banner__img{
      display:block;
      width:100%;
      height:auto;
      object-fit: var(--q-object-fit);
      object-position: var(--q-object-position);
    }

    .q-sale-banner__card.is-fixed .q-sale-banner__img{
      height: var(--q-banner-h-desktop);
    }
    @media (max-width: 1199px){
      .q-sale-banner__card.is-fixed .q-sale-banner__img{ height: var(--q-banner-h-laptop); }
    }
    @media (max-width: 989px){
      .q-sale-banner__card.is-fixed .q-sale-banner__img{ height: var(--q-banner-h-tablet); }
    }
    @media (max-width: 749px){
      .q-sale-banner__card.is-fixed .q-sale-banner__img{ height: var(--q-banner-h-mobile); }
    }

    .q-sale-banner__overlay{
      position:absolute;
      inset:0;
      background: var(--q-overlay-color);
      opacity: var(--q-overlay-opacity);
      pointer-events:none;
    }

    .q-sale-banner__link{
      display:block;
      text-decoration:none;
      color:inherit;
    }
    .q-sale-banner__link:focus-visible{
      box-shadow: 0 0 0 3px rgba(0,0,0,0.18);
      outline: none;
    }

    .q-sale-banner__empty{
      padding: 24px;
      border: 1px dashed var(--q-border);
      border-radius: var(--q-radius);
    }
  {% endstyle %}
</section>

{% schema %}
{
  "name": "Featured Sale Banner",
  "settings": [
    {
      "type": "header",
      "content": "Responsive images"
    },
    {
      "type": "paragraph",
      "content": "Recommended sizes — Desktop: 2400×800, Laptop: 1800×700, Tablet: 1400×700, Mobile: 900×1100. Use WebP when possible and keep each file under ~300–500KB."
    },
    { "type": "image_picker", "id": "image_desktop", "label": "Image — Desktop" },
    { "type": "image_picker", "id": "image_laptop", "label": "Image — Laptop" },
    { "type": "image_picker", "id": "image_tablet", "label": "Image — Tablet" },
    { "type": "image_picker", "id": "image_mobile", "label": "Image — Mobile" },

    {
      "type": "header",
      "content": "Link (optional)"
    },
    { "type": "url", "id": "link_url", "label": "Link URL" },
    {
      "type": "text",
      "id": "link_label",
      "label": "Link label (ARIA)",
      "default": "View promotion",
      "info": "If Link URL is set, this label is used for accessibility (example: “Shop Spring Sale”)."
    },

    {
      "type": "header",
      "content": "Banner sizing & fit"
    },
    {
      "type": "select",
      "id": "height_mode",
      "label": "Height mode",
      "default": "auto",
      "options": [
        { "value": "auto", "label": "Auto (image-driven)" },
        { "value": "fixed", "label": "Fixed height per device (advanced)" }
      ]
    },
    { "type": "range", "id": "height_desktop", "label": "Desktop height (fixed mode)", "min": 120, "max": 900, "step": 10, "default": 320 },
    { "type": "range", "id": "height_laptop",  "label": "Laptop height (fixed mode)",  "min": 120, "max": 900, "step": 10, "default": 300 },
    { "type": "range", "id": "height_tablet",  "label": "Tablet height (fixed mode)",  "min": 120, "max": 900, "step": 10, "default": 320 },
    { "type": "range", "id": "height_mobile",  "label": "Mobile height (fixed mode)",  "min": 120, "max": 900, "step": 10, "default": 520 },

    {
      "type": "select",
      "id": "image_fit",
      "label": "Image fit",
      "default": "cover",
      "options": [
        { "value": "cover", "label": "Cover" },
        { "value": "contain", "label": "Contain" }
      ]
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image position",
      "default": "center",
      "options": [
        { "value": "center", "label": "Center" },
        { "value": "top", "label": "Top" },
        { "value": "bottom", "label": "Bottom" },
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ]
    },

    {
      "type": "header",
      "content": "Optional overlay"
    },
    { "type": "checkbox", "id": "overlay_enable", "label": "Enable overlay", "default": false },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 90, "step": 1, "default": 20 },

    {
      "type": "header",
      "content": "Layout controls"
    },
    { "type": "checkbox", "id": "full_bleed", "label": "Full bleed", "default": true },
    { "type": "range", "id": "max_width", "label": "Max width (when not full bleed)", "min": 480, "max": 2480, "step": 20, "default": 1440 },
    { "type": "range", "id": "pad_y", "label": "Section padding (top/bottom)", "min": 0, "max": 120, "step": 4, "default": 24 },
    { "type": "range", "id": "pad_x", "label": "Section padding (left/right)", "min": 0, "max": 80, "step": 4, "default": 0 },
    { "type": "range", "id": "radius", "label": "Radius", "min": 0, "max": 48, "step": 1, "default": 0 },

    {
      "type": "range",
      "id": "shadow_strength",
      "label": "Shadow strength",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "default": 0.0,
      "info": "Schema-safe decimals (0.0–1.0)."
    },

    {
      "type": "header",
      "content": "Style system controls"
    },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#ffffff" },
    { "type": "color", "id": "border_color", "label": "Border color", "default": "rgba(0,0,0,0)" },

    {
      "type": "header",
      "content": "Recommendations"
    },
    {
      "type": "paragraph",
      "content": "Linking: Point to a Deals page / sale collection / financing offer / campaign landing page. Add UTM parameters for tracking if running ads."
    },
    {
      "type": "paragraph",
      "content": "Accessibility: If the banner is clickable, set a clear ARIA link label (e.g., “Shop Spring Sale”)."
    }
  ],
  "presets": [
    { "name": "Featured - Sale Banner Sale", "category": "Featured Content" },
    { "name": "Featured - Sale Banner Finance", "category": "Featured Content" },
    { "name": "Featured - Sale Banner Free Shipping", "category": "Featured Content" }
  ]
}
{% endschema %}
