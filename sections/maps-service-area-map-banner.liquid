{% comment %}
  Quadratum — Maps: Service Area Map Banner (Section)
  File: sections/maps-service-area-map-banner.liquid

  • Map-heavy hero banner communicating “We serve this region”
  • Modes:
      - Static image (recommended)
      - Google embed (iframe) OR coords fallback (no JS API)
  • Premium overlay system (color/gradient/opacity)
  • Token-driven + optional scoped custom colors
  • No hard-coded colors; CSS vars only
  • No JS
{% endcomment %}

{%- assign s = section.settings -%}

{%- assign t_bg     = settings.bg_base | default: '#ffffff' -%}
{%- assign t_surface= settings.bg_contrast | default: '#f6f7f8' -%}
{%- assign t_text   = settings.text_base | default: '#111111' -%}
{%- assign t_muted  = settings.text_muted | default: '#6b7280' -%}
{%- assign t_accent = settings.color_primary | default: '#2563eb' -%}
{%- assign t_border = '#e5e7eb' -%}

{%- assign q_bg      = t_bg -%}
{%- assign q_surface = t_surface -%}
{%- assign q_text    = t_text -%}
{%- assign q_muted   = t_muted -%}
{%- assign q_accent  = t_accent -%}
{%- assign q_border  = t_border -%}

{%- if s.use_custom_colors -%}
  {%- assign q_bg      = s.custom_bg -%}
  {%- assign q_surface = s.custom_overlay -%}
  {%- assign q_text    = s.custom_text -%}
  {%- assign q_muted   = s.custom_muted -%}
  {%- assign q_accent  = s.custom_accent -%}
  {%- assign q_border  = s.custom_border -%}
{%- endif -%}

{%- assign height_mode = s.height_mode | default: 'md' -%}

{%- assign map_link = s.map_link | default: '' -%}
{%- assign lat = s.lat | default: settings.gmap_default_lat | default: '37.7749' -%}
{%- assign lng = s.lng | default: settings.gmap_default_lng | default: '-122.4194' -%}
{%- assign zoom = s.zoom | default: settings.gmap_default_zoom | default: 12 -%}

{%- assign embed_code = s.embed_code | default: '' -%}
{%- assign embed_src = '' -%}
{%- if embed_code != blank -%}
  {%- assign _parts = embed_code | split: 'src="' -%}
  {%- if _parts.size > 1 -%}
    {%- assign _tail = _parts[1] | split: '"' -%}
    {%- if _tail.size > 0 -%}
      {%- assign embed_src = _tail[0] -%}
    {%- endif -%}
  {%- endif -%}
{%- endif -%}

{%- if map_link == blank -%}
  {%- if s.mode == 'coords' -%}
    {%- assign map_link = 'https://www.google.com/maps?q=' | append: lat | append: ',' | append: lng | append: '&z=' | append: zoom -%}
  {%- elsif s.mode == 'embed' -%}
    {%- if embed_src != blank -%}
      {%- assign map_link = embed_src | replace: 'output=embed', 'output=search' -%}
    {%- endif -%}
  {%- endif -%}
{%- endif -%}

{%- if map_link == blank -%}
  {%- assign map_link = 'https://www.google.com/maps' -%}
{%- endif -%}

{%- assign has_image = false -%}
{%- if s.map_image != blank -%}
  {%- assign has_image = true -%}
{%- endif -%}

{%- assign can_embed = false -%}
{%- if s.mode == 'embed' -%}
  {%- if embed_code contains '<iframe' -%}
    {%- assign can_embed = true -%}
  {%- endif -%}
{%- endif -%}

<section
  id="q-map-banner-{{ section.id }}"
  class="q-mapBanner q-mapBanner--{{ s.content_align | default: 'left' }} q-mapBanner--v-{{ s.vertical_align | default: 'center' }} q-mapBanner--h-{{ height_mode }}"
  style="
    --q-bg: {{ q_bg }};
    --q-surface: {{ q_surface }};
    --q-text: {{ q_text }};
    --q-muted: {{ q_muted }};
    --q-accent: {{ q_accent }};
    --q-border: {{ q_border }};
    --q-overlay-opacity: {{ s.overlay_opacity | default: 60 | times: 0.01 }};
    --q-content-max: {{ s.content_max | default: 560 }}px;
    --q-pad-y: {{ s.pad_y | default: 64 }}px;
    --q-pad-x: {{ s.pad_x | default: 28 }}px;
    --q-radius: {{ s.radius | default: 18 }}px;
    --q-btn-radius: {{ settings.button_radius | default: 12 }}px;
    --q-btn-bw: {{ settings.button_border_width | default: 1 }}px;
  "
>
  <div class="q-mapBanner__media" aria-hidden="true">
    {%- if s.mode == 'static_image' -%}
      {%- if has_image -%}
        <img
          class="q-mapBanner__img"
          src="{{ s.map_image | image_url: width: 2400 }}"
          alt="{{ s.image_alt | default: 'Service area map' | escape }}"
          loading="lazy"
          width="{{ s.map_image.width }}"
          height="{{ s.map_image.height }}"
        >
      {%- else -%}
        <div class="q-mapBanner__fallback">
          <div class="q-mapBanner__fallbackInner">
            <div class="q-mapBanner__fallbackTitle">{{ s.placeholder_title | default: 'Service coverage map' }}</div>
            <div class="q-mapBanner__fallbackSub">{{ s.placeholder_sub | default: 'Upload a shaded service-area map image to visually communicate coverage.' }}</div>
          </div>
        </div>
      {%- endif -%}

    {%- elsif s.mode == 'embed' -%}
      {%- if can_embed -%}
        <div class="q-mapBanner__iframeWrap {% unless s.embed_interactive %}q-mapBanner__iframeWrap--passive{% endunless %}">
          {{ embed_code }}
        </div>
      {%- else -%}
        <div class="q-mapBanner__fallback">
          <div class="q-mapBanner__fallbackInner">
            <div class="q-mapBanner__fallbackTitle">{{ s.invalid_embed_title | default: 'Map preview unavailable' }}</div>
            <div class="q-mapBanner__fallbackSub">{{ s.invalid_embed_note | default: 'Paste a valid Google Maps <iframe> embed code, or switch to Static Image mode.' }}</div>
          </div>
        </div>
      {%- endif -%}

    {%- else -%}
      <div class="q-mapBanner__fallback">
        <div class="q-mapBanner__fallbackInner">
          <div class="q-mapBanner__fallbackTitle">{{ s.placeholder_title | default: 'Service coverage' }}</div>
          <div class="q-mapBanner__fallbackSub">{{ s.placeholder_sub | default: 'Use coordinates mode to generate a Google Maps link (no API needed).' }}</div>
        </div>
      </div>
    {%- endif -%}
  </div>

  <div class="q-mapBanner__overlay {% if s.overlay_gradient %}q-mapBanner__overlay--gradient{% endif %}"></div>

  <div class="q-mapBanner__contentWrap">
    <div class="q-mapBanner__content">
      {%- if s.kicker != blank -%}
        <div class="q-mapBanner__kicker">{{ s.kicker }}</div>
      {%- endif -%}

      {%- if s.heading != blank -%}
        <h2 class="q-mapBanner__heading">{{ s.heading }}</h2>
      {%- endif -%}

      {%- if s.subheading != blank -%}
        <div class="q-mapBanner__subheading rte">{{ s.subheading }}</div>
      {%- endif -%}

      <div class="q-mapBanner__actions">
        {%- if s.primary_label != blank and s.primary_url != blank -%}
          <a class="q-mapBanner__btn q-mapBanner__btn--primary" href="{{ s.primary_url }}">{{ s.primary_label }}</a>
        {%- endif -%}

        {%- if s.secondary_label != blank and s.secondary_url != blank -%}
          <a class="q-mapBanner__btn q-mapBanner__btn--secondary" href="{{ s.secondary_url }}">{{ s.secondary_label }}</a>
        {%- endif -%}

        {%- if s.show_map_link -%}
          <a class="q-mapBanner__link" href="{{ map_link }}" target="_blank" rel="noopener">
            {{ s.map_link_label | default: 'Open in Google Maps' }}
          </a>
        {%- endif -%}
      </div>
    </div>
  </div>

  <style>
    #q-map-banner-{{ section.id }}{
      background: var(--q-bg);
      color: var(--q-text);
      position: relative;
      overflow: hidden;
      border-radius: 0;
    }

    #q-map-banner-{{ section.id }}.q-mapBanner--h-auto{ min-height: 0; }
    #q-map-banner-{{ section.id }}.q-mapBanner--h-sm{ min-height: 360px; }
    #q-map-banner-{{ section.id }}.q-mapBanner--h-md{ min-height: 520px; }
    #q-map-banner-{{ section.id }}.q-mapBanner--h-lg{ min-height: 680px; }
    #q-map-banner-{{ section.id }}.q-mapBanner--h-vh50{ min-height: 50vh; }
    #q-map-banner-{{ section.id }}.q-mapBanner--h-vh70{ min-height: 70vh; }
    #q-map-banner-{{ section.id }}.q-mapBanner--h-vh90{ min-height: 90vh; }

    #q-map-banner-{{ section.id }} .q-mapBanner__media{
      position: absolute;
      inset: 0;
      z-index: 0;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      filter: saturate(1.03) contrast(1.02);
      transform: scale(1.01);
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__iframeWrap{
      position: absolute;
      inset: 0;
    }
    #q-map-banner-{{ section.id }} .q-mapBanner__iframeWrap iframe{
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }
    #q-map-banner-{{ section.id }} .q-mapBanner__iframeWrap--passive{
      pointer-events: none;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__fallback{
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, rgba(0,0,0,0.06), rgba(0,0,0,0.02));
    }
    #q-map-banner-{{ section.id }} .q-mapBanner__fallbackInner{
      max-width: 54ch;
      padding: 24px;
      border-radius: var(--q-radius);
      background: rgba(255,255,255,0.75);
      border: 1px solid rgba(0,0,0,0.08);
      backdrop-filter: blur(8px);
    }
    #q-map-banner-{{ section.id }} .q-mapBanner__fallbackTitle{
      font-weight: 700;
      letter-spacing: -0.01em;
      margin-bottom: 6px;
    }
    #q-map-banner-{{ section.id }} .q-mapBanner__fallbackSub{
      color: var(--q-muted);
      line-height: 1.55;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__overlay{
      position: absolute;
      inset: 0;
      z-index: 1;
      background: var(--q-surface);
      opacity: var(--q-overlay-opacity);
    }
    #q-map-banner-{{ section.id }} .q-mapBanner__overlay--gradient{
      background: linear-gradient(90deg, var(--q-surface), rgba(0,0,0,0));
      opacity: 1;
      mix-blend-mode: normal;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__contentWrap{
      position: relative;
      z-index: 2;
      padding: var(--q-pad-y) var(--q-pad-x);
      display: flex;
      min-height: inherit;
      width: 100%;
    }

    #q-map-banner-{{ section.id }}.q-mapBanner--v-center .q-mapBanner__contentWrap{ align-items: center; }
    #q-map-banner-{{ section.id }}.q-mapBanner--v-bottom .q-mapBanner__contentWrap{ align-items: flex-end; }

    #q-map-banner-{{ section.id }} .q-mapBanner__content{
      max-width: var(--q-content-max);
    }

    #q-map-banner-{{ section.id }}.q-mapBanner--center .q-mapBanner__content{
      margin-left: auto;
      margin-right: auto;
      text-align: center;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__kicker{
      color: var(--q-muted);
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 0.82rem;
      margin-bottom: 10px;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__heading{
      margin: 0 0 10px 0;
      letter-spacing: -0.02em;
      line-height: 1.1;
      font-weight: 800;
      font-size: clamp(1.8rem, 3.2vw, 3.2rem);
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__subheading{
      color: var(--q-text);
      opacity: 0.92;
      line-height: 1.6;
      font-size: 1.02rem;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__actions{
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 18px;
      align-items: center;
      justify-content: flex-start;
    }
    #q-map-banner-{{ section.id }}.q-mapBanner--center .q-mapBanner__actions{
      justify-content: center;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      border-radius: var(--q-btn-radius);
      border: var(--q-btn-bw) solid transparent;
      font-weight: 700;
      text-decoration: none;
      line-height: 1;
      transition: transform 120ms ease, opacity 120ms ease, background 120ms ease, border-color 120ms ease;
      transform: translateZ(0);
      will-change: transform;
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__btn--primary{
      background: var(--q-accent);
      color: {{ settings.text_on_color | default: '#ffffff' }};
      border-color: var(--q-accent);
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__btn--secondary{
      background: rgba(255,255,255,0.86);
      color: var(--q-text);
      border-color: rgba(0,0,0,0.14);
      backdrop-filter: blur(10px);
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__btn:hover{
      opacity: {{ settings.button_hover_opacity | default: 92 | times: 0.01 }};
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__btn:active{
      transform: scale({{ settings.button_active_scale | default: 98 | times: 0.01 }});
    }

    #q-map-banner-{{ section.id }} .q-mapBanner__link{
      color: var(--q-text);
      opacity: 0.9;
      text-decoration: underline;
      text-underline-offset: 3px;
      font-weight: 600;
    }

    @media (max-width: 768px){
      #q-map-banner-{{ section.id }} .q-mapBanner__contentWrap{
        padding: calc(var(--q-pad-y) * 0.7) calc(var(--q-pad-x) * 0.75);
      }
      #q-map-banner-{{ section.id }} .q-mapBanner__heading{
        font-size: clamp(1.6rem, 7vw, 2.4rem);
      }
      #q-map-banner-{{ section.id }} .q-mapBanner__actions{
        gap: 10px;
      }
      #q-map-banner-{{ section.id }} .q-mapBanner__btn{
        width: auto;
      }
    }
  </style>

  {% schema %}
  {
    "name": "Maps - Service Area",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "header",
        "content": "Content"
      },
      {
        "type": "text",
        "id": "kicker",
        "label": "Kicker",
        "default": "Service Coverage"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Serving Northeast Ohio"
      },
      {
        "type": "richtext",
        "id": "subheading",
        "label": "Subheading",
        "default": "<p>From city centers to surrounding counties, our team covers a wide service area with fast scheduling and reliable support.</p>"
      },
      {
        "type": "text",
        "id": "primary_label",
        "label": "Primary button label",
        "default": "View All Service Areas"
      },
      {
        "type": "url",
        "id": "primary_url",
        "label": "Primary button link"
      },
      {
        "type": "text",
        "id": "secondary_label",
        "label": "Secondary button label",
        "default": "Get a Quote"
      },
      {
        "type": "url",
        "id": "secondary_url",
        "label": "Secondary button link"
      },

      {
        "type": "header",
        "content": "Map"
      },
      {
        "type": "select",
        "id": "mode",
        "label": "Map mode",
        "default": "static_image",
        "options": [
          { "value": "static_image", "label": "Static image (recommended)" },
          { "value": "embed", "label": "Google Maps embed (iframe)" },
          { "value": "coords", "label": "Coordinates (link fallback)" }
        ]
      },
      {
        "type": "image_picker",
        "id": "map_image",
        "label": "Map image (static mode)"
      },
      {
        "type": "text",
        "id": "image_alt",
        "label": "Image alt text",
        "default": "Service area coverage map"
      },
      {
        "type": "textarea",
        "id": "embed_code",
        "label": "Google Maps iframe embed code (embed mode)",
        "default": "<iframe src=\"https://www.google.com/maps?q=Cleveland%2C%20OH&output=embed\" width=\"600\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\" referrerpolicy=\"no-referrer-when-downgrade\" title=\"Service area map\"></iframe>"
      },
      {
        "type": "checkbox",
        "id": "embed_interactive",
        "label": "Allow map interaction (not recommended on mobile)",
        "default": false
      },
      {
        "type": "text",
        "id": "lat",
        "label": "Latitude (coords mode)",
        "default": "41.4993"
      },
      {
        "type": "text",
        "id": "lng",
        "label": "Longitude (coords mode)",
        "default": "-81.6944"
      },
      {
        "type": "range",
        "id": "zoom",
        "label": "Zoom (coords mode)",
        "min": 1,
        "max": 20,
        "step": 1,
        "default": 10
      },
      {
        "type": "text",
        "id": "map_link",
        "label": "Map link override (optional)",
      },
      {
        "type": "checkbox",
        "id": "show_map_link",
        "label": "Show 'Open in Google Maps' link",
        "default": true
      },
      {
        "type": "text",
        "id": "map_link_label",
        "label": "Map link label",
        "default": "Open in Google Maps"
      },

      {
        "type": "header",
        "content": "Overlay & Layout"
      },
      {
        "type": "range",
        "id": "overlay_opacity",
        "label": "Overlay opacity (%)",
        "min": 0,
        "max": 90,
        "step": 5,
        "default": 60
      },
      {
        "type": "checkbox",
        "id": "overlay_gradient",
        "label": "Use gradient overlay",
        "default": true
      },
      {
        "type": "select",
        "id": "content_align",
        "label": "Content alignment",
        "default": "left",
        "options": [
          { "value": "left", "label": "Left" },
          { "value": "center", "label": "Center" }
        ]
      },
      {
        "type": "select",
        "id": "vertical_align",
        "label": "Vertical alignment",
        "default": "center",
        "options": [
          { "value": "center", "label": "Center" },
          { "value": "bottom", "label": "Bottom" }
        ]
      },
      {
        "type": "range",
        "id": "content_max",
        "label": "Content max width (px)",
        "min": 360,
        "max": 860,
        "step": 10,
        "default": 560
      },
      {
        "type": "select",
        "id": "height_mode",
        "label": "Section height",
        "default": "md",
        "options": [
          { "value": "auto", "label": "Auto" },
          { "value": "sm", "label": "Small" },
          { "value": "md", "label": "Medium" },
          { "value": "lg", "label": "Large" },
          { "value": "vh50", "label": "50% viewport" },
          { "value": "vh70", "label": "70% viewport" },
          { "value": "vh90", "label": "90% viewport" }
        ]
      },
      {
        "type": "range",
        "id": "pad_y",
        "label": "Vertical padding (px)",
        "min": 16,
        "max": 140,
        "step": 4,
        "default": 64
      },
      {
        "type": "range",
        "id": "pad_x",
        "label": "Horizontal padding (px)",
        "min": 14,
        "max": 80,
        "step": 2,
        "default": 28
      },
      {
        "type": "range",
        "id": "radius",
        "label": "Surface radius (px)",
        "min": 0,
        "max": 32,
        "step": 1,
        "default": 18
      },

      {
        "type": "header",
        "content": "Fallback copy"
      },
      {
        "type": "text",
        "id": "placeholder_title",
        "label": "Placeholder title",
        "default": "Service coverage map"
      },
      {
        "type": "text",
        "id": "placeholder_sub",
        "label": "Placeholder subtext",
        "default": "Upload a shaded service-area map image to visually communicate coverage."
      },
      {
        "type": "text",
        "id": "invalid_embed_title",
        "label": "Invalid embed title",
        "default": "Map preview unavailable"
      },
      {
        "type": "text",
        "id": "invalid_embed_note",
        "label": "Invalid embed note",
        "default": "Paste a valid Google Maps <iframe> embed code, or switch to Static Image mode."
      },

      {
        "type": "header",
        "content": "Custom colors (scoped)"
      },
      {
        "type": "checkbox",
        "id": "use_custom_colors",
        "label": "Use custom colors (scoped)",
        "default": false
      },
      {
        "type": "color",
        "id": "custom_bg",
        "label": "Background",
        "default": "#ffffff"
      },
      {
        "type": "color",
        "id": "custom_overlay",
        "label": "Overlay color",
        "default": "#f6f7f8"
      },
      {
        "type": "color",
        "id": "custom_text",
        "label": "Text",
        "default": "#111111"
      },
      {
        "type": "color",
        "id": "custom_muted",
        "label": "Muted text",
        "default": "#6b7280"
      },
      {
        "type": "color",
        "id": "custom_accent",
        "label": "Accent",
        "default": "#2563eb"
      },
      {
        "type": "color",
        "id": "custom_border",
        "label": "Border",
        "default": "#e5e7eb"
      }
    ],
    "presets": [
      {
        "name": "Maps - Service Area Map Banner",
        "category": "Maps"
      }
    ]
  }
  {% endschema %}
</section>
