{% comment %}
  Quadratum • Web3 Banner
  - Purpose: Promote token-gated drops, NFT collections, or wallet-required perks.
  - UX: Gradient/glow background, optional media, headline/subhead, Connect Wallet CTA.
  - A11y: Labeled region, focus-visible rings, reduced-motion aware.
  - Perf: responsive images (right-sized), eager only when intended.
  - Analytics: data-cta + optional dataLayer events.
  - Note: This triggers a custom event for wallet connect (you wire to your app).
{% endcomment %}

{% assign s = section.settings %}

{%- comment -%} Container padding {%- endcomment -%}
{% assign container_pad = '' %}
{% if s.container_mode == 'contained' %}
  {% assign container_pad = 'px-4 md:px-6' %}
{% endif %}

{%- comment -%} Visibility toggles {%- endcomment -%}
{% assign visibility_classes = '' %}
{% if s.hide_on_mobile %}{% assign visibility_classes = visibility_classes | append: ' hidden md:block' %}{% endif %}
{% if s.hide_on_desktop %}{% assign visibility_classes = visibility_classes | append: ' md:hidden' %}{% endif %}

{%- comment -%} Responsive sizes {%- endcomment -%}
{% assign sizes_bg = '100vw' %}
{% assign widths_bg = '960,1280,1600,1920,2240' %}
{% assign sizes_media = '(min-width: 1024px) 50vw, 100vw' %}
{% assign widths_media = '640,750,828,960,1080,1280,1440,1600' %}

<section
  id="{{ s.anchor_id | default: 'section-' | append: section.id }}"
  class="relative overflow-hidden {{ visibility_classes }}"
  role="region"
  aria-label="{{ s.region_label | default: 'Web3 promotion' }}"
  style="min-height: {{ s.min_height_vh | default: 60 }}vh;"
>
  {%- comment -%} Optional background image with overlay {%- endcomment -%}
  {% if s.background_image != blank %}
    <div class="absolute inset-0 -z-20">
      {{ s.background_image
        | image_url: width: 2240
        | image_tag:
          widths: widths_bg,
          sizes: sizes_bg,
          loading: 'eager',
          fetchpriority: 'high',
          class: 'absolute inset-0 w-full h-full object-cover',
          alt: s.bg_image_alt }}
      <div class="absolute inset-0" aria-hidden="true"
           style="background-color: {{ s.overlay_color }}; opacity: {{ s.overlay_opacity | divided_by: 100.0 }};">
      </div>
    </div>
  {% endif %}

  {%- comment -%} Gradient / glow layer (no Tailwind arbitrary; inline style) {%- endcomment -%}
  <div class="absolute inset-0 -z-10" aria-hidden="true"
       style="
        background:
          radial-gradient(40% 35% at 20% 20%, {{ s.glow_color_1 }} 0%, transparent 60%),
          radial-gradient(45% 40% at 80% 30%, {{ s.glow_color_2 }} 0%, transparent 65%),
          radial-gradient(50% 45% at 50% 80%, {{ s.glow_color_3 }} 0%, transparent 70%),
          linear-gradient(180deg, {{ s.gradient_top }} 0%, {{ s.gradient_bottom }} 100%);
        {% if s.animate_glow %}animation: qGlow 16s linear infinite alternate;{% endif %}
       ">
  </div>

  <div class="relative z-10">
    <div class="mx-auto max-w-screen-xl {{ container_pad }}">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8 items-center"
           style="padding-top: {{ s.padding_top | default: 72 }}px; padding-bottom: {{ s.padding_bottom | default: 72 }}px;">

        {% assign media_first = false %}
        {% if s.media_position == 'left' %}{% assign media_first = true %}{% endif %}

        {% assign media_cols = 5 %}
        {% assign content_cols = 7 %}
        {% if s.media_width == '6' %}{% assign media_cols = 6 %}{% assign content_cols = 6 %}{% endif %}
        {% if s.media_width == '7' %}{% assign media_cols = 7 %}{% assign content_cols = 5 %}{% endif %}
        {% assign media_col_class = 'lg:col-span-' | append: media_cols %}
        {% assign content_col_class = 'lg:col-span-' | append: content_cols %}

        {% if media_first %}
          <div class="col-span-1 {{ media_col_class }}">
            {% if s.media_video != blank %}
              <video class="w-full h-auto rounded-2xl object-cover" autoplay muted loop playsinline preload="none"
                     {% if s.media_poster != blank %}poster="{{ s.media_poster | image_url: width: 1280 }}"{% endif %}>
                <source src="{{ s.media_video }}" type="video/mp4">
              </video>
            {% elsif s.media_image != blank %}
              {{ s.media_image
                | image_url: width: 1600
                | image_tag:
                  widths: widths_media,
                  sizes: sizes_media,
                  loading: 'lazy',
                  class: 'w-full h-auto object-cover rounded-2xl',
                  alt: s.media_alt }}
            {% endif %}
          </div>
        {% endif %}

        <div class="col-span-1 {{ content_col_class }}">
          <div class="{{ s.text_align | default: 'text-left' }}">
            {% if s.kicker != blank %}
              <p class="text-sm font-semibold tracking-wide uppercase text-muted-foreground">{{ s.kicker }}</p>
            {% endif %}

            {% if s.heading != blank %}
              {% if s.heading_level == 'h1' %}
                <h1 class="mt-1 text-3xl md:text-5xl font-semibold leading-tight text-foreground">{{ s.heading | escape }}</h1>
              {% else %}
                <h2 class="mt-1 text-3xl md:text-5xl font-semibold leading-tight text-foreground">{{ s.heading | escape }}</h2>
              {% endif %}
            {% endif %}

            {% if s.subheading != blank %}
              <p class="mt-3 text-base md:text-lg text-foreground/85 {% if s.hide_sub_mobile %}hidden md:block{% endif %}">
                {{ s.subheading }}
              </p>
            {% endif %}

            {% if s.bullets_enable %}
              <ul class="mt-4 space-y-2">
                {% for block in section.blocks %}
                  {% if block.type == 'bullet' %}
                    {% assign b = block.settings %}
                    <li class="flex items-start gap-3" {{ block.shopify_attributes }}>
                      {% if b.icon == 'bolt' %}
                        <svg class="mt-1 h-4 w-4 text-sky-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M11.3 1L3 11h5l-.8 8L15 9h-5l1.3-8z"/></svg>
                      {% elsif b.icon == 'shield' %}
                        <svg class="mt-1 h-4 w-4 text-emerald-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M10 2l7 3v5c0 5-3.5 7.5-7 8-3.5-.5-7-3-7-8V5l7-3z"/></svg>
                      {% else %}
                        <span class="mt-1 inline-block h-2 w-2 rounded-full bg-primary"></span>
                      {% endif %}
                      <span class="text-sm md:text-base text-foreground/90">{{ b.text }}</span>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}

            {%- comment -%} CTA row {%- endcomment -%}
            {% assign has_secondary = false %}
            {% assign href2 = s.cta2_link %}
            {% if href2 == blank and s.cta2_collection %}{% assign href2 = s.cta2_collection.url %}{% endif %}
            {% if href2 == blank and s.cta2_product %}{% assign href2 = s.cta2_product.url %}{% endif %}
            {% if href2 == blank and s.cta2_article %}{% assign href2 = s.cta2_article.url %}{% endif %}
            {% if s.cta2_text != blank and href2 != blank %}{% assign has_secondary = true %}{% endif %}

            <div class="mt-5 flex flex-wrap gap-3 {% if s.cta_align == 'left' %}justify-start{% elsif s.cta_align == 'right' %}justify-end{% else %}justify-start{% endif %}">
              <button type="button"
                      class="inline-flex items-center justify-center rounded-xl px-5 py-2.5 text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 transition
                             {% if s.button_mode == 'outline' %}border bg-transparent{% else %}bg-primary text-primary-foreground hover:opacity-90{% endif %}"
                      style="{% if s.button_mode == 'outline' %}color: {{ s.button_text_color }}; border-color: {{ s.button_border_color }}; border-width: {{ s.button_border_width }}px;{% else %}color: {{ s.button_text_color }}; background-color: {{ s.button_bg_color }};{% endif %} border-radius: {{ s.button_radius }}px;"
                      data-cta="primary"
                      data-q-wallet-connect
                      aria-label="{{ s.cta_aria_label | default: s.cta_text | escape }}">
                {{ s.cta_text }}
              </button>

              {% if has_secondary %}
                <a href="{{ href2 }}"
                   data-cta="secondary"
                   class="inline-flex items-center justify-center rounded-xl px-5 py-2.5 text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 transition
                          {% if s.button_mode == 'outline' %}border bg-transparent{% else %}border border-input bg-background hover:bg-accent hover:text-accent-foreground{% endif %}"
                   style="{% if s.button_mode == 'outline' %}color: {{ s.button_text_color }}; border-color: {{ s.button_border_color }}; border-width: {{ s.button_border_width }}px;{% else %}color: {{ s.button_text_color }};{% endif %} border-radius: {{ s.button_radius }}px;"
                   aria-label="{{ s.cta2_aria_label | default: s.cta2_text | escape }}">
                  {{ s.cta2_text }}
                </a>
              {% endif %}
            </div>

            {% if s.disclaimer != blank %}
              <p class="mt-3 text-xs text-foreground/70">{{ s.disclaimer }}</p>
            {% endif %}
          </div>
        </div>

        {% unless media_first %}
          <div class="col-span-1 {{ media_col_class }}">
            {% if s.media_video != blank %}
              <video class="w-full h-auto rounded-2xl object-cover" autoplay muted loop playsinline preload="none"
                     {% if s.media_poster != blank %}poster="{{ s.media_poster | image_url: width: 1280 }}"{% endif %}>
                <source src="{{ s.media_video }}" type="video/mp4">
              </video>
            {% elsif s.media_image != blank %}
              {{ s.media_image
                | image_url: width: 1600
                | image_tag:
                  widths: widths_media,
                  sizes: sizes_media,
                  loading: 'lazy',
                  class: 'w-full h-auto object-cover rounded-2xl',
                  alt: s.media_alt }}
            {% endif %}
          </div>
        {% endunless %}
      </div>
    </div>
  </div>

  {% if s.send_events %}
    <script>
      (function(){
        var root = document.getElementById('{{ s.anchor_id | default: 'section-' | append: section.id }}');
        if(!root) return;

        // Wallet connect button → custom event you can handle globally
        var btn = root.querySelector('[data-q-wallet-connect]');
        if (btn) {
          btn.addEventListener('click', function(){
            var payload = {
              component: 'web3_banner',
              chain: {{ s.chain | json }},
              provider_hint: {{ s.provider_hint | json }}
            };
            window.dispatchEvent(new CustomEvent('quadratum:wallet_connect', { detail: payload }));

            if ({{ s.send_events | json }} && window.dataLayer && Array.isArray(window.dataLayer)) {
              window.dataLayer.push({
                event: 'quadratum_wallet_connect',
                component: payload.component,
                chain: payload.chain,
                provider_hint: payload.provider_hint
              });
            }
          });
        }

        // Track secondary CTA clicks
        root.addEventListener('click', function(e){
          var a = e.target.closest('a[data-cta="secondary"]');
          if(!a || !{{ s.send_events | json }}) return;
          var href = a.getAttribute('href') || '';
          var payload = { component: 'web3_banner', cta_type: 'secondary', href: href };
          window.dispatchEvent(new CustomEvent('quadratum:cta', { detail: payload }));
          if(window.dataLayer && Array.isArray(window.dataLayer)){
            window.dataLayer.push({ event: 'quadratum_cta', component: payload.component, cta_type: payload.cta_type, href: payload.href });
          }
        });
      })();
    </script>
  {% endif %}

  <style>
    @keyframes qGlow {
      0%   { transform: translate3d(-2%, -1%, 0) scale(1.02); filter: saturate(1); }
      100% { transform: translate3d(2%, 1%, 0)  scale(1.04); filter: saturate(1.05); }
    }
    @media (prefers-reduced-motion: reduce) {
      [style*="qGlow"] { animation: none !important; }
    }
  </style>
</section>

{% render 'tw-safelist-banners' %}

{% schema %}
{
  "name": "Web3 Banner",
  "tag": "section",
  "class": "q-web3-banner",
  "settings": [
    { "type": "header", "content": "Content" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Token-gated" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Connect your wallet for early access" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Members with eligible tokens unlock drops, perks, and more." },
    { "type": "select", "id": "heading_level", "label": "Heading level", "default": "h2", "options": [
      { "value": "h1", "label": "H1" }, { "value": "h2", "label": "H2" }
    ]},
    { "type": "checkbox", "id": "hide_sub_mobile", "label": "Hide subheading on mobile", "default": false },

    { "type": "header", "content": "Buttons" },
    { "type": "text", "id": "cta_text", "label": "Primary button (Connect)", "default": "Connect wallet" },
    { "type": "text", "id": "cta_aria_label", "label": "Primary button ARIA label", "default": "Connect wallet" },
    { "type": "text", "id": "cta2_text", "label": "Secondary button text", "default": "View collection" },
    { "type": "url", "id": "cta2_link", "label": "Secondary URL" },
    { "type": "collection", "id": "cta2_collection", "label": "…or link to collection" },
    { "type": "product", "id": "cta2_product", "label": "…or link to product" },
    { "type": "article", "id": "cta2_article", "label": "…or link to article" },
    { "type": "select", "id": "cta_align", "label": "CTA alignment", "default": "left", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},

    { "type": "header", "content": "Wallet options" },
    { "type": "select", "id": "chain", "label": "Preferred chain", "default": "ethereum", "options": [
      { "value": "ethereum", "label": "Ethereum" },
      { "value": "polygon", "label": "Polygon" },
      { "value": "base", "label": "Base" },
      { "value": "solana", "label": "Solana" }
    ]},
    { "type": "text", "id": "provider_hint", "label": "Provider hint (optional)", "default": "any" },

    { "type": "header", "content": "Media (optional)" },
    { "type": "image_picker", "id": "media_image", "label": "Side image" },
    { "type": "text", "id": "media_alt", "label": "Media alt", "default": "Artwork" },
    { "type": "text", "id": "media_video", "label": "Side video URL (MP4)" },
    { "type": "image_picker", "id": "media_poster", "label": "Side video poster" },

    { "type": "header", "content": "Background (optional)" },
    { "type": "image_picker", "id": "background_image", "label": "Background image" },
    { "type": "text", "id": "bg_image_alt", "label": "Background image alt", "default": "Decorative background" },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "default": 20, "unit": "%" },

    { "type": "header", "content": "Gradient / glow" },
    { "type": "color", "id": "gradient_top", "label": "Gradient top", "default": "#0b0b12" },
    { "type": "color", "id": "gradient_bottom", "label": "Gradient bottom", "default": "#12121a" },
    { "type": "color", "id": "glow_color_1", "label": "Glow color 1", "default": "rgba(76, 29, 149, 0.45)" },
    { "type": "color", "id": "glow_color_2", "label": "Glow color 2", "default": "rgba(3, 105, 161, 0.45)" },
    { "type": "color", "id": "glow_color_3", "label": "Glow color 3", "default": "rgba(16, 185, 129, 0.35)" },
    { "type": "checkbox", "id": "animate_glow", "label": "Subtle glow animation", "default": true },

    { "type": "header", "content": "Layout & alignment" },
    { "type": "range", "id": "min_height_vh", "label": "Min height (vh)", "min": 40, "max": 100, "step": 5, "default": 60 },
    { "type": "range", "id": "padding_top", "label": "Padding top (px)", "min": 0, "max": 200, "step": 8, "default": 72 },
    { "type": "range", "id": "padding_bottom", "label": "Padding bottom (px)", "min": 0, "max": 200, "step": 8, "default": 72 },
    { "type": "select", "id": "media_position", "label": "Media position", "default": "right", "options": [
      { "value": "left", "label": "Left" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "select", "id": "media_width", "label": "Media width (desktop)", "default": "5", "options": [
      { "value": "5", "label": "5/12" }, { "value": "6", "label": "1/2" }, { "value": "7", "label": "7/12" }
    ]},
    { "type": "select", "id": "text_align", "label": "Text alignment", "default": "text-left", "options": [
      { "value": "text-left", "label": "Left" }, { "value": "text-center", "label": "Center" }, { "value": "text-right", "label": "Right" }
    ]},
    { "type": "select", "id": "container_mode", "label": "Container", "default": "contained", "options": [
      { "value": "contained", "label": "Contained (side padding)" }, { "value": "full", "label": "Full-bleed (edge to edge)" }
    ]},

    { "type": "header", "content": "Buttons styling" },
    { "type": "select", "id": "button_mode", "label": "Button style", "default": "solid", "options": [
      { "value": "solid", "label": "Solid" }, { "value": "outline", "label": "Outline" }
    ]},
    { "type": "color", "id": "button_bg_color", "label": "Button background (solid)", "default": "#111111" },
    { "type": "color", "id": "button_text_color", "label": "Button text color", "default": "#ffffff" },
    { "type": "color", "id": "button_border_color", "label": "Button border (outline)", "default": "#ffffff" },
    { "type": "range", "id": "button_border_width", "label": "Outline border width", "min": 0, "max": 6, "step": 1, "default": 1 },
    { "type": "range", "id": "button_radius", "label": "Corner radius", "min": 0, "max": 36, "step": 2, "default": 12 },

    { "type": "header", "content": "Visibility & analytics" },
    { "type": "text", "id": "anchor_id", "label": "Optional anchor ID" },
    { "type": "text", "id": "region_label", "label": "Accessible region label", "default": "Web3 promotion" },
    { "type": "checkbox", "id": "hide_on_mobile", "label": "Hide on mobile", "default": false },
    { "type": "checkbox", "id": "hide_on_desktop", "label": "Hide on desktop", "default": false },
    { "type": "checkbox", "id": "bullets_enable", "label": "Show bullet points", "default": false },
    { "type": "checkbox", "id": "send_events", "label": "Send analytics events on clicks", "default": true }
  ],
  "blocks": [
    {
      "type": "bullet",
      "name": "Bullet",
      "settings": [
        { "type": "select", "id": "icon", "label": "Icon", "default": "dot", "options": [
          { "value": "dot", "label": "Dot" }, { "value": "bolt", "label": "Bolt" }, { "value": "shield", "label": "Shield" }
        ]},
        { "type": "text", "id": "text", "label": "Text", "default": "Holder-only discount & early access" }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Web3 • Wallet CTA",
      "category": "Banner",
      "settings": {
        "kicker": "Token-gated",
        "heading": "Connect your wallet for early access",
        "subheading": "Holders unlock exclusive drops and perks.",
        "animate_glow": true,
        "media_position": "right"
      }
    }
  ]
}
{% endschema %}

{% render 'tw-safelist-banners' %}
