{% comment %}
  Quadratum — 3rd Party · Supplier & Brand Logo Carousel (Theme-only)
  File: sections/3rd-party-dropshipping-logo-carousel.liquid

  • Pure theme content (no API calls / no external JS required)
  • Modes: strip (scroll), marquee (CSS continuous scroll), grid (static)
  • A11Y: list semantics, focus styles, reduced motion support
  • Centered inner wrapper + image/text enforcement
{% endcomment %}

{%- liquid
  assign s = section.settings

  assign has_header = false
  if s.kicker != blank or s.heading != blank or s.body != blank
    assign has_header = true
  endif

  assign logo_block_count = 0
  for block in section.blocks
    if block.type == 'logo'
      assign logo_block_count = logo_block_count | plus: 1
    endif
  endfor

  assign should_render = false
  if s.enable_section == true
    if logo_block_count > 0
      assign should_render = true
    elsif has_header
      assign should_render = true
    endif
  endif

  assign img_variant = s.logo_style | default: 'color'
  assign img_class = 'q-logos__image q-logos__image--' | append: img_variant

  assign autoplay_enabled = false
  if s.autoplay == true and s.layout_mode != 'grid'
    assign autoplay_enabled = true
  endif

  assign respect_rm = false
  if s.respect_reduced_motion == true
    assign respect_rm = true
  endif

  assign do_clone_pass = false
  if s.layout_mode == 'marquee' and autoplay_enabled and logo_block_count > 0
    assign do_clone_pass = true
  endif

  assign passes = 1
  if do_clone_pass
    assign passes = 2
  endif

  assign inner_max = '1200px'
  case s.max_width
    when 'sm'
      assign inner_max = '720px'
    when 'md'
      assign inner_max = '960px'
    else
      assign inner_max = '1200px'
  endcase
-%}

{%- if should_render -%}
<section
  id="brand-logo-carousel-{{ section.id }}"
  class="q-section q-brand-logo-carousel q-section--bg-{{ s.background_style }} q-section--width-{{ s.max_width }}"
  aria-label="{{ s.aria_label | escape }}"
  data-q-section="brand-logo-carousel"
>
  <style>
    #brand-logo-carousel-{{ section.id }}{
      --q-logos-gap: {{ s.gutter | default: 16 }}px;
      --q-logos-max-h: {{ s.logo_max_height | default: 48 }}px;
      --q-logos-speed-ms: {{ s.autoplay_speed_ms | default: 4000 }};
      --q-logos-pad-y: 0.75rem;
      --q-logos-pad-x: 0.75rem;
    }

    /* FORCE: centered content area (prevents “hug left”) */
    #brand-logo-carousel-{{ section.id }} .q-section__inner{
      max-width: {{ inner_max }};
      margin-inline: auto;
      padding-inline: clamp(16px, 3vw, 32px);
    }

    /* Header alignment fallback */
    #brand-logo-carousel-{{ section.id }} .q-section__header--center{ text-align: center; }
    #brand-logo-carousel-{{ section.id }} .q-section__header--left{ text-align: left; }

    /* Panel treatment */
    #brand-logo-carousel-{{ section.id }} .q-logos{
      position: relative;
      width: 100%;
      margin-top: 0.75rem;
      padding: var(--q-logos-pad-y) var(--q-logos-pad-x);
      border-radius: var(--q-radius, 16px);
      background: rgba(0,0,0,0.03);
      background: color-mix(in srgb, currentColor 6%, transparent);
      border: 1px solid rgba(0,0,0,0.08);
      border-color: color-mix(in srgb, currentColor 12%, transparent);
    }

    #brand-logo-carousel-{{ section.id }} .q-logos__track{
      display: flex;
      align-items: center;
      gap: var(--q-logos-gap);
    }

    /* STRIP */
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-strip{
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scroll-snap-type: x proximity;
      scrollbar-width: thin;
    }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-strip .q-logos__track{
      flex-wrap: nowrap;
      min-width: 100%;
    }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-strip .q-logos__item{
      scroll-snap-align: center;
    }

    /* GRID */
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-grid{ overflow: visible; }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-grid .q-logos__track{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      align-items: center;
      gap: var(--q-logos-gap);
    }

    /* Alignment */
    #brand-logo-carousel-{{ section.id }} .q-logos--align-center .q-logos__track{ justify-content: center; }
    #brand-logo-carousel-{{ section.id }} .q-logos--align-left .q-logos__track{ justify-content: flex-start; }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-grid.q-logos--align-center .q-logos__track{ justify-items: center; }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-grid.q-logos--align-left .q-logos__track{ justify-items: start; }

    /* Items */
    #brand-logo-carousel-{{ section.id }} .q-logos__item{
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 160px;
    }

    /* Tiles */
    #brand-logo-carousel-{{ section.id }} .q-logos__link,
    #brand-logo-carousel-{{ section.id }} .q-logos__tile{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      padding: 0.65rem 0.85rem;
      border-radius: var(--q-radius, 14px);
      text-decoration: none;
      background: rgba(0,0,0,0.025);
      background: color-mix(in srgb, currentColor 4%, transparent);
      border: 1px solid rgba(0,0,0,0.06);
      border-color: color-mix(in srgb, currentColor 10%, transparent);
      min-height: calc(var(--q-logos-max-h) + 24px);
    }

    #brand-logo-carousel-{{ section.id }} .q-logos__link:focus-visible{
      outline: 2px solid currentColor;
      outline-offset: 3px;
    }

    #brand-logo-carousel-{{ section.id }} .q-logos__image{
      display: block;
      max-height: var(--q-logos-max-h);
      width: auto;
      height: auto;
      object-fit: contain;
    }

    #brand-logo-carousel-{{ section.id }} .q-logos__placeholder{
      display: block;
      width: 100%;
      max-width: 200px;
      height: var(--q-logos-max-h);
      opacity: 0.6;
    }

    #brand-logo-carousel-{{ section.id }} .q-logos__fallback{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      font-size: 0.95em;
      line-height: 1.2;
      opacity: 0.92;
      text-align: center;
      word-break: break-word;
    }

    /* Mono */
    #brand-logo-carousel-{{ section.id }} .q-logos__image--mono{
      filter: grayscale(1);
      opacity: 0.78;
      transition: filter 160ms ease, opacity 160ms ease, transform 160ms ease;
    }
    #brand-logo-carousel-{{ section.id }} .q-logos__link:hover .q-logos__image--mono,
    #brand-logo-carousel-{{ section.id }} .q-logos__link:focus-visible .q-logos__image--mono{
      filter: grayscale(0);
      opacity: 1;
      transform: translateY(-1px);
    }

    /* MARQUEE */
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-marquee{
      overflow: hidden;
      mask-image: linear-gradient(to right, transparent 0%, #000 8%, #000 92%, transparent 100%);
    }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-marquee .q-logos__track{
      width: max-content;
      will-change: transform;
    }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-marquee.q-logos--autoplay .q-logos__track{
      animation: q-logos-marquee-{{ section.id }} calc(var(--q-logos-speed-ms) * 1ms) linear infinite;
    }
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-marquee:hover .q-logos__track,
    #brand-logo-carousel-{{ section.id }} .q-logos--mode-marquee:focus-within .q-logos__track{
      animation-play-state: paused;
    }

    @keyframes q-logos-marquee-{{ section.id }}{
      from { transform: translateX(0); }
      to   { transform: translateX(-50%); }
    }

    @media (prefers-reduced-motion: reduce){
      #brand-logo-carousel-{{ section.id }} .q-logos--respect-rm.q-logos--autoplay .q-logos__track{
        animation: none !important;
        transform: none !important;
      }
    }
  </style>

  <div class="q-section__inner">
    {%- if has_header -%}
      <header class="q-section__header q-section__header--{{ s.content_align }}">
        {%- if s.kicker != blank -%}<p class="q-section__kicker">{{ s.kicker | escape }}</p>{%- endif -%}
        {%- if s.heading != blank -%}<h2 class="q-section__heading">{{ s.heading | escape }}</h2>{%- endif -%}
        {%- if s.body != blank -%}
          <div class="q-section__body"><p>{{ s.body | escape | newline_to_br }}</p></div>
        {%- endif -%}
      </header>
    {%- endif -%}

    <div
      class="q-logos q-logos--mode-{{ s.layout_mode }} q-logos--align-{{ s.logos_align }}{% if autoplay_enabled %} q-logos--autoplay{% endif %}{% if respect_rm %} q-logos--respect-rm{% endif %}"
      data-q-logos="{{ s.layout_mode }}"
      data-q-logos-speed="{{ s.autoplay_speed_ms | default: 4000 }}"
      {% if s.layout_mode == 'strip' %}tabindex="0"{% endif %}
    >
      {%- if logo_block_count > 0 -%}
        <div class="q-logos__track" role="list">
          {%- for pass in (1..passes) -%}
            {%- assign is_clone = false -%}
            {%- if pass == 2 -%}{%- assign is_clone = true -%}{%- endif -%}

            {%- for block in section.blocks -%}
              {%- if block.type == 'logo' -%}
                {%- assign b = block.settings -%}

                {%- assign has_img = false -%}
                {%- if b.logo != blank -%}{%- assign has_img = true -%}{%- endif -%}

                {%- assign has_text = false -%}
                {%- if b.brand_name != blank -%}{%- assign has_text = true -%}{%- endif -%}

                {%- if request.design_mode == false and has_img == false and has_text == false -%}
                  {%- continue -%}
                {%- endif -%}

                {%- assign brand_label = b.brand_name | default: 'Brand logo' -%}
                {%- assign link_label = b.aria_label | default: b.brand_name | default: 'Brand logo' -%}

                <div
                  class="q-logos__item{% if is_clone %} q-logos__item--clone{% endif %}"
                  role="listitem"
                  {% if is_clone %}aria-hidden="true"{% endif %}
                  {% unless is_clone %}{{ block.shopify_attributes }}{% endunless %}
                >
                  {%- if b.link_url != blank -%}
                    <a
                      href="{{ b.link_url }}"
                      class="q-logos__link"
                      aria-label="{{ link_label | escape }}"
                      {% if b.open_in_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                      {% if is_clone %}tabindex="-1"{% endif %}
                    >
                      {%- if has_img -%}
                        {{ b.logo
                          | image_url: width: 320
                          | image_tag:
                            class: img_class,
                            alt: brand_label,
                            loading: 'lazy',
                            widths: '160, 240, 320, 480',
                            sizes: '(min-width: 990px) 200px, 140px'
                        }}
                      {%- elsif has_text -%}
                        <span class="q-logos__fallback" aria-hidden="true">{{ b.brand_name | escape }}</span>
                      {%- else -%}
                        {{ 'image' | placeholder_svg_tag: 'q-logos__placeholder' }}
                      {%- endif -%}
                    </a>
                  {%- else -%}
                    <span class="q-logos__tile" role="img" aria-label="{{ brand_label | escape }}">
                      {%- if has_img -%}
                        {{ b.logo
                          | image_url: width: 320
                          | image_tag:
                            class: img_class,
                            alt: brand_label,
                            loading: 'lazy',
                            widths: '160, 240, 320, 480',
                            sizes: '(min-width: 990px) 200px, 140px'
                        }}
                      {%- elsif has_text -%}
                        <span class="q-logos__fallback">{{ b.brand_name | escape }}</span>
                      {%- else -%}
                        {{ 'image' | placeholder_svg_tag: 'q-logos__placeholder' }}
                      {%- endif -%}
                    </span>
                  {%- endif -%}
                </div>
              {%- endif -%}
            {%- endfor -%}
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>
{%- endif -%}

{% schema %}
{
  "name": "3rd Party - Partner Logos",
  "tag": "section",
  "class": "q-section q-brand-logo-carousel",
  "settings": [
    { "type": "checkbox", "id": "enable_section", "label": "Enable section", "default": true },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Our trusted partners" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Brands we work with" },
    { "type": "textarea", "id": "body", "label": "Description", "default": "We’re proud to partner with respected brands and suppliers to deliver consistent quality." },

    { "type": "header", "content": "Layout & styling" },
    {
      "type": "select",
      "id": "content_align",
      "label": "Content alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },
    {
      "type": "select",
      "id": "layout_mode",
      "label": "Layout mode",
      "default": "strip",
      "options": [
        { "value": "strip", "label": "Carousel strip" },
        { "value": "marquee", "label": "Continuous marquee" },
        { "value": "grid", "label": "Static grid" }
      ]
    },
    {
      "type": "select",
      "id": "logos_align",
      "label": "Logo alignment",
      "default": "center",
      "options": [
        { "value": "center", "label": "Center" },
        { "value": "left", "label": "Left" }
      ]
    },
    { "type": "range", "id": "logo_max_height", "label": "Max logo height (px)", "min": 24, "max": 96, "step": 4, "default": 48 },
    {
      "type": "select",
      "id": "logo_style",
      "label": "Logo style",
      "default": "color",
      "options": [
        { "value": "color", "label": "Full color" },
        { "value": "mono", "label": "Monochrome / subdued" }
      ]
    },
    { "type": "range", "id": "gutter", "label": "Gap between logos (px)", "min": 8, "max": 40, "step": 2, "default": 16 },

    { "type": "header", "content": "Motion" },
    { "type": "checkbox", "id": "autoplay", "label": "Enable autoplay (strip/marquee)", "default": true },
    { "type": "range", "id": "autoplay_speed_ms", "label": "Autoplay speed (ms)", "min": 1000, "max": 9500, "step": 500, "default": 4000 },
    { "type": "checkbox", "id": "respect_reduced_motion", "label": "Respect 'prefers-reduced-motion'", "default": true },

    { "type": "header", "content": "Background & accessibility" },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background style",
      "default": "surface",
      "options": [
        { "value": "surface", "label": "Surface" },
        { "value": "contrast", "label": "Contrast" },
        { "value": "brand", "label": "Brand color" }
      ]
    },
    {
      "type": "select",
      "id": "max_width",
      "label": "Content width",
      "default": "lg",
      "options": [
        { "value": "sm", "label": "Narrow" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Wide" }
      ]
    },
    { "type": "text", "id": "aria_label", "label": "Section aria label", "default": "Supplier and brand logos" }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        { "type": "image_picker", "id": "logo", "label": "Logo image" },
        { "type": "text", "id": "brand_name", "label": "Brand name", "default": "Brand name" },
        { "type": "url", "id": "link_url", "label": "Logo link (optional)" },
        { "type": "checkbox", "id": "open_in_new_tab", "label": "Open link in new tab", "default": false },
        { "type": "text", "id": "aria_label", "label": "Accessibility label (optional)"}
      ]
    }
  ],
  "presets": [
    {
      "name": "3rd Party - Partner Logos",
      "category": "3rd Party Integrations",
      "blocks": [
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" }
      ]
    }
  ]
}
{% endschema %}
