{% comment %}
  Quadratum — Collection Card (shared)
  File: snippets/collection-card.liquid

  Goals:
  • One collection card system used across the theme
  • Token-driven styling via CSS vars
  • No invalid nesting (no buttons inside <a>)
  • Optional overlay text (contrast-safe)
{% endcomment %}

{%- liquid
  assign c = collection
  if c == blank
    break
  endif

  assign card_preset = card_preset | default: 'catalog'
  assign density = density | default: 'compact'

  assign show_image = show_image
  if show_image == nil
    assign show_image = true
  endif

  assign show_count = show_count
  if show_count == nil
    assign show_count = true
  endif

  assign show_description = show_description
  if show_description == nil
    assign show_description = false
  endif

  assign overlay_text_enabled = overlay_text_enabled
  if overlay_text_enabled == nil
    assign overlay_text_enabled = false
  endif


  assign overlay_text_source = overlay_text_source | default: 'title'
  assign overlay_custom_text = overlay_custom_text | default: ''

  assign image_aspect = image_aspect | default: 'auto'

  assign text_align = text_align | default: 'left'
  assign title_size = title_size | default: 16
  assign title_weight = title_weight | default: '600'

  assign meta_size = meta_size | default: 13
  assign meta_opacity = meta_opacity | default: 0.82

  assign enable_color_overrides = enable_color_overrides

  assign card_style = ''
  assign card_style = card_style | append: '--q-cc-title-size:' | append: title_size | append: 'px;'
  assign card_style = card_style | append: '--q-cc-title-weight:' | append: title_weight | append: ';'
  assign card_style = card_style | append: '--q-cc-meta-size:' | append: meta_size | append: 'px;'
  assign card_style = card_style | append: '--q-cc-meta-opacity:' | append: meta_opacity | append: ';'

  if enable_color_overrides
    assign card_style = card_style | append: '--q-cc-card-bg:' | append: card_bg | append: ';'
    assign card_style = card_style | append: '--q-cc-card-border:' | append: card_border | append: ';'
    assign card_style = card_style | append: '--q-cc-title-color:' | append: title_color | append: ';'
    assign card_style = card_style | append: '--q-cc-meta-color:' | append: meta_color | append: ';'
    assign card_style = card_style | append: '--q-cc-overlay-color:' | append: overlay_color | append: ';'
    assign card_style = card_style | append: '--q-cc-overlay-text:' | append: overlay_text_color | append: ';'
  endif

  assign preset_class = 'q-collection-card--' | append: card_preset
  assign density_class = 'q-collection-card--density-' | append: density
  assign align_class = 'q-collection-card--align-' | append: text_align
  assign aspect_class = 'q-collection-card--aspect-' | append: image_aspect

  assign has_image = false
  assign img = nil
  if c.featured_image
    assign has_image = true
    assign img = c.featured_image
  endif

  assign overlay_text = ''
  if overlay_text_enabled
    if overlay_text_source == 'custom' and overlay_custom_text != blank
      assign overlay_text = overlay_custom_text
    elsif overlay_text_source == 'description' and c.description != blank
      assign overlay_text = c.description | strip_html | truncate: 90
    else
      assign overlay_text = c.title
    endif
  endif

  assign count_label = ''
  if show_count
    assign count_label = c.products_count | append: ' products'
  endif
-%}

<article class="q-collection-card {{ preset_class }} {{ density_class }} {{ align_class }} {{ aspect_class }}" style="{{ card_style }}" data-collection-card>
  <a class="q-collection-card__link" href="{{ c.url }}" aria-label="{{ c.title | escape }}">
    {%- if show_image -%}
      <div class="q-collection-card__media" aria-hidden="true">
        <div class="q-collection-card__media-inner">
          {%- if has_image and img -%}
            <img
              class="q-collection-card__img"
              src="{{ img | image_url: width: 1200 }}"
              alt="{{ img.alt | default: c.title | escape }}"
              loading="lazy"
              width="{{ img.width | default: 1200 }}"
              height="{{ img.height | default: 1200 }}"
            />
          {%- else -%}
            <div class="q-collection-card__media-placeholder"></div>
          {%- endif -%}

          {%- if overlay_text_enabled and overlay_text != blank -%}
            <div class="q-collection-card__overlay" aria-hidden="true">
              <div class="q-collection-card__overlay-inner">
                <span class="q-collection-card__overlay-text">{{ overlay_text }}</span>
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}

    <div class="q-collection-card__content">
      <h3 class="q-collection-card__title">{{ c.title }}</h3>

      {%- if show_count and count_label != blank -%}
        <div class="q-collection-card__meta">{{ count_label }}</div>
      {%- endif -%}

      {%- if show_description and c.description != blank -%}
        <div class="q-collection-card__desc">{{ c.description | strip_html | truncate: 120 }}</div>
      {%- endif -%}
    </div>
  </a>

  <style>
    .q-collection-card{
      position: relative;
      background: var(--q-cc-card-bg, var(--q-card-bg, transparent));
      border: 1px solid var(--q-cc-card-border, var(--q-card-border, rgba(0,0,0,.10)));
      border-radius: var(--q-radius, 12px);
      overflow: hidden;
    }
    .q-collection-card__link{
      display:block;
      color: inherit;
      text-decoration:none;
      outline: none;
    }
    .q-collection-card__link:focus-visible{
      box-shadow: 0 0 0 3px rgba(0,0,0,.18);
      border-radius: var(--q-radius, 12px);
    }

    .q-collection-card__media{ position: relative; overflow:hidden; }
    .q-collection-card__media-inner{ position: relative; }

    /* aspect ratios affect media container only */
    .q-collection-card--aspect-auto .q-collection-card__media-inner{ padding-top: var(--q-cc-media-auto, 62%); height: 0; }
    .q-collection-card--aspect-square .q-collection-card__media-inner{ padding-top: 100%; height: 0; }
    .q-collection-card--aspect-landscape .q-collection-card__media-inner{ padding-top: 66.666%; height: 0; }

    .q-collection-card__img,
    .q-collection-card__media-placeholder{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      background: rgba(0,0,0,.04);
    }

    .q-collection-card__overlay{
      position:absolute;
      inset:0;
      display:flex;
      align-items:flex-end;
      padding: .8rem;
      pointer-events:none;
    }
    .q-collection-card__overlay-inner{
      width:100%;
      border-radius: 12px;
      padding: .6rem .7rem;
      background: var(--q-cc-overlay-color, rgba(0,0,0,.55));
      backdrop-filter: blur(6px);
    }
    .q-collection-card__overlay-text{
      display:block;
      color: var(--q-cc-overlay-text, #fff);
      font-size: .95rem;
      line-height: 1.2;
    }

    .q-collection-card__content{
      padding: .9rem .95rem;
      text-align: left;
    }
    .q-collection-card--align-center .q-collection-card__content{ text-align:center; }

    .q-collection-card__title{
      margin:0;
      font-size: var(--q-cc-title-size, 16px);
      font-weight: var(--q-cc-title-weight, 600);
      color: var(--q-cc-title-color, inherit);
      font-family: var(--q-cc-title-ff, inherit);
      letter-spacing: var(--q-cc-title-ls, normal);
    }

    .q-collection-card__meta{
      margin-top: .35rem;
      font-size: var(--q-cc-meta-size, 13px);
      opacity: var(--q-cc-meta-opacity, .82);
      color: var(--q-cc-meta-color, inherit);
    }

    .q-collection-card__desc{
      margin-top: .45rem;
      font-size: var(--q-body-fs, 1rem);
      opacity: .9;
      color: var(--q-cc-meta-color, inherit);
    }

    .q-collection-card--density-compact .q-collection-card__content{ padding: .8rem .9rem; }
    .q-collection-card--density-comfortable .q-collection-card__content{ padding: 1rem 1rem; }
  </style>
</article>
