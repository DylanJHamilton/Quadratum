{%- comment -%}
  sections/social-media-pinterest-grid.liquid
  Quadratum — Social media · Pinterest moodboard (manual pins, Link-ready hooks)
{%- endcomment -%}

{%- if section.settings.enable_section -%}
  <section
    id="social-media-pinterest-grid-{{ section.id }}"
    class="q-section q-social-pinterest-grid"
    aria-label="{{ section.settings.aria_label | escape }}"
  >
    <div class="q-section__inner">

      {%- liquid
        assign align_value = section.settings.align | default: 'center'
        assign has_header = false

        if section.settings.kicker != blank
          assign has_header = true
        endif
        if section.settings.heading != blank
          assign has_header = true
        endif
        if section.settings.body != blank
          assign has_header = true
        endif
      -%}

      {%- if has_header -%}
        <header class="q-section-heading q-section-heading--{{ align_value }}">
          {%- if section.settings.kicker != blank -%}
            <p class="q-section-heading__kicker">
              {{ section.settings.kicker | escape }}
            </p>
          {%- endif -%}

          {%- if section.settings.heading != blank -%}
            <h2 class="q-section-heading__title">
              {{ section.settings.heading | escape }}
            </h2>
          {%- endif -%}

          {%- if section.settings.body != blank -%}
            <div class="q-section-heading__body">
              {{ section.settings.body | escape | newline_to_br }}
            </div>
          {%- endif -%}
        </header>
      {%- endif -%}

      {%- liquid
        assign data_source_mode = section.settings.data_source_mode | default: 'manual'
      -%}

      {%- if data_source_mode == 'manual' -%}
        {%- if section.blocks.size > 0 -%}
          <div
            class="q-pin-grid"
            style="
              --q-pin-grid-gap: {{ section.settings.card_gap | default: 20 }}px;
              --q-pin-grid-cols-desktop: {{ section.settings.columns_desktop | default: 3 }};
              --q-pin-grid-cols-mobile: {{ section.settings.columns_mobile | default: '1' }};
            "
          >
            {%- for block in section.blocks -%}
              {%- render 'q-social-pinterest-card',
                block: block,
                section_settings: section.settings
              -%}
            {%- endfor -%}
          </div>
        {%- else -%}
          {%- if request.design_mode -%}
            <div class="q-pin-grid__placeholder" role="status" aria-live="polite">
              <p>Add up to 16 “Pin” blocks to populate this moodboard grid.</p>
            </div>
          {%- endif -%}
        {%- endif -%}
      {%- else -%}
        {%- if request.design_mode -%}
          <div class="q-pin-grid__placeholder" role="status" aria-live="polite">
            <p>Board mode is enabled. Connect this section to a Quadratum Link Pinterest board feed.</p>
          </div>
        {%- endif -%}
      {%- endif -%}

    </div>
  </section>
{%- endif -%}

{% schema %}
{
  "name": "Social - Pinterest Board",
  "tag": "section",
  "class": "q-section q-social-pinterest-grid",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_section",
      "label": "Enable section",
      "default": true
    },
    {
      "type": "text",
      "id": "kicker",
      "label": "Kicker",
      "default": "Moodboard"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Pinterest-inspired ideas"
    },
    {
      "type": "textarea",
      "id": "body",
      "label": "Body text",
      "default": "Curate scenes, layouts, and style ideas that inspire your customers."
    },
    {
      "type": "select",
      "id": "align",
      "label": "Text alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },

    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns on desktop",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Columns on mobile",
      "default": "1",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ]
    },
    {
      "type": "range",
      "id": "card_gap",
      "label": "Gap between pins (px)",
      "min": 8,
      "max": 40,
      "step": 2,
      "default": 20
    },
    {
      "type": "select",
      "id": "card_style",
      "label": "Card style",
      "default": "surface",
      "options": [
        { "value": "surface", "label": "Soft surface" },
        { "value": "bordered", "label": "Bordered" },
        { "value": "minimal", "label": "Minimal (no background)" }
      ]
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image aspect ratio",
      "default": "2:3",
      "options": [
        { "value": "adapt", "label": "Adapt to image" },
        { "value": "1:1", "label": "Square (1:1)" },
        { "value": "2:3", "label": "Portrait (2:3)" },
        { "value": "4:5", "label": "Portrait (4:5)" }
      ]
    },

    {
      "type": "header",
      "content": "Display"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show title",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_copy",
      "label": "Show short copy",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pinterest_badge",
      "label": "Show Pinterest badge on pin",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_view_label",
      "label": "Show \"View on Pinterest\" label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "open_in_new_tab",
      "label": "Open pins in new tab",
      "default": true
    },

    {
      "type": "header",
      "content": "Data source (Quadratum Link ready)"
    },
    {
      "type": "select",
      "id": "data_source_mode",
      "label": "Data source",
      "default": "manual",
      "options": [
        { "value": "manual", "label": "Manual pins (theme editor)" },
        { "value": "board", "label": "Board feed (Quadratum Link, future)" }
      ]
    },
    {
      "type": "text",
      "id": "board_handle",
      "label": "Board handle (for Quadratum Link)",
      "default": "pinterest_board_default"
    },

    {
      "type": "text",
      "id": "aria_label",
      "label": "ARIA label for section",
      "default": "Pinterest moodboard grid"
    }
  ],
  "blocks": [
    {
      "type": "pin_item",
      "name": "Pin",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Cabin porch inspiration"
        },
        {
          "type": "textarea",
          "id": "copy",
          "label": "Short line of copy",
          "default": "Soft lighting, warm wood tones, and a cozy front porch to welcome guests."
        },
        {
          "type": "url",
          "id": "pinterest_url",
          "label": "View on Pinterest URL",
        },
        {
          "type": "text",
          "id": "aria_label",
          "label": "ARIA label for pin link",
          "default": "View this idea on Pinterest"
        }
      ]
    }
  ],
  "max_blocks": 16,
  "presets": [
    {
      "name": "Social Media - Pinterest Moodboard",
      "category": "Social Media",
      "blocks": [
        { "type": "pin_item" },
        { "type": "pin_item" },
        { "type": "pin_item" }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
  .q-social-pinterest-grid .q-pin-grid {
    display: grid;
    gap: var(--q-pin-grid-gap, 20px);
    grid-template-columns: repeat(var(--q-pin-grid-cols-mobile, 1), minmax(0, 1fr));
    align-items: start;
  }

  @media (min-width: 750px) {
    .q-social-pinterest-grid .q-pin-grid {
      grid-template-columns: repeat(var(--q-pin-grid-cols-desktop, 3), minmax(0, 1fr));
    }
  }

  .q-social-pinterest-grid .q-pin-grid__placeholder {
    padding: 16px;
    border: 1px dashed rgba(0, 0, 0, 0.2);
    border-radius: 12px;
  }

  .q-social-pinterest-grid .q-pin-grid__placeholder p {
    margin: 0;
  }
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
