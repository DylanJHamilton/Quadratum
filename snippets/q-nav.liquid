{% comment %}
  Quadratum â€” q-nav (primitive)
  File: snippets/q-nav.liquid

  Purpose:
  - Reusable nav list renderer (TOC, step menus, in-page nav, doc nav)
  - Accessible + keyboard friendly
  - Token/CSS-var driven (scoped vars only)

  Contract (recommended):
  {% render 'q-nav',
    nav_id: 'toc-1',
    aria_label: 'On this page',
    title: 'On this page',            (optional)
    items: items,                    (array of objects)
    active_id: active_id,            (optional)
    active_href: active_href,        (optional)
    item_class: 'q-toc__item',        (optional)
    link_class: 'q-toc__link',        (optional)
    list_class: 'q-toc__list',        (optional)
    wrapper_class: 'q-toc__nav',      (optional)
    indent_class_prefix: 'q-indent--',(optional)
    data_link_attr: 'data-q-toc-link',(optional)
    data_target_attr: 'data-q-toc-target', (optional)
    variant: 'default'               (optional)
  %}

  Items format (array):
  [
    { "label": "Overview", "href": "#overview", "id": "overview", "indent": 0 },
    { "label": "Pricing", "href": "#pricing", "id": "pricing", "indent": 0 },
    { "label": "FAQ", "href": "#faq", "id": "faq", "indent": 1 }
  ]

  Note:
  - Shopify Liquid supports `parse_json`. Most sections can build items as JSON string then parse.
{% endcomment %}

{%- liquid
  assign nav_id = nav_id | default: ''
  assign aria_label = aria_label | default: ''
  assign title = title | default: ''

  assign wrapper_class = wrapper_class | default: 'q-nav'
  assign list_class = list_class | default: 'q-nav__list'
  assign item_class = item_class | default: 'q-nav__item'
  assign link_class = link_class | default: 'q-nav__link'
  assign indent_class_prefix = indent_class_prefix | default: 'q-indent--'

  assign data_link_attr = data_link_attr | default: ''
  assign data_target_attr = data_target_attr | default: ''

  assign variant = variant | default: 'default'

  assign active_id = active_id | default: ''
  assign active_href = active_href | default: ''

  assign has_items = false
  if items != blank and items.size > 0
    assign has_items = true
  endif

  if has_items == false
    break
  endif
-%}

<nav
  class="{{ wrapper_class }} q-nav--{{ variant }}"
  {% if aria_label != blank %}aria-label="{{ aria_label | escape }}"{% endif %}
  {% if nav_id != blank %}id="{{ nav_id | escape }}"{% endif %}
>
  {%- if title != blank -%}
    <div class="q-nav__title">{{ title }}</div>
  {%- endif -%}

  <ul class="{{ list_class }}" role="list">
    {%- for item in items -%}
      {%- liquid
        assign label = item.label
        assign href = item.href
        assign id = item.id
        assign indent = item.indent | default: 0

        if label == blank or href == blank
          continue
        endif

        assign is_active = false
        if active_id != blank and id != blank and active_id == id
          assign is_active = true
        elsif active_href != blank and active_href == href
          assign is_active = true
        endif
      -%}

      <li class="{{ item_class }} {{ indent_class_prefix }}{{ indent }}">
        <a
          class="{{ link_class }}{% if is_active %} is-active{% endif %}"
          href="{{ href | escape }}"
          {% if data_link_attr != blank %}{{ data_link_attr }}{% endif %}
          {% if data_target_attr != blank and id != blank %}{{ data_target_attr }}="{{ id | escape }}"{% endif %}
        >
          <span class="q-nav__label">{{ label }}</span>
        </a>
      </li>
    {%- endfor -%}
  </ul>
</nav>
