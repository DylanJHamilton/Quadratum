{% comment %}
  Quadratum • Gradient Hero Banner (Animated)
  - Pure CSS animated gradient (pan/shine) with reduced-motion fallback.
  - Optional background image + overlay, tokenized CTAs, analytics toggle.
  - Perf: right-sized responsive images; eager-only when this is first visual.
  - A11y: descriptive region label; strong focus rings; WCAG-ready buttons.
{% endcomment %}

{% assign s = section.settings %}

{%- comment -%} Container padding for contained mode {%- endcomment -%}
{% assign container_pad = '' %}
{% if s.container_mode == 'contained' %}
  {% assign container_pad = 'px-4 md:px-6' %}
{% endif %}

{%- comment -%} Visibility toggles {%- endcomment -%}
{% assign visibility_classes = '' %}
{% if s.hide_on_mobile %}{% assign visibility_classes = visibility_classes | append: ' hidden md:block' %}{% endif %}
{% if s.hide_on_desktop %}{% assign visibility_classes = visibility_classes | append: ' md:hidden' %}{% endif %}

{%- comment -%} CTA href resolution via pickers (fallback to URLs) {%- endcomment -%}
{% assign href1 = s.cta_link %}
{% if href1 == blank and s.cta_product %}{% assign href1 = s.cta_product.url %}{% endif %}
{% if href1 == blank and s.cta_collection %}{% assign href1 = s.cta_collection.url %}{% endif %}
{% if href1 == blank and s.cta_article %}{% assign href1 = s.cta_article.url %}{% endif %}

{% assign href2 = s.cta2_link %}
{% if href2 == blank and s.cta2_product %}{% assign href2 = s.cta2_product.url %}{% endif %}
{% if href2 == blank and s.cta2_collection %}{% assign href2 = s.cta2_collection.url %}{% endif %}
{% if href2 == blank and s.cta2_article %}{% assign href2 = s.cta2_article.url %}{% endif %}

{%- comment -%} Responsive image sizing (if bg image used) {%- endcomment -%}
{% assign sizes_bg = '100vw' %}
{% assign widths_bg = '960,1280,1600,1920,2240' %}

<section
  id="{{ s.anchor_id | default: 'section-' | append: section.id }}"
  class="relative overflow-hidden {{ visibility_classes }}"
  role="region"
  aria-label="{{ s.region_label | default: 'Featured gradient hero' }}"
  style="min-height: {{ s.min_height_vh | default: 75 }}vh;"
>
  {%- if s.background_image != blank -%}
    <div class="absolute inset-0 -z-20">
      {{ s.background_image
        | image_url: width: 2240
        | image_tag:
          widths: widths_bg,
          sizes: sizes_bg,
          loading: 'eager',
          fetchpriority: 'high',
          class: 'absolute inset-0 w-full h-full object-cover',
          alt: s.bg_image_alt }}
      <div class="absolute inset-0" aria-hidden="true"
           style="background-color: {{ s.overlay_color }}; opacity: {{ s.overlay_opacity | divided_by: 100.0 }};">
      </div>
    </div>
  {%- endif -%}

  {%- comment -%} Animated gradient layer {%- endcomment -%}
  {% assign grad_c1 = s.gradient_color_1 | default: '#6EE7F9' %}
  {% assign grad_c2 = s.gradient_color_2 | default: '#A78BFA' %}
  {% assign grad_c3 = s.gradient_color_3 | default: '#F472B6' %}
  {% assign angle   = s.gradient_angle | default: 135 %}
  {% assign stop1   = s.stop_1 | default: 0 %}
  {% assign stop2   = s.stop_2 | default: 50 %}
  {% assign stop3   = s.stop_3 | default: 100 %}

  {% assign anim_class = '' %}
  {% if s.animation_mode == 'pan' %}
    {% assign anim_class = 'q-grad-pan' %}
  {% elsif s.animation_mode == 'shine' %}
    {% assign anim_class = 'q-grad-shine' %}
  {% endif %}

  <div class="absolute inset-0 -z-10 {{ anim_class }}"
       style="
         --q-pan-speed: {{ s.pan_speed | default: 12 }}s;
         background: linear-gradient({{ angle }}deg, {{ grad_c1 }} {{ stop1 }}%, {{ grad_c2 }} {{ stop2 }}%, {{ grad_c3 }} {{ stop3 }}%);
         background-size: 200% 200%;
       ">
  </div>

  <div class="relative z-10">
    <div class="mx-auto max-w-screen-xl {{ container_pad }}">
      <div class="flex items-center justify-{{ s.content_h_align | default: 'center' }} text-{{ s.text_align | default: 'center' }}"
           style="padding-top: {{ s.padding_top | default: 64 }}px; padding-bottom: {{ s.padding_bottom | default: 64 }}px;">
        <div class="{{ s.content_max_w | default: 'max-w-3xl' }} w-full">
          {% if s.kicker != blank %}
            <p class="text-sm font-semibold tracking-wide uppercase text-primary-foreground/90">{{ s.kicker }}</p>
          {% endif %}

          {% assign heading_text = s.heading | default: 'Gradient headline that sells' %}
          {% if s.heading_level == 'h1' %}
            <h1 class="mt-2 text-3xl md:text-5xl font-semibold leading-tight text-primary-foreground">{{ heading_text | escape }}</h1>
          {% else %}
            <h2 class="mt-2 text-3xl md:text-5xl font-semibold leading-tight text-primary-foreground">{{ heading_text | escape }}</h2>
          {% endif %}

          {% if s.subheading != blank %}
            <p class="mt-3 text-base md:text-lg text-primary-foreground/90 {% if s.hide_sub_mobile %}hidden md:block{% endif %}">
              {{ s.subheading }}
            </p>
          {% endif %}

          {% assign has_cta1 = false %}
          {% if s.cta_text != blank and href1 != blank %}{% assign has_cta1 = true %}{% endif %}
          {% assign has_cta2 = false %}
          {% if s.cta2_text != blank and href2 != blank %}{% assign has_cta2 = true %}{% endif %}

          {% if has_cta1 or has_cta2 %}
            <div class="mt-5 flex flex-wrap gap-3 {% if s.cta_group_align == 'left' %}justify-start{% elsif s.cta_group_align == 'right' %}justify-end{% else %}justify-center{% endif %}">
              {% if has_cta1 %}
                {% assign cta_label = s.cta_text %}
                {% if cta_label == blank %}{% assign cta_label = 'actions.shop_now' | t %}{% endif %}
                <a href="{{ href1 }}"
                   data-cta="primary"
                   class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 transition
                          {% if s.button_mode == 'outline' %}border bg-transparent{% else %}bg-primary text-primary-foreground hover:opacity-90{% endif %}"
                   style="{% if s.button_mode == 'outline' %}color: {{ s.button_text_color }}; border-color: {{ s.button_border_color }}; border-width: {{ s.button_border_width }}px;{% else %}color: {{ s.button_text_color }}; background-color: {{ s.button_bg_color }};{% endif %} border-radius: {{ s.button_radius }}px;"
                   aria-label="{{ s.cta_aria_label | default: cta_label | escape }}">
                  {{ cta_label }}
                </a>
              {% endif %}
              {% if has_cta2 %}
                {% assign cta2_label = s.cta2_text %}
                {% if cta2_label == blank %}{% assign cta2_label = 'actions.learn_more' | t %}{% endif %}
                <a href="{{ href2 }}"
                   data-cta="secondary"
                   class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 transition
                          {% if s.button_mode == 'outline' %}border bg-transparent{% else %}border border-input bg-background hover:bg-accent hover:text-accent-foreground{% endif %}"
                   style="{% if s.button_mode == 'outline' %}color: {{ s.button_text_color }}; border-color: {{ s.button_border_color }}; border-width: {{ s.button_border_width }}px;{% else %}color: {{ s.button_text_color }};{% endif %} border-radius: {{ s.button_radius }}px;"
                   aria-label="{{ s.cta2_aria_label | default: cta2_label | escape }}">
                  {{ cta2_label }}
                </a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if s.send_events %}
    <script>
      (function(){
        var root = document.getElementById('{{ s.anchor_id | default: 'section-' | append: section.id }}');
        if(!root) return;
        root.addEventListener('click', function(e){
          var a = e.target.closest('a[data-cta]');
          if(!a) return;
          var payload = { component: 'gradient_hero_banner', cta_type: a.getAttribute('data-cta'), href: a.getAttribute('href') };
          window.dispatchEvent(new CustomEvent('quadratum:cta', { detail: payload }));
          if(window.dataLayer && Array.isArray(window.dataLayer)){
            window.dataLayer.push({ event: 'quadratum_cta', component: payload.component, cta_type: payload.cta_type, href: payload.href });
          }
        });
      })();
    </script>
  {% endif %}

  <style>
    .q-grad-pan { animation: qGradPan var(--q-pan-speed, 12s) ease-in-out infinite alternate; }
    @keyframes qGradPan {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    .q-grad-shine { position: relative; }
    .q-grad-shine::after {
      content: "";
      position: absolute; inset: -20%; pointer-events: none;
      background: radial-gradient(circle at 20% 50%, rgba(255,255,255,.18), rgba(255,255,255,0) 45%);
      animation: qShine 6s linear infinite;
    }
    @keyframes qShine {
      0% { transform: translateX(-15%); }
      100% { transform: translateX(15%); }
    }
    @media (prefers-reduced-motion: reduce) {
      .q-grad-pan, .q-grad-shine::after { animation: none !important; }
    }
  </style>
</section>

{% render 'tw-safelist-banners' %}

{% schema %}
{
  "name": "Gradient Hero Banner",
  "tag": "section",
  "class": "q-gradient-hero",
  "settings": [
    { "type": "header", "content": "Header" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "New" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Gradient headline that sells" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "A bold, animated hero that stays fast and accessible." },
    { "type": "select", "id": "heading_level", "label": "Heading level", "default": "h2", "options": [
      { "value": "h1", "label": "H1" }, { "value": "h2", "label": "H2" }
    ]},

    { "type": "header", "content": "Layout & alignment" },
    { "type": "range", "id": "min_height_vh", "label": "Min height (vh)", "min": 40, "max": 100, "step": 5, "default": 75 },
    { "type": "range", "id": "padding_top", "label": "Padding top (px)", "min": 0, "max": 200, "step": 8, "default": 64 },
    { "type": "range", "id": "padding_bottom", "label": "Padding bottom (px)", "min": 0, "max": 200, "step": 8, "default": 64 },
    { "type": "select", "id": "content_h_align", "label": "Horizontal alignment", "default": "center", "options": [
      { "value": "start", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "end", "label": "Right" }
    ]},
    { "type": "select", "id": "text_align", "label": "Text alignment", "default": "center", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "select", "id": "content_max_w", "label": "Text width", "default": "max-w-3xl", "options": [
      { "value": "max-w-2xl", "label": "Narrow" },
      { "value": "max-w-3xl", "label": "Comfort" },
      { "value": "max-w-4xl", "label": "Wide" }
    ]},
    { "type": "select", "id": "container_mode", "label": "Container", "default": "contained", "options": [
      { "value": "contained", "label": "Contained (side padding)" },
      { "value": "full", "label": "Full-bleed (edge to edge)" }
    ]},

    { "type": "header", "content": "Gradient" },
    { "type": "color", "id": "gradient_color_1", "label": "Gradient color 1", "default": "#6EE7F9" },
    { "type": "color", "id": "gradient_color_2", "label": "Gradient color 2", "default": "#A78BFA" },
    { "type": "color", "id": "gradient_color_3", "label": "Gradient color 3", "default": "#F472B6" },
    { "type": "range", "id": "stop_1", "label": "Stop 1 (%)", "min": 0, "max": 100, "step": 1, "default": 0 },
    { "type": "range", "id": "stop_2", "label": "Stop 2 (%)", "min": 0, "max": 100, "step": 1, "default": 50 },
    { "type": "range", "id": "stop_3", "label": "Stop 3 (%)", "min": 0, "max": 100, "step": 1, "default": 100 },
    { "type": "range", "id": "gradient_angle", "label": "Angle (deg)", "min": 0, "max": 360, "step": 5, "default": 135 },
    { "type": "select", "id": "animation_mode", "label": "Animation", "default": "pan", "options": [
      { "value": "none", "label": "None" },
      { "value": "pan", "label": "Slow pan" },
      { "value": "shine", "label": "Shine sweep" }
    ]},
    { "type": "range", "id": "pan_speed", "label": "Pan speed (s)", "min": 6, "max": 30, "step": 1, "default": 12 },

    { "type": "header", "content": "Optional background image (under gradient)" },
    { "type": "image_picker", "id": "background_image", "label": "Background image" },
    { "type": "text", "id": "bg_image_alt", "label": "Background image alt", "default": "Decorative background" },
    { "type": "color", "id": "overlay_color", "label": "Overlay color (over image)", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "default": 25, "unit": "%" },

    { "type": "header", "content": "Buttons" },
    { "type": "select", "id": "cta_group_align", "label": "CTA alignment", "default": "center", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "select", "id": "button_mode", "label": "Button style", "default": "solid", "options": [
      { "value": "solid", "label": "Solid" }, { "value": "outline", "label": "Outline" }
    ]},
    { "type": "color", "id": "button_bg_color", "label": "Button background (solid)", "default": "#111111" },
    { "type": "color", "id": "button_text_color", "label": "Button text color", "default": "#ffffff" },
    { "type": "color", "id": "button_border_color", "label": "Button border (outline)", "default": "#ffffff" },
    { "type": "range", "id": "button_border_width", "label": "Outline border width", "min": 0, "max": 6, "step": 1, "default": 1 },
    { "type": "range", "id": "button_radius", "label": "Corner radius", "min": 0, "max": 36, "step": 2, "default": 12 },
    { "type": "text", "id": "cta_text", "label": "Primary CTA text", "default": "Shop now" },
    { "type": "url", "id": "cta_link", "label": "Primary CTA URL" },
    { "type": "product", "id": "cta_product", "label": "…or link to product" },
    { "type": "collection", "id": "cta_collection", "label": "…or link to collection" },
    { "type": "article", "id": "cta_article", "label": "…or link to article" },
    { "type": "text", "id": "cta_aria_label", "label": "Primary CTA ARIA label", "default": "Shop now" },
    { "type": "text", "id": "cta2_text", "label": "Secondary CTA text", "default": "Learn more" },
    { "type": "url", "id": "cta2_link", "label": "Secondary CTA URL" },
    { "type": "product", "id": "cta2_product", "label": "Secondary… link to product" },
    { "type": "collection", "id": "cta2_collection", "label": "Secondary… link to collection" },
    { "type": "article", "id": "cta2_article", "label": "Secondary… link to article" },
    { "type": "text", "id": "cta2_aria_label", "label": "Secondary CTA ARIA label", "default": "Learn more" },

    { "type": "header", "content": "Visibility & analytics" },
    { "type": "text", "id": "anchor_id", "label": "Optional anchor ID" },
    { "type": "text", "id": "region_label", "label": "Accessible region label", "default": "Featured gradient hero" },
    { "type": "checkbox", "id": "hide_on_mobile", "label": "Hide on mobile", "default": false },
    { "type": "checkbox", "id": "hide_on_desktop", "label": "Hide on desktop", "default": false },
    { "type": "checkbox", "id": "send_events", "label": "Send analytics events on clicks", "default": true }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Gradient Hero • Drop",
      "category": "Banner",
      "settings": {
        "kicker": "New drop",
        "heading": "Color that moves",
        "subheading": "Subtle animated gradient that keeps LCP lean.",
        "gradient_color_1": "#60a5fa",
        "gradient_color_2": "#a78bfa",
        "gradient_color_3": "#f472b6",
        "animation_mode": "pan",
        "pan_speed": 14
      }
    },
    {
      "name": "Gradient Hero • Editorial",
      "category": "Banner",
      "settings": {
        "kicker": "Story",
        "heading": "Craft & color",
        "subheading": "A modern editorial hero with gentle shine.",
        "animation_mode": "shine"
      }
    },
    {
      "name": "Gradient Hero • Sale",
      "category": "Banner",
      "settings": {
        "kicker": "Sale",
        "heading": "Extra 20% off",
        "subheading": "Applied automatically at checkout.",
        "animation_mode": "none"
      }
    }
  ]
}
{% endschema %}
