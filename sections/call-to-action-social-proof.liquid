{% comment %}
  Quadratum — CTA: Social Proof (Metrics + Logo Wall)
  • Root background (color / image / video) + overlay (solid/gradient)
  • Metrics grid + Logo wall + Primary/Secondary CTAs
  • Optional external icon host via icon_base_url ('auto' means unset)
  • A11y: role=region, custom aria-label, focus outlines
{% endcomment %}

{%- assign s = section.settings -%}

{%- comment %} THEME TOKENS {% endcomment -%}
{%- assign C_text_base  = settings.text_base  | default: '#111111' -%}
{%- assign C_text_muted = settings.text_muted | default: '#6b7280' -%}
{%- assign C_primary    = settings.color_primary | default: '#2563eb' -%}

<style>
  /* Scoped to this section by id to avoid leakage */
  #{{ section.id }} .q-wrap { margin-left:auto; margin-right:auto; }
  #{{ section.id }} .q-head { display:grid; gap:.5rem; }
  #{{ section.id }} .q-kicker{ color: {{ C_primary }}; font-size: 1rem; letter-spacing:.02em; }
  #{{ section.id }} .q-heading{ color: {{ C_text_base }}; line-height:1.15; }
  #{{ section.id }} .q-sub{ color: {{ C_text_muted }}; }

  #{{ section.id }} .q-metrics{
    display:grid; gap: {{ s.gap | default: 20 }}px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    margin-top: {{ s.gap | default: 20 }}px;
  }
  #{{ section.id }} .q-metric{ display:grid; align-content:start; gap: {{ s.item_gap | default: 8 }}px; text-align: {{ s.text_align | default: 'center' }}; }
  #{{ section.id }} .q-metric .q-icon{ width:24px; height:24px; display:inline-block; }
  #{{ section.id }} .q-stat{ font-weight:600; font-size:1.5rem; color: {{ C_text_base }}; }
  #{{ section.id }} .q-label{ color: {{ C_text_base }}; opacity:.9; }
  #{{ section.id }} .q-subtext{ color: {{ C_text_muted }}; font-size:.95rem; }

  #{{ section.id }} .q-logos{
    display:flex; flex-wrap:wrap; justify-content:center; align-items:center;
    gap: {{ s.logo_gap | default: 24 }}px; margin-top: calc({{ s.gap | default: 20 }}px + .25rem);
  }
  #{{ section.id }} .q-logo{ flex:0 0 auto; opacity:.9; transition: opacity .2s ease; }
  #{{ section.id }} .q-logo img{ max-height: {{ s.logo_max_h | default: 40 }}px; width:auto; height:auto; display:block; filter:grayscale(100%); }
  #{{ section.id }} .q-logo a:focus-visible{ outline:2px solid {{ C_primary }}; outline-offset:4px; border-radius:6px; }

  #{{ section.id }} .q-ctas{ display:flex; gap:12px; justify-content: {{ s.cta_align | default: 'center' }}; margin-top: calc({{ s.gap | default: 20 }}px + .25rem); }
  #{{ section.id }} .q-btn{
    display:inline-flex; align-items:center; justify-content:center;
    text-decoration:none; font-weight:600; transform-origin:center;
    padding:.75rem 1.5rem; border-radius: {{ s.btn_radius | default: 24 }}px;
    transition: all {{ s.btn_transition_ms | default: 220 }}ms {{ s.btn_ease | default: 'ease-in-out' }};
  }
  #{{ section.id }} .q-btn--primary{
    background: {{ s.btn_bg | default: C_primary }}; color: {{ s.btn_text | default: '#ffffff' }};
    border: 1px solid {{ s.btn_bg | default: C_primary }};
  }
  #{{ section.id }} .q-btn--primary:hover{
    background: {{ s.btn_bg_hover | default: C_primary }}; color: {{ s.btn_text_hover | default: '#ffffff' }};
    transform: scale({{ s.btn_hover_scale | default: '1.05' }});
  }
  #{{ section.id }} .q-btn--secondary{
    background: transparent; color: {{ s.btn_bg | default: C_primary }};
    border: 1px solid {{ s.btn_bg | default: C_primary }};
  }
  #{{ section.id }} .q-btn--secondary:hover{
    background: {{ s.btn_bg | default: C_primary }}; color: {{ s.btn_text | default: '#ffffff' }};
    transform: scale({{ s.btn_hover_scale | default: '1.05' }});
  }

  /* Root background layering */
  #{{ section.id }} .q-bg { position:absolute; inset:0; overflow:hidden; pointer-events:none; }
  #{{ section.id }} .q-bg-media{ width:100%; height:100%; object-fit:cover; display:block; }
  #{{ section.id }} .q-overlay{ position:absolute; inset:0; pointer-events:none; }
  #{{ section.id }} .q-bleed{ position:relative; }
  #{{ section.id }} .q-layer{ position:relative; z-index:1; }
</style>

<section
  id="{{ section.id }}"
  class="q-cta-social-proof"
  role="region"
  aria-label="{{ s.aria_label | default: 'Social proof' }}"
>
  <div class="q-bleed" style="background-color: {{ s.background_color | default: '#f6f7f8' }};">
    {%- comment %} Root background (color / image / video) lives here {% endcomment -%}
    <div class="q-bg" aria-hidden="true">
      {%- assign vurl = s.background_video | strip -%}
      {%- if vurl != blank -%}
        <video class="q-bg-media" autoplay loop muted playsinline preload="metadata"
          {% if s.background_image != blank %}poster="{{ s.background_image | image_url: width: 1600 }}"{% endif %}>
          <source src="{{ vurl | escape }}" type="video/mp4">
        </video>
      {%- elsif s.background_image != blank -%}
        {{ s.background_image
          | image_url: width: 2880
          | image_tag:
            widths: '960,1440,1920,2560,2880',
            sizes: '100vw',
            loading: 'lazy',
            decoding: 'async',
            class: 'q-bg-media',
            alt: '' }}
      {%- else -%}
        <div class="q-bg-media"></div>
      {%- endif -%}

      {%- if s.overlay_type == 'gradient' -%}
        {%- assign g1 = s.grad_start | default: '#000000' -%}
        {%- assign g2 = s.grad_end   | default: '#000000' -%}
        {%- assign g1o = s.grad_start_opacity | default: 20 | divided_by: 100.0 -%}
        {%- assign g2o = s.grad_end_opacity   | default: 0  | divided_by: 100.0 -%}
        {%- assign ang = s.grad_angle | default: 180 -%}
        {%- assign g1c = g1 | color_modify: 'alpha', g1o -%}
        {%- assign g2c = g2 | color_modify: 'alpha', g2o -%}
        <div class="q-overlay" style="background: linear-gradient({{ ang }}deg, {{ g1c }}, {{ g2c }});"></div>
      {%- else -%}
        <div class="q-overlay" style="background-color: {{ s.overlay_color | default: '#000000' }}; opacity: {{ s.overlay_opacity | default: 25 | divided_by: 100.0 }};"></div>
      {%- endif -%}
    </div>

    <div class="q-layer">
      <div class="q-wrap" style="
        max-width: {{ s.max_width | default: 1200 }}px;
        padding-top: {{ s.pad_y | default: 64 }}px;
        padding-bottom: {{ s.pad_y | default: 64 }}px;
        padding-left: {{ s.pad_x | default: 24 }}px;
        padding-right: {{ s.pad_x | default: 24 }}px;
        text-align: {{ s.text_align | default: 'center' }};
        margin: 0 auto;
      ">
        {%- if s.kicker != blank -%}
          <div class="q-kicker">{{ s.kicker }}</div>
        {%- endif -%}

        {%- if s.heading != blank -%}
          <h2 class="q-heading">{{ s.heading }}</h2>
        {%- endif -%}

        {%- if s.subheading != blank -%}
          <p class="q-sub">{{ s.subheading }}</p>
        {%- endif -%}

        {%- assign mode = s.display_mode | default: 'mixed' -%}

        {%- if mode != 'logo_strip' -%}
          {%- assign metric_blocks = section.blocks | where: 'type', 'metric' -%}
          {%- if metric_blocks.size > 0 -%}
            <div class="q-metrics" role="list">
              {%- for block in metric_blocks -%}
                {%- assign m = block.settings -%}
                {%- assign icon_url = blank -%}
                {%- if m.icon_filename != blank -%}
                  {%- if s.icon_base_url and s.icon_base_url != 'auto' -%}
                    {%- assign icon_url = s.icon_base_url | append: m.icon_filename -%}
                  {%- else -%}
                    {%- assign icon_url = m.icon_filename | asset_url -%}
                  {%- endif -%}
                {%- endif -%}
                <div class="q-metric" role="listitem" {{ block.shopify_attributes }}>
                  {%- if icon_url != blank -%}
                    <img class="q-icon" src="{{ icon_url }}" alt="" loading="lazy" decoding="async">
                  {%- endif -%}
                  {%- if m.stat_value != blank -%}<div class="q-stat">{{ m.stat_value }}</div>{%- endif -%}
                  {%- if m.stat_label != blank -%}<div class="q-label">{{ m.stat_label }}</div>{%- endif -%}
                  {%- if m.stat_subtext != blank -%}<div class="q-subtext">{{ m.stat_subtext }}</div>{%- endif -%}
                </div>
              {%- endfor -%}
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- if mode != 'grid_only' -%}
          {%- assign logo_blocks = section.blocks | where: 'type', 'logo' -%}
          {%- if logo_blocks.size > 0 -%}
            <div class="q-logos" role="list">
              {%- for block in logo_blocks -%}
                {%- assign l = block.settings -%}
                <div class="q-logo" role="listitem" {{ block.shopify_attributes }}>
                  {%- if l.logo_link != blank -%}
                    <a href="{{ l.logo_link }}" aria-label="{{ l.logo_alt | default: 'Partner' | escape }}" rel="noopener">
                  {%- endif -%}
                    {%- if l.logo_image != blank -%}
                      {{ l.logo_image
                        | image_url: width: 300
                        | image_tag: loading: 'lazy', decoding: 'async', alt: l.logo_alt | default: 'Partner logo' }}
                    {%- else -%}
                      <span class="q-subtext">{{ l.logo_alt | default: 'Partner' }}</span>
                    {%- endif -%}
                  {%- if l.logo_link != blank -%}
                    </a>
                  {%- endif -%}
                </div>
              {%- endfor -%}
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- if s.cta_label != blank or s.cta2_label != blank -%}
          <div class="q-ctas">
            {%- if s.cta_label != blank -%}
              <a href="{{ s.cta_link | default: '#' }}" class="q-btn q-btn--primary" aria-label="{{ s.cta_label | escape }}">{{ s.cta_label }}</a>
            {%- endif -%}
            {%- if s.cta2_label != blank -%}
              <a href="{{ s.cta2_link | default: '#' }}" class="q-btn q-btn--secondary" aria-label="{{ s.cta2_label | escape }}">{{ s.cta2_label }}</a>
            {%- endif -%}
          </div>
        {%- endif -%}

      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "CTA – Social Proof",
  "tag": "section",
  "class": "q-cta-social-proof",
  "settings": [
    { "type": "text", "id": "aria_label", "label": "ARIA label", "default": "Social proof" },

    { "type": "header", "content": "Display" },
    { "type": "select", "id": "display_mode", "label": "Display mode", "default": "mixed", "options": [
      { "value": "mixed", "label": "Metrics + logos" },
      { "value": "grid_only", "label": "Metrics only" },
      { "value": "logo_strip", "label": "Logos only" }
    ]},

    { "type": "header", "content": "Header" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Top rated" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Trusted by thousands worldwide" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Top-rated products with proven results across industries." },

    { "type": "header", "content": "Alignment & Layout" },
    { "type": "select", "id": "text_align", "label": "Text alignment", "default": "center", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "range", "id": "max_width", "label": "Max width (px)", "min": 640, "max": 1600, "step": 20, "default": 1200 },
    { "type": "range", "id": "pad_y", "label": "Padding Y", "min": 0, "max": 200, "step": 4, "default": 64 },
    { "type": "range", "id": "pad_x", "label": "Padding X", "min": 0, "max": 64, "step": 4, "default": 24 },
    { "type": "range", "id": "gap", "label": "Metric gap", "min": 0, "max": 80, "step": 4, "default": 20 },
    { "type": "range", "id": "item_gap", "label": "Metric item gap", "min": 0, "max": 24, "step": 2, "default": 8 },
    { "type": "range", "id": "logo_gap", "label": "Logo gap", "min": 8, "max": 64, "step": 4, "default": 24 },
    { "type": "range", "id": "logo_max_h", "label": "Logo max height (px)", "min": 20, "max": 80, "step": 2, "default": 40 },

    { "type": "header", "content": "Background" },
    { "type": "image_picker", "id": "background_image", "label": "Background image" },
    { "type": "text", "id": "background_video", "label": "Background video URL (MP4)" },
    { "type": "color", "id": "background_color", "label": "Background color", "default": "#f6f7f8" },
    { "type": "select", "id": "overlay_type", "label": "Overlay type", "default": "solid", "options": [
      { "value": "solid", "label": "Solid color" }, { "value": "gradient", "label": "Gradient" }
    ]},
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "default": 25, "unit": "%" },
    { "type": "color", "id": "grad_start", "label": "Gradient start", "default": "#000000" },
    { "type": "range", "id": "grad_start_opacity", "label": "Start opacity", "min": 0, "max": 100, "step": 5, "default": 20, "unit": "%" },
    { "type": "color", "id": "grad_end", "label": "Gradient end", "default": "#000000" },
    { "type": "range", "id": "grad_end_opacity", "label": "End opacity", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "%" },
    { "type": "range", "id": "grad_angle", "label": "Gradient angle", "min": 0, "max": 360, "step": 5, "default": 180, "unit": "deg" },

    { "type": "header", "content": "Icons (advanced)" },
    { "type": "text", "id": "icon_base_url", "label": "Icon base URL (optional)", "default": "auto", "info": "Set to a full URL prefix like https://cdn.example.com/icons/. 'auto' uses local theme assets." },

    { "type": "header", "content": "CTAs" },
    { "type": "text", "id": "cta_label", "label": "Primary label", "default": "See why teams choose us" },
    { "type": "url",  "id": "cta_link",  "label": "Primary link" },
    { "type": "text", "id": "cta2_label", "label": "Secondary label", "default": "Shop bestsellers" },
    { "type": "url",  "id": "cta2_link", "label": "Secondary link" },
    { "type": "select", "id": "cta_align", "label": "CTA alignment", "default": "center", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "color", "id": "btn_bg", "label": "Button background", "default": "#2563eb" },
    { "type": "color", "id": "btn_text", "label": "Button text", "default": "#ffffff" },
    { "type": "color", "id": "btn_bg_hover", "label": "Button background (hover)", "default": "#2563eb" },
    { "type": "color", "id": "btn_text_hover", "label": "Button text (hover)", "default": "#ffffff" },
    { "type": "range", "id": "btn_radius", "label": "Button radius", "min": 0, "max": 48, "step": 2, "default": 24 },
    { "type": "range", "id": "btn_transition_ms", "label": "Button transition (ms)", "min": 0, "max": 600, "step": 20, "default": 220 },
    { "type": "text", "id": "btn_hover_scale", "label": "Button hover scale", "default": "1.05" },
    { "type": "text", "id": "btn_ease", "label": "Button easing", "default": "ease-in-out" },

    { "type": "header", "content": "Visibility" },
    { "type": "checkbox", "id": "hide_on_mobile", "label": "Hide on mobile", "default": false },
    { "type": "checkbox", "id": "hide_on_desktop", "label": "Hide on desktop", "default": false }
  ],
  "blocks": [
    {
      "type": "metric",
      "name": "Metric",
      "settings": [
        { "type": "text", "id": "icon_filename", "label": "Icon filename (/assets or Files URL suffix)", "default": "star.svg" },
        { "type": "text", "id": "stat_value", "label": "Stat value", "default": "4.9 / 5" },
        { "type": "text", "id": "stat_label", "label": "Label", "default": "Average rating" },
        { "type": "text", "id": "stat_subtext", "label": "Subtext", "default": "Based on 2,430 reviews" }
      ]
    },
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        { "type": "image_picker", "id": "logo_image", "label": "Logo image" },
        { "type": "text", "id": "logo_alt", "label": "Alt text", "default": "Partner logo" },
        { "type": "url", "id": "logo_link", "label": "Optional logo link" }
      ]
    }
  ],
  "max_blocks": 32,
  "presets": [
    {
      "name": "CTA – Social Proof",
      "category": "Call To Action",
      "settings": {
        "kicker": "Top rated",
        "heading": "Trusted by thousands worldwide",
        "subheading": "Top-rated products with proven results across industries.",
        "background_color": "#f6f7f8",
        "overlay_type": "solid",
        "overlay_opacity": 25
      },
      "blocks": [
        { "type": "metric", "settings": { "icon_filename": "star.svg",  "stat_value": "4.9 / 5", "stat_label": "Average rating",   "stat_subtext": "Based on 2,430 reviews" } },
        { "type": "metric", "settings": { "icon_filename": "users.svg", "stat_value": "20,000+", "stat_label": "Happy customers",  "stat_subtext": "Across 15 countries" } },
        { "type": "metric", "settings": { "icon_filename": "award.svg", "stat_value": "#1 Rated","stat_label": "Industry awards", "stat_subtext": "Capterra & G2" } }
      ]
    }
  ]
}
{% endschema %}

