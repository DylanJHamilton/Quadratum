{% comment %}
  Quadratum ‚Äî Interactive Content Helper ¬∑ Tabs/Accordion
  File: sections/interactive-content-helper-tabs-accordion.liquid

  IMPORTANT:
  - The {% schema %} tag MUST be top-level (not nested in any Liquid tags).
  - Therefore: wrap ONLY the rendered markup in an `{% if count > 0 %}` guard.
{% endcomment %}

{%- liquid
  assign items = section.blocks | where: 'type', 'item'
  assign count = items.size

  assign layout_mode = section.settings.layout_mode
  assign style_preset = section.settings.style_preset
  assign mobile_mode = section.settings.mobile_mode
  assign tab_alignment = section.settings.tab_alignment
  assign icon_position = section.settings.icon_position

  assign accordion_default_open = section.settings.accordion_default_open
  assign accordion_behavior = section.settings.accordion_behavior

  assign show_header = section.settings.show_header
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading

  assign maxw = section.settings.max_width
  assign pad_y = section.settings.pad_y
  assign pad_x = section.settings.pad_x
  assign gap = section.settings.gap

  assign use_custom_colors = section.settings.use_custom_colors

  assign ui_id = 'q-tac-' | append: section.id
  assign anchor_ns = section.id | append: '-'

  assign is_tabs = false
  if layout_mode == 'tabs_horizontal' or layout_mode == 'tabs_vertical'
    assign is_tabs = true
  endif

  assign is_tabs_vertical = false
  if layout_mode == 'tabs_vertical'
    assign is_tabs_vertical = true
  endif

  assign should_render_dual = false
  if layout_mode == 'tabs_horizontal' and mobile_mode == 'auto'
    assign should_render_dual = true
  endif

  assign force_accordion_mobile = false
  if mobile_mode == 'force_accordion'
    assign force_accordion_mobile = true
  endif

  assign label_font_mode = section.settings.label_font_mode
  assign label_font_style = section.settings.label_font_style
  assign label_transform = section.settings.label_transform

  assign tab_indicator = section.settings.tab_active_indicator
-%}

{%- if count > 0 -%}
<section
  class="q-section q-tac q-tac--preset-{{ style_preset }}"
  id="section-{{ section.id }}"
  style="
    --q-tac-pad-y: {{ pad_y }}px;
    --q-tac-pad-x: {{ pad_x }}px;
    --q-tac-gap: {{ gap }}px;
    --q-tac-maxw: {{ maxw }}px;
    --q-tac-bp: {{ section.settings.mobile_breakpoint }}px;

    --q-tac-radius: {{ section.settings.radius }}px;

    --q-tac-heading-fs: {{ section.settings.heading_fs }}px;
    --q-tac-heading-fw: {{ section.settings.heading_fw }};
    --q-tac-subheading-fs: {{ section.settings.subheading_fs }}px;
    --q-tac-subheading-lh: {{ section.settings.subheading_lh_x100 | divided_by: 100.0 }};

    --q-tac-label-fs: {{ section.settings.label_fs }}px;
    --q-tac-label-fw: {{ section.settings.label_fw }};
    --q-tac-label-ls: {{ section.settings.label_ls_x1000 | divided_by: 1000.0 }}em;

    --q-tac-body-fs: {{ section.settings.body_fs }}px;
    --q-tac-body-lh: {{ section.settings.body_lh_x100 | divided_by: 100.0 }};

    --q-tac-shadow-strength: {{ section.settings.shadow_strength_x100 | divided_by: 100.0 }};

    --q-tac-tab-radius: {{ section.settings.tab_radius }}px;
    --q-tac-tab-pad-y: {{ section.settings.tab_pad_y }}px;
    --q-tac-tab-pad-x: {{ section.settings.tab_pad_x }}px;
    --q-tac-tab-gap: {{ section.settings.tab_gap }}px;
    --q-tac-tab-border-w: {{ section.settings.tab_border_w }}px;

    --q-tac-acc-radius: {{ section.settings.acc_radius }}px;
    --q-tac-acc-pad-y: {{ section.settings.acc_pad_y }}px;
    --q-tac-acc-pad-x: {{ section.settings.acc_pad_x }}px;
    --q-tac-acc-gap: {{ section.settings.acc_gap }}px;
    --q-tac-acc-border-w: {{ section.settings.acc_border_w }}px;

    {% if use_custom_colors %}
      --q-tac-bg: {{ section.settings.bg }};
      --q-tac-text: {{ section.settings.text }};
      --q-tac-muted: {{ section.settings.muted }};
      --q-tac-accent: {{ section.settings.accent }};
      --q-tac-surface: {{ section.settings.surface }};
      --q-tac-border: {{ section.settings.border }};

      --q-tac-tab-bg: {{ section.settings.tab_bg }};
      --q-tac-tab-fg: {{ section.settings.tab_text }};
      --q-tac-tab-border: {{ section.settings.tab_border }};
      --q-tac-tab-active-bg: {{ section.settings.tab_active_bg }};
      --q-tac-tab-active-fg: {{ section.settings.tab_active_text }};
      --q-tac-tab-active-border: {{ section.settings.tab_active_border }};

      --q-tac-acc-bg: {{ section.settings.acc_bg }};
      --q-tac-acc-fg: {{ section.settings.acc_text }};
      --q-tac-acc-border: {{ section.settings.acc_border }};
      --q-tac-acc-active-bg: {{ section.settings.acc_active_bg }};
      --q-tac-acc-active-fg: {{ section.settings.acc_active_text }};
      --q-tac-acc-active-border: {{ section.settings.acc_active_border }};
    {% else %}
      --q-tac-bg: var(--q-bg, var(--bg_base, #ffffff));
      --q-tac-text: var(--q-text, var(--text_base, #111111));
      --q-tac-muted: var(--q-muted, var(--text_muted, #6b7280));
      --q-tac-accent: var(--q-accent, var(--color_primary, #2563eb));
      --q-tac-surface: var(--q-surface, var(--bg_contrast, #f6f7f8));
      --q-tac-border: var(--q-border, rgba(0,0,0,.12));

      /* sensible defaults for chrome */
      --q-tac-tab-bg: var(--q-tac-surface);
      --q-tac-tab-fg: var(--q-tac-text);
      --q-tac-tab-border: var(--q-tac-border);
      --q-tac-tab-active-bg: var(--q-tac-accent);
      --q-tac-tab-active-fg: #ffffff;
      --q-tac-tab-active-border: var(--q-tac-accent);

      --q-tac-acc-bg: var(--q-tac-surface);
      --q-tac-acc-fg: var(--q-tac-text);
      --q-tac-acc-border: var(--q-tac-border);
      --q-tac-acc-active-bg: var(--q-tac-accent);
      --q-tac-acc-active-fg: #ffffff;
      --q-tac-acc-active-border: var(--q-tac-accent);
    {% endif %}
  "
  data-q-tac-root
  data-label-font="{{ label_font_mode }}"
  data-label-style="{{ label_font_style }}"
  data-label-transform="{{ label_transform }}"
  data-tab-indicator="{{ tab_indicator }}"
>
  <div class="q-tac__wrap">
    {%- if show_header -%}
      <header class="q-tac__header">
        <h2 class="q-tac__heading">{{ heading }}</h2>
        <div class="q-tac__subheading rte">{{ subheading }}</div>
      </header>
    {%- endif -%}

    {%- comment -%} 1 block special-case {%- endcomment -%}
    {%- if count == 1 and is_tabs -%}
      {%- assign only_block = items[0] -%}
      <div class="q-tac__single rte">
        {{ only_block.settings.content }}
      </div>

    {%- else -%}

      {%- if should_render_dual -%}
        {%- comment -%} Tabs on desktop, Accordion on mobile {%- endcomment -%}

        <div
          class="q-tac__ui q-tac__ui--tabs"
          data-q-tac
          data-ui="tabs"
          data-orientation="horizontal"
          data-align="{{ tab_alignment }}"
          data-iconpos="{{ icon_position }}"
          data-update-hash="{{ section.settings.update_hash }}"
        >
          <div class="q-tac__tabs" role="tablist" aria-label="{{ heading | escape }}">
            {%- liquid assign used = '|' -%}
            {%- for block in items -%}
              {%- liquid
                assign base_anchor = block.settings.anchor_id | default: block.settings.label | handle
                if base_anchor == blank
                  assign base_anchor = 'item-' | append: forloop.index
                endif

                assign key = '|' | append: base_anchor | append: '|'
                assign final_anchor = base_anchor
                if used contains key
                  assign final_anchor = base_anchor | append: '-' | append: forloop.index
                endif
                assign used = used | append: final_anchor | append: '|'

                assign tab_id = ui_id | append: '-tab-' | append: forloop.index
                assign panel_id = ui_id | append: '-panel-' | append: forloop.index
              -%}

              <button
                class="q-tac__tab"
                type="button"
                role="tab"
                id="{{ tab_id }}"
                aria-controls="{{ panel_id }}"
                aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                tabindex="{% if forloop.first %}0{% else %}-1{% endif %}"
                data-q-tac-trigger
                data-index="{{ forloop.index0 }}"
                data-anchor="{{ anchor_ns | append: final_anchor }}"
              >
                {%- if icon_position == 'left' and block.settings.icon != blank -%}
                  <span class="q-tac__icon" aria-hidden="true">{{ block.settings.icon }}</span>
                {%- endif -%}
                <span class="q-tac__label">{{ block.settings.label }}</span>
              </button>
            {%- endfor -%}
          </div>

          <div class="q-tac__panels">
            {%- liquid assign used2 = '|' -%}
            {%- for block in items -%}
              {%- liquid
                assign base_anchor2 = block.settings.anchor_id | default: block.settings.label | handle
                if base_anchor2 == blank
                  assign base_anchor2 = 'item-' | append: forloop.index
                endif

                assign key2 = '|' | append: base_anchor2 | append: '|'
                assign final_anchor2 = base_anchor2
                if used2 contains key2
                  assign final_anchor2 = base_anchor2 | append: '-' | append: forloop.index
                endif
                assign used2 = used2 | append: final_anchor2 | append: '|'

                assign tab_id2 = ui_id | append: '-tab-' | append: forloop.index
                assign panel_id2 = ui_id | append: '-panel-' | append: forloop.index
              -%}

              <div
                class="q-tac__panel rte"
                role="tabpanel"
                id="{{ panel_id2 }}"
                aria-labelledby="{{ tab_id2 }}"
                {% unless forloop.first %}hidden{% endunless %}
                data-q-tac-panel
                data-index="{{ forloop.index0 }}"
                data-anchor="{{ anchor_ns | append: final_anchor2 }}"
              >
                {{ block.settings.content }}
              </div>
            {%- endfor -%}
          </div>
        </div>

        <div
          class="q-tac__ui q-tac__ui--accordion"
          data-q-tac
          data-ui="accordion"
          data-open="{{ accordion_default_open }}"
          data-single-open="{% if accordion_behavior == 'single_open_only' %}true{% else %}false{% endif %}"
          data-iconpos="{{ icon_position }}"
          data-update-hash="{{ section.settings.update_hash }}"
        >
          {%- liquid assign used3 = '|' -%}
          {%- for block in items -%}
            {%- liquid
              assign base_anchor3 = block.settings.anchor_id | default: block.settings.label | handle
              if base_anchor3 == blank
                assign base_anchor3 = 'item-' | append: forloop.index
              endif

              assign key3 = '|' | append: base_anchor3 | append: '|'
              assign final_anchor3 = base_anchor3
              if used3 contains key3
                assign final_anchor3 = base_anchor3 | append: '-' | append: forloop.index
              endif
              assign used3 = used3 | append: final_anchor3 | append: '|'

              assign btn_id = ui_id | append: '-acc-btn-' | append: forloop.index
              assign region_id = ui_id | append: '-acc-region-' | append: forloop.index

              assign is_open = false
              if accordion_default_open == 'first_open' and forloop.first
                assign is_open = true
              endif
            -%}

            <div class="q-tac__acc-item" data-q-tac-acc-item>
              <button
                class="q-tac__acc-btn"
                type="button"
                id="{{ btn_id }}"
                aria-controls="{{ region_id }}"
                aria-expanded="{% if is_open %}true{% else %}false{% endif %}"
                data-q-tac-acc-btn
                data-index="{{ forloop.index0 }}"
                data-anchor="{{ anchor_ns | append: final_anchor3 }}"
              >
                <span class="q-tac__acc-left">
                  {%- if icon_position == 'left' and block.settings.icon != blank -%}
                    <span class="q-tac__icon" aria-hidden="true">{{ block.settings.icon }}</span>
                  {%- endif -%}
                  <span class="q-tac__label">{{ block.settings.label }}</span>
                </span>
                <span class="q-tac__chev" aria-hidden="true">‚ñæ</span>
              </button>

              <div
                class="q-tac__acc-panel rte"
                id="{{ region_id }}"
                role="region"
                aria-labelledby="{{ btn_id }}"
                {% unless is_open %}hidden{% endunless %}
                data-q-tac-acc-panel
                data-index="{{ forloop.index0 }}"
                data-anchor="{{ anchor_ns | append: final_anchor3 }}"
              >
                {{ block.settings.content }}
              </div>
            </div>
          {%- endfor -%}
        </div>

      {%- else -%}

        {%- if layout_mode == 'accordion' or force_accordion_mobile -%}
          <div
            class="q-tac__ui q-tac__ui--accordion"
            data-q-tac
            data-ui="accordion"
            data-open="{{ accordion_default_open }}"
            data-single-open="{% if accordion_behavior == 'single_open_only' %}true{% else %}false{% endif %}"
            data-iconpos="{{ icon_position }}"
            data-update-hash="{{ section.settings.update_hash }}"
          >
            {%- liquid assign used4 = '|' -%}
            {%- for block in items -%}
              {%- liquid
                assign base_anchor4 = block.settings.anchor_id | default: block.settings.label | handle
                if base_anchor4 == blank
                  assign base_anchor4 = 'item-' | append: forloop.index
                endif

                assign key4 = '|' | append: base_anchor4 | append: '|'
                assign final_anchor4 = base_anchor4
                if used4 contains key4
                  assign final_anchor4 = base_anchor4 | append: '-' | append: forloop.index
                endif
                assign used4 = used4 | append: final_anchor4 | append: '|'

                assign btn_id4 = ui_id | append: '-acc-btn-' | append: forloop.index
                assign region_id4 = ui_id | append: '-acc-region-' | append: forloop.index

                assign is_open4 = false
                if accordion_default_open == 'first_open' and forloop.first
                  assign is_open4 = true
                endif
              -%}

              <div class="q-tac__acc-item" data-q-tac-acc-item>
                <button
                  class="q-tac__acc-btn"
                  type="button"
                  id="{{ btn_id4 }}"
                  aria-controls="{{ region_id4 }}"
                  aria-expanded="{% if is_open4 %}true{% else %}false{% endif %}"
                  data-q-tac-acc-btn
                  data-index="{{ forloop.index0 }}"
                  data-anchor="{{ anchor_ns | append: final_anchor4 }}"
                >
                  <span class="q-tac__acc-left">
                    {%- if icon_position == 'left' and block.settings.icon != blank -%}
                      <span class="q-tac__icon" aria-hidden="true">{{ block.settings.icon }}</span>
                    {%- endif -%}
                    <span class="q-tac__label">{{ block.settings.label }}</span>
                  </span>
                  <span class="q-tac__chev" aria-hidden="true">‚ñæ</span>
                </button>

                <div
                  class="q-tac__acc-panel rte"
                  id="{{ region_id4 }}"
                  role="region"
                  aria-labelledby="{{ btn_id4 }}"
                  {% unless is_open4 %}hidden{% endunless %}
                  data-q-tac-acc-panel
                  data-index="{{ forloop.index0 }}"
                  data-anchor="{{ anchor_ns | append: final_anchor4 }}"
                >
                  {{ block.settings.content }}
                </div>
              </div>
            {%- endfor -%}
          </div>

        {%- else -%}
          <div
            class="q-tac__ui q-tac__ui--tabs q-tac__ui--{{ layout_mode }}"
            data-q-tac
            data-ui="tabs"
            data-orientation="{% if is_tabs_vertical %}vertical{% else %}horizontal{% endif %}"
            data-align="{{ tab_alignment }}"
            data-iconpos="{{ icon_position }}"
            data-update-hash="{{ section.settings.update_hash }}"
          >
            <div class="q-tac__tabs" role="tablist" aria-label="{{ heading | escape }}">
              {%- liquid assign used5 = '|' -%}
              {%- for block in items -%}
                {%- liquid
                  assign base_anchor5 = block.settings.anchor_id | default: block.settings.label | handle
                  if base_anchor5 == blank
                    assign base_anchor5 = 'item-' | append: forloop.index
                  endif

                  assign key5 = '|' | append: base_anchor5 | append: '|'
                  assign final_anchor5 = base_anchor5
                  if used5 contains key5
                    assign final_anchor5 = base_anchor5 | append: '-' | append: forloop.index
                  endif
                  assign used5 = used5 | append: final_anchor5 | append: '|'

                  assign tab_id5 = ui_id | append: '-tab-' | append: forloop.index
                  assign panel_id5 = ui_id | append: '-panel-' | append: forloop.index
                -%}

                <button
                  class="q-tac__tab"
                  type="button"
                  role="tab"
                  id="{{ tab_id5 }}"
                  aria-controls="{{ panel_id5 }}"
                  aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                  tabindex="{% if forloop.first %}0{% else %}-1{% endif %}"
                  data-q-tac-trigger
                  data-index="{{ forloop.index0 }}"
                  data-anchor="{{ anchor_ns | append: final_anchor5 }}"
                >
                  {%- if icon_position == 'left' and block.settings.icon != blank -%}
                    <span class="q-tac__icon" aria-hidden="true">{{ block.settings.icon }}</span>
                  {%- endif -%}
                  <span class="q-tac__label">{{ block.settings.label }}</span>
                </button>
              {%- endfor -%}
            </div>

            <div class="q-tac__panels">
              {%- liquid assign used6 = '|' -%}
              {%- for block in items -%}
                {%- liquid
                  assign base_anchor6 = block.settings.anchor_id | default: block.settings.label | handle
                  if base_anchor6 == blank
                    assign base_anchor6 = 'item-' | append: forloop.index
                  endif

                  assign key6 = '|' | append: base_anchor6 | append: '|'
                  assign final_anchor6 = base_anchor6
                  if used6 contains key6
                    assign final_anchor6 = base_anchor6 | append: '-' | append: forloop.index
                  endif
                  assign used6 = used6 | append: final_anchor6 | append: '|'

                  assign tab_id6 = ui_id | append: '-tab-' | append: forloop.index
                  assign panel_id6 = ui_id | append: '-panel-' | append: forloop.index
                -%}

                <div
                  class="q-tac__panel rte"
                  role="tabpanel"
                  id="{{ panel_id6 }}"
                  aria-labelledby="{{ tab_id6 }}"
                  {% unless forloop.first %}hidden{% endunless %}
                  data-q-tac-panel
                  data-index="{{ forloop.index0 }}"
                  data-anchor="{{ anchor_ns | append: final_anchor6 }}"
                >
                  {{ block.settings.content }}
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- endif -%}

      {%- endif -%}

    {%- endif -%}
  </div>

  <style>
    .q-tac{
      background: var(--q-tac-bg);
      color: var(--q-tac-text);
      padding: var(--q-tac-pad-y) var(--q-tac-pad-x);
    }
    .q-tac__wrap{
      max-width: var(--q-tac-maxw);
      margin: 0 auto;
      display: grid;
      gap: var(--q-tac-gap);
    }
    .q-tac__header{ display:grid; gap:.5rem; }
    .q-tac__heading{
      margin: 0;
      font-size: var(--q-tac-heading-fs);
      font-weight: var(--q-tac-heading-fw);
    }
    .q-tac__subheading{
      color: var(--q-tac-muted);
      font-size: var(--q-tac-subheading-fs);
      line-height: var(--q-tac-subheading-lh);
    }

    /* label typography controls */
    .q-tac[data-label-font="body"] .q-tac__label { font-family: var(--font-body-family, inherit); }
    .q-tac[data-label-font="heading"] .q-tac__label { font-family: var(--font-heading-family, inherit); }
    .q-tac[data-label-font="inherit"] .q-tac__label { font-family: inherit; }

    .q-tac[data-label-style="italic"] .q-tac__label { font-style: italic; }
    .q-tac[data-label-style="normal"] .q-tac__label { font-style: normal; }

    .q-tac[data-label-transform="uppercase"] .q-tac__label { text-transform: uppercase; }
    .q-tac[data-label-transform="lowercase"] .q-tac__label { text-transform: lowercase; }
    .q-tac[data-label-transform="capitalize"] .q-tac__label { text-transform: capitalize; }
    .q-tac[data-label-transform="none"] .q-tac__label { text-transform: none; }

    /* Presets */
    .q-tac--preset-boxed .q-tac__ui{
      background: var(--q-tac-surface);
      border: 1px solid var(--q-tac-border);
      border-radius: var(--q-tac-radius);
      box-shadow: 0 10px 28px rgba(0,0,0, calc(var(--q-tac-shadow-strength) * 0.12));
      padding: clamp(12px, 2vw, 20px);
    }
    .q-tac--preset-minimal .q-tac__ui{
      background: transparent;
      border: 0;
      box-shadow: none;
      padding: 0;
    }
    .q-tac--preset-faq .q-tac__ui--accordion .q-tac__acc-item{
      border-bottom: 1px solid var(--q-tac-border);
    }

    /* Tabs */
    .q-tac__ui--tabs{ display:grid; gap: calc(var(--q-tac-gap) * 0.75); }
    .q-tac__tabs{
      display:flex;
      flex-wrap: wrap;
      gap: var(--q-tac-tab-gap);
      align-items: center;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: .25rem;
    }
    .q-tac__ui[data-align="center"] .q-tac__tabs{ justify-content:center; }
    .q-tac__ui[data-align="justify"] .q-tac__tabs{ justify-content:space-between; }

    .q-tac__ui--tabs.q-tac__ui--tabs_vertical{
      grid-template-columns: minmax(180px, 260px) 1fr;
      align-items: start;
    }
    .q-tac__ui--tabs.q-tac__ui--tabs_vertical .q-tac__tabs{
      flex-direction: column;
      align-items: stretch;
      overflow: visible;
      padding-bottom: 0;
    }

    .q-tac__tab{
      appearance:none;
      border: var(--q-tac-tab-border-w) solid var(--q-tac-tab-border);
      background: var(--q-tac-tab-bg);
      color: var(--q-tac-tab-fg);
      border-radius: var(--q-tac-tab-radius);
      padding: var(--q-tac-tab-pad-y) var(--q-tac-tab-pad-x);
      font-size: var(--q-tac-label-fs);
      font-weight: var(--q-tac-label-fw);
      letter-spacing: var(--q-tac-label-ls);
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      cursor:pointer;
      white-space: nowrap;
      position: relative;
      transition: transform .12s ease, opacity .12s ease, border-color .12s ease, background-color .12s ease;
    }
    .q-tac__tab:hover{ transform: translateY(-1px); }

    .q-tac__tab[aria-selected="true"]{
      background: var(--q-tac-tab-active-bg);
      color: var(--q-tac-tab-active-fg);
      border-color: var(--q-tac-tab-active-border);
      box-shadow: 0 10px 24px rgba(0,0,0,.10);
    }

    /* active indicator option */
    .q-tac[data-tab-indicator="underline"] .q-tac__tab[aria-selected="true"]::after{
      content:"";
      position:absolute;
      left: 14px;
      right: 14px;
      bottom: 8px;
      height: 2px;
      border-radius: 99px;
      background: currentColor;
      opacity: .9;
    }
    .q-tac[data-tab-indicator="none"] .q-tac__tab[aria-selected="true"]::after{ display:none; }

    .q-tac__tab:focus-visible{
      outline: 2px solid var(--q-tac-accent);
      outline-offset: 2px;
    }

    .q-tac__panel{
      font-size: var(--q-tac-body-fs);
      line-height: var(--q-tac-body-lh);
      min-width: 0;
    }

    /* Accordion */
    .q-tac__ui--accordion{ display:grid; gap: var(--q-tac-acc-gap); }

    .q-tac__acc-item{
      border-radius: var(--q-tac-acc-radius);
      overflow: hidden;
    }

    .q-tac__acc-btn{
      width: 100%;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: .75rem;
      text-align:left;
      appearance:none;
      border: var(--q-tac-acc-border-w) solid var(--q-tac-acc-border);
      background: var(--q-tac-acc-bg);
      color: var(--q-tac-acc-fg);
      padding: var(--q-tac-acc-pad-y) var(--q-tac-acc-pad-x);
      font-size: var(--q-tac-label-fs);
      font-weight: var(--q-tac-label-fw);
      letter-spacing: var(--q-tac-label-ls);
      cursor:pointer;
      transition: background-color .12s ease, border-color .12s ease, transform .12s ease;
    }
    .q-tac__acc-btn:hover{ transform: translateY(-1px); }

    .q-tac__acc-btn[aria-expanded="true"]{
      background: var(--q-tac-acc-active-bg);
      color: var(--q-tac-acc-active-fg);
      border-color: var(--q-tac-acc-active-border);
      box-shadow: 0 10px 24px rgba(0,0,0,.10);
    }

    .q-tac__acc-left{ display:inline-flex; align-items:center; gap:.5rem; }
    .q-tac__chev{
      opacity:.9;
      transform: rotate(0deg);
      transition: transform .2s ease;
    }
    .q-tac__acc-btn[aria-expanded="true"] .q-tac__chev{ transform: rotate(180deg); }

    .q-tac__acc-btn:focus-visible{
      outline: 2px solid var(--q-tac-accent);
      outline-offset: 3px;
    }

    .q-tac__acc-panel{
      padding: 0 var(--q-tac-acc-pad-x) calc(var(--q-tac-acc-pad-y) + 6px) var(--q-tac-acc-pad-x);
      font-size: var(--q-tac-body-fs);
      line-height: var(--q-tac-body-lh);
      background: var(--q-tac-bg);
      color: var(--q-tac-text);
    }
    .q-tac__acc-panel[data-animating]{ overflow:hidden; }

    @media (prefers-reduced-motion: reduce){
      .q-tac__tab, .q-tac__acc-btn, .q-tac__chev{ transition:none !important; }
    }

    /* Dual render (auto): tabs desktop, accordion mobile */
    @media (max-width: calc(var(--q-tac-bp) - 1px)){
      .q-tac__ui--tabs{ display:none; }
      .q-tac__ui--accordion{ display:grid; }
    }
    @media (min-width: var(--q-tac-bp)){
      .q-tac__ui--tabs{ display:grid; }
      .q-tac__ui--accordion{ display:none; }
    }

    /* No-JS fallback */
    html.no-js .q-tac__ui[data-ui="tabs"] .q-tac__tabs{ display:none; }
    html.no-js .q-tac__ui[data-ui="tabs"] .q-tac__panel[hidden]{ display:block !important; }

    html.no-js .q-tac__ui[data-ui="accordion"] .q-tac__acc-btn{ display:none; }
    html.no-js .q-tac__ui[data-ui="accordion"] .q-tac__acc-panel[hidden]{ display:block !important; }

    .q-tac__tab .q-tac__label { color: inherit !important; }
    .q-tac__acc-btn .q-tac__label { color: inherit !important; }

    .q-tac__subheading{
  color: var(--q-tac-subheading-color, var(--q-tac-muted));
}

.q-tac__subheading{
  color: var(--q-tac-subheading-color, var(--q-tac-muted));
  font-size: var(--q-tac-subheading-fs);
  line-height: var(--q-tac-subheading-lh);
}

/* IMPORTANT: beat theme .rte p { color: ... } */
.q-tac__subheading :is(p, a, strong, em, span, li, ul, ol, small){
  color: inherit;
}

  </style>

<script>
  (function () {
    try { document.documentElement.classList.remove('no-js'); } catch(e) {}

    function qsa(root, sel){ return Array.prototype.slice.call(root.querySelectorAll(sel)); }
    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

    function prefersReducedMotion(){
      return window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    }

    function setHash(anchor){
      if (!anchor) return;
      try {
        if (history && history.replaceState) history.replaceState(null, '', '#' + anchor);
        else location.hash = anchor;
      } catch(e) {}
    }

    function initTabs(root){
      var triggers = qsa(root, '[data-q-tac-trigger]');
      var panels = qsa(root, '[data-q-tac-panel]');
      if (!triggers.length || !panels.length) return;

      var orientation = root.getAttribute('data-orientation') || 'horizontal';
      var updateHash = (root.getAttribute('data-update-hash') === 'true');

      function activate(index, focus){
        index = clamp(index, 0, triggers.length - 1);

        triggers.forEach(function(btn, i){
          var selected = (i === index);
          btn.setAttribute('aria-selected', selected ? 'true' : 'false');
          btn.tabIndex = selected ? 0 : -1;
          if (selected && focus) btn.focus({preventScroll:true});
        });

        panels.forEach(function(panel, i){
          if (i === index) panel.removeAttribute('hidden');
          else panel.setAttribute('hidden','');
        });

        var anchor = triggers[index].getAttribute('data-anchor');
        if (updateHash && anchor) setHash(anchor);
      }

      triggers.forEach(function(btn, idx){
        btn.addEventListener('click', function(){ activate(idx, false); });

        btn.addEventListener('keydown', function(e){
          var key = e.key;
          var isHoriz = (orientation !== 'vertical');
          var prevKey = isHoriz ? 'ArrowLeft' : 'ArrowUp';
          var nextKey = isHoriz ? 'ArrowRight' : 'ArrowDown';

          if (key === prevKey || key === nextKey || key === 'Home' || key === 'End'){
            e.preventDefault();
            var next = idx;
            if (key === prevKey) next = idx - 1;
            if (key === nextKey) next = idx + 1;
            if (key === 'Home') next = 0;
            if (key === 'End') next = triggers.length - 1;
            activate(next, true);
            return;
          }

          if (key === 'Enter' || key === ' '){
            e.preventDefault();
            activate(idx, false);
          }
        });
      });

      var hash = (location.hash || '').replace('#','');
      if (hash){
        var match = -1;
        triggers.forEach(function(btn, i){
          if (btn.getAttribute('data-anchor') === hash) match = i;
        });
        if (match >= 0) activate(match, false);
        else activate(0, false);
      } else {
        activate(0, false);
      }

      window.addEventListener('hashchange', function(){
        var h = (location.hash || '').replace('#','');
        if (!h) return;
        var m = -1;
        triggers.forEach(function(btn, i){
          if (btn.getAttribute('data-anchor') === h) m = i;
        });
        if (m >= 0) activate(m, false);
      });
    }

    function animateAccordion(panel, open){
      if (prefersReducedMotion()) {
        if (open) panel.removeAttribute('hidden');
        else panel.setAttribute('hidden','');
        return;
      }

      panel.setAttribute('data-animating','true');
      panel.style.overflow = 'hidden';
      panel.style.willChange = 'max-height';

      if (open){
        panel.removeAttribute('hidden');
        panel.style.maxHeight = '0px';
        requestAnimationFrame(function(){
          panel.style.maxHeight = panel.scrollHeight + 'px';
          setTimeout(function(){
            panel.style.maxHeight = '';
            panel.style.overflow = '';
            panel.style.willChange = '';
            panel.removeAttribute('data-animating');
          }, 220);
        });
      } else {
        panel.style.maxHeight = panel.getBoundingClientRect().height + 'px';
        requestAnimationFrame(function(){
          panel.style.maxHeight = '0px';
          setTimeout(function(){
            panel.setAttribute('hidden','');
            panel.style.maxHeight = '';
            panel.style.overflow = '';
            panel.style.willChange = '';
            panel.removeAttribute('data-animating');
          }, 220);
        });
      }
    }

    function initAccordion(root){
      var buttons = qsa(root, '[data-q-tac-acc-btn]');
      var panels = qsa(root, '[data-q-tac-acc-panel]');
      if (!buttons.length || !panels.length) return;

      var defaultOpen = root.getAttribute('data-open') || 'first_open';
      var singleOpen = (root.getAttribute('data-single-open') === 'true');
      var updateHash = (root.getAttribute('data-update-hash') === 'true');

      function closeAllExcept(index){
        buttons.forEach(function(btn, i){
          if (i === index) return;
          if (btn.getAttribute('aria-expanded') === 'true'){
            btn.setAttribute('aria-expanded','false');
            animateAccordion(panels[i], false);
          } else {
            panels[i].setAttribute('hidden','');
          }
        });
      }

      function setOpen(index, open, userAction){
        index = clamp(index, 0, buttons.length - 1);
        if (singleOpen && open) closeAllExcept(index);

        buttons[index].setAttribute('aria-expanded', open ? 'true' : 'false');
        animateAccordion(panels[index], open);

        if (open && updateHash && userAction){
          var anchor = buttons[index].getAttribute('data-anchor');
          if (anchor) setHash(anchor);
        }
      }

      buttons.forEach(function(btn, idx){
        btn.addEventListener('click', function(){
          var isOpen = (btn.getAttribute('aria-expanded') === 'true');
          setOpen(idx, !isOpen, true);
        });

        btn.addEventListener('keydown', function(e){
          if (e.key === 'Enter' || e.key === ' '){
            e.preventDefault();
            btn.click();
          }
        });
      });

      function closeAll(){
        buttons.forEach(function(btn, i){
          btn.setAttribute('aria-expanded','false');
          panels[i].setAttribute('hidden','');
        });
      }

      var hash = (location.hash || '').replace('#','');
      closeAll();

      if (hash){
        var match = -1;
        buttons.forEach(function(btn, i){
          if (btn.getAttribute('data-anchor') === hash) match = i;
        });
        if (match >= 0) setOpen(match, true, false);
        else if (defaultOpen === 'first_open') setOpen(0, true, false);
      } else {
        if (defaultOpen !== 'all_closed') setOpen(0, true, false);
      }

      window.addEventListener('hashchange', function(){
        var h = (location.hash || '').replace('#','');
        if (!h) return;
        var m = -1;
        buttons.forEach(function(btn, i){
          if (btn.getAttribute('data-anchor') === h) m = i;
        });
        if (m >= 0) setOpen(m, true, false);
      });
    }

    // ‚úÖ Proper ‚Äúonly-init-once‚Äù that doesn‚Äôt brick the UI
    var inited = window.__Q_TAC_INITED;
    if (!inited) {
      inited = new WeakSet();
      window.__Q_TAC_INITED = inited;
    }

    function initAll(scope){
      var root = scope || document;
      qsa(root, '[data-q-tac]').forEach(function(el){
        if (inited.has(el)) return;
        inited.add(el);

        var ui = el.getAttribute('data-ui');
        if (ui === 'tabs') initTabs(el);
        if (ui === 'accordion') initAccordion(el);
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function(){ initAll(document); });
    } else {
      initAll(document);
    }

    // ‚úÖ Shopify Theme Editor: re-init when section reloads
    document.addEventListener('shopify:section:load', function(e){
      initAll(e.target);
    });
  })();
</script>

</section>
{%- endif -%}

{% schema %}
{
  "name": "Content - Tab/Accordion",
  "settings": [
    { "type": "header", "content": "Header" },
    { "type": "checkbox", "id": "show_header", "label": "Show header", "default": true },
    { "type": "text", "id": "heading", "label": "Heading", "default": "FAQs & details" },
    { "type": "richtext", "id": "subheading", "label": "Subheading", "default": "<p>Organize policies, specs, and answers into a clean interactive UI.</p>" },

    { "type": "header", "content": "Layout & behavior" },
    {
      "type": "select",
      "id": "layout_mode",
      "label": "Layout mode",
      "default": "tabs_horizontal",
      "options": [
        { "value": "tabs_horizontal", "label": "Tabs (horizontal)" },
        { "value": "tabs_vertical", "label": "Tabs (vertical)" },
        { "value": "accordion", "label": "Accordion" }
      ]
    },
    {
      "type": "select",
      "id": "style_preset",
      "label": "Style preset",
      "default": "default",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "faq", "label": "FAQ" },
        { "value": "minimal", "label": "Minimal" },
        { "value": "boxed", "label": "Boxed" }
      ]
    },
    {
      "type": "select",
      "id": "tab_alignment",
      "label": "Tab alignment (horizontal tabs)",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "justify", "label": "Justify" }
      ]
    },
    {
      "type": "select",
      "id": "icon_position",
      "label": "Icon position",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "none", "label": "None" }
      ]
    },
    {
      "type": "select",
      "id": "accordion_default_open",
      "label": "Accordion default open",
      "default": "first_open",
      "options": [
        { "value": "first_open", "label": "First open" },
        { "value": "all_closed", "label": "All closed" }
      ]
    },
    {
      "type": "select",
      "id": "accordion_behavior",
      "label": "Accordion behavior",
      "default": "multi_open",
      "options": [
        { "value": "multi_open", "label": "Allow multiple open" },
        { "value": "single_open_only", "label": "Single open only" }
      ]
    },
    {
      "type": "select",
      "id": "mobile_mode",
      "label": "Mobile behavior",
      "default": "auto",
      "options": [
        { "value": "auto", "label": "Auto (horizontal tabs ‚Üí accordion on mobile)" },
        { "value": "keep_tabs", "label": "Keep tabs" },
        { "value": "force_accordion", "label": "Force accordion" }
      ]
    },
    { "type": "number", "id": "mobile_breakpoint", "label": "Mobile breakpoint (px)", "default": 768 },
    { "type": "checkbox", "id": "update_hash", "label": "Update URL hash on activate (section-id + anchor_id)", "default": true },

    { "type": "header", "content": "Layout sizing" },
    { "type": "range", "id": "max_width", "label": "Max width (px)", "min": 720, "max": 1440, "step": 24, "default": 1152 },
    { "type": "range", "id": "pad_y", "label": "Padding Y (px)", "min": 0, "max": 120, "step": 4, "default": 48 },
    { "type": "range", "id": "pad_x", "label": "Padding X (px)", "min": 0, "max": 80, "step": 4, "default": 24 },
    { "type": "range", "id": "gap", "label": "Gap (px)", "min": 8, "max": 48, "step": 2, "default": 16 },

    { "type": "header", "content": "Typography" },
    { "type": "range", "id": "heading_fs", "label": "Heading size (px)", "min": 18, "max": 56, "step": 1, "default": 32 },
    { "type": "range", "id": "heading_fw", "label": "Heading weight", "min": 300, "max": 900, "step": 100, "default": 700 },

    { "type": "range", "id": "subheading_fs", "label": "Subheading size (px)", "min": 12, "max": 22, "step": 1, "default": 16 },
    { "type": "range", "id": "subheading_lh_x100", "label": "Subheading line-height (√ó100)", "min": 120, "max": 220, "step": 5, "default": 160 },

    { "type": "range", "id": "label_fs", "label": "Label size (px)", "min": 12, "max": 26, "step": 1, "default": 15 },
    { "type": "range", "id": "label_fw", "label": "Label weight", "min": 300, "max": 900, "step": 100, "default": 600 },
    { "type": "range", "id": "label_ls_x1000", "label": "Label letter-spacing (em √ó1000)", "min": -20, "max": 80, "step": 5, "default": 0 },
    {
      "type": "select",
      "id": "label_font_mode",
      "label": "Label font family",
      "default": "inherit",
      "options": [
        { "value": "inherit", "label": "Inherit" },
        { "value": "body", "label": "Body font" },
        { "value": "heading", "label": "Heading font" }
      ]
    },
    {
      "type": "select",
      "id": "label_font_style",
      "label": "Label font style",
      "default": "normal",
      "options": [
        { "value": "normal", "label": "Normal" },
        { "value": "italic", "label": "Italic" }
      ]
    },
    {
      "type": "select",
      "id": "label_transform",
      "label": "Label text transform",
      "default": "none",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "uppercase", "label": "Uppercase" },
        { "value": "lowercase", "label": "Lowercase" },
        { "value": "capitalize", "label": "Capitalize" }
      ]
    },

    { "type": "range", "id": "body_fs", "label": "Body size (px)", "min": 12, "max": 22, "step": 1, "default": 16 },
    { "type": "range", "id": "body_lh_x100", "label": "Body line-height (√ó100)", "min": 120, "max": 220, "step": 5, "default": 170 },

    { "type": "header", "content": "Surface style" },
    { "type": "range", "id": "radius", "label": "Outer radius (px)", "min": 0, "max": 32, "step": 1, "default": 16 },
    { "type": "range", "id": "shadow_strength_x100", "label": "Shadow strength (√ó100)", "min": 0, "max": 100, "step": 5, "default": 40 },

    { "type": "header", "content": "Tabs ‚Äî pill styling" },
    { "type": "range", "id": "tab_radius", "label": "Tab radius (px)", "min": 0, "max": 40, "step": 1, "default": 14 },
    { "type": "range", "id": "tab_pad_y", "label": "Tab padding Y (px)", "min": 6, "max": 22, "step": 1, "default": 10 },
    { "type": "range", "id": "tab_pad_x", "label": "Tab padding X (px)", "min": 10, "max": 34, "step": 1, "default": 14 },
    { "type": "range", "id": "tab_gap", "label": "Tab gap (px)", "min": 4, "max": 20, "step": 1, "default": 8 },
    { "type": "range", "id": "tab_border_w", "label": "Tab border width (px)", "min": 0, "max": 4, "step": 1, "default": 1 },
    {
      "type": "select",
      "id": "tab_active_indicator",
      "label": "Active tab indicator",
      "default": "none",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "underline", "label": "Underline" }
      ]
    },

    { "type": "header", "content": "Accordion ‚Äî header styling" },
    { "type": "range", "id": "acc_radius", "label": "Accordion item radius (px)", "min": 0, "max": 40, "step": 1, "default": 14 },
    { "type": "range", "id": "acc_pad_y", "label": "Accordion header padding Y (px)", "min": 10, "max": 28, "step": 1, "default": 14 },
    { "type": "range", "id": "acc_pad_x", "label": "Accordion header padding X (px)", "min": 10, "max": 34, "step": 1, "default": 14 },
    { "type": "range", "id": "acc_gap", "label": "Accordion item gap (px)", "min": 4, "max": 20, "step": 1, "default": 10 },
    { "type": "range", "id": "acc_border_w", "label": "Accordion border width (px)", "min": 0, "max": 4, "step": 1, "default": 1 },

    { "type": "header", "content": "Base colors" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors", "default": false },
    { "type": "color", "id": "bg", "label": "Background", "default": "#ffffff" },
    { "type": "color", "id": "text", "label": "Text", "default": "#111111" },
    { "type": "color", "id": "muted", "label": "Muted text", "default": "#6b7280" },
    { "type": "color", "id": "accent", "label": "Accent", "default": "#2563eb" },
    { "type": "color", "id": "surface", "label": "Surface", "default": "#f6f7f8" },
    { "type": "color", "id": "border", "label": "Border", "default": "#e5e7eb" },

    { "type": "header", "content": "Tabs ‚Äî colors" },
    { "type": "color", "id": "tab_bg", "label": "Tab background", "default": "#f6f7f8" },
    { "type": "color", "id": "tab_text", "label": "Tab text", "default": "#111111" },
    { "type": "color", "id": "tab_border", "label": "Tab border", "default": "#e5e7eb" },
    { "type": "color", "id": "tab_active_bg", "label": "Active tab background", "default": "#2563eb" },
    { "type": "color", "id": "tab_active_text", "label": "Active tab text", "default": "#ffffff" },
    { "type": "color", "id": "tab_active_border", "label": "Active tab border", "default": "#2563eb" },

    { "type": "header", "content": "Accordion ‚Äî colors" },
    { "type": "color", "id": "acc_bg", "label": "Accordion header background", "default": "#f6f7f8" },
    { "type": "color", "id": "acc_text", "label": "Accordion header text", "default": "#111111" },
    { "type": "color", "id": "acc_border", "label": "Accordion header border", "default": "#e5e7eb" },
    { "type": "color", "id": "acc_active_bg", "label": "Active accordion background", "default": "#2563eb" },
    { "type": "color", "id": "acc_active_text", "label": "Active accordion text", "default": "#ffffff" },
    { "type": "color", "id": "acc_active_border", "label": "Active accordion border", "default": "#2563eb" }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Item",
      "settings": [
        { "type": "text", "id": "label", "label": "Label", "default": "Shipping" },
        { "type": "text", "id": "icon", "label": "Icon (emoji or short text)", "default": "üöö" },
        { "type": "text", "id": "anchor_id", "label": "Anchor ID (optional)", "default": "shipping" },
        { "type": "richtext", "id": "content", "label": "Content", "default": "<p>Add your content here. This supports links, lists, and basic formatting.</p>" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Interactive Content Helper - Tabs/Accordion",
      "category": "Content Helpers",
      "settings": {
        "layout_mode": "tabs_horizontal",
        "style_preset": "boxed",
        "mobile_mode": "auto",
        "use_custom_colors": true,
        "tab_bg": "#ff3ea5",
        "tab_text": "#ffffff",
        "tab_active_bg": "#111827",
        "tab_active_text": "#ffffff",
        "tab_border": "#ff3ea5",
        "tab_active_border": "#111827",
        "acc_bg": "#ff3ea5",
        "acc_text": "#ffffff",
        "acc_active_bg": "#111827",
        "acc_active_text": "#ffffff",
        "acc_border": "#ff3ea5",
        "acc_active_border": "#111827",
        "label_font_style": "italic",
        "label_font_mode": "heading"
      },
      "blocks": [
        { "type": "item", "settings": { "label": "Shipping", "icon": "üöö", "anchor_id": "shipping", "content": "<p>Typical shipping times and options.</p>" } },
        { "type": "item", "settings": { "label": "Returns", "icon": "‚Ü©Ô∏è", "anchor_id": "returns", "content": "<p>Return windows, condition requirements, and process.</p>" } },
        { "type": "item", "settings": { "label": "Warranty", "icon": "üõ°Ô∏è", "anchor_id": "warranty", "content": "<p>Coverage details and how to submit a claim.</p>" } }
      ]
    }
  ]
}
{% endschema %}
