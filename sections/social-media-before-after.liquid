{%- comment -%}
  Section: Social media · Before & after
  File: sections/social-media-before-after.liquid

  Notes:
  - Manual items only (no API).
  - After embed supports either:
    (1) full HTML embed code (paste into textarea), OR
    (2) a plain URL (theme will wrap it in an iframe).
  - Schema tag is NOT nested (kept at file root to avoid CLI error).
{%- endcomment -%}

{%- assign s = section.settings -%}

{%- if s.enable_section -%}
  {%- assign section_id = 'social-media-before-after-' | append: section.id -%}
  {%- assign ratio_class = 'q-before-after__media--' | append: s.media_ratio | replace: ':', '-' -%}
  {%- assign layout_class = 'q-before-after--' | append: s.layout -%}
  {%- assign card_style_class = 'q-before-after__card--' | append: s.card_style -%}
  {%- assign align_class = 'q-text-' | append: s.align -%}

  <section
    id="{{ section_id }}"
    class="q-section q-social-before-after {{ layout_class }}"
    aria-label="{{ s.aria_label | escape }}"
  >
    <div class="q-section__inner">
      {%- comment -%} Heading area (self-contained; avoids external snippet dependency) {%- endcomment -%}
      <div class="q-section-header q-stack q-stack--gap-sm {{ align_class }}">
        {%- if s.kicker != blank -%}
          <p class="q-section-header__kicker">{{ s.kicker | escape }}</p>
        {%- endif -%}
        {%- if s.heading != blank -%}
          <h2 class="q-section-header__heading">{{ s.heading | escape }}</h2>
        {%- endif -%}
        {%- if s.body != blank -%}
          <div class="q-section-header__body rte">{{ s.body }}</div>
        {%- endif -%}
      </div>

      {%- assign data_mode = s.data_source_mode | default: 'manual' -%}

      {%- if data_mode == 'manual' -%}
        {%- if section.blocks.size > 0 -%}
          <div class="q-before-after__list" style="--q-before-after-gap: {{ s.card_gap }}px;">
            {%- for block in section.blocks -%}
              {%- assign b = block.settings -%}

              {%- assign title = b.title | strip -%}
              {%- assign description = b.description | strip -%}

              {%- assign before_label = b.before_label | strip -%}
              {%- if before_label == blank -%}
                {%- assign before_label = s.before_label_default | strip -%}
              {%- endif -%}

              {%- assign after_label = b.after_label | strip -%}
              {%- if after_label == blank -%}
                {%- assign after_label = s.after_label_default | strip -%}
              {%- endif -%}

              {%- assign after_embed = b.after_embed_html | strip -%}

              {%- assign platform_label = 'TikTok' -%}
              {%- case b.after_platform -%}
                {%- when 'instagram_reel' -%}{%- assign platform_label = 'Reels' -%}
                {%- when 'youtube_short' -%}{%- assign platform_label = 'Shorts' -%}
                {%- when 'other' -%}{%- assign platform_label = 'Video' -%}
                {%- else -%}{%- assign platform_label = 'TikTok' -%}
              {%- endcase -%}

              {%- assign cta_label = b.cta_label | strip -%}
              {%- assign cta_url = b.cta_url -%}
              {%- assign show_cta = false -%}
              {%- if cta_label != blank and cta_url != blank and cta_url != '#' -%}
                {%- assign show_cta = true -%}
              {%- endif -%}

              {%- assign before_alt = b.before_alt_text | strip -%}
              {%- if before_alt == blank -%}
                {%- if title != blank -%}
                  {%- assign before_alt = title -%}
                {%- else -%}
                  {%- assign before_alt = 'Before result' -%}
                {%- endif -%}
              {%- endif -%}

              <article
                class="q-before-after__card {{ card_style_class }}"
                {{ block.shopify_attributes }}
              >
                {%- if title != blank -%}
                  <h3 class="q-before-after__title">{{ title | escape }}</h3>
                {%- endif -%}

                <div class="q-before-after__media-grid">
                  {%- comment -%} BEFORE {%- endcomment -%}
                  <div class="q-before-after__media-col">
                    <div class="q-before-after__media {{ ratio_class }}">
                      {%- if s.show_before_after_labels and before_label != blank -%}
                        <span class="q-before-after__tag" aria-hidden="true">{{ before_label | escape }}</span>
                      {%- endif -%}

                      {%- if b.before_media_type == 'video' and b.before_video != blank -%}
                        <div class="q-before-after__media-inner">
                          {{ b.before_video | video_tag: class: 'q-before-after__video-el', controls: true, preload: 'metadata', playsinline: true }}
                        </div>
                      {%- else -%}
                        <div class="q-before-after__media-inner">
                          {%- if b.before_image != blank -%}
                            {{ b.before_image
                              | image_url: width: 1600
                              | image_tag:
                                  widths: '360,540,720,900,1080,1320,1600',
                                  loading: 'lazy',
                                  class: 'q-before-after__img',
                                  alt: before_alt
                            }}
                          {%- else -%}
                            {%- if request.design_mode -%}
                              <div class="q-before-after__placeholder">
                                {{ 'image' | placeholder_svg_tag: 'q-before-after__placeholder-svg' }}
                              </div>
                            {%- endif -%}
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                    </div>
                  </div>

                  {%- comment -%} AFTER {%- endcomment -%}
                  <div class="q-before-after__media-col">
                    <div class="q-before-after__media {{ ratio_class }}">
                      {%- if s.show_before_after_labels and after_label != blank -%}
                        <span class="q-before-after__tag" aria-hidden="true">{{ after_label | escape }}</span>
                      {%- endif -%}

                      {%- if s.show_platform_badge and platform_label != blank -%}
                        <span class="q-before-after__badge" aria-hidden="true">{{ platform_label | escape }}</span>
                      {%- endif -%}

                      <div class="q-before-after__media-inner q-before-after__embed" role="group" aria-label="{{ b.after_aria_label | escape }}">
                        {%- if after_embed != blank -%}
                          {%- if after_embed contains '<' -%}
                            {{ b.after_embed_html }}
                          {%- else -%}
                            <iframe
                              class="q-before-after__iframe"
                              src="{{ after_embed | escape }}"
                              title="{{ b.after_aria_label | escape }}"
                              loading="lazy"
                              allowfullscreen
                              referrerpolicy="strict-origin-when-cross-origin"
                            ></iframe>
                          {%- endif -%}
                        {%- else -%}
                          {%- if request.design_mode -%}
                            <div class="q-before-after__empty">
                              <p>Add an embed HTML snippet or a URL for the “After” media.</p>
                            </div>
                          {%- endif -%}
                        {%- endif -%}
                      </div>
                    </div>
                  </div>
                </div>

                {%- if description != blank -%}
                  <div class="q-before-after__desc rte">{{ b.description }}</div>
                {%- endif -%}

                {%- if show_cta -%}
                  <div class="q-before-after__cta">
                    <a
                      class="q-button q-button--solid"
                      href="{{ cta_url }}"
                      {%- if s.open_cta_in_new_tab -%} target="_blank" rel="noopener noreferrer"{%- endif -%}
                    >
                      {{ cta_label | escape }}
                    </a>
                  </div>
                {%- endif -%}
              </article>
            {%- endfor -%}
          </div>
        {%- endif -%}
      {%- else -%}
        {%- if request.design_mode -%}
          <div class="q-before-after__placeholder-feed">
            <p><strong>Feed mode is enabled.</strong> Connect this section to a Quadratum Link feed: <code>{{ s.feed_handle | escape }}</code></p>
          </div>
        {%- endif -%}
      {%- endif -%}
    </div>
  </section>

  <style>
    #{{ section_id }} .q-before-after__list {
      display: grid;
      gap: 16px;
    }

    #{{ section_id }} .q-before-after__card {
      padding: 16px;
      border-radius: 16px;
    }

    #{{ section_id }} .q-before-after__card--surface {
      background: var(--q-bg-contrast, rgba(0,0,0,0.03));
      border: 1px solid rgba(0,0,0,0.06);
    }

    #{{ section_id }} .q-before-after__card--bordered {
      background: transparent;
      border: 1px solid rgba(0,0,0,0.12);
    }

    #{{ section_id }} .q-before-after__card--minimal {
      background: transparent;
      border: 0;
      padding: 0;
    }

    #{{ section_id }} .q-before-after__title {
      margin: 0 0 12px;
      font-size: 1.1em;
      line-height: 1.2;
    }

    #{{ section_id }} .q-before-after__media-grid {
      display: grid;
      gap: var(--q-before-after-gap, 16px);
      align-items: start;
    }

    #{{ section_id }}.q-before-after--split .q-before-after__media-grid {
      grid-template-columns: 1fr;
    }

    #{{ section_id }}.q-before-after--stacked .q-before-after__media-grid {
      grid-template-columns: 1fr;
    }

    @media (min-width: 768px) {
      #{{ section_id }}.q-before-after--split .q-before-after__media-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    #{{ section_id }} .q-before-after__media {
      position: relative;
      overflow: hidden;
      border-radius: 14px;
      background: rgba(0,0,0,0.04);
    }

    #{{ section_id }} .q-before-after__media--1-1 { aspect-ratio: 1 / 1; }
    #{{ section_id }} .q-before-after__media--4-5 { aspect-ratio: 4 / 5; }
    #{{ section_id }} .q-before-after__media--9-16 { aspect-ratio: 9 / 16; }
    #{{ section_id }} .q-before-after__media--16-9 { aspect-ratio: 16 / 9; }

    #{{ section_id }} .q-before-after__media-inner {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    #{{ section_id }} .q-before-after__img,
    #{{ section_id }} .q-before-after__video-el,
    #{{ section_id }} .q-before-after__iframe {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
      border: 0;
    }

    #{{ section_id }} .q-before-after__tag,
    #{{ section_id }} .q-before-after__badge {
      position: absolute;
      top: 10px;
      z-index: 2;
      font-size: 12px;
      line-height: 1;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.70);
      color: #fff;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    #{{ section_id }} .q-before-after__tag { left: 10px; }
    #{{ section_id }} .q-before-after__badge { right: 10px; }

    #{{ section_id }} .q-before-after__desc {
      margin-top: 12px;
    }

    #{{ section_id }} .q-before-after__cta {
      margin-top: 12px;
    }

    #{{ section_id }} .q-before-after__empty,
    #{{ section_id }} .q-before-after__placeholder-feed {
      padding: 12px;
      border-radius: 12px;
      background: rgba(0,0,0,0.03);
      border: 1px dashed rgba(0,0,0,0.2);
    }

    #{{ section_id }} .q-before-after__placeholder-svg {
      width: 100%;
      height: 100%;
    }
/* Keep columns normal so text/CTA don't get awkwardly centered */
.q-social-before-after .q-before-after__col {
  display: flex;
  flex-direction: column;
}

/* Center ONLY the media wrapper (before + after) */
.q-social-before-after .q-before-after__video,
.q-social-before-after .q-before-after__embed,
.q-social-before-after .q-before-after__media {
  width: 100%;
  max-inline-size: var(--q-ba-media-max, 360px);
  margin-inline: auto; /* ✅ centers the card */
}

/* If your embed/video wrapper contains an inner ratio box, center that too */
.q-social-before-after .q-before-after__video > *,
.q-social-before-after .q-before-after__embed > *,
.q-social-before-after .q-before-after__media > * {
  width: 100%;
}

/* Ensure the iframe fills the ratio box and doesn’t “float” weird */
.q-social-before-after iframe {
  width: 100%;
  height: 100%;
  display: block;
  border: 0;
}

    
  </style>
{%- endif -%}

{% schema %}
{
  "name": "Social Media - Results",
  "tag": "section",
  "class": "q-section q-social-before-after",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_section",
      "label": "Enable section",
      "default": true
    },
    {
      "type": "text",
      "id": "kicker",
      "label": "Kicker",
      "default": "Real results"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "TikTok before & after showcases"
    },
    {
      "type": "textarea",
      "id": "body",
      "label": "Body text",
      "default": "Showcase real transformations with side-by-side before media and embedded TikTok or Reels content."
    },
    {
      "type": "select",
      "id": "align",
      "label": "Text alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "default": "split",
      "options": [
        { "value": "split", "label": "Before/after side by side" },
        { "value": "stacked", "label": "Before on top, after below" }
      ]
    },
    {
      "type": "range",
      "id": "card_gap",
      "label": "Gap between before & after (px)",
      "min": 0,
      "max": 48,
      "step": 2,
      "default": 16
    },
    {
      "type": "select",
      "id": "card_style",
      "label": "Card style",
      "default": "surface",
      "options": [
        { "value": "surface", "label": "Soft surface" },
        { "value": "bordered", "label": "Bordered card" },
        { "value": "minimal", "label": "Minimal, no background" }
      ]
    },
    {
      "type": "select",
      "id": "media_ratio",
      "label": "Media aspect ratio",
      "default": "9:16",
      "options": [
        { "value": "1:1", "label": "Square (1:1)" },
        { "value": "4:5", "label": "Portrait (4:5)" },
        { "value": "9:16", "label": "Vertical (9:16, TikTok style)" },
        { "value": "16:9", "label": "Landscape (16:9)" }
      ]
    },
    {
      "type": "header",
      "content": "Labels & CTA"
    },
    {
      "type": "checkbox",
      "id": "show_before_after_labels",
      "label": "Show Before / After labels on cards",
      "default": true
    },
    {
      "type": "text",
      "id": "before_label_default",
      "label": "Default Before label",
      "default": "Before"
    },
    {
      "type": "text",
      "id": "after_label_default",
      "label": "Default After label",
      "default": "After"
    },
    {
      "type": "checkbox",
      "id": "show_platform_badge",
      "label": "Show platform badge (TikTok / Reels / Shorts)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "open_cta_in_new_tab",
      "label": "Open CTA links in new tab",
      "default": false
    },
    {
      "type": "header",
      "content": "Data source (Quadratum Link ready)"
    },
    {
      "type": "select",
      "id": "data_source_mode",
      "label": "Data source",
      "default": "manual",
      "options": [
        { "value": "manual", "label": "Manual items (theme editor)" },
        { "value": "feed", "label": "Feed (Quadratum Link, future)" }
      ]
    },
    {
      "type": "text",
      "id": "feed_handle",
      "label": "Feed handle (for Quadratum Link)",
      "default": "before_after_default"
    },
    {
      "type": "text",
      "id": "aria_label",
      "label": "ARIA label for section",
      "default": "Before and after showcase"
    }
  ],
  "blocks": [
    {
      "type": "before_after_item",
      "name": "Before & after item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "8-week transformation"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
        },
        {
          "type": "header",
          "content": "Before media"
        },
        {
          "type": "select",
          "id": "before_media_type",
          "label": "Before media type",
          "default": "image",
          "options": [
            { "value": "image", "label": "Image" },
            { "value": "video", "label": "Uploaded video" }
          ]
        },
        {
          "type": "image_picker",
          "id": "before_image",
          "label": "Before image"
        },
        {
          "type": "text",
          "id": "before_alt_text",
          "label": "Before image alt text",
          "default": "Before result"
        },
        {
          "type": "video",
          "id": "before_video",
          "label": "Before video (optional)"
        },
        {
          "type": "text",
          "id": "before_label",
          "label": "Override Before label",
        },
        {
          "type": "header",
          "content": "After embed"
        },
        {
          "type": "select",
          "id": "after_platform",
          "label": "Platform",
          "default": "tiktok",
          "options": [
            { "value": "tiktok", "label": "TikTok" },
            { "value": "instagram_reel", "label": "Instagram Reel" },
            { "value": "youtube_short", "label": "YouTube Short" },
            { "value": "other", "label": "Other embed" }
          ]
        },
        {
          "type": "textarea",
          "id": "after_embed_html",
          "label": "After embed HTML (or URL)",
        },
        {
          "type": "text",
          "id": "after_label",
          "label": "Override After label",
        },
        {
          "type": "text",
          "id": "after_aria_label",
          "label": "ARIA label for embedded video",
          "default": "After result video"
        },
        {
          "type": "header",
          "content": "CTA"
        },
        {
          "type": "text",
          "id": "cta_label",
          "label": "CTA label",
        },
        {
          "type": "url",
          "id": "cta_url",
          "label": "CTA URL",
        }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Social Media - Before & After",
      "category": "Social Media",
      "blocks": [
        { "type": "before_after_item" },
        { "type": "before_after_item" },
        { "type": "before_after_item" }
      ]
    }
  ]
}
{% endschema %}
