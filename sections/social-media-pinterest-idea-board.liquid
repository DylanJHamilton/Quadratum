{%- comment -%}
  sections/social-media-micro-post-strip.liquid
  Quadratum ‚Äî Social media ¬∑ Micro-post highlight strip (X / Bluesky) (manual, Link-ready hooks)
{%- endcomment -%}

{%- if section.settings.enable_section -%}
  {%- liquid
    assign s = section.settings
    assign layout_style = s.layout_style | default: 'strip'
    assign bg_style = s.background_style | default: 'default'
    assign data_source_mode = s.data_source_mode | default: 'manual'
  -%}

  <section
    id="social-media-micro-post-strip-{{ section.id }}"
    class="q-section q-social-micro-post-strip q-section--bg-{{ bg_style }}"
    aria-label="{{ s.aria_label | escape }}"
  >
    <div class="q-section__inner">
      <header class="q-section__heading">
        {%- if s.kicker != blank -%}
          <p class="q-section__kicker">{{ s.kicker | escape }}</p>
        {%- endif -%}

        {%- if s.heading != blank -%}
          <h2 class="q-section__title">{{ s.heading | escape }}</h2>
        {%- endif -%}

        {%- if s.body != blank -%}
          <div class="q-section__body">{{ s.body | escape | newline_to_br }}</div>
        {%- endif -%}
      </header>

      <div
        class="q-micro-post-strip q-micro-post-strip--{{ layout_style }}"
        style="--q-micro-post-cols-desktop: {{ s.max_columns_desktop | default: 3 }};"
      >
        {%- if data_source_mode == 'manual' -%}
          {%- if section.blocks.size > 0 -%}
            {%- for block in section.blocks -%}
              {%- render 'social-micro-post-card',
                block: block,
                section_settings: s
              -%}
            {%- endfor -%}
          {%- else -%}
            {%- if request.design_mode -%}
              <div class="q-micro-post-strip__placeholder" role="status" aria-live="polite">
                <p>Add up to 8 ‚ÄúMicro-post‚Äù blocks to populate this strip.</p>
              </div>
            {%- endif -%}
          {%- endif -%}
        {%- else -%}
          {%- if request.design_mode -%}
            <div class="q-micro-post-strip__placeholder" role="status" aria-live="polite">
              <p>Micro-post timeline <strong>{{ s.timeline_id | escape }}</strong> will be rendered here by Quadratum Link.</p>
            </div>
          {%- endif -%}
        {%- endif -%}
      </div>
    </div>
  </section>
{%- endif -%}

{% schema %}
{
  "name": "Social Media - Micro Post",
  "tag": "section",
  "class": "q-section q-social-micro-post-strip",
  "settings": [
    { "type": "checkbox", "id": "enable_section", "label": "Enable section", "default": true },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "From our socials" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Recent highlights from X and Bluesky" },
    { "type": "textarea", "id": "body", "label": "Body text", "default": "Share quick announcements, thoughts, and updates in a familiar social style without relying on live API feeds." },

    { "type": "header", "content": "Layout" },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Layout style",
      "default": "strip",
      "options": [
        { "value": "strip", "label": "Horizontal strip (scroll on mobile)" },
        { "value": "grid", "label": "Grid (wrap to multiple rows)" }
      ]
    },
    { "type": "range", "id": "max_columns_desktop", "label": "Max columns on desktop", "min": 1, "max": 4, "step": 1, "default": 3 },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background style",
      "default": "default",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "contrast", "label": "Contrast surface" },
        { "value": "soft", "label": "Soft tint" }
      ]
    },

    { "type": "header", "content": "Micro-post chrome" },
    { "type": "checkbox", "id": "show_platform_badge", "label": "Show platform badge (icon + label)", "default": true },
    { "type": "checkbox", "id": "show_handle", "label": "Show handle", "default": true },
    { "type": "checkbox", "id": "show_timestamp", "label": "Show timestamp text", "default": true },
    { "type": "checkbox", "id": "open_links_in_new_tab", "label": "Open micro-post links in new tab", "default": true },

    { "type": "header", "content": "Data source (Quadratum Link ready)" },
    {
      "type": "select",
      "id": "data_source_mode",
      "label": "Data source mode",
      "default": "manual",
      "options": [
        { "value": "manual", "label": "Manual micro-posts (theme editor)" },
        { "value": "timeline", "label": "Timeline feed (Quadratum Link, future)" }
      ]
    },
    { "type": "text", "id": "timeline_id", "label": "Timeline ID (for Quadratum Link)", "default": "primary_social_timeline" },

    { "type": "text", "id": "aria_label", "label": "ARIA label for section", "default": "Micro-post highlight strip from X and Bluesky" }
  ],
  "blocks": [
    {
      "type": "micro_post",
      "name": "Micro-post",
      "settings": [
        {
          "type": "select",
          "id": "platform",
          "label": "Platform",
          "default": "x",
          "options": [
            { "value": "x", "label": "X (Twitter)" },
            { "value": "bluesky", "label": "Bluesky" }
          ]
        },
        { "type": "text", "id": "display_name", "label": "Display name", "default": "Best Website Builder Group" },
        { "type": "text", "id": "handle", "label": "Handle", "default": "@bestwebsitebuildergroup" },
        { "type": "textarea", "id": "post_text", "label": "Post text", "default": "Shipping another beautiful site today. SEO tuned, fast, and built to convert. üöÄ" },
        { "type": "text", "id": "timestamp", "label": "Timestamp / meta", "default": "2h ago" },
        { "type": "url", "id": "post_url", "label": "Original post URL (optional)" },
        { "type": "text", "id": "link_label", "label": "Link label", "default": "View post" }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [
    {
      "name": "Social Media - Micro Post (X / BlueSky)",
      "category": "Social Media",
      "blocks": [
        { "type": "micro_post" },
        { "type": "micro_post" },
        { "type": "micro_post" }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
  .q-social-micro-post-strip .q-section__heading {
    margin: 0 0 18px;
  }

  .q-social-micro-post-strip .q-section__kicker {
    margin: 0 0 6px;
  }

  .q-social-micro-post-strip .q-section__title {
    margin: 0 0 10px;
  }

  .q-social-micro-post-strip .q-section__body {
    margin: 0;
    max-width: 70ch;
  }

  /* Layout: strip (mobile scroll) + desktop grid */
  .q-social-micro-post-strip .q-micro-post-strip {
    --q-micro-post-gap: 16px;
    gap: var(--q-micro-post-gap);
  }

  .q-social-micro-post-strip .q-micro-post-strip--strip {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: minmax(260px, 85%);
    overflow-x: auto;
    padding-bottom: 6px;
    scroll-snap-type: x proximity;
    -webkit-overflow-scrolling: touch;
  }

  .q-social-micro-post-strip .q-micro-post-strip--strip > * {
    scroll-snap-align: start;
  }

  @media (min-width: 750px) {
    .q-social-micro-post-strip .q-micro-post-strip--strip {
      overflow: visible;
      grid-auto-flow: initial;
      grid-auto-columns: initial;
      grid-template-columns: repeat(var(--q-micro-post-cols-desktop, 3), minmax(0, 1fr));
    }
  }

  /* Layout: grid */
  .q-social-micro-post-strip .q-micro-post-strip--grid {
    display: grid;
    grid-template-columns: repeat(1, minmax(0, 1fr));
  }

  @media (min-width: 750px) {
    .q-social-micro-post-strip .q-micro-post-strip--grid {
      grid-template-columns: repeat(var(--q-micro-post-cols-desktop, 3), minmax(0, 1fr));
    }
  }

  .q-social-micro-post-strip .q-micro-post-strip__placeholder {
    padding: 16px;
    border: 1px dashed rgba(0,0,0,0.2);
    border-radius: 12px;
  }

  .q-social-micro-post-strip .q-micro-post-strip__placeholder p {
    margin: 0;
  }
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
