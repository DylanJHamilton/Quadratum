{% comment %}
  Quadratum â€” 3rd Party Â· Affiliate Program CTA (Theme-only)
  File: sections/third-party-affiliate-program.liquid

  â€¢ Content + buttons only (no tracking logic)
  â€¢ Layouts: full_width_hero | strip | card
  â€¢ Token-first styling with scoped fallbacks (no new assets/snippets)
  â€¢ A11Y: semantic lists, focus-visible, reduced motion
{% endcomment %}

{%- assign s = section.settings -%}

{%- liquid
  if s.enable_section != true
    assign _skip = true
  endif

  assign has_benefits = false
  assign has_badges = false

  for block in section.blocks
    if block.type == 'benefit' and block.settings.label != blank
      assign has_benefits = true
    endif
    if block.type == 'badge' and block.settings.label != blank
      assign has_badges = true
    endif
  endfor

  assign has_actions = false
  if s.primary_button_label != blank and s.primary_button_url != blank
    assign has_actions = true
  endif
  if s.secondary_button_label != blank and s.secondary_button_url != blank
    assign has_actions = true
  endif

  assign has_content = false
  if s.kicker != blank or s.heading != blank or s.body != blank
    assign has_content = true
  endif

  assign should_render = false
  if s.enable_section == true
    if has_content or has_benefits or has_badges or has_actions
      assign should_render = true
    endif
  endif
-%}

{%- if should_render -%}
<section
  id="affiliate-cta-{{ section.id }}"
  class="q-section q-section--bg-{{ s.background_style }} q-section--layout-{{ s.layout_style }} q-section--align-{{ s.alignment }} q-affiliate-cta"
  aria-label="{{ s.aria_label | escape }}"
  data-q-section="affiliate-cta"
>
  <style>
    /* =========================
      Token-first (scoped)
      ========================= */
    #affiliate-cta-{{ section.id }}{
      --q-aff-fg: var(--q-color-fg, var(--color-foreground, #111827));
      --q-aff-bg: var(--q-color-bg, var(--color-background, #ffffff));
      --q-aff-border: var(--q-color-border, rgba(0,0,0,0.12));
      --q-aff-soft: var(--q-color-soft, rgba(0,0,0,0.05));
      --q-aff-shadow: var(--q-shadow-md, 0 12px 28px rgba(0,0,0,0.08));

      --q-aff-radius: var(--q-radius-lg, var(--q-radius, 16px));

      --q-aff-container-lg: var(--q-container-lg, 1200px);
      --q-aff-container-xl: var(--q-container-xl, 1320px);

      --q-aff-pad-x: var(--q-pad-x, clamp(16px, 3vw, 32px));
      --q-aff-pad-strip-y: var(--q-pad-strip-y, clamp(18px, 2.8vw, 34px));
      --q-aff-pad-hero-y: var(--q-pad-hero-y, clamp(44px, 6vw, 92px));
      --q-aff-pad-card-y: var(--q-pad-card-y, clamp(22px, 3.5vw, 48px));

      --q-aff-gap-sm: var(--q-gap-sm, 10px);
      --q-aff-gap-md: var(--q-gap-md, 16px);
      --q-aff-gap-lg: var(--q-gap-lg, 22px);

      --q-aff-kicker-fs: var(--q-kicker-fs, 0.85rem);
      --q-aff-heading-fs: var(--q-heading-2-fs, clamp(1.65rem, 2.6vw, 2.4rem));
      --q-aff-body-fs: var(--q-body-fs, 1.02rem);
      --q-aff-body-lh: var(--q-body-lh, 1.7);

      --q-aff-btn-bg: var(--q-btn-primary-bg, var(--q-color-primary, #111827));
      --q-aff-btn-bg-hover: var(--q-btn-primary-bg-hover, #0b1220);
      --q-aff-btn-fg: var(--q-btn-primary-fg, #ffffff);
    }

    @supports (color: color-mix(in srgb, #000 10%, transparent)) {
      #affiliate-cta-{{ section.id }}{
        --q-aff-border: var(--q-color-border, color-mix(in srgb, var(--q-aff-fg) 12%, transparent));
        --q-aff-soft: var(--q-color-soft, color-mix(in srgb, var(--q-aff-fg) 6%, transparent));
      }
    }

    #affiliate-cta-{{ section.id }}{
      color: var(--q-aff-fg);
    }

    /* Inner container (layout-driven) */
    #affiliate-cta-{{ section.id }} .q-section__inner{
      margin-inline: auto;
      padding-inline: var(--q-aff-pad-x);
    }

    #affiliate-cta-{{ section.id }}.q-section--layout-full_width_hero .q-section__inner{
      max-width: var(--q-aff-container-xl);
      padding-block: var(--q-aff-pad-hero-y);
    }

    #affiliate-cta-{{ section.id }}.q-section--layout-strip .q-section__inner{
      max-width: var(--q-aff-container-lg);
      padding-block: var(--q-aff-pad-strip-y);
    }

    #affiliate-cta-{{ section.id }}.q-section--layout-card .q-section__inner{
      max-width: var(--q-aff-container-lg);
      padding-block: var(--q-aff-pad-card-y);
    }

    /* Alignment behavior:
       - Mobile defaults to center for a "hero CTA" feel
       - Desktop respects setting via q-section--align-* */
    #affiliate-cta-{{ section.id }} .q-affiliate-cta__body{
      text-align: center;
    }
    @media (min-width: 750px){
      #affiliate-cta-{{ section.id }}.q-section--align-left .q-affiliate-cta__body{ text-align: left; }
      #affiliate-cta-{{ section.id }}.q-section--align-center .q-affiliate-cta__body{ text-align: center; }
    }

    /* Stack fallback (only if your global q-stack isn't present) */
    #affiliate-cta-{{ section.id }} .q-stack{ display: flex; flex-direction: column; }
    #affiliate-cta-{{ section.id }} .q-stack--sm{ gap: var(--q-aff-gap-sm); }
    #affiliate-cta-{{ section.id }} .q-stack--md{ gap: var(--q-aff-gap-md); }
    #affiliate-cta-{{ section.id }} .q-stack--lg{ gap: var(--q-aff-gap-lg); }

    /* Kicker/heading/body fallbacks (token-first) */
    #affiliate-cta-{{ section.id }} .q-kicker{
      margin: 0;
      font-size: var(--q-aff-kicker-fs);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.78;
    }
    #affiliate-cta-{{ section.id }} .q-kicker--subtle{ opacity: 0.76; }

    #affiliate-cta-{{ section.id }} .q-heading{
      margin: 0;
      letter-spacing: -0.01em;
      line-height: 1.12;
    }
    #affiliate-cta-{{ section.id }} .q-heading--section{
      font-size: var(--q-aff-heading-fs);
    }

    #affiliate-cta-{{ section.id }} .q-text{
      font-size: var(--q-aff-body-fs);
      line-height: var(--q-aff-body-lh);
      opacity: 0.94;
    }
    #affiliate-cta-{{ section.id }} .q-text--muted{ opacity: 0.9; }

    #affiliate-cta-{{ section.id }} .rte p{ margin: 0 0 0.75rem; }
    #affiliate-cta-{{ section.id }} .rte p:last-child{ margin-bottom: 0; }

    /* Card layout wrapper */
    #affiliate-cta-{{ section.id }} .q-affiliate-cta__card{
      border-radius: var(--q-aff-radius);
      border: 1px solid var(--q-aff-border);
      background: var(--q-aff-bg);
      box-shadow: var(--q-aff-shadow);
      padding: clamp(18px, 2.6vw, 28px);
    }
    #affiliate-cta-{{ section.id }}.q-section--layout-full_width_hero .q-affiliate-cta__card,
    #affiliate-cta-{{ section.id }}.q-section--layout-strip .q-affiliate-cta__card{
      /* In non-card layouts, keep wrapper neutral */
      border: none;
      background: transparent;
      box-shadow: none;
      padding: 0;
    }

    /* Bullets */
    #affiliate-cta-{{ section.id }} .q-list{
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 0.55rem;
    }
    #affiliate-cta-{{ section.id }} .q-affiliate-cta__bullets{
      max-width: 72ch;
      margin-inline: auto;
    }
    @media (min-width: 750px){
      #affiliate-cta-{{ section.id }}.q-section--align-left .q-affiliate-cta__bullets{ margin-inline: 0; }
    }
    #affiliate-cta-{{ section.id }} .q-list__item{
      display: flex;
      align-items: flex-start;
      gap: 0.55rem;
    }
    #affiliate-cta-{{ section.id }} .q-list__icon{
      margin-top: 0.22rem;
      opacity: 0.6;
      line-height: 1;
      flex: 0 0 auto;
    }
    #affiliate-cta-{{ section.id }} .q-list__text{
      opacity: 0.92;
    }

    /* Badges row */
    #affiliate-cta-{{ section.id }} .q-affiliate-cta__badges{
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
      justify-content: center;
    }
    @media (min-width: 750px){
      #affiliate-cta-{{ section.id }}.q-section--align-left .q-affiliate-cta__badges{ justify-content: flex-start; }
      #affiliate-cta-{{ section.id }}.q-section--align-center .q-affiliate-cta__badges{ justify-content: center; }
    }

    #affiliate-cta-{{ section.id }} .q-badge{
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--q-aff-border);
      background: var(--q-aff-soft);
      font-size: var(--q-badge-fs, 0.88rem);
      line-height: 1.2;
      opacity: 0.96;
    }
    #affiliate-cta-{{ section.id }} .q-badge--soft{ background: var(--q-aff-soft); }
    #affiliate-cta-{{ section.id }} .q-badge__icon{ opacity: 0.9; }
    #affiliate-cta-{{ section.id }} .q-badge__label{ opacity: 0.98; }

    /* Actions */
    #affiliate-cta-{{ section.id }} .q-actions{
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: center;
      align-items: center;
      margin-top: 0.25rem;
    }
    #affiliate-cta-{{ section.id }} .q-actions--left{ justify-content: center; }
    @media (min-width: 750px){
      #affiliate-cta-{{ section.id }}.q-section--align-left .q-actions--left{ justify-content: flex-start; }
      #affiliate-cta-{{ section.id }}.q-section--align-center .q-actions--center{ justify-content: center; }
    }

    /* Button fallbacks (mapped to existing variants) */
    #affiliate-cta-{{ section.id }} .q-btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--q-btn-pad-y, 0.85rem) var(--q-btn-pad-x, 1.05rem);
      border-radius: var(--q-btn-radius, var(--q-aff-radius));
      text-decoration: none;
      font-weight: var(--q-btn-fw, 650);
      line-height: 1;
      border: 1px solid transparent;
      transition: transform 140ms ease, background 140ms ease, border-color 140ms ease, opacity 140ms ease;
      white-space: nowrap;
    }
    #affiliate-cta-{{ section.id }} .q-btn:focus-visible{
      outline: 2px solid currentColor;
      outline-offset: 3px;
    }
    #affiliate-cta-{{ section.id }} .q-btn--primary{
      background: var(--q-aff-btn-bg);
      color: var(--q-aff-btn-fg);
    }
    #affiliate-cta-{{ section.id }} .q-btn--primary:hover{
      background: var(--q-aff-btn-bg-hover);
      transform: translateY(-1px);
    }

    #affiliate-cta-{{ section.id }} .q-btn--ghost{
      background: transparent;
      color: var(--q-aff-fg);
      border-color: var(--q-aff-border);
    }
    #affiliate-cta-{{ section.id }} .q-btn--ghost:hover{
      background: var(--q-aff-soft);
      transform: translateY(-1px);
    }

    @media (prefers-reduced-motion: reduce){
      #affiliate-cta-{{ section.id }} .q-btn{ transition: none; }
      #affiliate-cta-{{ section.id }} .q-btn--primary:hover,
      #affiliate-cta-{{ section.id }} .q-btn--ghost:hover{ transform: none; }
    }
  </style>

  <div class="q-section__inner">
    {%- if s.layout_style == 'card' -%}
      <div class="q-affiliate-cta__card q-card q-card--emphasis">
    {%- endif -%}

      <div class="q-affiliate-cta__body q-stack q-stack--{{ s.stack_density }}">
        {%- if s.kicker != blank -%}
          <p class="q-kicker q-kicker--subtle">{{ s.kicker | escape }}</p>
        {%- endif -%}

        {%- if s.heading != blank -%}
          <h2 class="q-heading q-heading--section">{{ s.heading | escape }}</h2>
        {%- endif -%}

        {%- if s.body != blank -%}
          <div class="q-text q-text--muted rte">
            {{ s.body }}
          </div>
        {%- endif -%}

        {%- if s.show_bullets == true and has_benefits -%}
          <ul class="q-list q-list--bullets q-affiliate-cta__bullets" role="list">
            {%- for block in section.blocks -%}
              {%- if block.type == 'benefit' -%}
                {%- assign b = block.settings -%}
                {%- if b.label != blank -%}
                  <li class="q-list__item" role="listitem" {{ block.shopify_attributes }}>
                    <span class="q-list__icon" aria-hidden="true">â€¢</span>
                    <span class="q-list__text">{{ b.label | escape }}</span>
                  </li>
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- if s.show_badges == true and has_badges -%}
          <div class="q-affiliate-cta__badges" role="list">
            {%- for block in section.blocks -%}
              {%- if block.type == 'badge' -%}
                {%- assign b = block.settings -%}
                {%- if b.label != blank -%}
                  <span class="q-badge q-badge--soft" role="listitem" {{ block.shopify_attributes }}>
                    {%- if b.icon_text != blank -%}
                      <span class="q-badge__icon" aria-hidden="true">{{ b.icon_text | escape }}</span>
                    {%- endif -%}
                    <span class="q-badge__label">{{ b.label | escape }}</span>
                  </span>
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
          </div>
        {%- endif -%}

        {%- if has_actions -%}
          <div class="q-affiliate-cta__actions q-actions q-actions--{{ s.alignment }}">
            {%- if s.primary_button_label != blank and s.primary_button_url != blank -%}
              <a href="{{ s.primary_button_url }}" class="q-btn q-btn--primary">
                {{ s.primary_button_label | escape }}
              </a>
            {%- endif -%}

            {%- if s.secondary_button_label != blank and s.secondary_button_url != blank -%}
              <a href="{{ s.secondary_button_url }}" class="q-btn q-btn--ghost">
                {{ s.secondary_button_label | escape }}
              </a>
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>

    {%- if s.layout_style == 'card' -%}
      </div>
    {%- endif -%}
  </div>
</section>
{%- endif -%}

{% schema %}
{
  "name": "3P - Affiliate Program",
  "tag": "section",
  "class": "q-section q-affiliate-cta",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_section",
      "label": "Enable section",
      "default": true
    },
    {
      "type": "text",
      "id": "aria_label",
      "label": "Section aria-label",
      "default": "Affiliate program call-to-action"
    },

    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "kicker",
      "label": "Kicker",
      "default": "Partner with us"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Earn commissions by sharing our brand"
    },
    {
      "type": "richtext",
      "id": "body",
      "label": "Body text",
      "default": "<p>Join our affiliate program and earn recurring commissions by sharing products your audience already loves. Fast approvals, clear reporting, and dedicated support.</p>"
    },
    {
      "type": "checkbox",
      "id": "show_bullets",
      "label": "Show bullet list",
      "default": true
    },

    {
      "type": "header",
      "content": "Layout & styling"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Layout style",
      "default": "strip",
      "options": [
        { "value": "full_width_hero", "label": "Full-width hero" },
        { "value": "strip", "label": "Strip" },
        { "value": "card", "label": "Card" }
      ]
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Content alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background style",
      "default": "surface",
      "options": [
        { "value": "surface", "label": "Surface" },
        { "value": "contrast", "label": "Contrast" },
        { "value": "brand", "label": "Brand color" }
      ]
    },
    {
      "type": "select",
      "id": "stack_density",
      "label": "Vertical spacing density",
      "default": "md",
      "options": [
        { "value": "sm", "label": "Tight" },
        { "value": "md", "label": "Comfort" },
        { "value": "lg", "label": "Relaxed" }
      ]
    },

    {
      "type": "header",
      "content": "Badges"
    },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "Show badges row",
      "default": true
    },

    {
      "type": "header",
      "content": "Primary & secondary actions"
    },
    {
      "type": "text",
      "id": "primary_button_label",
      "label": "Primary button label",
      "default": "Apply to become an affiliate"
    },
    {
      "type": "url",
      "id": "primary_button_url",
      "label": "Primary button URL"
    },
    {
      "type": "text",
      "id": "secondary_button_label",
      "label": "Secondary button label",
      "default": "Affiliate login"
    },
    {
      "type": "url",
      "id": "secondary_button_url",
      "label": "Secondary button URL"
    }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Benefit bullet",
      "limit": 5,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Benefit label",
          "default": "High commission payouts"
        }
      ]
    },
    {
      "type": "badge",
      "name": "Program badge",
      "limit": 6,
      "settings": [
        {
          "type": "text",
          "id": "icon_text",
          "label": "Icon text (emoji or short code)",
          "default": "ðŸ’¸"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Badge label",
          "default": "Fast payouts"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "3rd Party Â· Affiliate program CTA",
      "category": "3rd Party Integrations",
      "blocks": [
        { "type": "benefit" },
        { "type": "benefit" },
        { "type": "benefit" },
        { "type": "badge" },
        { "type": "badge" }
      ]
    }
  ]
}
{% endschema %}
