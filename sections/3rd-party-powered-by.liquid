{% comment %}
  Quadratum — 3rd Party: Powered By Integrations Panel
  File: sections/3p-powered-by-integrations.liquid

  Conventions:
  - Schema name: "3rd Party - [Section Name]"
  - ALL presets use category: "3rd Party Integrations"
{% endcomment %}

{%- assign s = section.settings -%}

{%- if s.enable_section -%}
<section
  id="q-powered-by-{{ section.id }}"
  class="q-section q-section--powered-by q-section--bg-{{ s.background_style }} q-powered-by--{{ s.layout_style }} q-align-{{ s.align }}"
  aria-label="{{ s.aria_label | escape }}"
  style="
    --q-powered-pad-y: {{ s.padding_y | divided_by: 10.0 }}rem;
    --q-powered-pad-x: {{ s.padding_x | divided_by: 10.0 }}rem;

    --q-powered-card-radius: {{ s.card_radius }}px;
    --q-powered-card-pad: {{ s.card_padding | divided_by: 10.0 }}rem;

    --q-powered-shadow-alpha: {{ s.card_shadow_strength | divided_by: 100.0 }};
    --q-powered-grid-gap: {{ s.grid_gap | divided_by: 10.0 }}rem;
    --q-powered-logo-max-h: {{ s.logo_max_height }}px;

    --q-powered-cols-desktop: {{ s.columns_desktop }};
  "
>
  <div class="q-section__inner q-section__inner--{{ s.max_width }} q-powered-by__inner">
    <header class="q-powered-by__header">
      {%- if s.kicker != blank -%}
        <p class="q-kicker q-powered-by__kicker">{{ s.kicker | escape }}</p>
      {%- endif -%}

      {%- if s.heading != blank -%}
        <h2 class="q-heading q-heading--section q-powered-by__heading q-powered-by__heading--{{ s.heading_size }}">
          {{ s.heading | escape }}
        </h2>
      {%- endif -%}

      {%- if s.body != blank -%}
        <div class="q-text q-powered-by__body q-powered-by__body--{{ s.body_size }}">
          {{ s.body }}
        </div>
      {%- endif -%}
    </header>

    {%- if section.blocks.size > 0 -%}
      <div class="q-powered-by__list" role="list">
        {%- for block in section.blocks -%}
          {%- if block.type == 'integration' -%}
            {%- assign b = block.settings -%}

            {%- assign initials = '' -%}
            {%- assign name_parts = b.name | split: ' ' -%}
            {%- if name_parts.size >= 2 -%}
              {%- assign first_i = name_parts[0] | strip | slice: 0, 1 -%}
              {%- assign second_i = name_parts[1] | strip | slice: 0, 1 -%}
              {%- assign initials = first_i | append: second_i -%}
            {%- else -%}
              {%- assign initials = b.name | strip | slice: 0, 2 -%}
            {%- endif -%}

            <article
              class="q-powered-by__item{% if s.show_border %} q-powered-by__item--bordered{% endif %}"
              role="listitem"
              {{ block.shopify_attributes }}
            >
              <div class="q-powered-by__top">
                {%- if b.logo != blank -%}
                  <div class="q-powered-by__logo" aria-hidden="true">
                    {{ b.logo | image_url: width: 240 | image_tag: loading: 'lazy', alt: b.name | escape }}
                  </div>
                {%- else -%}
                  <div class="q-powered-by__mark" aria-hidden="true">
                    <span class="q-powered-by__mark-text">{{ initials | upcase | escape }}</span>
                  </div>
                {%- endif -%}

                {%- if b.role != blank -%}
                  <p class="q-powered-by__role">{{ b.role | escape }}</p>
                {%- endif -%}
              </div>

              <div class="q-powered-by__content">
                {%- if b.name != blank -%}
                  <h3 class="q-powered-by__name">{{ b.name | escape }}</h3>
                {%- endif -%}

                {%- if b.description != blank -%}
                  <div class="q-powered-by__description">
                    {{ b.description }}
                  </div>
                {%- endif -%}

                {%- if b.link != blank -%}
                  {%- assign cta_is_button = false -%}
                  {%- assign cta_class = 'q-link q-powered-by__cta' -%}

                  {%- if s.cta_style != 'link' -%}
                    {%- assign cta_is_button = true -%}
                    {%- case s.cta_style -%}
                      {%- when 'button_primary' -%}
                        {%- assign cta_class = 'q-btn q-btn--primary q-powered-by__cta q-powered-by__cta--btn' -%}
                      {%- when 'button_secondary' -%}
                        {%- assign cta_class = 'q-btn q-btn--secondary q-powered-by__cta q-powered-by__cta--btn' -%}
                      {%- when 'button_ghost' -%}
                        {%- assign cta_class = 'q-btn q-btn--secondary q-btn--ghost q-powered-by__cta q-powered-by__cta--btn' -%}
                      {%- else -%}
                        {%- assign cta_class = 'q-btn q-btn--primary q-powered-by__cta q-powered-by__cta--btn' -%}
                    {%- endcase -%}
                  {%- endif -%}

                  <a
                    href="{{ b.link }}"
                    class="{{ cta_class }}"
                    {% if s.open_links_in_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                    aria-label="{{ s.cta_label | escape }}: {{ b.name | escape }}"
                  >
                    <span>{{ s.cta_label | escape }}</span>
                    {%- if s.cta_show_icon -%}
                      <span class="q-powered-by__cta-icon" aria-hidden="true">↗</span>
                    {%- endif -%}
                  </a>
                {%- endif -%}
              </div>
            </article>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>

  {%- if s.use_custom_colors -%}
    <style>
      #q-powered-by-{{ section.id }}{
        --q-powered-bg: {{ s.custom_bg_color }};
        --q-powered-card-bg: {{ s.custom_card_bg_color }};
        --q-powered-text: {{ s.custom_text_color }};
        --q-powered-muted: {{ s.custom_muted_text_color }};
        --q-powered-border: {{ s.custom_border_color }};
        --q-powered-accent: {{ s.custom_accent_color }};
      }
    </style>
  {%- endif -%}

  <style>
    /* Root + containment */
    #q-powered-by-{{ section.id }}{
      position: relative;
      padding: var(--q-powered-pad-y) 0;
    }
    #q-powered-by-{{ section.id }}.q-align-left{ text-align: left; }
    #q-powered-by-{{ section.id }}.q-align-center{ text-align: center; }

    /* Use theme vars if present; allow overrides */
    #q-powered-by-{{ section.id }}{
      background: var(--q-powered-bg, var(--q-section-bg, transparent));
      color: var(--q-powered-text, var(--q-section-fg, inherit));
    }

    #q-powered-by-{{ section.id }} .q-section__inner{
      margin: 0 auto;
      padding: 0 var(--q-powered-pad-x);
    }

    /* Header */
    #q-powered-by-{{ section.id }} .q-powered-by__header{
      display: grid;
      gap: .75rem;
      margin-bottom: 1.25rem;
    }
    #q-powered-by-{{ section.id }}.q-align-center .q-powered-by__header{ justify-items: center; }

    #q-powered-by-{{ section.id }} .q-powered-by__kicker{
      margin: 0;
      color: var(--q-powered-muted, var(--q-section-muted, rgba(255,255,255,.72)));
      letter-spacing: .08em;
      text-transform: uppercase;
      font-weight: 700;
      font-size: .8rem;
    }

    #q-powered-by-{{ section.id }} .q-powered-by__heading{ margin: 0; line-height: 1.08; }
    #q-powered-by-{{ section.id }} .q-powered-by__heading--sm{ font-size: clamp(1.35rem, 2vw, 1.7rem); }
    #q-powered-by-{{ section.id }} .q-powered-by__heading--md{ font-size: clamp(1.6rem, 2.4vw, 2.1rem); }
    #q-powered-by-{{ section.id }} .q-powered-by__heading--lg{ font-size: clamp(1.9rem, 3vw, 2.5rem); }

    #q-powered-by-{{ section.id }} .q-powered-by__body{
      margin: 0;
      max-width: 62ch;
      color: var(--q-powered-muted, var(--q-section-muted, rgba(255,255,255,.72)));
    }
    #q-powered-by-{{ section.id }} .q-powered-by__body--sm{ font-size: .95rem; }
    #q-powered-by-{{ section.id }} .q-powered-by__body--md{ font-size: 1rem; }
    #q-powered-by-{{ section.id }} .q-powered-by__body--lg{ font-size: 1.05rem; }
    /* Force richtext to inherit (fixes "black text" overrides) */
    #q-powered-by-{{ section.id }} .q-powered-by__body *{ color: inherit; }

    /* List layouts */
    #q-powered-by-{{ section.id }} .q-powered-by__list{
      display: grid;
      gap: var(--q-powered-grid-gap);
      margin-top: 1rem;
    }

    #q-powered-by-{{ section.id }}.q-powered-by--grid .q-powered-by__list{ grid-template-columns: 1fr; }
    @media (min-width: 740px){
      #q-powered-by-{{ section.id }}.q-powered-by--grid .q-powered-by__list{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 1024px){
      #q-powered-by-{{ section.id }}.q-powered-by--grid .q-powered-by__list{
        grid-template-columns: repeat(var(--q-powered-cols-desktop), minmax(0, 1fr));
      }
    }

    #q-powered-by-{{ section.id }}.q-powered-by--strip .q-powered-by__list{ grid-template-columns: 1fr; }
    @media (min-width: 740px){
      #q-powered-by-{{ section.id }}.q-powered-by--strip .q-powered-by__list{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 1024px){
      #q-powered-by-{{ section.id }}.q-powered-by--strip .q-powered-by__list{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    /* Card treatment */
    #q-powered-by-{{ section.id }} .q-powered-by__item{
      border-radius: var(--q-powered-card-radius);
      padding: var(--q-powered-card-pad);
      background: var(--q-powered-card-bg, var(--q-section-card-bg, rgba(255,255,255,.06)));
      box-shadow:
        0 14px 36px rgba(0,0,0, var(--q-powered-shadow-alpha)),
        0 1px 0 rgba(0,0,0,.03);
      border: 1px solid rgba(255,255,255,.10);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    #q-powered-by-{{ section.id }} .q-powered-by__item--bordered{
      border-color: var(--q-powered-border, rgba(255,255,255,.18));
    }
    #q-powered-by-{{ section.id }} .q-powered-by__item:hover{
      transform: translateY(-2px);
      box-shadow:
        0 18px 44px rgba(0,0,0, calc(var(--q-powered-shadow-alpha) + .03)),
        0 1px 0 rgba(0,0,0,.04);
      border-color: rgba(255,255,255,.18);
    }

    /* Top */
    #q-powered-by-{{ section.id }} .q-powered-by__top{
      display: grid;
      gap: .6rem;
      margin-bottom: .65rem;
      align-items: start;
      justify-items: start;
    }
    #q-powered-by-{{ section.id }}.q-align-center .q-powered-by__top{ justify-items: center; }

    #q-powered-by-{{ section.id }} .q-powered-by__logo{
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: .5rem .6rem;
      border-radius: calc(var(--q-powered-card-radius) - 6px);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      max-width: 100%;
    }
    #q-powered-by-{{ section.id }}.q-align-center .q-powered-by__logo{ justify-content: center; }
    #q-powered-by-{{ section.id }} .q-powered-by__logo img{
      max-height: var(--q-powered-logo-max-h);
      width: auto;
      height: auto;
      max-width: 100%;
      object-fit: contain;
      display: block;
      filter: saturate(1.05);
    }

    /* Initials badge fallback */
    #q-powered-by-{{ section.id }} .q-powered-by__mark{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
    }
    #q-powered-by-{{ section.id }} .q-powered-by__mark-text{
      font-weight: 900;
      letter-spacing: .02em;
      font-size: .95rem;
      color: var(--q-powered-text, var(--q-section-fg, #fff));
    }

    #q-powered-by-{{ section.id }} .q-powered-by__role{
      margin: 0;
      font-size: .9rem;
      color: var(--q-powered-muted, var(--q-section-muted, rgba(255,255,255,.72)));
    }

    /* Content */
    #q-powered-by-{{ section.id }} .q-powered-by__name{
      margin: 0 0 .35rem 0;
      font-size: 1.05rem;
      font-weight: 800;
      line-height: 1.2;
      color: var(--q-powered-text, var(--q-section-fg, inherit));
    }

    #q-powered-by-{{ section.id }} .q-powered-by__description{
      color: var(--q-powered-muted, var(--q-section-muted, rgba(255,255,255,.72)));
      font-size: .95rem;
      line-height: 1.55;
    }
    #q-powered-by-{{ section.id }} .q-powered-by__description p{ margin: 0; }
    /* Force richtext to inherit inside description (prevents theme RTE overrides) */
    #q-powered-by-{{ section.id }} .q-powered-by__description *{ color: inherit; }

    /* CTA (link or button) */
    #q-powered-by-{{ section.id }} .q-powered-by__cta{
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      margin-top: .85rem;
      text-decoration: none;
    }
    /* Link style */
    #q-powered-by-{{ section.id }} .q-powered-by__cta.q-link{
      font-weight: 800;
      color: var(--q-powered-accent, var(--q-section-accent, currentColor));
    }
    #q-powered-by-{{ section.id }} .q-powered-by__cta.q-link:hover{
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    /* Button style helpers */
    #q-powered-by-{{ section.id }} .q-powered-by__cta--btn{
      justify-content: center;
      white-space: nowrap;
    }

    #q-powered-by-{{ section.id }} .q-powered-by__cta-icon{
      font-size: .95em;
      opacity: .9;
    }

    /* Strip tweak */
    #q-powered-by-{{ section.id }}.q-powered-by--strip .q-powered-by__item{
      box-shadow:
        0 10px 26px rgba(0,0,0, calc(var(--q-powered-shadow-alpha) - .02)),
        0 1px 0 rgba(0,0,0,.02);
    }
  </style>
</section>
{%- endif -%}

{% schema %}
{
  "name": "3rd Party - Powered By",
  "tag": "section",
  "class": "q-section q-section--powered-by",
  "settings": [
    { "type": "checkbox", "id": "enable_section", "label": "Enable section", "default": true },
    { "type": "text", "id": "aria_label", "label": "Section aria-label", "default": "Powered by integrations" },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Our technology stack" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Powered by tools you already trust" },
    { "type": "richtext", "id": "body", "label": "Body text", "default": "<p>Behind every order is a reliable stack for CRM, email, shipping, and tracking. Here are some of the platforms we use every day.</p>" },

    { "type": "header", "content": "Layout" },
    { "type": "select", "id": "layout_style", "label": "Layout style", "default": "grid", "options": [
      { "value": "grid", "label": "Grid" },
      { "value": "strip", "label": "Strip row" }
    ]},
    { "type": "select", "id": "align", "label": "Content alignment", "default": "center", "options": [
      { "value": "left", "label": "Left" },
      { "value": "center", "label": "Center" }
    ]},
    { "type": "select", "id": "background_style", "label": "Background style", "default": "surface", "options": [
      { "value": "surface", "label": "Surface" },
      { "value": "contrast", "label": "Contrast" },
      { "value": "brand_soft", "label": "Brand soft / tint" }
    ]},
    { "type": "select", "id": "max_width", "label": "Max content width", "default": "lg", "options": [
      { "value": "sm", "label": "Small" },
      { "value": "md", "label": "Medium" },
      { "value": "lg", "label": "Large" }
    ]},
    { "type": "checkbox", "id": "show_border", "label": "Show subtle border around cards", "default": false },

    { "type": "header", "content": "CTA (Learn more)" },
    { "type": "text", "id": "cta_label", "label": "CTA label", "default": "Learn more" },
    { "type": "select", "id": "cta_style", "label": "CTA style", "default": "link", "options": [
      { "value": "link", "label": "Link" },
      { "value": "button_primary", "label": "Button — Primary" },
      { "value": "button_secondary", "label": "Button — Secondary" },
      { "value": "button_ghost", "label": "Button — Ghost" }
    ]},
    { "type": "checkbox", "id": "cta_show_icon", "label": "Show launch icon", "default": true },
    { "type": "checkbox", "id": "open_links_in_new_tab", "label": "Open integration links in a new tab", "default": true },

    { "type": "header", "content": "Styling — spacing, size, typography" },
    { "type": "range", "id": "padding_y", "label": "Section padding Y (rem ×10)", "min": 0, "max": 96, "step": 2, "default": 48 },
    { "type": "range", "id": "padding_x", "label": "Section padding X (rem ×10)", "min": 0, "max": 96, "step": 2, "default": 24 },
    { "type": "range", "id": "card_radius", "label": "Card radius (px)", "min": 0, "max": 28, "step": 1, "default": 16 },
    { "type": "range", "id": "card_padding", "label": "Card padding (rem ×10)", "min": 10, "max": 34, "step": 2, "default": 18 },
    { "type": "range", "id": "grid_gap", "label": "Grid gap (rem ×10)", "min": 8, "max": 30, "step": 2, "default": 16 },
    { "type": "select", "id": "columns_desktop", "label": "Grid columns (desktop)", "default": "3", "options": [
      { "value": "2", "label": "2 columns" },
      { "value": "3", "label": "3 columns" },
      { "value": "4", "label": "4 columns" }
    ]},
    { "type": "range", "id": "logo_max_height", "label": "Logo max height (px)", "min": 20, "max": 56, "step": 2, "default": 34 },

    { "type": "range", "id": "card_shadow_strength", "label": "Shadow strength (%)", "min": 0, "max": 25, "step": 1, "default": 8 },

    { "type": "select", "id": "heading_size", "label": "Heading size", "default": "md", "options": [
      { "value": "sm", "label": "Small" },
      { "value": "md", "label": "Medium" },
      { "value": "lg", "label": "Large" }
    ]},
    { "type": "select", "id": "body_size", "label": "Body size", "default": "md", "options": [
      { "value": "sm", "label": "Small" },
      { "value": "md", "label": "Medium" },
      { "value": "lg", "label": "Large" }
    ]},

    { "type": "header", "content": "Styling — optional custom colors" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors for this section", "default": false },
    { "type": "color", "id": "custom_bg_color", "label": "Custom background color", "default": "#0b1220" },
    { "type": "color", "id": "custom_card_bg_color", "label": "Custom card background color", "default": "#111a2e" },
    { "type": "color", "id": "custom_text_color", "label": "Custom text color", "default": "#ffffff" },
    { "type": "color", "id": "custom_muted_text_color", "label": "Custom muted text color", "default": "#a9b4c7" },
    { "type": "color", "id": "custom_border_color", "label": "Custom border color", "default": "#26324a" },
    { "type": "color", "id": "custom_accent_color", "label": "Custom accent/link color", "default": "#7aa2ff" }
  ],
  "blocks": [
    {
      "type": "integration",
      "name": "Integration",
      "limit": 12,
      "settings": [
        { "type": "text", "id": "name", "label": "Integration name", "default": "GoHighLevel" },
        { "type": "text", "id": "role", "label": "Short role/label", "default": "CRM & automation" },
        { "type": "richtext", "id": "description", "label": "Short description", "default": "<p>Manages leads, pipelines, and follow-up workflows so nothing falls through the cracks.</p>" },
        { "type": "url", "id": "link", "label": "Optional “Learn more” link" },
        { "type": "image_picker", "id": "logo", "label": "Logo (optional)" }
      ]
    }
  ],
  "presets": [
    {
      "name": "3rd Party · Powered By Integrations",
      "category": "3rd Party Integrations",
      "settings": {
        "layout_style": "grid",
        "align": "center",
        "background_style": "surface",
        "max_width": "lg",
        "show_border": false,
        "heading_size": "md",
        "body_size": "md",
        "columns_desktop": "3",
        "cta_style": "button_ghost",
        "cta_label": "Learn more",
        "cta_show_icon": true,
        "open_links_in_new_tab": true
      },
      "blocks": [
        {
          "type": "integration",
          "settings": {
            "name": "GoHighLevel",
            "role": "CRM & funnels",
            "description": "<p>Captures leads, automates follow-up, and keeps our sales pipeline organized.</p>",
            "link": "https://www.gohighlevel.com"
          }
        },
        {
          "type": "integration",
          "settings": {
            "name": "Klaviyo",
            "role": "Email & SMS",
            "description": "<p>Delivers personalized email and SMS campaigns based on real customer behavior.</p>",
            "link": "https://www.klaviyo.com"
          }
        },
        {
          "type": "integration",
          "settings": {
            "name": "ShipStation",
            "role": "Fulfillment & shipping",
            "description": "<p>Routes orders to the right carriers and keeps deliveries moving on time.</p>",
            "link": "https://www.shipstation.com"
          }
        }
      ]
    }
  ]
}
{% endschema %}
