{% comment %}
  Quadratum — 3rd Party · CRM form & funnel embed (Section)
  Purpose:
    • Allows merchants to paste a 3rd-party embed snippet (GoHighLevel, Calendly, HubSpot, etc.)
    • Wraps embed in Quadratum UX (header, bullets, trust badges, layout variants)
  Notes:
    • Theme-only. No app dependency.
    • IMPORTANT: embed_code is rendered RAW (not escaped) so JS/iframes work.
{% endcomment %}

{% liquid
  assign s = section.settings
%}

{% if s.enable_section %}
<section
  id="third-party-crm-embed-{{ section.id }}"
  class="q-section q-third-party-crm-embed q-section--bg-{{ s.background_style }} q-section--width-{{ s.max_width }}"
  aria-label="{{ s.aria_label | escape }}"
  data-q-third-party="crm-embed"
  data-q-crm-type="{{ s.embed_type }}"
>
  <div class="q-section__inner">
    {%- comment -%} Header {%- endcomment -%}
    {% if s.kicker != blank or s.heading != blank or s.subheading != blank %}
      <header class="q-section__header q-section__header--{{ s.content_align }}">
        {% if s.kicker != blank %}
          <p class="q-section__kicker">{{ s.kicker | escape }}</p>
        {% endif %}

        {% if s.heading != blank %}
          <h2 class="q-section__heading">{{ s.heading | escape }}</h2>
        {% endif %}

        {% if s.subheading != blank %}
          <div class="q-section__body">
            <p>{{ s.subheading | escape }}</p>
          </div>
        {% endif %}
      </header>
    {% endif %}

    {%- comment -%} Layout wrapper {%- endcomment -%}
    <div class="q-third-party-crm-embed__layout q-third-party-crm-embed__layout--{{ s.layout_variant }}">
      <div class="q-third-party-crm-embed__content">
        {%- comment -%} Bullets {%- endcomment -%}
        {% if s.show_bullets %}
          {% assign bullet_blocks = section.blocks | where: 'type', 'bullet' %}
          {% if bullet_blocks.size > 0 %}
            <ul class="q-third-party-crm-embed__bullets">
              {% for block in bullet_blocks %}
                <li class="q-third-party-crm-embed__bullet" {{ block.shopify_attributes }}>
                  {{ block.settings.text | escape }}
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endif %}

        {%- comment -%} Trust badges {%- endcomment -%}
        {% if s.show_trust_row %}
          {% assign trust_blocks = section.blocks | where: 'type', 'trust_badge' %}
          {% if trust_blocks.size > 0 %}
            <div class="q-third-party-crm-embed__trust-row">
              {% for block in trust_blocks %}
                {% assign b = block.settings %}
                <figure class="q-third-party-crm-embed__trust" {{ block.shopify_attributes }}>
                  {% if b.logo != blank %}
                    {{ b.logo | image_url: width: 200 | image_tag: alt: b.alt, loading: 'lazy', class: 'q-third-party-crm-embed__trust-logo' }}
                  {% endif %}
                  {% if b.label != blank %}
                    <figcaption class="q-third-party-crm-embed__trust-label">
                      {{ b.label | escape }}
                    </figcaption>
                  {% endif %}
                </figure>
              {% endfor %}
            </div>
          {% endif %}
        {% endif %}
      </div>

      <div class="q-third-party-crm-embed__embed">
        {{ s.embed_code }}
      </div>
    </div>
  </div>
</section>

<style>
    .q-third-party-crm-embed__layout{
  display: grid;
  gap: var(--q-gap, 24px);
}

.q-third-party-crm-embed__layout--stacked{
  grid-template-columns: 1fr;
}

.q-third-party-crm-embed__layout--split{
  grid-template-columns: 1fr;
}

@media (min-width: 768px){
  .q-third-party-crm-embed__layout--split{
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    align-items: start;
  }
}

.q-third-party-crm-embed__content{
  display: grid;
  gap: var(--q-gap, 16px);
}

.q-third-party-crm-embed__embed{
  border-radius: var(--q-radius-lg, 16px);
  padding: var(--q-pad, 16px);
  background: var(--q-surface, rgba(255,255,255,.9));
  border: 1px solid rgba(0,0,0,.10);
  box-shadow: var(--q-shadow-md, 0 10px 30px rgba(0,0,0,.08));
  overflow: hidden;
}

.q-third-party-crm-embed__embed iframe{
  width: 100%;
  border: 0;
  display: block;
  min-height: 740px;
}

.q-third-party-crm-embed__bullets{
  margin: 0;
  padding-left: 1.15em;
  display: grid;
  gap: 10px;
}

.q-third-party-crm-embed__trust-row{
  display: flex;
  flex-wrap: wrap;
  gap: var(--q-gap-sm, 12px);
  align-items: center;
}

.q-third-party-crm-embed__trust{
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

.q-third-party-crm-embed__trust-logo{
  width: auto;
  height: 28px;
}

.q-third-party-crm-embed__trust-label{
  font-size: .9rem;
  opacity: .8;
}

</style>
{% endif %}

{% schema %}
{
  "name": "3rd Party - CRM Embed",
  "tag": "section",
  "class": "q-section q-third-party-crm-embed",
  "settings": [
    { "type": "checkbox", "id": "enable_section", "label": "Enable section", "default": true },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Get started today" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Book your call or request a quote" },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading / description",
      "default": "Use the form below to request a quote, schedule a call, or take the next step with our team."
    },
    { "type": "checkbox", "id": "show_bullets", "label": "Show bullet list", "default": false },
    {
      "type": "select",
      "id": "embed_type",
      "label": "Embed type",
      "default": "form",
      "options": [
        { "value": "form", "label": "Form" },
        { "value": "funnel", "label": "Full funnel page" }
      ]
    },
    {
      "type": "textarea",
      "id": "embed_code",
      "label": "Embed code (form, funnel, or calendar)",
      "default": "<!-- Paste your CRM or booking embed code here -->",
      "info": "Supports GoHighLevel, Calendly, HubSpot, and other providers via their HTML/JS/iframe snippets."
    },
    { "type": "checkbox", "id": "show_trust_row", "label": "Show trust badges / logos", "default": false },
    {
      "type": "select",
      "id": "layout_variant",
      "label": "Layout",
      "default": "split",
      "options": [
        { "value": "stacked", "label": "Stacked (content above embed)" },
        { "value": "split", "label": "Split: content + embed side by side" }
      ]
    },
    {
      "type": "select",
      "id": "content_align",
      "label": "Content alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background style",
      "default": "surface",
      "options": [
        { "value": "surface", "label": "Surface" },
        { "value": "contrast", "label": "Contrast" },
        { "value": "brand", "label": "Brand color" }
      ]
    },
    {
      "type": "select",
      "id": "max_width",
      "label": "Content width",
      "default": "md",
      "options": [
        { "value": "sm", "label": "Narrow" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Wide" }
      ]
    },
    {
      "type": "text",
      "id": "aria_label",
      "label": "Section aria label",
      "default": "CRM form and booking section"
    }
  ],
  "blocks": [
    {
      "type": "bullet",
      "name": "Bullet",
      "limit": 6,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Bullet text",
          "default": "No-obligation consultation"
        }
      ]
    },
    {
      "type": "trust_badge",
      "name": "Trust badge",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Logo / badge image"
        },
        {
          "type": "text",
          "id": "alt",
          "label": "Alt text",
          "default": "Trust badge"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Caption (optional)",
          "default": "Trusted by 10,000+ customers"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "3rd Party - CRM Form/Funnel Embed",
      "category": "3rd Party Integrations",
      "settings": {
        "kicker": "Get started",
        "heading": "Book your free consultation",
        "subheading": "Use the form below to request a quote or schedule a call with our team.",
        "embed_type": "form",
        "show_bullets": true
      },
      "blocks": [
        {
          "type": "bullet",
          "settings": { "text": "Fast response within 24 hours" }
        },
        {
          "type": "bullet",
          "settings": { "text": "Personalized recommendations" }
        }
      ]
    }
  ]
}
{% endschema %}
