{%- comment -%}
  Quadratum — Basic Content Helper · Section Divider
  File: sections/content-helper-section-divider.liquid

  Purpose:
  - Structural “chapter break” divider for long pages
  - Optional label + optional chapter subtitle
  - Anchor target for ToC / in-page navigation

  Constraints:
  - No JS
  - Token-driven via scoped CSS variables
  - No blank defaults (EVER)
{%- endcomment -%}

{%- liquid
  assign s = section.settings

  assign variant = s.variant | default: 'divider_with_label'

  assign anchor_raw = s.anchor_id | default: 'section-divider'
  assign anchor = anchor_raw | strip | handle

  assign label_txt = s.label | default: 'Next Section'
  assign label_txt = label_txt | strip

  assign subtitle_rich = s.subtitle

  assign show_icon = s.show_icon
  assign icon_name = s.icon | default: 'sparkle'

  comment
    Spacing token mapping (no raw px inputs)
  endcomment
  assign space_map = 'small:var(--q-space-4)|medium:var(--q-space-7)|large:var(--q-space-10)' | split: '|'
  assign space_above_key = s.space_above | default: 'medium'
  assign space_below_key = s.space_below | default: 'medium'

  assign space_above_val = 'var(--q-space-7)'
  assign space_below_val = 'var(--q-space-7)'

  for pair in space_map
    assign kv = pair | split: ':'
    if kv[0] == space_above_key
      assign space_above_val = kv[1]
    endif
    if kv[0] == space_below_key
      assign space_below_val = kv[1]
    endif
  endfor

  comment
    Max-width + pad-x token mapping (designer tunable, no px inputs in schema)
  endcomment
  assign maxw_key = s.max_width | default: 'standard'
  assign maxw_val = 'var(--q-container-standard)'
  case maxw_key
    when 'narrow'
      assign maxw_val = 'var(--q-container-narrow)'
    when 'standard'
      assign maxw_val = 'var(--q-container-standard)'
    when 'wide'
      assign maxw_val = 'var(--q-container-wide)'
    when 'full'
      assign maxw_val = 'var(--q-container-full)'
  endcase

  assign padx_key = s.pad_x | default: 'normal'
  assign padx_val = 'var(--q-space-6)'
  case padx_key
    when 'tight'
      assign padx_val = 'var(--q-space-4)'
    when 'normal'
      assign padx_val = 'var(--q-space-6)'
    when 'roomy'
      assign padx_val = 'var(--q-space-8)'
  endcase

  comment
    Line style mapping
  endcomment
  assign line_style = s.line_style | default: 'soft'
  assign css_line_style = 'solid'
  case line_style
    when 'solid'
      assign css_line_style = 'solid'
    when 'soft'
      assign css_line_style = 'solid'
    when 'dotted'
      assign css_line_style = 'dotted'
    when 'dashed'
      assign css_line_style = 'dashed'
  endcase

  comment
    Thickness mapping (token-driven sizes)
  endcomment
  assign line_thickness = s.line_thickness | default: 'hairline'
  assign line_weight_val = 'var(--q-border-hairline)'
  case line_thickness
    when 'hairline'
      assign line_weight_val = 'var(--q-border-hairline)'
    when 'normal'
      assign line_weight_val = 'var(--q-border-normal)'
    when 'strong'
      assign line_weight_val = 'var(--q-border-strong)'
  endcase

  assign line_alignment = s.line_alignment | default: 'center'

  assign use_custom_colors = s.use_custom_colors
  assign use_alt_background = s.use_alt_background

  comment
    Graceful fallback:
    - If variant needs label but label is blank, treat as divider_only
  endcomment
  assign effective_variant = variant
  if variant != 'divider_only' and label_txt == blank
    assign effective_variant = 'divider_only'
  endif
-%}

<section
  class="q-sd q-sd--{{ effective_variant }} q-sd-align-{{ line_alignment }}"
  id="{{ anchor }}"
  data-anchor="{{ anchor }}"
  style="
    --q-sd-maxw: {{ maxw_val }};
    --q-sd-pad-x: {{ padx_val }};
    --q-sd-space-above: {{ space_above_val }};
    --q-sd-space-below: {{ space_below_val }};

    --q-sd-line-style: {{ css_line_style }};
    --q-sd-line-weight: {{ line_weight_val }};

    {%- if use_custom_colors -%}
      --q-sd-bg: {{ s.bg_color }};
      --q-sd-text: {{ s.text_color }};
      --q-sd-muted: {{ s.muted_text_color }};
      --q-sd-accent: {{ s.accent_color }};
      --q-sd-line-color: {{ s.surface_color }};
    {%- else -%}
      --q-sd-bg: var(--q-bg);
      --q-sd-text: var(--q-text);
      --q-sd-muted: var(--q-muted);
      --q-sd-accent: var(--q-accent);
      --q-sd-line-color: var(--q-border);
    {%- endif -%}

    --q-sd-label-size: var(--q-eyebrow-size);
    --q-sd-label-weight: var(--q-eyebrow-weight);
    --q-sd-subtitle-size: var(--q-body-sm-size);
    --q-sd-subtitle-opacity: 0.78;
    --q-sd-icon-size: 1.05em;
  "
>
  <div class="q-sd__wrap{%- if effective_variant == 'section_chapter' and use_alt_background -%} q-sd__wrap--alt{%- endif -%}">
    <div class="q-sd__inner">

      {%- if effective_variant == 'divider_only' -%}
        <div class="q-sd__line" role="separator" aria-hidden="true"></div>

      {%- elsif effective_variant == 'divider_with_label' -%}
        <div class="q-sd__row">
          {%- if line_alignment == 'center' -%}
            <span class="q-sd__line q-sd__line--flex" aria-hidden="true"></span>
          {%- endif -%}

          <span class="q-sd__label">
            {%- if show_icon -%}
              <span class="q-sd__icon" aria-hidden="true">
                {%- render 'q-icon', name: icon_name -%}
              </span>
            {%- endif -%}
            <span class="q-sd__label-text">{{ label_txt }}</span>
          </span>

          {%- if line_alignment == 'center' or line_alignment == 'left' -%}
            <span class="q-sd__line q-sd__line--flex" aria-hidden="true"></span>
          {%- endif -%}
        </div>

        {%- if line_alignment == 'full_width' -%}
          <div class="q-sd__line" role="separator" aria-hidden="true"></div>
        {%- endif -%}

      {%- elsif effective_variant == 'section_chapter' -%}
        <div class="q-sd__chapter">
          <p class="q-sd__chapter-title" role="heading" aria-level="2">
            {%- if show_icon -%}
              <span class="q-sd__icon" aria-hidden="true">
                {%- render 'q-icon', name: icon_name -%}
              </span>
            {%- endif -%}
            <span class="q-sd__label-text">{{ label_txt }}</span>
          </p>

          <div class="q-sd__chapter-subtitle">
            {{ subtitle_rich }}
          </div>

          <div class="q-sd__line q-sd__line--chapter" role="separator" aria-hidden="true"></div>
        </div>
      {%- endif -%}

    </div>
  </div>
</section>

<style>
  #shopify-section-{{ section.id }} .q-sd {
    color: var(--q-sd-text);
    background: transparent;
  }

  #shopify-section-{{ section.id }} .q-sd__wrap {
    padding-block: var(--q-sd-space-above) var(--q-sd-space-below);
  }

  #shopify-section-{{ section.id }} .q-sd__wrap--alt {
    background: var(--q-sd-bg);
  }

  #shopify-section-{{ section.id }} .q-sd__inner {
    max-width: var(--q-sd-maxw);
    padding-inline: var(--q-sd-pad-x);
    margin-inline: auto;
  }

  /* Line core */
  #shopify-section-{{ section.id }} .q-sd__line {
    border-top-width: var(--q-sd-line-weight);
    border-top-style: var(--q-sd-line-style);
    border-top-color: var(--q-sd-line-color);
    opacity: 1;
    width: 100%;
  }

  /* “soft” is achieved by muting line via opacity, not by hard-coded colors */
  #shopify-section-{{ section.id }} .q-sd--divider_only .q-sd__line,
  #shopify-section-{{ section.id }} .q-sd--divider_with_label .q-sd__line,
  #shopify-section-{{ section.id }} .q-sd--section_chapter .q-sd__line {
    opacity: {% if line_style == 'soft' %}0.55{% else %}1{% endif %};
  }

  /* Divider with label row */
  #shopify-section-{{ section.id }} .q-sd__row {
    display: flex;
    align-items: center;
    gap: var(--q-space-4);
    min-width: 0;
  }

  #shopify-section-{{ section.id }} .q-sd__line--flex {
    flex: 1 1 auto;
    min-width: 0;
  }

  #shopify-section-{{ section.id }} .q-sd__label {
    display: inline-flex;
    align-items: center;
    gap: var(--q-space-3);
    min-width: 0;
    color: var(--q-sd-text);
    font-size: var(--q-sd-label-size);
    font-weight: var(--q-sd-label-weight);
    letter-spacing: var(--q-eyebrow-tracking, 0.06em);
    text-transform: var(--q-eyebrow-transform, uppercase);
  }

  #shopify-section-{{ section.id }} .q-sd__label-text {
    overflow-wrap: anywhere;
  }

  #shopify-section-{{ section.id }} .q-sd__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--q-sd-icon-size);
    height: var(--q-sd-icon-size);
    color: var(--q-sd-accent);
    flex: 0 0 auto;
  }

  /* Alignment behaviors */
  #shopify-section-{{ section.id }} .q-sd-align-left .q-sd__row {
    justify-content: flex-start;
  }

  #shopify-section-{{ section.id }} .q-sd-align-full_width .q-sd__row {
    justify-content: flex-start;
    margin-bottom: var(--q-space-4);
  }

  /* Chapter variant */
  #shopify-section-{{ section.id }} .q-sd__chapter {
    display: grid;
    gap: var(--q-space-3);
    min-width: 0;
  }

  #shopify-section-{{ section.id }} .q-sd__chapter-title {
    margin: 0;
    display: inline-flex;
    align-items: center;
    gap: var(--q-space-3);
    font-size: var(--q-type-lg-size, var(--q-body-lg-size));
    font-weight: var(--q-type-lg-weight, var(--q-heading-weight));
    letter-spacing: var(--q-type-lg-tracking, normal);
    color: var(--q-sd-text);
    overflow-wrap: anywhere;
  }

  #shopify-section-{{ section.id }} .q-sd__chapter-subtitle {
    font-size: var(--q-sd-subtitle-size);
    color: var(--q-sd-muted);
    opacity: var(--q-sd-subtitle-opacity);
    max-width: var(--q-measure, 65ch);
  }

  #shopify-section-{{ section.id }} .q-sd__line--chapter {
    margin-top: var(--q-space-2);
  }

  /* Responsive guardrail: prevent overflow in label layouts */
  @media (max-width: 480px) {
    #shopify-section-{{ section.id }} .q-sd__row {
      gap: var(--q-space-3);
    }
    #shopify-section-{{ section.id }} .q-sd__label {
      flex-wrap: wrap;
    }
  }
</style>

{% schema %}
{
  "name": "Section Divider",
  "tag": "section",
  "class": "q-section-divider",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "select",
      "id": "variant",
      "label": "Variant",
      "default": "divider_with_label",
      "options": [
        { "value": "divider_only", "label": "Divider only" },
        { "value": "divider_with_label", "label": "Divider with label" },
        { "value": "section_chapter", "label": "Section chapter" }
      ]
    },
    {
      "type": "text",
      "id": "label",
      "label": "Label",
      "default": "Next Section"
    },
    {
      "type": "richtext",
      "id": "subtitle",
      "label": "Subtitle (chapter only)",
      "default": "<p>A quick break before what’s next.</p>"
    },
    {
      "type": "text",
      "id": "anchor_id",
      "label": "Anchor ID",
      "default": "section-divider"
    },
    {
      "type": "checkbox",
      "id": "show_icon",
      "label": "Show icon",
      "default": false
    },
    {
      "type": "text",
      "id": "icon",
      "label": "Icon name",
      "default": "sparkle",
      "info": "Uses snippet: render 'q-icon', name: icon"
    },

    {
      "type": "header",
      "content": "Line & layout"
    },
    {
      "type": "select",
      "id": "line_alignment",
      "label": "Line alignment",
      "default": "center",
      "options": [
        { "value": "center", "label": "Center" },
        { "value": "left", "label": "Left" },
        { "value": "full_width", "label": "Full width" }
      ]
    },
    {
      "type": "select",
      "id": "line_style",
      "label": "Line style",
      "default": "soft",
      "options": [
        { "value": "solid", "label": "Solid" },
        { "value": "soft", "label": "Soft" },
        { "value": "dotted", "label": "Dotted" },
        { "value": "dashed", "label": "Dashed" }
      ]
    },
    {
      "type": "select",
      "id": "line_thickness",
      "label": "Line thickness",
      "default": "hairline",
      "options": [
        { "value": "hairline", "label": "Hairline" },
        { "value": "normal", "label": "Normal" },
        { "value": "strong", "label": "Strong" }
      ]
    },

    {
      "type": "header",
      "content": "Spacing (token-mapped)"
    },
    {
      "type": "select",
      "id": "space_above",
      "label": "Space above",
      "default": "medium",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ]
    },
    {
      "type": "select",
      "id": "space_below",
      "label": "Space below",
      "default": "medium",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ]
    },

    {
      "type": "header",
      "content": "Layout primitives"
    },
    {
      "type": "select",
      "id": "max_width",
      "label": "Max width",
      "default": "standard",
      "options": [
        { "value": "narrow", "label": "Narrow" },
        { "value": "standard", "label": "Standard" },
        { "value": "wide", "label": "Wide" },
        { "value": "full", "label": "Full" }
      ]
    },
    {
      "type": "select",
      "id": "pad_x",
      "label": "Side padding",
      "default": "normal",
      "options": [
        { "value": "tight", "label": "Tight" },
        { "value": "normal", "label": "Normal" },
        { "value": "roomy", "label": "Roomy" }
      ]
    },

    {
      "type": "header",
      "content": "Visual context"
    },
    {
      "type": "checkbox",
      "id": "use_alt_background",
      "label": "Use alternate background (chapter only)",
      "default": false
    },

    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "checkbox",
      "id": "use_custom_colors",
      "label": "Use custom colors",
      "default": false
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "muted_text_color",
      "label": "Muted text",
      "default": "#4b5563"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "surface_color",
      "label": "Line / border",
      "default": "#e5e7eb"
    }
  ],
  "presets": [
    {
      "name": "Basic Content Helpers - Section Divider",
      "category": "Basic Content Helpers"
    }
  ]
}
{% endschema %}
