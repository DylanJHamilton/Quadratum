{% comment %}
  Quadratum — Form: Support Request (Section)
  • Reuses shared engine:
      - snippets/form-dispatch.liquid (routing + hidden meta)
      - snippets/form-core.liquid (field/steps renderer)
  • Layouts: Card / Split / Steps
  • Background media + overlay on ROOT
  • A11y, inline validation hooks, conditional logic, steps UI
  • Tokenized CSS; mirrors CTA + Quote sections

  Fixes included:
  - Section id is ALWAYS section.id (prevents scoped CSS mismatch)
  - Optional anchor_id rendered as a separate <span> (no duplicate ids)
  - Captcha mode/key uses globals-first fallback correctly (based on provider)
  - Checkbox/radio no longer inherit text-input chrome (padding/width/etc.)
  - Hide on mobile/desktop uses is-hidden-m / is-hidden-d parity
  - JS loaded once (top), reCAPTCHA script uses defer
{% endcomment %}

{{ 'forms-sections.css' | asset_url | stylesheet_tag }}
{{ 'frontend-form-logic-form-sections.js' | asset_url | script_tag }}

{%- assign s = section.settings -%}
{%- assign g = settings -%}

{%- comment -%}Effective captcha mode (supports inherit){%- endcomment -%}
{%- assign _cm = s.captcha_mode | default: 'inherit' -%}
{%- if _cm == 'inherit' -%}{%- assign _cm = blank -%}{%- endif -%}
{%- assign eff_captcha_mode = _cm | default: g.forms_captcha_provider | default: 'none' -%}

{%- comment -%}Effective captcha key (provider-aware){%- endcomment -%}
{%- assign eff_captcha_key = s.captcha_site_key | default: '' -%}
{%- if eff_captcha_key == blank -%}
  {%- if eff_captcha_mode == 'turnstile' -%}
    {%- assign eff_captcha_key = g.captcha_turnstile_site_key | default: '' -%}
  {%- elsif eff_captcha_mode == 'recaptcha_v3' -%}
    {%- assign eff_captcha_key = g.captcha_recaptcha_site_key | default: '' -%}
  {%- endif -%}
{%- endif -%}

{%- assign tags_theme   = g.forms_default_tags | default: 'form, web' -%}
{%- assign tags_section = s.hidden_tags | default: 'support, web' -%}
{%- assign eff_tags = tags_theme -%}
{%- if tags_section != blank -%}{%- assign eff_tags = tags_theme | append: ', ' | append: tags_section -%}{%- endif -%}

{%- assign eff_endpoint = s.endpoint_url -%}
{%- if eff_endpoint == blank and s.destination == 'custom_endpoint' -%}
  {%- assign eff_endpoint = g.forms_global_endpoint | default: '' -%}
{%- endif -%}

{%- assign BTN_default = g.button_variant_default | default: 'solid' -%}
{%- assign _btn_choice = s.button_variant | default: 'inherit' -%}
{%- assign _btn_variant = BTN_default -%}
{%- if _btn_choice != 'inherit' and _btn_choice != blank -%}{%- assign _btn_variant = _btn_choice -%}{%- endif -%}
{%- assign btn_mode_class = 'q-btn--solid' -%}
{%- if _btn_variant == 'outline' -%}{%- assign btn_mode_class = 'q-btn--outline' -%}{%- endif -%}
{%- if _btn_variant == 'ghost' -%}{%- assign btn_mode_class = 'q-btn--ghost' -%}{%- endif -%}

{%- assign anchor_id = s.anchor_id | strip -%}
{%- assign wrap_class = 'q-wrap' -%}
{%- if s.container_mode == 'full' -%}{%- assign wrap_class = 'q-wrap-full' -%}{%- endif -%}

{%- assign _support_source = 'support-request' -%}
{%- assign _subject_prefix = 'Support – ' -%}
{%- assign _privacy_cc = 'privacy@' | append: shop.domain -%}

<style>
  #{{ section.id }}{
    --q-pad-y: {{ s.padding_y | default: 64 }}px;
    --q-pad-x: {{ s.padding_x | default: 24 }}px;
    --q-card-br: {{ s.card_radius | default: 16 }}px;
    --q-text: {{ g.text_base | default: '#111111' }};
    --q-muted: {{ g.text_muted | default: '#6b7280' }};
    --q-bg: {{ s.bg_color | default: g.bg_contrast | default: '#f6f7f8' }};

    --q-form-bg: {{ s.form_bg | default: g.bg_base | default: '#ffffff' }};
    --q-input-br: {{ s.input_radius | default: 10 }}px;
    --q-input-bdr: {{ s.input_border | default: '#e5e7eb' }};

    --q-card-shadow-1: {% if s.card_shadow > 0 %}0 1px 2px rgba(0,0,0,.06){% else %}none{% endif %};
    --q-card-shadow-2: {% if s.card_shadow > 1 %}0 8px 24px rgba(0,0,0,.08){% else %}0 0 0 rgba(0,0,0,0){% endif %};
  }

  #{{ section.id }}{ position: relative; }
  #{{ section.id }} .q-anchor{ position: relative; top: -80px; height: 0; width: 0; display: block; visibility: hidden; }

  #{{ section.id }} .q-wrap{
    max-width:{% if g.style_kit == 'full' %}100%{% elsif g.style_kit == 'wide' %}var(--q-cont-xl,1440px){% else %}var(--q-cont-lg,1152px){% endif %};
    margin:0 auto;
    padding:0 var(--q-pad-x);
  }
  #{{ section.id }} .q-wrap-full{
    width:100%;
    max-width:none;
    margin:0;
    padding:0 var(--q-pad-x);
  }

  #{{ section.id }} .q-bleed{position:relative;}
  #{{ section.id }} .q-bg{position:absolute; inset:0; z-index:0; overflow:hidden; pointer-events:none;}
  #{{ section.id }} .q-media{width:100%; height:100%; object-fit:cover; display:block;}
  #{{ section.id }} .q-overlay{position:absolute; inset:0; pointer-events:none;}
  #{{ section.id }} .q-layer{position:relative; z-index:1; padding: var(--q-pad-y) 0;}

  #{{ section.id }} .q-grid{display:grid; gap:24px; align-items:stretch;}
  @media (min-width: 768px){
    #{{ section.id }} .q-grid.split-left{grid-template-columns:1.1fr 1fr;}
    #{{ section.id }} .q-grid.split-right{grid-template-columns:1fr 1.1fr;}
  }

  #{{ section.id }} .q-card{
    background: var(--q-form-bg);
    border-radius: var(--q-card-br);
    box-shadow: var(--q-card-shadow-1), var(--q-card-shadow-2);
    padding: 28px;
  }
  /* ✨ Frameless toggle */
  #{{ section.id }}[data-surface="frameless"] .q-card.is-frameless{
    background: transparent !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    padding: 0 !important;
  }

  #{{ section.id }} .q-media-card{ border-radius: var(--q-card-br); overflow:hidden; background:#000; min-height:240px;}
  #{{ section.id }} .q-head .q-kicker{color:var(--q-muted); font-size:.95rem; margin:0 0 4px;}
  #{{ section.id }} .q-head .q-heading{ margin:0 0 8px; color:var(--q-text); }
  #{{ section.id }} .q-head .q-sub{color:var(--q-muted); margin:0 0 16px;}

  #{{ section.id }} .q-live{ min-height: 1.25rem; }

  #{{ section.id }} .q-error{ color: {{ g.color_error | default: '#dc2626' }}; font-size:.85rem; margin-top:6px; }
  #{{ section.id }} [aria-invalid="true"]{ border-color: {{ g.color_error | default: '#dc2626' }}; outline:1px solid {{ g.color_error | default: '#dc2626' }}; }

  /* Conditional visibility */
  #{{ section.id }} .is-hidden{ display:none !important; }

  /* Inputs parity (tokenized) — text-like only */
  #{{ section.id }} input.q-input:not([type="checkbox"]):not([type="radio"]),
  #{{ section.id }} select.q-select,
  #{{ section.id }} textarea.q-textarea{
    width:100%;
    border:1px solid var(--q-input-bdr);
    border-radius:var(--q-input-br);
    padding:12px 14px;
    background:#fff;
    color:var(--q-text);
  }

  /* Radio/checkbox controls */
  #{{ section.id }} .q-radio{ display:flex; align-items:center; gap:10px; width:max-content; }
  #{{ section.id }} input.q-input[type="checkbox"],
  #{{ section.id }} input.q-input[type="radio"]{
    width:auto !important;
    min-width: 1rem;
    max-width: 1rem;
    height: 1.05rem;
    padding: 0 !important;
    margin: 0;
    display:inline-block;
    vertical-align:middle;
  }

  /* Invalid state for text/select/textarea */
  #{{ section.id }} input:not([type="checkbox"]):not([type="radio"])[aria-invalid="true"],
  #{{ section.id }} select[aria-invalid="true"],
  #{{ section.id }} textarea[aria-invalid="true"]{
    border-color: var(--q-error, #dc2626);
    outline:1px solid var(--q-error, #dc2626);
  }
  /* Invalid state for checkboxes/radios */
  #{{ section.id }} input.q-input[type="checkbox"][aria-invalid="true"],
  #{{ section.id }} input.q-input[type="radio"][aria-invalid="true"]{
    outline:2px solid var(--q-error, #dc2626);
    outline-offset:2px;
  }

  /* Visibility helpers (parity) */
  @media (max-width: 767.98px){ #{{ section.id }}.is-hidden-m { display:none !important; } }
  @media (min-width: 768px){ #{{ section.id }}.is-hidden-d { display:none !important; } }
</style>

<section
  id="{{ section.id }}"
  class="q-form q-form--support-request{% if s.hide_on_mobile %} is-hidden-m{% endif %}{% if s.hide_on_desktop %} is-hidden-d{% endif %}"
  role="region"
  aria-label="{{ s.aria_label | default: 'Support request form' }}"
  data-template="{{ s.template_style }}"
  data-surface="{{ s.surface_style | default: 'card' }}"
  data-msg-error="{{ s.error_text | escape }}"
  data-msg-success="{{ s.success_text | escape }}"
  data-captcha="{{ eff_captcha_mode }}"
  data-captcha-key="{{ eff_captcha_key | escape }}"
  data-btn-variant="{{ btn_mode_class }}"

  data-form-source="{{ _support_source }}"
  data-subject-prefix="{{ _subject_prefix | escape }}"
  data-sla-timestamp="1"
  data-privacy-cc="{{ _privacy_cc | escape }}"
>
  {%- comment -%}Optional deep-link anchor WITHOUT duplicating section id{%- endcomment -%}
  {%- if anchor_id != blank and anchor_id != section.id -%}
    <span id="{{ anchor_id | escape }}" class="q-anchor" aria-hidden="true"></span>
  {%- endif -%}

  <div class="q-bleed">
    <div class="q-bg" aria-hidden="true">
      {%- assign vurl = s.bg_video | strip -%}
      {%- if vurl != blank -%}
        {%- assign is_yt = false -%}{%- assign is_vm = false -%}
        {%- if vurl contains 'youtube.com' or vurl contains 'youtu.be' -%}{%- assign is_yt = true -%}{%- endif -%}
        {%- if vurl contains 'vimeo.com' -%}{%- assign is_vm = true -%}{%- endif -%}
        {%- if is_yt -%}
          {%- assign yid = vurl
            | replace: 'https://youtu.be/','' | replace: 'http://youtu.be/',''
            | replace: 'https://www.youtube.com/watch?v=','' | replace: 'http://www.youtube.com/watch?v=',''
            | replace: 'https://youtube.com/watch?v=','' | replace: 'http://youtube.com/watch?v=',''
            | split:'?' | first -%}
          <iframe class="q-media" src="https://www.youtube.com/embed/{{ yid }}?autoplay=1&mute=1&controls=0&playsinline=1&loop=1&playlist={{ yid }}&modestbranding=1&rel=0" title="" tabindex="-1" allow="autoplay; encrypted-media"></iframe>
        {%- elsif is_vm -%}
          {%- assign vid = vurl | split:'/' | last | split:'?' | first -%}
          <iframe class="q-media" src="https://player.vimeo.com/video/{{ vid }}?background=1&autoplay=1&muted=1&loop=1&autopause=0&controls=0" title="" tabindex="-1" allow="autoplay; fullscreen; picture-in-picture"></iframe>
        {%- else -%}
          <video class="q-media" autoplay loop muted playsinline preload="none">
            <source src="{{ vurl | escape }}" type="video/mp4">
          </video>
        {%- endif -%}
      {%- elsif s.bg_image != blank -%}
        {{ s.bg_image | image_url: width: 2880 | image_tag: widths: '960,1440,1920,2560,2880', sizes: '100vw', loading: 'lazy', class: 'q-media', decoding: 'async', alt: '' }}
      {%- else -%}
        <div class="q-media" style="background: var(--q-bg);"></div>
      {%- endif -%}

      {%- if s.overlay_type == 'gradient' -%}
        {%- assign g1c = s.grad_start | default: '#000000' -%}
        {%- assign g2c = s.grad_end   | default: '#000000' -%}
        {%- assign g1o = s.grad_start_opacity | default: 40 | divided_by: 100.0 -%}
        {%- assign g2o = s.grad_end_opacity   | default: 0  | divided_by: 100.0 -%}
        <div class="q-overlay" style="background: linear-gradient({{ s.grad_angle | default: 180 }}deg, {{ g1c | color_modify: 'alpha', g1o }}, {{ g2c | color_modify: 'alpha', g2o }});"></div>
      {%- elsif s.overlay_type == 'solid' -%}
        <div class="q-overlay" style="background-color: {{ s.overlay_color | default: '#000000' }}; opacity: {{ s.overlay_opacity | default: 35 | divided_by: 100.0 }};"></div>
      {%- endif -%}
    </div>

    <div class="q-layer">
      <div class="{{ wrap_class }}">
        {%- assign is_split_left = false -%}
        {%- assign is_split_right = false -%}
        {%- if s.template_style == 'split' and s.split_media_side == 'left' -%}{%- assign is_split_left = true -%}{%- endif -%}
        {%- if s.template_style == 'split' and s.split_media_side == 'right' -%}{%- assign is_split_right = true -%}{%- endif -%}

        <div class="q-grid{% if is_split_left %} split-left{% endif %}{% if is_split_right %} split-right{% endif %}">
          {%- if s.template_style == 'split' and s.split_image != blank and s.split_media_side == 'left' -%}
            <div class="q-media-card">
              {{ s.split_image | image_url: width: 1600 | image_tag: widths: '800,1200,1600', sizes: '(min-width:768px) 50vw, 100vw', loading: 'lazy', class: 'q-media', decoding: 'async', alt: '' }}
            </div>
          {%- endif -%}

          <div class="q-card{% if s.surface_style == 'frameless' %} is-frameless{% endif %}" data-q-form-card>
            <header class="q-head">
              {%- if s.kicker != blank -%}<p class="q-kicker">{{ s.kicker }}</p>{%- endif -%}
              {%- assign htag = s.heading_level | default: 'h2' -%}
              {%- if s.heading != blank -%}
                {%- if htag == 'h3' -%}<h3 class="q-heading">{{ s.heading }}</h3>{%- else -%}<h2 class="q-heading">{{ s.heading }}</h2>{%- endif -%}
              {%- endif -%}
              {%- if s.subheading != blank -%}<p class="q-sub">{{ s.subheading }}</p>{%- endif -%}
            </header>

            <div class="q-live" aria-live="polite" role="status"></div>

            {% render 'form-dispatch',
              id: section.id,
              settings: section.settings,
              blocks: section.blocks,
              theme_settings: g,
              eff_captcha_mode: eff_captcha_mode,
              eff_captcha_key:  eff_captcha_key,
              eff_endpoint_url: eff_endpoint,
              eff_tags:         eff_tags
            %}

            {%- if s.template_style == 'steps' -%}
              <div class="q-steps-nav" data-q-steps>
                <div class="q-steps-bar"><div class="q-steps-fill" data-q-steps-fill></div></div>
                <div class="q-steps-count" data-q-steps-count></div>
              </div>
            {%- endif -%}
          </div>

          {%- if s.template_style == 'split' and s.split_image != blank and s.split_media_side == 'right' -%}
            <div class="q-media-card">
              {{ s.split_image | image_url: width: 1600 | image_tag: widths: '800,1200,1600', sizes: '(min-width:768px) 50vw, 100vw', loading: 'lazy', class: 'q-media', decoding: 'async', alt: '' }}
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>

  {%- if eff_captcha_mode == 'turnstile' and eff_captcha_key != blank -%}
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>
  {%- endif -%}
  {%- if eff_captcha_mode == 'recaptcha_v3' and eff_captcha_key != blank -%}
    <script src="https://www.google.com/recaptcha/api.js?render={{ eff_captcha_key | escape }}" defer></script>
  {%- endif -%}
</section>

{% schema %}
{
  "name": "Form – Support Request",
  "tag": "section",
  "class": "q-form q-form--support-request",
  "settings": [
    { "type": "text", "id": "aria_label", "label": "ARIA label", "default": "Support request form" },

    { "type": "header", "content": "Layout" },
    { "type": "select", "id": "template_style", "label": "Template", "default": "card", "options": [
      { "value": "card", "label": "Card" },
      { "value": "split", "label": "Split" },
      { "value": "steps", "label": "Steps" }
    ]},
    { "type": "select", "id": "surface_style", "label": "Surface", "default": "card", "options": [
      { "value": "card", "label": "Card surface" },
      { "value": "frameless", "label": "Frameless (no card)" }
    ]},
    { "type": "select", "id": "split_media_side", "label": "Split: media position", "default": "left", "options": [
      { "value": "left", "label": "Media left" },
      { "value": "right", "label": "Media right" }
    ]},
    { "type": "image_picker", "id": "split_image", "label": "Split: image" },
    { "type": "text", "id": "anchor_id", "label": "Optional anchor ID" },

    { "type": "header", "content": "Background (root)" },
    { "type": "image_picker", "id": "bg_image", "label": "Background image" },
    { "type": "text", "id": "bg_video", "label": "Background video URL (MP4, YouTube, Vimeo)" },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#f6f7f8" },
    { "type": "select", "id": "overlay_type", "label": "Overlay", "default": "solid", "options": [
      { "value": "none", "label": "None" },
      { "value": "solid", "label": "Solid" },
      { "value": "gradient", "label": "Gradient" }
    ]},
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "default": 35, "unit": "%" },
    { "type": "color", "id": "grad_start", "label": "Gradient start", "default": "#000000" },
    { "type": "range", "id": "grad_start_opacity", "label": "Start opacity", "min": 0, "max": 100, "step": 5, "default": 40, "unit": "%" },
    { "type": "color", "id": "grad_end", "label": "Gradient end", "default": "#000000" },
    { "type": "range", "id": "grad_end_opacity", "label": "End opacity", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "%" },
    { "type": "range", "id": "grad_angle", "label": "Gradient angle", "min": 0, "max": 360, "step": 5, "default": 180, "unit": "deg" },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "kicker", "label": "Accent (kicker)", "default": "We’re here to help" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "We’re here to help." },
    { "type": "select", "id": "heading_level", "label": "Heading level", "default": "h2", "options": [
      { "value": "h2", "label": "H2" },
      { "value": "h3", "label": "H3" }
    ]},
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Most requests receive a reply within 1 business day." },
    { "type": "text", "id": "success_text", "label": "Success message", "default": "Thanks — your support request was received." },
    { "type": "text", "id": "error_text", "label": "Error message", "default": "Please review highlighted fields and try again." },

    { "type": "header", "content": "Form routing" },
    { "type": "select", "id": "destination", "label": "Destination", "default": "shopify_contact", "options": [
      { "value": "shopify_contact", "label": "Shopify Contact" },
      { "value": "custom_endpoint", "label": "Custom endpoint (POST)" }
    ]},
    { "type": "url", "id": "endpoint_url", "label": "Custom endpoint URL (HTTPS)" },
    { "type": "text", "id": "hidden_tags", "label": "Hidden tags/params (comma-separated)", "default": "support, web" },

    { "type": "header", "content": "CAPTCHA" },
    { "type": "select", "id": "captcha_mode", "label": "Captcha provider (overrides Theme → Integrations)", "default": "inherit", "options": [
      { "value": "inherit", "label": "Inherit (Theme → Integrations)" },
      { "value": "none", "label": "None" },
      { "value": "turnstile", "label": "Cloudflare Turnstile" },
      { "value": "recaptcha_v3", "label": "reCAPTCHA v3" }
    ]},
    { "type": "text", "id": "captcha_site_key", "label": "Captcha site key (override)" },

    { "type": "header", "content": "Button" },
    { "type": "text", "id": "button_label", "label": "Button label", "default": "Send Support Request" },
    { "type": "select", "id": "button_variant", "label": "Variant", "default": "inherit", "options": [
      { "value": "inherit", "label": "— Theme default —" },
      { "value": "solid", "label": "Solid" },
      { "value": "outline", "label": "Outline" },
      { "value": "ghost", "label": "Ghost" }
    ]},

    { "type": "header", "content": "Form UI" },
    { "type": "color", "id": "form_bg", "label": "Form background", "default": "#ffffff" },
    { "type": "range", "id": "input_radius", "label": "Input radius", "min": 0, "max": 20, "step": 1, "default": 10 },
    { "type": "color", "id": "input_border", "label": "Input border color", "default": "#e5e7eb" },

    { "type": "header", "content": "Sizing & spacing" },
    { "type": "select", "id": "container_mode", "label": "Container", "default": "contained", "options": [
      { "value": "contained", "label": "Contained" },
      { "value": "full", "label": "Full width" }
    ]},
    { "type": "range", "id": "padding_y", "label": "Padding Y", "min": 0, "max": 160, "step": 8, "default": 64 },
    { "type": "range", "id": "padding_x", "label": "Padding X", "min": 0, "max": 120, "step": 8, "default": 24 },
    { "type": "range", "id": "card_radius", "label": "Card radius", "min": 0, "max": 32, "step": 1, "default": 16 },
    { "type": "range", "id": "card_shadow", "label": "Card elevation", "min": 0, "max": 3, "step": 1, "default": 2 },
    { "type": "checkbox", "id": "hide_on_mobile", "label": "Hide on mobile", "default": false },
    { "type": "checkbox", "id": "hide_on_desktop", "label": "Hide on desktop", "default": false }
  ],
  "blocks": [
    {
      "type": "field",
      "name": "Field",
      "settings": [
        { "type": "select", "id": "field_type", "label": "Type", "default": "text", "options": [
          { "value": "text", "label": "Text" },
          { "value": "email", "label": "Email" },
          { "value": "tel", "label": "Phone" },
          { "value": "textarea", "label": "Textarea" },
          { "value": "select", "label": "Select" },
          { "value": "radio", "label": "Radio group" },
          { "value": "checkbox", "label": "Checkbox" },
          { "value": "consent", "label": "Consent" },
          { "value": "hidden", "label": "Hidden" },
          { "value": "number", "label": "Number" },
          { "value": "url", "label": "URL" },
          { "value": "date", "label": "Date" },
          { "value": "time", "label": "Time" },
          { "value": "password", "label": "Password" },
          { "value": "file", "label": "File upload" },
          { "value": "html", "label": "HTML content" }
        ]},
        { "type": "text", "id": "name_attr", "label": "Input name (e.g. contact[email])", "default": "contact[field]" },
        { "type": "text", "id": "label", "label": "Label", "default": "Your field" },
        { "type": "text", "id": "placeholder", "label": "Placeholder" },
        { "type": "checkbox", "id": "required", "label": "Required", "default": false },
        { "type": "textarea", "id": "help_text", "label": "Help text" },
        { "type": "text", "id": "default_value", "label": "Default/hidden value" },
        { "type": "textarea", "id": "options", "label": "Options (one per line, value|label)", "default": "order_issue|Order Issue\nshipping_question|Shipping Question\nproduct_question|Product Question\nprivacy_request|Privacy Request\nother|Other" },
        { "type": "text", "id": "accept", "label": "File accept (e.g. .pdf,.png)" },
        { "type": "select", "id": "width", "label": "Width", "default": "full", "options": [
          { "value": "half", "label": "1/2" },
          { "value": "full", "label": "Full" }
        ]},
        { "type": "checkbox", "id": "condition_enable", "label": "Show conditionally", "default": false },
        { "type": "text", "id": "condition_field", "label": "When field name equals…" },
        { "type": "text", "id": "condition_value", "label": "…this value (or 'checked')" },
        { "type": "select", "id": "condition_operator", "label": "Operator", "default": "equals", "options": [
          { "value": "equals", "label": "Equals" },
          { "value": "contains", "label": "Contains" },
          { "value": "checked", "label": "Checked" }
        ]},
        { "type": "richtext", "id": "html_content", "label": "HTML content (for HTML type)" }
      ]
    },
    {
      "type": "step",
      "name": "Step (Steps template)",
      "settings": [
        { "type": "text", "id": "step_title", "label": "Title", "default": "Step" },
        { "type": "textarea", "id": "step_desc", "label": "Description" }
      ]
    }
  ],
  "max_blocks": 40,
  "presets": [
    {
      "name": "Forms – Support Request",
      "category": "Forms",
      "settings": {
        "template_style": "card",
        "surface_style": "card",
        "kicker": "We’re here to help",
        "heading": "We’re here to help.",
        "subheading": "Most requests receive a reply within 1 business day.",
        "destination": "shopify_contact",
        "button_label": "Send Support Request",
        "captcha_mode": "inherit"
      },
      "blocks": [
        { "type": "field", "settings": { "field_type": "text",     "name_attr": "contact[name]",          "label": "Name",          "placeholder": "Your name",         "required": true,  "width": "full" } },
        { "type": "field", "settings": { "field_type": "email",    "name_attr": "contact[email]",         "label": "Email",         "placeholder": "you@example.com",   "required": true,  "width": "full" } },
        { "type": "field", "settings": { "field_type": "select",   "name_attr": "contact[category]",      "label": "Category",      "required": true, "options": "order_issue|Order Issue\nshipping_question|Shipping Question\nproduct_question|Product Question\nprivacy_request|Privacy Request\nother|Other", "width": "full" } },
        { "type": "field", "settings": { "field_type": "text",     "name_attr": "contact[order_number]",  "label": "Order Number",  "placeholder": "e.g. #1234",        "required": false, "width": "half", "condition_enable": true, "condition_field": "contact[category]", "condition_operator": "equals", "condition_value": "order_issue" } },
        { "type": "field", "settings": { "field_type": "textarea", "name_attr": "contact[body]",          "label": "Message",       "placeholder": "Tell us what’s going on…", "required": true, "width": "full" } },
        { "type": "field", "settings": { "field_type": "file",     "name_attr": "attachment",             "label": "Attachment",    "accept": ".png,.jpg,.jpeg,.pdf",   "required": false, "width": "full", "help_text": "Optional. Add a screenshot, receipt, or product photo.", "condition_enable": true, "condition_field": "contact[category]", "condition_operator": "equals", "condition_value": "product_question" } },
        { "type": "field", "settings": { "field_type": "consent",  "name_attr": "contact[consent]",       "label": "I agree to the privacy policy", "required": true, "width": "full" } }
      ]
    }
  ]
}
{% endschema %}
