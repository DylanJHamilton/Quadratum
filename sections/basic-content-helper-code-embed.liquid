{%- comment -%}
  Quadratum — Basic Content Helper · Content Embed
  File: sections/basic-content-helper-code-embed.liquid

  Purpose:
  - Premium “escape hatch” for third-party embeds (widgets, iframes, scripts)
  - Always framed (surface/padding/radius/shadow)
  - No JS required
  - Layout-safe (prevents page-level horizontal overflow)

  Notes:
  - Meaningful non-blank defaults for kicker/title/description
  - Demo embed renders immediately on add
  - Hide entirely if embed_code is blank (design mode notice only)
{%- endcomment -%}

{%- liquid
  assign s = section.settings

  assign has_embed = false
  if s.embed_code != blank
    assign has_embed = true
  endif

  assign header_has_content = false
  if s.kicker != blank or s.title != blank or s.description != blank
    assign header_has_content = true
  endif

  assign maxw = 1200
  case s.max_width
    when 'narrow'
      assign maxw = 900
    when 'wide'
      assign maxw = 1440
    else
      assign maxw = 1200
  endcase

  assign shadow_css = 'none'
  case s.frame_shadow_strength
    when 1
      assign shadow_css = '0 8px 24px rgba(0,0,0,.08)'
    when 2
      assign shadow_css = '0 10px 30px rgba(0,0,0,.10)'
    when 3
      assign shadow_css = '0 14px 40px rgba(0,0,0,.12)'
    when 4
      assign shadow_css = '0 18px 54px rgba(0,0,0,.14)'
    when 5
      assign shadow_css = '0 22px 70px rgba(0,0,0,.16)'
  endcase

  assign ratio_pct = '56.25%'
  case s.aspect_ratio
    when '16_9'
      assign ratio_pct = '56.25%'
    when '4_3'
      assign ratio_pct = '75%'
    when '1_1'
      assign ratio_pct = '100%'
    when 'custom'
      assign ratio_pct = s.aspect_ratio_custom | append: '%'
  endcase

  if has_embed == false
    if request.design_mode
      echo '<div style="max-width:' | append: maxw | append: 'px;margin:0 auto;padding:12px 16px;border:1px dashed currentColor;border-radius:12px;opacity:.8;">Add embed code to display this section.</div>'
    endif
    break
  endif
-%}

<section
  class="q-content-embed q-frame-{{ s.frame_style }} q-mode-{{ s.embed_mode }}"
  style="
    --q-max-width: {{ maxw }}px;
    --q-pad-y: {{ s.pad_y }}px;
    --q-pad-x: {{ s.pad_x }}px;

    --q-gap-header: {{ s.gap_header }}px;

    --q-kicker-size: {{ s.kicker_size }}px;
    --q-kicker-weight: {{ s.kicker_weight }};
    --q-title-size: {{ s.title_size }}px;
    --q-title-weight: {{ s.title_weight }};
    --q-desc-size: {{ s.desc_size }}px;

    --q-frame-pad: {{ s.frame_padding }}px;
    --q-frame-radius: {{ s.frame_radius }}px;
    --q-frame-border-w: {% if s.frame_border %}1px{% else %}0px{% endif %};
    --q-frame-shadow: {{ shadow_css }};
    --q-ratio-pct: {{ ratio_pct }};

    {% if s.use_custom_colors %}
      --q-bg: {{ s.bg_color }};
      --q-text: {{ s.text_color }};
      --q-muted: {{ s.muted_text_color }};
      --q-accent: {{ s.accent_color }};
      --q-surface: {{ s.surface_color }};
      --q-border: {{ s.border_color }};
    {% endif %}
  "
>
  <div class="q-content-embed__outer">
    <div class="q-content-embed__inner">
      {%- if header_has_content -%}
        <header class="q-content-embed__header">
          {%- if s.kicker != blank -%}
            <p class="q-content-embed__kicker">{{ s.kicker | escape }}</p>
          {%- endif -%}

          {%- if s.title != blank -%}
            <h2 class="q-content-embed__title">{{ s.title | escape }}</h2>
          {%- endif -%}

          {%- if s.description != blank -%}
            <div class="q-content-embed__desc rte">
              {{ s.description }}
            </div>
          {%- endif -%}
        </header>
      {%- endif -%}

      <div class="q-content-embed__frame">
        {%- if s.embed_mode == 'iframe_ratio' -%}
          <div class="q-content-embed__ratio">
            <div class="q-content-embed__embed q-scroll-{{ s.allow_horizontal_scroll }}">
              {{ s.embed_code }}
            </div>
          </div>
        {%- else -%}
          <div class="q-content-embed__embed q-scroll-{{ s.allow_horizontal_scroll }}">
            {{ s.embed_code }}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>

  <style>
    /* Scoped styling — section-only */
    #shopify-section-{{ section.id }}.shopify-section,
    #shopify-section-{{ section.id }} {
      background: var(--q-bg, var(--q-section-bg, transparent));
      color: var(--q-text, var(--q-section-text, inherit));
    }

    #shopify-section-{{ section.id }} .q-content-embed__outer {
      padding: var(--q-pad-y) var(--q-pad-x);
    }

    #shopify-section-{{ section.id }} .q-content-embed__inner {
      max-width: var(--q-max-width);
      margin: 0 auto;
      width: 100%;
      min-width: 0;
    }

    #shopify-section-{{ section.id }} .q-content-embed__header {
      display: grid;
      gap: 10px;
      margin-bottom: var(--q-gap-header);
    }

    #shopify-section-{{ section.id }} .q-content-embed__kicker {
      margin: 0;
      font-size: var(--q-kicker-size);
      font-weight: var(--q-kicker-weight);
      letter-spacing: 0.02em;
      color: var(--q-muted, var(--q-section-muted, currentColor));
      opacity: 0.9;
    }

    #shopify-section-{{ section.id }} .q-content-embed__title {
      margin: 0;
      font-size: var(--q-title-size);
      font-weight: var(--q-title-weight);
      line-height: 1.15;
      letter-spacing: -0.01em;
    }

    #shopify-section-{{ section.id }} .q-content-embed__desc {
      font-size: var(--q-desc-size);
      color: var(--q-muted, var(--q-section-muted, currentColor));
      opacity: 0.95;
    }

    /* Frame */
    #shopify-section-{{ section.id }} .q-content-embed__frame {
      background: var(--q-surface, var(--q-section-surface, transparent));
      border: var(--q-frame-border-w) solid var(--q-border, var(--q-section-border, currentColor));
      border-radius: var(--q-frame-radius);
      box-shadow: var(--q-frame-shadow);
      padding: var(--q-frame-pad);
      min-width: 0;
      max-width: 100%;
      overflow: hidden;
    }

    /* Frame style variants */
    #shopify-section-{{ section.id }} .q-frame-minimal .q-content-embed__frame {
      background: transparent;
      box-shadow: none;
    }
    #shopify-section-{{ section.id }} .q-frame-outline .q-content-embed__frame {
      background: transparent;
    }

    /* Embed wrapper safety */
    #shopify-section-{{ section.id }} .q-content-embed__embed {
      width: 100%;
      max-width: 100%;
      min-width: 0;
      display: block;
    }

    /* Allow contained horizontal scroll */
    #shopify-section-{{ section.id }} .q-scroll-true {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    #shopify-section-{{ section.id }} .q-scroll-false {
      overflow-x: hidden;
    }

    /* Prevent page-level overflow from common embed media */
    #shopify-section-{{ section.id }} .q-content-embed__embed iframe,
    #shopify-section-{{ section.id }} .q-content-embed__embed embed,
    #shopify-section-{{ section.id }} .q-content-embed__embed object,
    #shopify-section-{{ section.id }} .q-content-embed__embed video,
    #shopify-section-{{ section.id }} .q-content-embed__embed img,
    #shopify-section-{{ section.id }} .q-content-embed__embed table {
      max-width: 100%;
    }

    /* Ratio mode */
    #shopify-section-{{ section.id }} .q-content-embed__ratio {
      position: relative;
      width: 100%;
      padding-top: var(--q-ratio-pct);
    }
    #shopify-section-{{ section.id }} .q-content-embed__ratio .q-content-embed__embed {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    #shopify-section-{{ section.id }} .q-content-embed__ratio .q-content-embed__embed iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }

    /* RTE containment */
    #shopify-section-{{ section.id }} .rte > :first-child { margin-top: 0; }
    #shopify-section-{{ section.id }} .rte > :last-child { margin-bottom: 0; }

    @media (max-width: 749px) {
      #shopify-section-{{ section.id }} .q-content-embed__outer {
        padding: calc(var(--q-pad-y) * 0.75) calc(var(--q-pad-x) * 0.75);
      }
    }
  </style>
</section>

{% schema %}
{
  "name": "Content Embed",
  "tag": "section",
  "class": "shopify-section",
  "settings": [
    { "type": "header", "content": "Header content" },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Optional embed context" },
    { "type": "text", "id": "title", "label": "Title", "default": "Embedded content" },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Use this section to place third-party widgets inside a premium frame. Replace the demo embed with your provider’s code.</p>"
    },

    { "type": "header", "content": "Embed" },
    {
      "type": "textarea",
      "id": "embed_code",
      "label": "Embed code",
      "info": "Paste your third-party embed code (iframe/script/html). If empty, this section will hide.",
      "default": "<iframe title=\"Demo embed\" src=\"https://www.youtube.com/embed/dQw4w9WgXcQ\" loading=\"lazy\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>"
    },
    {
      "type": "select",
      "id": "embed_mode",
      "label": "Embed mode",
      "default": "raw",
      "options": [
        { "value": "raw", "label": "Raw (default)" },
        { "value": "iframe_ratio", "label": "Iframe ratio wrapper" }
      ]
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "default": "16_9",
      "options": [
        { "value": "16_9", "label": "16:9" },
        { "value": "4_3", "label": "4:3" },
        { "value": "1_1", "label": "1:1" },
        { "value": "custom", "label": "Custom (%)" }
      ]
    },
    {
      "type": "range",
      "id": "aspect_ratio_custom",
      "label": "Custom ratio (padding-top %)",
      "min": 25,
      "max": 150,
      "step": 5,
      "default": 55
    },
    {
      "type": "checkbox",
      "id": "allow_horizontal_scroll",
      "label": "Allow horizontal scroll inside frame",
      "default": true
    },

    { "type": "header", "content": "Layout & framing" },
    {
      "type": "select",
      "id": "max_width",
      "label": "Max width",
      "default": "default",
      "options": [
        { "value": "narrow", "label": "Narrow" },
        { "value": "default", "label": "Default" },
        { "value": "wide", "label": "Wide" }
      ]
    },
    { "type": "range", "id": "pad_y", "label": "Section padding (Y)", "min": 0, "max": 120, "step": 4, "default": 56 },
    { "type": "range", "id": "pad_x", "label": "Section padding (X)", "min": 0, "max": 80, "step": 4, "default": 20 },
    { "type": "range", "id": "gap_header", "label": "Space between header and embed", "min": 0, "max": 60, "step": 2, "default": 18 },

    {
      "type": "select",
      "id": "frame_style",
      "label": "Frame style",
      "default": "card",
      "options": [
        { "value": "card", "label": "Card" },
        { "value": "minimal", "label": "Minimal" },
        { "value": "outline", "label": "Outline" }
      ]
    },
    { "type": "range", "id": "frame_padding", "label": "Frame padding", "min": 0, "max": 48, "step": 2, "default": 18 },
    { "type": "range", "id": "frame_radius", "label": "Frame radius", "min": 0, "max": 40, "step": 1, "default": 18 },
    { "type": "checkbox", "id": "frame_border", "label": "Show frame border", "default": false },
    { "type": "range", "id": "frame_shadow_strength", "label": "Shadow strength", "min": 0, "max": 5, "step": 1, "default": 2 },

    { "type": "header", "content": "Header typography" },
    { "type": "range", "id": "kicker_size", "label": "Kicker size", "min": 10, "max": 18, "step": 1, "default": 12 },
    {
      "type": "select",
      "id": "kicker_weight",
      "label": "Kicker weight",
      "default": "600",
      "options": [
        { "value": "400", "label": "Regular" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semibold" },
        { "value": "700", "label": "Bold" }
      ]
    },
    { "type": "range", "id": "title_size", "label": "Title size", "min": 18, "max": 54, "step": 1, "default": 32 },
    {
      "type": "select",
      "id": "title_weight",
      "label": "Title weight",
      "default": "700",
      "options": [
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semibold" },
        { "value": "700", "label": "Bold" }
      ]
    },
    { "type": "range", "id": "desc_size", "label": "Description size", "min": 12, "max": 20, "step": 1, "default": 16 },

    { "type": "header", "content": "Colors" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors", "default": false },
    { "type": "color", "id": "bg_color", "label": "Background color" },
    { "type": "color", "id": "text_color", "label": "Text color" },
    { "type": "color", "id": "muted_text_color", "label": "Muted text color" },
    { "type": "color", "id": "accent_color", "label": "Accent color" },
    { "type": "color", "id": "surface_color", "label": "Surface color (frame)" },
    { "type": "color", "id": "border_color", "label": "Border color (frame)" }
  ],
  "presets": [
    { "name": "Content Embed", "category": "Basic Content Helpers" }
  ]
}
{% endschema %}
