{%- comment -%}
  Quadratum — People Card
  Used by: Interactive · Team Members / People Grid

  Guarantees:
  - No parentheses in Liquid conditionals (Shopify-safe)
  - Accessible
  - SEO-safe
  - No empty UI rows
  - Photo OR initials avatar
{%- endcomment -%}

{%- liquid
  assign b = block
  assign s = b.settings

  assign name = s.name | default: 'Team member'
  assign role = s.role
  assign bio = s.bio
  assign email = s.email
  assign photo = s.photo

  assign linkedin = s.linkedin_url
  assign other_url = s.other_social_url
  assign other_label = s.other_social_label | default: 'Social'

  assign has_photo = false
  if photo != blank
    assign has_photo = true
  endif

  assign has_email = false
  if show_email
    if email != blank
      assign has_email = true
    endif
  endif

  assign has_social = false
  if show_social
    if linkedin != blank
      assign has_social = true
    endif
    if has_social == false and other_url != blank
      assign has_social = true
    endif
  endif

  assign initials = ''
  if name != blank
    assign parts = name | strip | split: ' '
    assign first = parts.first | slice: 0, 1
    assign last = parts.last | slice: 0, 1
    assign initials = first | append: last
  else
    assign initials = '•'
  endif
-%}

<article
  class="q-person{% if is_featured %} q-person--featured{% endif %}"
  {{ block.shopify_attributes }}
>
  <div class="q-person__media">
    {% if has_photo %}
      <img
        src="{{ photo | image_url: width: 1200 }}"
        alt="{{ name | escape }}"
        loading="lazy"
        width="{{ photo.width }}"
        height="{{ photo.height }}"
      >
    {% else %}
      <div
        class="q-person__avatar"
        aria-label="Initials avatar for {{ name | escape }}"
      >
        <div class="q-person__avatar-inner" aria-hidden="true">
          {{ initials | escape }}
        </div>
      </div>
    {% endif %}
  </div>

  <div class="q-person__body">
    <div class="q-person__top">
      <h3 class="q-person__name">{{ name | escape }}</h3>

      {% if role != blank %}
        <p class="q-person__role">{{ role | escape }}</p>
      {% endif %}
    </div>

    {% if bio != blank %}
      <div class="q-person__bio rte">
        {{ bio }}
      </div>
    {% endif %}

    {% if has_email or has_social %}
      <div class="q-person__links" aria-label="Links for {{ name | escape }}">
        {% if has_email %}
          <a
            class="q-person__link"
            href="mailto:{{ email | strip | escape }}"
            aria-label="Email {{ name | escape }}"
          >
            Email
          </a>
        {% endif %}

        {% if has_social %}
          {% if linkedin != blank %}
            <a
              class="q-person__link"
              href="{{ linkedin }}"
              target="_blank"
              rel="noopener"
              aria-label="LinkedIn profile for {{ name | escape }}"
            >
              LinkedIn
            </a>
          {% endif %}

          {% if other_url != blank %}
            <a
              class="q-person__link"
              href="{{ other_url }}"
              target="_blank"
              rel="noopener"
              aria-label="{{ other_label | escape }} profile for {{ name | escape }}"
            >
              {{ other_label | escape }}
            </a>
          {% endif %}
        {% endif %}
      </div>
    {% endif %}
  </div>
</article>
