{%- comment -%}
  Quadratum — Featured · Testimonial Highlight
  Hero social proof (1–3 testimonials) + OPTIONAL Carousel mode
  Reuse: snippets/testimonial-card.liquid

  Carousel mode is implemented as:
  - CSS scroll-snap (no dependency)
  - Optional arrows + dots
  - Optional autoplay (respects prefers-reduced-motion)
{%- endcomment -%}

{%- liquid
  assign blocks_all = section.blocks | where: 'type', 'testimonial'
  assign t_count = blocks_all.size

  assign display_mode = section.settings.display_mode | default: 'static'
  assign carousel_enabled = false
  if display_mode == 'carousel'
    assign carousel_enabled = true
  endif

  assign layout = section.settings.layout
  if layout == 'split' and t_count < 2
    assign layout = 'hero'
  endif

  assign align = section.settings.content_align

  assign show_header = section.settings.show_header
  assign show_cta = section.settings.show_cta

  assign show_rating = section.settings.show_rating
  assign show_badge = section.settings.show_badge
  assign show_context = section.settings.show_context
  assign show_featured_product = section.settings.show_featured_product
  assign show_featured_product_preview = section.settings.show_featured_product_preview

  assign featured_product = section.settings.featured_product

  assign hero_block = blocks_all[0]
  assign secondary_1 = blocks_all[1]
  assign secondary_2 = blocks_all[2]

  assign has_header_content = false
  if section.settings.kicker != blank or section.settings.heading != blank or section.settings.subheading != blank
    assign has_header_content = true
  endif

  assign bg_has_image = false
  if section.settings.bg_image != blank
    assign bg_has_image = true
  endif

  assign can_show_arrows = false
  if carousel_enabled and section.settings.carousel_arrows and t_count > 1
    assign can_show_arrows = true
  endif

  assign can_show_dots = false
  if carousel_enabled and section.settings.carousel_dots and t_count > 1
    assign can_show_dots = true
  endif

  assign autoplay_enabled = false
  if carousel_enabled and section.settings.carousel_autoplay and t_count > 1
    assign autoplay_enabled = true
  endif
-%}

<section
  class="q-section q-testimonial-highlight q-align--{{ align }} q-layout--{{ layout }} q-mode--{{ display_mode }}"
  style="
    /* spacing + frame */
    --q-th-pad-y: {{ section.settings.pad_y }}px;
    --q-th-pad-x: {{ section.settings.pad_x }}px;
    --q-th-maxw: {{ section.settings.max_width }}px;
    --q-th-gap: {{ section.settings.gap }}px;
    --q-th-radius: {{ section.settings.radius }}px;
    --q-th-border-w: {{ section.settings.border_width }}px;
    --q-th-shadow: {{ section.settings.shadow_strength }};

    /* header typography */
    --q-th-kicker-fs: {{ section.settings.kicker_fs }}px;
    --q-th-kicker-ls: {{ section.settings.kicker_ls | times: 0.01 }}em;
    --q-th-heading-fs: {{ section.settings.heading_fs }}px;
    --q-th-subheading-fs: {{ section.settings.subheading_fs }}px;

    /* quote + attribution typography */
    --q-th-quote-fs: {{ section.settings.quote_fs }}px;
    --q-th-quote-lh: {{ section.settings.quote_lh }};
    --q-th-name-fs: {{ section.settings.name_fs }}px;
    --q-th-role-fs: {{ section.settings.role_fs }}px;

    /* meta chips + rating */
    --q-th-badge-fs: {{ section.settings.badge_fs }}px;
    --q-th-badge-radius: {{ section.settings.badge_radius }}px;
    --q-th-badge-pad-y: {{ section.settings.badge_pad_y }}px;
    --q-th-badge-pad-x: {{ section.settings.badge_pad_x }}px;

    --q-th-star-size: {{ section.settings.star_size }}px;
    --q-th-star-gap: {{ section.settings.star_gap }}px;

    /* avatar */
    --q-th-avatar: {{ section.settings.avatar_size }}px;
    --q-th-avatar-radius: {{ section.settings.avatar_radius }}px;
    --q-th-avatar-border-w: {{ section.settings.avatar_border_w }}px;

    /* CTA */
    --q-th-cta-fs: {{ section.settings.cta_fs }}px;
    --q-th-cta-radius: {{ section.settings.cta_radius }}px;
    --q-th-cta-pad-y: {{ section.settings.cta_pad_y }}px;
    --q-th-cta-pad-x: {{ section.settings.cta_pad_x }}px;
    --q-th-cta-border-w: {{ section.settings.cta_border_w }}px;

    /* Carousel */
    --q-th-car-gap: {{ section.settings.carousel_gap }}px;
    --q-th-car-slide-min: {{ section.settings.carousel_slide_min }}px;
    --q-th-car-peek: {{ section.settings.carousel_peek }}px;

    /* Background image */
    {%- if bg_has_image -%}
      --q-th-bg-image: url({{ section.settings.bg_image | image_url: width: 2400 }});
    {%- else -%}
      --q-th-bg-image: none;
    {%- endif -%}
    --q-th-bg-pos: {{ section.settings.bg_position }};
    --q-th-bg-size: {{ section.settings.bg_size }};
    --q-th-bg-overlay-opacity: {{ section.settings.bg_overlay_opacity | times: 0.01 }};

    /* Colors (scoped) */
    {%- if section.settings.use_custom_colors -%}
      --q-th-bg: {{ section.settings.bg_color }};
      --q-th-surface: {{ section.settings.surface_color }};
      --q-th-text: {{ section.settings.text_color }};
      --q-th-muted: {{ section.settings.muted_color }};
      --q-th-accent: {{ section.settings.accent_color }};
      --q-th-border: {{ section.settings.border_color }};
      --q-th-overlay: {{ section.settings.bg_overlay_color }};

      --q-th-cta-bg: {{ section.settings.cta_bg }};
      --q-th-cta-text: {{ section.settings.cta_text }};
      --q-th-cta-border: {{ section.settings.cta_border }};

      --q-th-badge-bg: {{ section.settings.badge_bg }};
      --q-th-badge-text: {{ section.settings.badge_text }};
      --q-th-badge-border: {{ section.settings.badge_border }};

      --q-th-avatar-border: {{ section.settings.avatar_border_color }};
      --q-th-star: {{ section.settings.star_color }};
      --q-th-star-muted: {{ section.settings.star_muted_color }};
    {%- else -%}
      --q-th-bg: var(--q-color-bg, transparent);
      --q-th-surface: var(--q-color-surface, rgba(0,0,0,.03));
      --q-th-text: var(--q-color-text, currentColor);
      --q-th-muted: var(--q-color-muted, rgba(0,0,0,.65));
      --q-th-accent: var(--q-color-accent, currentColor);
      --q-th-border: var(--q-color-border, rgba(0,0,0,.12));
      --q-th-overlay: rgba(0,0,0,0);

      --q-th-cta-bg: transparent;
      --q-th-cta-text: var(--q-th-text);
      --q-th-cta-border: var(--q-th-border);

      --q-th-badge-bg: transparent;
      --q-th-badge-text: var(--q-th-muted);
      --q-th-badge-border: var(--q-th-border);

      --q-th-avatar-border: var(--q-th-border);
      --q-th-star: var(--q-th-accent);
      --q-th-star-muted: var(--q-th-border);
    {%- endif -%}
  "
  data-section-id="{{ section.id }}"
  data-section-type="featured-content-testimonial-highlight"
  {%- if carousel_enabled -%}
    data-carousel="true"
    data-autoplay="{{ autoplay_enabled }}"
    data-autoplay-ms="{{ section.settings.carousel_autoplay_ms }}"
  {%- endif -%}
>
  <div class="q-th__bg" aria-hidden="true"></div>

  <div class="q-th__inner">
    {%- if show_header and has_header_content -%}
      <header class="q-th__header">
        {%- if section.settings.kicker != blank -%}
          <p class="q-th__kicker">{{ section.settings.kicker | escape }}</p>
        {%- endif -%}

        {%- if section.settings.heading != blank -%}
          <h2 class="q-th__heading">{{ section.settings.heading | escape }}</h2>
        {%- endif -%}

        {%- if section.settings.subheading != blank -%}
          <div class="q-th__subheading rte">{{ section.settings.subheading }}</div>
        {%- endif -%}
      </header>
    {%- endif -%}

    {%- if t_count > 0 -%}

      {%- if carousel_enabled -%}
        <div class="q-th__carousel" aria-roledescription="carousel">
          {%- if can_show_arrows -%}
            <button class="q-th__nav q-th__nav--prev" type="button" aria-label="Previous testimonial">
              <span aria-hidden="true">‹</span>
            </button>
          {%- endif -%}

          <div class="q-th__track" role="list" tabindex="0">
            {%- for b in blocks_all -%}
              <div class="q-th__slide" role="listitem" data-index="{{ forloop.index0 }}">
                {%- render 'testimonial-card',
                  variant: 'featured',
                  align: align,
                  show_rating: show_rating,
                  show_badge: show_badge,
                  show_context: show_context,

                  quote: b.settings.quote,
                  name: b.settings.name,
                  role: b.settings.role,
                  avatar: b.settings.avatar,
                  rating: b.settings.rating,
                  platform: b.settings.platform,
                  custom_badge_label: b.settings.custom_badge_label,
                  custom_badge_icon: b.settings.custom_badge_icon,

                  association_product: b.settings.product,
                  association_collection: b.settings.collection,
                  service_label: b.settings.service_label,

                  featured_product: featured_product,
                  show_featured_product: show_featured_product,
                  show_featured_product_preview: show_featured_product_preview
                -%}
              </div>
            {%- endfor -%}
          </div>

          {%- if can_show_arrows -%}
            <button class="q-th__nav q-th__nav--next" type="button" aria-label="Next testimonial">
              <span aria-hidden="true">›</span>
            </button>
          {%- endif -%}

          {%- if can_show_dots -%}
            <div class="q-th__dots" role="tablist" aria-label="Testimonial slides">
              {%- for b in blocks_all -%}
                <button
                  class="q-th__dot"
                  type="button"
                  role="tab"
                  aria-label="Go to slide {{ forloop.index }}"
                  aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                  data-goto="{{ forloop.index0 }}"
                ></button>
              {%- endfor -%}
            </div>
          {%- endif -%}
        </div>

      {%- else -%}
        <div class="q-th__grid" role="list">
          {%- if hero_block != blank -%}
            <div class="q-th__cell q-th__cell--hero" role="listitem">
              {%- render 'testimonial-card',
                variant: 'featured',
                align: align,
                show_rating: show_rating,
                show_badge: show_badge,
                show_context: show_context,

                quote: hero_block.settings.quote,
                name: hero_block.settings.name,
                role: hero_block.settings.role,
                avatar: hero_block.settings.avatar,
                rating: hero_block.settings.rating,
                platform: hero_block.settings.platform,
                custom_badge_label: hero_block.settings.custom_badge_label,
                custom_badge_icon: hero_block.settings.custom_badge_icon,

                association_product: hero_block.settings.product,
                association_collection: hero_block.settings.collection,
                service_label: hero_block.settings.service_label,

                featured_product: featured_product,
                show_featured_product: show_featured_product,
                show_featured_product_preview: show_featured_product_preview
              -%}
            </div>
          {%- endif -%}

          {%- if layout == 'split' -%}
            {%- if secondary_1 != blank -%}
              <div class="q-th__cell q-th__cell--small" role="listitem">
                {%- render 'testimonial-card',
                  variant: 'compact',
                  align: align,
                  show_rating: show_rating,
                  show_badge: show_badge,
                  show_context: show_context,

                  quote: secondary_1.settings.quote,
                  name: secondary_1.settings.name,
                  role: secondary_1.settings.role,
                  avatar: secondary_1.settings.avatar,
                  rating: secondary_1.settings.rating,
                  platform: secondary_1.settings.platform,
                  custom_badge_label: secondary_1.settings.custom_badge_label,
                  custom_badge_icon: secondary_1.settings.custom_badge_icon,

                  association_product: secondary_1.settings.product,
                  association_collection: secondary_1.settings.collection,
                  service_label: secondary_1.settings.service_label,

                  featured_product: featured_product,
                  show_featured_product: false,
                  show_featured_product_preview: false
                -%}
              </div>
            {%- endif -%}

            {%- if secondary_2 != blank -%}
              <div class="q-th__cell q-th__cell--small" role="listitem">
                {%- render 'testimonial-card',
                  variant: 'compact',
                  align: align,
                  show_rating: show_rating,
                  show_badge: show_badge,
                  show_context: show_context,

                  quote: secondary_2.settings.quote,
                  name: secondary_2.settings.name,
                  role: secondary_2.settings.role,
                  avatar: secondary_2.settings.avatar,
                  rating: secondary_2.settings.rating,
                  platform: secondary_2.settings.platform,
                  custom_badge_label: secondary_2.settings.custom_badge_label,
                  custom_badge_icon: secondary_2.settings.custom_badge_icon,

                  association_product: secondary_2.settings.product,
                  association_collection: secondary_2.settings.collection,
                  service_label: secondary_2.settings.service_label,

                  featured_product: featured_product,
                  show_featured_product: false,
                  show_featured_product_preview: false
                -%}
              </div>
            {%- endif -%}
          {%- endif -%}
        </div>
      {%- endif -%}

    {%- else -%}
      <div class="q-th__empty" role="status" aria-live="polite">
        {{ 'sections.testimonial.no_testimonials' | t | default: 'Add a testimonial block to display this section.' }}
      </div>
    {%- endif -%}

    {%- if show_cta and section.settings.cta_label != blank and section.settings.cta_link != blank -%}
      <div class="q-th__cta">
        <a class="q-th__cta-btn q-th__cta-btn--{{ section.settings.cta_style }}" href="{{ section.settings.cta_link }}">
          {{ section.settings.cta_label | escape }}
        </a>
      </div>
    {%- endif -%}
  </div>

  <style>
    .q-testimonial-highlight{
      position: relative;
      color: var(--q-th-text);
      padding: var(--q-th-pad-y) var(--q-th-pad-x);
      background: var(--q-th-bg);
      overflow: hidden;
    }

    /* background image lives at root only */
    .q-testimonial-highlight .q-th__bg{
      position: absolute;
      inset: 0;
      background-image: var(--q-th-bg-image);
      background-position: var(--q-th-bg-pos);
      background-size: var(--q-th-bg-size);
      background-repeat: no-repeat;
      z-index: 0;
    }
    .q-testimonial-highlight .q-th__bg::after{
      content: "";
      position: absolute;
      inset: 0;
      background: var(--q-th-overlay);
      opacity: var(--q-th-bg-overlay-opacity);
    }

    .q-testimonial-highlight .q-th__inner{
      position: relative;
      z-index: 1;
      max-width: var(--q-th-maxw);
      margin: 0 auto;
    }

    .q-testimonial-highlight .q-th__header{
      text-align: left;
      margin-bottom: calc(var(--q-th-gap) * 0.9);
    }
    .q-testimonial-highlight.q-align--center .q-th__header{
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .q-testimonial-highlight .q-th__kicker{
      font-size: var(--q-th-kicker-fs);
      letter-spacing: var(--q-th-kicker-ls);
      text-transform: uppercase;
      color: var(--q-th-muted);
      margin: 0 0 .35em;
    }
    .q-testimonial-highlight .q-th__heading{
      font-size: var(--q-th-heading-fs);
      line-height: 1.1;
      margin: 0 0 .35em;
    }
    .q-testimonial-highlight .q-th__subheading{
      font-size: var(--q-th-subheading-fs);
      color: var(--q-th-muted);
      margin: 0;
    }

    /* STATIC layouts */
    .q-testimonial-highlight .q-th__grid{
      display: grid;
      gap: var(--q-th-gap);
    }
    .q-testimonial-highlight.q-layout--hero .q-th__grid{ grid-template-columns: 1fr; }
    .q-testimonial-highlight.q-layout--split .q-th__grid{
      grid-template-columns: 1.2fr .8fr;
      align-items: stretch;
    }
    .q-testimonial-highlight.q-layout--split .q-th__cell--hero{ grid-row: 1 / span 2; }
    .q-testimonial-highlight.q-layout--split .q-th__cell--small{ grid-column: 2; }

    /* CAROUSEL */
    .q-testimonial-highlight.q-mode--carousel .q-th__carousel{
      position: relative;
    }
    .q-testimonial-highlight .q-th__track{
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: minmax(var(--q-th-car-slide-min), 1fr);
      gap: var(--q-th-car-gap);
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      padding: 2px 2px calc(var(--q-th-gap) * 0.4);
      padding-right: calc(var(--q-th-car-peek) + 2px);
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .q-testimonial-highlight .q-th__track::-webkit-scrollbar{ display:none; }

    .q-testimonial-highlight .q-th__slide{
      scroll-snap-align: start;
    }

    .q-testimonial-highlight .q-th__nav{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 3;
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: var(--q-th-border-w) solid var(--q-th-border);
      background: var(--q-th-surface);
      color: var(--q-th-text);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .q-testimonial-highlight .q-th__nav:focus-visible{
      box-shadow: 0 0 0 2px var(--q-th-accent);
      border-color: var(--q-th-accent);
      outline: none;
    }
    .q-testimonial-highlight .q-th__nav--prev{ left: -10px; }
    .q-testimonial-highlight .q-th__nav--next{ right: -10px; }

    .q-testimonial-highlight .q-th__dots{
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
    }
    .q-testimonial-highlight .q-th__dot{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      border: 1px solid var(--q-th-border);
      background: transparent;
      cursor: pointer;
      padding: 0;
    }
    .q-testimonial-highlight .q-th__dot[aria-selected="true"]{
      background: var(--q-th-accent);
      border-color: var(--q-th-accent);
    }

    /* Forward vars to the shared testimonial engine */
    .q-testimonial-highlight{
      --q-tm-surface: var(--q-th-surface);
      --q-tm-border: var(--q-th-border);
      --q-tm-radius: var(--q-th-radius);
      --q-tm-border-w: var(--q-th-border-w);
      --q-tm-shadow-strength: var(--q-th-shadow);
      --q-tm-accent: var(--q-th-accent);
      --q-tm-text: var(--q-th-text);
      --q-tm-muted: var(--q-th-muted);

      --q-tm-quote-fs-featured: var(--q-th-quote-fs);
      --q-tm-quote-lh-featured: var(--q-th-quote-lh);
      --q-tm-name-fs: var(--q-th-name-fs);
      --q-tm-role-fs: var(--q-th-role-fs);

      --q-tm-badge-fs: var(--q-th-badge-fs);
      --q-tm-badge-radius: var(--q-th-badge-radius);
      --q-tm-badge-pad-y: var(--q-th-badge-pad-y);
      --q-tm-badge-pad-x: var(--q-th-badge-pad-x);
      --q-tm-badge-bg: var(--q-th-badge-bg);
      --q-tm-badge-text: var(--q-th-badge-text);
      --q-tm-badge-border: var(--q-th-badge-border);

      --q-tm-avatar: var(--q-th-avatar);
      --q-tm-avatar-radius: var(--q-th-avatar-radius);
      --q-tm-avatar-border-w: var(--q-th-avatar-border-w);
      --q-tm-avatar-border: var(--q-th-avatar-border);

      --q-tm-star-size: var(--q-th-star-size);
      --q-tm-star-gap: var(--q-th-star-gap);
      --q-tm-star: var(--q-th-star);
      --q-tm-star-muted: var(--q-th-star-muted);

      --q-tm-fp-radius: calc(var(--q-th-radius) * 0.8);
      --q-tm-fp-border-w: var(--q-th-border-w);
      --q-tm-fp-border: var(--q-th-border);
    }

    .q-testimonial-highlight .q-th__cta{
      margin-top: calc(var(--q-th-gap) * 0.9);
      text-align: left;
    }
    .q-testimonial-highlight.q-align--center .q-th__cta{ text-align: center; }

    .q-testimonial-highlight .q-th__cta-btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      border-radius: var(--q-th-cta-radius);
      border: var(--q-th-cta-border-w) solid var(--q-th-cta-border);
      padding: var(--q-th-cta-pad-y) var(--q-th-cta-pad-x);
      font-size: var(--q-th-cta-fs);
      color: var(--q-th-cta-text);
      background: var(--q-th-cta-bg);
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      outline: none;
    }
    .q-testimonial-highlight .q-th__cta-btn:focus-visible{
      box-shadow: 0 0 0 2px var(--q-th-accent);
      border-color: var(--q-th-accent);
    }
    .q-testimonial-highlight .q-th__cta-btn:hover{
      transform: translateY(-1px);
      border-color: var(--q-th-accent);
    }

    @media (max-width: 989px){
      .q-testimonial-highlight.q-layout--split .q-th__grid{
        grid-template-columns: 1fr;
      }
      .q-testimonial-highlight.q-layout--split .q-th__cell--hero{
        grid-row: auto;
      }
      .q-testimonial-highlight.q-layout--split .q-th__cell--small{
        grid-column: auto;
      }
      .q-testimonial-highlight .q-th__nav--prev{ left: -4px; }
      .q-testimonial-highlight .q-th__nav--next{ right: -4px; }
    }

    @media (prefers-reduced-motion: reduce){
      .q-testimonial-highlight .q-th__track{ scroll-behavior: auto; }
    }
  </style>

  {%- if carousel_enabled -%}
    <script>
      (() => {
        const root = document.currentScript.closest('[data-section-id="{{ section.id }}"]');
        if (!root) return;

        const track = root.querySelector('.q-th__track');
        if (!track) return;

        const prev = root.querySelector('.q-th__nav--prev');
        const next = root.querySelector('.q-th__nav--next');
        const dots = Array.from(root.querySelectorAll('.q-th__dot'));
        const slides = Array.from(root.querySelectorAll('.q-th__slide'));
        const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        const getSlideWidth = () => {
          const first = slides[0];
          if (!first) return track.clientWidth;
          const rect = first.getBoundingClientRect();
          const style = window.getComputedStyle(track);
          const gap = parseFloat(style.columnGap || style.gap || '0') || 0;
          return rect.width + gap;
        };

        const scrollToIndex = (i) => {
          const idx = Math.max(0, Math.min(i, slides.length - 1));
          track.scrollTo({ left: idx * getSlideWidth(), behavior: reduceMotion ? 'auto' : 'smooth' });
        };

        const activeIndexFromScroll = () => {
          const w = getSlideWidth() || 1;
          return Math.round(track.scrollLeft / w);
        };

        const setActiveDot = (idx) => {
          if (!dots.length) return;
          dots.forEach((d, i) => d.setAttribute('aria-selected', i === idx ? 'true' : 'false'));
        };

        if (prev) prev.addEventListener('click', () => scrollToIndex(activeIndexFromScroll() - 1));
        if (next) next.addEventListener('click', () => scrollToIndex(activeIndexFromScroll() + 1));

        if (dots.length) {
          dots.forEach((d) => {
            d.addEventListener('click', () => {
              const i = parseInt(d.getAttribute('data-goto') || '0', 10);
              scrollToIndex(i);
            });
          });
        }

        let ticking = false;
        track.addEventListener('scroll', () => {
          if (ticking) return;
          ticking = true;
          window.requestAnimationFrame(() => {
            setActiveDot(activeIndexFromScroll());
            ticking = false;
          });
        });

        // Autoplay
        const autoplay = root.getAttribute('data-autoplay') === 'true';
        const autoplayMs = parseInt(root.getAttribute('data-autoplay-ms') || '4500', 10);
        if (autoplay && !reduceMotion && slides.length > 1) {
          let timer = null;

          const start = () => {
            stop();
            timer = window.setInterval(() => {
              const idx = activeIndexFromScroll();
              const nextIdx = (idx + 1) % slides.length;
              scrollToIndex(nextIdx);
            }, Math.max(1200, autoplayMs));
          };

          const stop = () => {
            if (timer) window.clearInterval(timer);
            timer = null;
          };

          root.addEventListener('mouseenter', stop);
          root.addEventListener('mouseleave', start);
          root.addEventListener('focusin', stop);
          root.addEventListener('focusout', start);

          start();
        }
      })();
    </script>
  {%- endif -%}
</section>

{% schema %}
{
  "name": "Featured Testimonial",
  "tag": "section",
  "class": "q-section-wrap q-section-wrap--featured-testimonial-highlight",
  "settings": [
    { "type": "header", "content": "Header" },
    { "type": "checkbox", "id": "show_header", "label": "Show header", "default": true },
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Testimonials" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "What our customers say" },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Subheading",
      "default": "<p>One strong proof point can make the decision feel easy.</p>"
    },

    { "type": "header", "content": "Display mode" },
    {
      "type": "select",
      "id": "display_mode",
      "label": "Mode",
      "default": "static",
      "options": [
        { "value": "static", "label": "Static (hero / split)" },
        { "value": "carousel", "label": "Carousel" }
      ]
    },

    { "type": "header", "content": "Layout (static mode)" },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout variant",
      "default": "hero",
      "options": [
        { "value": "hero", "label": "Single hero quote" },
        { "value": "split", "label": "1 large + 2 small" }
      ]
    },
    {
      "type": "select",
      "id": "content_align",
      "label": "Content alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ]
    },
    { "type": "range", "id": "max_width", "label": "Max width", "min": 560, "max": 1400, "step": 20, "unit": "px", "default": 900 },
    { "type": "range", "id": "gap", "label": "Gap", "min": 10, "max": 64, "step": 2, "unit": "px", "default": 22 },

    { "type": "header", "content": "Carousel settings" },
    { "type": "checkbox", "id": "carousel_arrows", "label": "Show arrows", "default": true },
    { "type": "checkbox", "id": "carousel_dots", "label": "Show dots", "default": true },
    { "type": "checkbox", "id": "carousel_autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "carousel_autoplay_ms", "label": "Autoplay interval", "min": 2000, "max": 9000, "step": 250, "unit": "ms", "default": 4500 },
    { "type": "range", "id": "carousel_gap", "label": "Slide gap", "min": 8, "max": 40, "step": 2, "unit": "px", "default": 16 },
    { "type": "range", "id": "carousel_slide_min", "label": "Slide min width", "min": 240, "max": 700, "step": 10, "unit": "px", "default": 520 },
    { "type": "range", "id": "carousel_peek", "label": "Peek (right)", "min": 0, "max": 140, "step": 2, "unit": "px", "default": 60 },

    { "type": "header", "content": "Badges & ratings" },
    { "type": "checkbox", "id": "show_badge", "label": "Enable platform badge", "default": true },
    { "type": "checkbox", "id": "show_rating", "label": "Enable rating stars", "default": true },
    { "type": "checkbox", "id": "show_context", "label": "Show context line (Bought / Collection / Service)", "default": true },

    { "type": "header", "content": "Featured product (optional)" },
    { "type": "checkbox", "id": "show_featured_product", "label": "Show featured product line", "default": false },
    { "type": "checkbox", "id": "show_featured_product_preview", "label": "Show featured product preview (mini)", "default": false },
    { "type": "product", "id": "featured_product", "label": "Featured product" },

    { "type": "header", "content": "CTA" },
    { "type": "checkbox", "id": "show_cta", "label": "Show CTA", "default": false },
    { "type": "select", "id": "cta_style", "label": "CTA style", "default": "button", "options": [
      { "value": "button", "label": "Button" },
      { "value": "link", "label": "Link" }
    ]},
    { "type": "text", "id": "cta_label", "label": "CTA label", "default": "Read more reviews" },
    { "type": "url", "id": "cta_link", "label": "CTA link" },

    { "type": "header", "content": "Background image" },
    { "type": "image_picker", "id": "bg_image", "label": "Background image" },
    { "type": "select", "id": "bg_position", "label": "Image position", "default": "center center", "options": [
      { "value": "left top", "label": "Left top" },
      { "value": "left center", "label": "Left center" },
      { "value": "left bottom", "label": "Left bottom" },
      { "value": "center top", "label": "Center top" },
      { "value": "center center", "label": "Center center" },
      { "value": "center bottom", "label": "Center bottom" },
      { "value": "right top", "label": "Right top" },
      { "value": "right center", "label": "Right center" },
      { "value": "right bottom", "label": "Right bottom" }
    ]},
    { "type": "select", "id": "bg_size", "label": "Image size", "default": "cover", "options": [
      { "value": "cover", "label": "Cover" },
      { "value": "contain", "label": "Contain" }
    ]},
    { "type": "range", "id": "bg_overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 1, "unit": "%", "default": 0 },
    { "type": "color", "id": "bg_overlay_color", "label": "Overlay color", "default": "#000000" },

    { "type": "header", "content": "Spacing & frame" },
    { "type": "range", "id": "pad_y", "label": "Padding (Y)", "min": 24, "max": 140, "step": 4, "unit": "px", "default": 64 },
    { "type": "range", "id": "pad_x", "label": "Padding (X)", "min": 16, "max": 96, "step": 4, "unit": "px", "default": 24 },
    { "type": "range", "id": "radius", "label": "Radius", "min": 0, "max": 40, "step": 1, "unit": "px", "default": 18 },
    { "type": "range", "id": "border_width", "label": "Border width", "min": 0, "max": 6, "step": 1, "unit": "px", "default": 1 },
    { "type": "range", "id": "shadow_strength", "label": "Shadow strength", "min": 0, "max": 1, "step": 0.1, "default": 0.2 },

    { "type": "header", "content": "Typography" },
    { "type": "range", "id": "kicker_fs", "label": "Kicker size", "min": 10, "max": 18, "step": 1, "unit": "px", "default": 12 },
    { "type": "range", "id": "kicker_ls", "label": "Kicker letter spacing", "min": 0, "max": 20, "step": 1, "unit": "%", "default": 8 },
    { "type": "range", "id": "heading_fs", "label": "Heading size", "min": 20, "max": 64, "step": 2, "unit": "px", "default": 34 },
    { "type": "range", "id": "subheading_fs", "label": "Subheading size", "min": 12, "max": 24, "step": 1, "unit": "px", "default": 16 },

    { "type": "range", "id": "quote_fs", "label": "Featured quote size", "min": 18, "max": 54, "step": 2, "unit": "px", "default": 28 },
    { "type": "range", "id": "quote_lh", "label": "Featured quote line height", "min": 1, "max": 1.8, "step": 0.1, "default": 1.2 },
    { "type": "range", "id": "name_fs", "label": "Name size", "min": 12, "max": 22, "step": 1, "unit": "px", "default": 15 },
    { "type": "range", "id": "role_fs", "label": "Role size", "min": 11, "max": 20, "step": 1, "unit": "px", "default": 13 },

    { "type": "header", "content": "Avatar" },
    { "type": "range", "id": "avatar_size", "label": "Avatar size", "min": 28, "max": 92, "step": 2, "unit": "px", "default": 44 },
    { "type": "range", "id": "avatar_radius", "label": "Avatar radius", "min": 0, "max": 32, "step": 1, "unit": "px", "default": 32 },
    { "type": "range", "id": "avatar_border_w", "label": "Avatar border width", "min": 0, "max": 4, "step": 1, "unit": "px", "default": 1 },

    { "type": "header", "content": "Badge" },
    { "type": "range", "id": "badge_fs", "label": "Badge size", "min": 10, "max": 18, "step": 1, "unit": "px", "default": 12 },
    { "type": "range", "id": "badge_radius", "label": "Badge radius", "min": 0, "max": 32, "step": 1, "unit": "px", "default": 32 },
    { "type": "range", "id": "badge_pad_y", "label": "Badge padding Y", "min": 0, "max": 16, "step": 1, "unit": "px", "default": 4 },
    { "type": "range", "id": "badge_pad_x", "label": "Badge padding X", "min": 0, "max": 24, "step": 1, "unit": "px", "default": 10 },

    { "type": "header", "content": "Rating stars" },
    { "type": "range", "id": "star_size", "label": "Star size", "min": 10, "max": 26, "step": 1, "unit": "px", "default": 14 },
    { "type": "range", "id": "star_gap", "label": "Star gap", "min": 0, "max": 10, "step": 1, "unit": "px", "default": 2 },

    { "type": "header", "content": "CTA styling" },
    { "type": "range", "id": "cta_fs", "label": "CTA size", "min": 12, "max": 20, "step": 1, "unit": "px", "default": 14 },
    { "type": "range", "id": "cta_radius", "label": "CTA radius", "min": 0, "max": 30, "step": 1, "unit": "px", "default": 12 },
    { "type": "range", "id": "cta_pad_y", "label": "CTA padding Y", "min": 6, "max": 18, "step": 1, "unit": "px", "default": 10 },
    { "type": "range", "id": "cta_pad_x", "label": "CTA padding X", "min": 10, "max": 30, "step": 1, "unit": "px", "default": 14 },
    { "type": "range", "id": "cta_border_w", "label": "CTA border width", "min": 0, "max": 4, "step": 1, "unit": "px", "default": 1 },

    { "type": "header", "content": "Colors" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors", "default": false },

    { "type": "color", "id": "bg_color", "label": "Section background", "default": "#FFFFFF" },
    { "type": "color", "id": "surface_color", "label": "Card surface", "default": "#F5F5F5" },
    { "type": "color", "id": "text_color", "label": "Text", "default": "#111111" },
    { "type": "color", "id": "muted_color", "label": "Muted text", "default": "#6B7280" },
    { "type": "color", "id": "accent_color", "label": "Accent", "default": "#111111" },
    { "type": "color", "id": "border_color", "label": "Border", "default": "#E5E7EB" },

    { "type": "header", "content": "Badge colors" },
    { "type": "color", "id": "badge_bg", "label": "Badge background", "default": "rgba(0,0,0,0)" },
    { "type": "color", "id": "badge_text", "label": "Badge text", "default": "#6B7280" },
    { "type": "color", "id": "badge_border", "label": "Badge border", "default": "#E5E7EB" },

    { "type": "header", "content": "Stars colors" },
    { "type": "color", "id": "star_color", "label": "Star fill", "default": "#111111" },
    { "type": "color", "id": "star_muted_color", "label": "Star muted", "default": "#E5E7EB" },

    { "type": "header", "content": "Avatar border" },
    { "type": "color", "id": "avatar_border_color", "label": "Avatar border color", "default": "#E5E7EB" },

    { "type": "header", "content": "CTA colors" },
    { "type": "color", "id": "cta_bg", "label": "CTA background", "default": "rgba(0,0,0,0)" },
    { "type": "color", "id": "cta_text", "label": "CTA text", "default": "#111111" },
    { "type": "color", "id": "cta_border", "label": "CTA border", "default": "#111111" }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "limit": 12,
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "We swapped themes and instantly felt more premium. The layout tools are fast, the styling is consistent, and customers trust the brand more at first glance."
        },
        { "type": "text", "id": "name", "label": "Name", "default": "Jordan M." },
        { "type": "text", "id": "role", "label": "Role / context", "default": "Verified customer" },
        { "type": "image_picker", "id": "avatar", "label": "Avatar" },

        { "type": "range", "id": "rating", "label": "Rating", "min": 0, "max": 5, "step": 0.5, "default": 5 },
        {
          "type": "select",
          "id": "platform",
          "label": "Platform badge",
          "default": "none",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "google", "label": "Google" },
            { "value": "trustpilot", "label": "Trustpilot" },
            { "value": "yelp", "label": "Yelp" },
            { "value": "facebook", "label": "Facebook" },
            { "value": "custom", "label": "Custom" }
          ]
        },
        { "type": "text", "id": "custom_badge_label", "label": "Custom badge label", "default": "Verified" },
        { "type": "image_picker", "id": "custom_badge_icon", "label": "Custom badge icon" },

        { "type": "header", "content": "Context association (optional)" },
        { "type": "product", "id": "product", "label": "Product" },
        { "type": "collection", "id": "collection", "label": "Collection" },
        { "type": "text", "id": "service_label", "label": "Service label" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured - ```liquidTestimonial Highlight",
      "category": "Featured Content",
      "blocks": [{ "type": "testimonial" }]
    }
  ]
}
{% endschema %}
```

