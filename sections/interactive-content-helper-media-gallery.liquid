{%- comment -%}
  Quadratum — Interactive · Gallery
  File: sections/interactive-content-helper-media-gallery.liquid

  Dependencies:
    - snippets/q-gallery-item.liquid
    - assets/intractive-content-gallery.css
    - assets/interactive-content-gallery.js
{%- endcomment -%}

{{ 'interactive-content-gallery.css' | asset_url | stylesheet_tag }}
<script src="{{ 'interactive-content-gallery.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign items = section.blocks | where: 'type', 'item'
  assign count = items.size

  assign mode = section.settings.layout_mode
  if count == 1
    assign mode = 'single'
  endif

  assign use_custom = section.settings.use_custom_colors
  assign enable_lightbox = section.settings.enable_lightbox
  assign click_action = section.settings.click_action
  assign lightbox_loop = section.settings.lightbox_loop

  assign columns_d = section.settings.columns_desktop
  assign columns_t = section.settings.columns_tablet
  assign columns_m = section.settings.columns_mobile
  assign min_card_w = section.settings.min_card_width

  assign ratio = section.settings.image_ratio
  assign fit = section.settings.image_fit

  assign caption_style = section.settings.caption_style
  assign caption_hover = section.settings.show_caption_on_hover

  assign clamp_text = section.settings.clamp_text
  assign title_lines = section.settings.title_clamp_lines
  assign desc_lines = section.settings.desc_clamp_lines

  assign acc_visible = section.settings.accordion_items_visible_desktop
  assign acc_mode = section.settings.accordion_expand_mode
  assign acc_default = section.settings.accordion_default_active
  assign acc_min_w = section.settings.accordion_min_width
  assign acc_mobile = section.settings.accordion_mobile_behavior

  assign slides_d = section.settings.slides_desktop
  assign slides_t = section.settings.slides_tablet
  assign slides_m = section.settings.slides_mobile
-%}

{%- if count > 0 -%}
  {%- capture scoped_vars -%}
    --q-gallery-pad-y: {{ section.settings.pad_y }}px;
    --q-gallery-pad-x: {{ section.settings.pad_x }}px;
    --q-gallery-gap: {{ section.settings.gap }}px;
    --q-gallery-radius: {{ section.settings.card_radius }}px;
    --q-gallery-shadow: {{ section.settings.shadow_strength }};
    --q-gallery-cols-d: {{ columns_d }};
    --q-gallery-cols-t: {{ columns_t }};
    --q-gallery-cols-m: {{ columns_m }};
    --q-gallery-min-card: {{ min_card_w }}px;

    --q-gallery-overlay: {{ section.settings.overlay_color }};
    --q-gallery-overlay-o: {{ section.settings.overlay_opacity | times: 0.01 }};

    --q-gallery-title-lines: {{ title_lines }};
    --q-gallery-desc-lines: {{ desc_lines }};

    --q-gallery-acc-visible: {{ acc_visible }};
    --q-gallery-acc-minw: {{ acc_min_w }}px;

    --q-gallery-slides-d: {{ slides_d }};
    --q-gallery-slides-t: {{ slides_t }};
    --q-gallery-slides-m: {{ slides_m }};

    --q-gallery-cap-text: {{ section.settings.cap_text }};
    --q-gallery-cap-text-hover: {{ section.settings.cap_text_hover }};
    --q-gallery-cap-title: {{ section.settings.cap_title }};
    --q-gallery-cap-title-hover: {{ section.settings.cap_title_hover }};
    --q-gallery-cap-tag-bg: {{ section.settings.cap_tag_bg }};
    --q-gallery-cap-tag-fg: {{ section.settings.cap_tag_fg }};
    --q-gallery-cap-tag-bg-hover: {{ section.settings.cap_tag_bg_hover }};
    --q-gallery-cap-tag-fg-hover: {{ section.settings.cap_tag_fg_hover }};
  {%- endcapture -%}

  {%- capture scoped_colors -%}
    --q-gallery-bg: {{ section.settings.c_bg }};
    --q-gallery-text: {{ section.settings.c_text }};
    --q-gallery-muted: {{ section.settings.c_muted }};
    --q-gallery-accent: {{ section.settings.c_accent }};
    --q-gallery-surface: {{ section.settings.c_surface }};
    --q-gallery-border: {{ section.settings.c_border }};
  {%- endcapture -%}

  <section
    class="q-gallery q-gallery--mode-{{ mode }} q-gallery--caption-{{ caption_style }}{% if caption_hover %} q-gallery--caption-hover{% endif %}{% if clamp_text %} q-gallery--clamp{% endif %}"
    style="{{ scoped_vars | strip }}{% if use_custom %}{{ scoped_colors | strip }}{% endif %}"
    data-q-gallery
    data-mode="{{ mode }}"
    data-enable-lightbox="{{ enable_lightbox }}"
    data-click-action="{{ click_action }}"
    data-lightbox-loop="{{ lightbox_loop }}"
    data-accordion-mode="{{ acc_mode }}"
    data-accordion-default="{{ acc_default }}"
    data-accordion-mobile="{{ acc_mobile }}"
  >
    <div class="q-gallery__frame q-mw--{{ section.settings.max_width }}">
      {%- if section.settings.show_header -%}
        <header class="q-gallery__header">
          {%- if section.settings.heading != blank -%}
            <h2 class="q-gallery__heading">{{ section.settings.heading | escape }}</h2>
          {%- endif -%}
          {%- if section.settings.subheading != blank -%}
            <div class="q-gallery__subheading rte">{{ section.settings.subheading }}</div>
          {%- endif -%}
        </header>
      {%- endif -%}

      <div class="q-gallery__body">
        {%- if mode == 'carousel' -%}
          <div
            class="q-gallery__carousel q-carousel"
            data-q-carousel
            data-carousel-loop="{{ section.settings.carousel_loop }}"
            data-carousel-autoplay="{{ section.settings.carousel_autoplay }}"
            data-carousel-autoplay-seconds="{{ section.settings.carousel_autoplay_seconds }}"
            data-carousel-arrows="{{ section.settings.carousel_arrows }}"
            data-carousel-dots="{{ section.settings.carousel_dots }}"
          >
            <div class="q-gallery__track" data-q-carousel-track>
              {%- for block in items -%}
                {%- render 'q-gallery-item',
                  section: section,
                  block: block,
                  mode: mode,
                  ratio: ratio,
                  fit: fit,
                  enable_lightbox: enable_lightbox,
                  click_action: click_action
                -%}
              {%- endfor -%}
            </div>

            {%- if section.settings.carousel_arrows -%}
              <button class="q-gallery__nav q-gallery__nav--prev" type="button" aria-label="Previous" data-q-carousel-prev></button>
              <button class="q-gallery__nav q-gallery__nav--next" type="button" aria-label="Next" data-q-carousel-next></button>
            {%- endif -%}

            {%- if section.settings.carousel_dots -%}
              <div class="q-gallery__dots" data-q-carousel-dots aria-label="Carousel pagination"></div>
            {%- endif -%}
          </div>

        {%- elsif mode == 'image_accordion' -%}
          <div class="q-gallery__accordion" role="list">
            {%- for block in items -%}
              {%- assign idx1 = forloop.index -%}
              {%- if idx1 > acc_visible -%}{% break %}{%- endif -%}
              {%- render 'q-gallery-item',
                section: section,
                block: block,
                mode: mode,
                ratio: 'natural',
                fit: 'cover',
                enable_lightbox: enable_lightbox,
                click_action: click_action,
                accordion_index: idx1,
                accordion_default: acc_default
              -%}
            {%- endfor -%}
          </div>

        {%- elsif mode == 'masonry' -%}
          <div class="q-gallery__masonry">
            {%- for block in items -%}
              {%- render 'q-gallery-item',
                section: section,
                block: block,
                mode: mode,
                ratio: 'natural',
                fit: fit,
                enable_lightbox: enable_lightbox,
                click_action: click_action
              -%}
            {%- endfor -%}
          </div>

        {%- else -%}
          <div class="q-gallery__grid" data-ratio="{{ ratio }}" data-fit="{{ fit }}">
            {%- for block in items -%}
              {%- render 'q-gallery-item',
                section: section,
                block: block,
                mode: mode,
                ratio: ratio,
                fit: fit,
                enable_lightbox: enable_lightbox,
                click_action: click_action
              -%}
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>
    </div>

    {%- if enable_lightbox -%}
      <div class="q-gallery__lightbox" hidden data-q-lightbox>
        <div class="q-gallery__lightbox-backdrop" data-q-lightbox-close tabindex="-1" aria-hidden="true"></div>
        <div class="q-gallery__lightbox-panel" role="dialog" aria-modal="true" aria-label="Image viewer">
          <button class="q-gallery__lightbox-close" type="button" aria-label="Close" data-q-lightbox-close></button>
          <button class="q-gallery__lightbox-nav q-gallery__lightbox-nav--prev" type="button" aria-label="Previous" data-q-lightbox-prev></button>
          <button class="q-gallery__lightbox-nav q-gallery__lightbox-nav--next" type="button" aria-label="Next" data-q-lightbox-next></button>

          <figure class="q-gallery__lightbox-figure">
            <img class="q-gallery__lightbox-img" alt="" data-q-lightbox-img>
            <figcaption class="q-gallery__lightbox-cap" data-q-lightbox-cap></figcaption>
          </figure>
        </div>
      </div>
    {%- endif -%}
  </section>
{%- endif -%}

{% schema %}
{
  "name": "Interactive · Gallery",
  "tag": "section",
  "class": "section q-section q-gallery-section",
  "settings": [
    { "type": "header", "content": "Layout" },
    {
      "type": "select",
      "id": "layout_mode",
      "label": "Layout mode",
      "default": "grid",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "masonry", "label": "Masonry" },
        { "value": "carousel", "label": "Carousel" },
        { "value": "image_accordion", "label": "Image accordion" }
      ]
    },
    { "type": "range", "id": "columns_desktop", "label": "Columns (desktop)", "min": 1, "max": 6, "step": 1, "default": 3 },
    { "type": "range", "id": "columns_tablet", "label": "Columns (tablet)", "min": 1, "max": 4, "step": 1, "default": 2 },
    { "type": "range", "id": "columns_mobile", "label": "Columns (mobile)", "min": 1, "max": 3, "step": 1, "default": 1 },
    { "type": "range", "id": "min_card_width", "label": "Min card width (px) safety clamp", "min": 160, "max": 420, "step": 10, "default": 220 },

    { "type": "header", "content": "Grid image behavior" },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio (grid only)",
      "default": "natural",
      "options": [
        { "value": "natural", "label": "Natural" },
        { "value": "square", "label": "Square" },
        { "value": "landscape", "label": "Landscape" },
        { "value": "portrait", "label": "Portrait" }
      ]
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image fit",
      "default": "cover",
      "options": [
        { "value": "cover", "label": "Cover" },
        { "value": "contain", "label": "Contain" }
      ]
    },

    { "type": "header", "content": "Captions" },
    { "type": "checkbox", "id": "show_caption_on_hover", "label": "Show caption on hover/focus", "default": true },
    {
      "type": "select",
      "id": "caption_style",
      "label": "Caption style",
      "default": "overlay",
      "options": [
        { "value": "overlay", "label": "Overlay" },
        { "value": "below_image", "label": "Below image" },
        { "value": "none", "label": "None" }
      ]
    },

    { "type": "header", "content": "Caption colors" },
    { "type": "color", "id": "cap_text", "label": "Caption text", "default": "#ffffff" },
    { "type": "color", "id": "cap_text_hover", "label": "Caption text (hover/focus)", "default": "#ffffff" },
    { "type": "color", "id": "cap_title", "label": "Caption title", "default": "#ffffff" },
    { "type": "color", "id": "cap_title_hover", "label": "Caption title (hover/focus)", "default": "#ffffff" },
    { "type": "color", "id": "cap_tag_bg", "label": "Tag background", "default": "#ffffff" },
    { "type": "color", "id": "cap_tag_fg", "label": "Tag text", "default": "#111111" },
    { "type": "color", "id": "cap_tag_bg_hover", "label": "Tag background (hover/focus)", "default": "#ff4da6" },
    { "type": "color", "id": "cap_tag_fg_hover", "label": "Tag text (hover/focus)", "default": "#111111" },

    { "type": "header", "content": "Click behavior" },
    { "type": "checkbox", "id": "enable_lightbox", "label": "Enable lightbox", "default": false },
    { "type": "checkbox", "id": "lightbox_show_thumbnails", "label": "Lightbox thumbnails (future)", "default": false },
    { "type": "checkbox", "id": "lightbox_loop", "label": "Lightbox loops", "default": true },
    {
      "type": "select",
      "id": "click_action",
      "label": "Click action precedence",
      "default": "lightbox",
      "options": [
        { "value": "lightbox", "label": "Lightbox (when enabled)" },
        { "value": "link", "label": "Link (when provided)" },
        { "value": "none", "label": "None" }
      ]
    },

    { "type": "header", "content": "Carousel (carousel mode)" },
    { "type": "checkbox", "id": "carousel_loop", "label": "Loop", "default": true },
    { "type": "checkbox", "id": "carousel_autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "carousel_autoplay_seconds", "label": "Autoplay seconds", "min": 2, "max": 10, "step": 1, "default": 5 },
    { "type": "checkbox", "id": "carousel_arrows", "label": "Arrows", "default": true },
    { "type": "checkbox", "id": "carousel_dots", "label": "Dots", "default": true },
    { "type": "range", "id": "slides_desktop", "label": "Slides per view (desktop)", "min": 1, "max": 3, "step": 1, "default": 2 },
    { "type": "range", "id": "slides_tablet", "label": "Slides per view (tablet)", "min": 1, "max": 3, "step": 1, "default": 2 },
    { "type": "range", "id": "slides_mobile", "label": "Slides per view (mobile)", "min": 1, "max": 3, "step": 1, "default": 1 },

    { "type": "header", "content": "Image accordion (accordion mode)" },
    { "type": "range", "id": "accordion_items_visible_desktop", "label": "Visible items (desktop)", "min": 2, "max": 8, "step": 1, "default": 4 },
    {
      "type": "select",
      "id": "accordion_expand_mode",
      "label": "Expand mode",
      "default": "hover",
      "options": [
        { "value": "hover", "label": "Hover/focus" },
        { "value": "click", "label": "Click (touch-friendly)" }
      ]
    },
    { "type": "range", "id": "accordion_default_active", "label": "Default active (1 = first)", "min": 1, "max": 12, "step": 1, "default": 1 },
    { "type": "range", "id": "accordion_min_width", "label": "Panel min width (px)", "min": 80, "max": 220, "step": 10, "default": 120 },
    {
      "type": "select",
      "id": "accordion_mobile_behavior",
      "label": "Mobile behavior",
      "default": "stack",
      "options": [
        { "value": "stack", "label": "Stacked list" },
        { "value": "carousel", "label": "Carousel" }
      ]
    },

    { "type": "header", "content": "Header" },
    { "type": "checkbox", "id": "show_header", "label": "Show header", "default": true },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Gallery" },
    { "type": "richtext", "id": "subheading", "label": "Subheading", "default": "<p>Showcase your work, space, or products-in-use.</p>" },

    { "type": "header", "content": "Frame" },
    {
      "type": "select",
      "id": "max_width",
      "label": "Max width",
      "default": "xl",
      "options": [
        { "value": "full", "label": "Full" },
        { "value": "xl", "label": "XL" },
        { "value": "lg", "label": "LG" },
        { "value": "md", "label": "MD" }
      ]
    },
    { "type": "range", "id": "pad_y", "label": "Vertical padding", "min": 0, "max": 120, "step": 4, "default": 48 },
    { "type": "range", "id": "pad_x", "label": "Horizontal padding", "min": 0, "max": 64, "step": 4, "default": 0 },
    { "type": "range", "id": "gap", "label": "Gap", "min": 8, "max": 48, "step": 2, "default": 18 },

    { "type": "header", "content": "Styling" },
    { "type": "checkbox", "id": "use_custom_colors", "label": "Use custom colors (scoped)", "default": false },
    { "type": "color", "id": "c_bg", "label": "Background", "default": "#ffffff" },
    { "type": "color", "id": "c_text", "label": "Text", "default": "#121212" },
    { "type": "color", "id": "c_muted", "label": "Muted text", "default": "#666666" },
    { "type": "color", "id": "c_accent", "label": "Accent", "default": "#1a73e8" },
    { "type": "color", "id": "c_surface", "label": "Surface", "default": "#f6f6f6" },
    { "type": "color", "id": "c_border", "label": "Border", "default": "#e7e7e7" },
    { "type": "range", "id": "card_radius", "label": "Card radius", "min": 0, "max": 32, "step": 1, "default": 16 },
    { "type": "range", "id": "shadow_strength", "label": "Shadow strength", "min": 0, "max": 5, "step": 1, "default": 2 },
    { "type": "color", "id": "overlay_color", "label": "Caption overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Caption overlay opacity", "min": 0, "max": 90, "step": 5, "default": 45 },

    { "type": "header", "content": "Typography + truncation" },
    { "type": "checkbox", "id": "clamp_text", "label": "Clamp long text", "default": true },
    { "type": "range", "id": "title_clamp_lines", "label": "Title clamp lines", "min": 1, "max": 4, "step": 1, "default": 2 },
    { "type": "range", "id": "desc_clamp_lines", "label": "Description clamp lines", "min": 1, "max": 6, "step": 1, "default": 3 }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Item",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "title", "label": "Title", },
        { "type": "text", "id": "description", "label": "Description", },
        { "type": "text", "id": "tag", "label": "Tag/label",  },
        { "type": "url", "id": "link_url", "label": "Link" }
      ]
    }
  ],
  "max_blocks": 24,
  "presets": [
    {
      "name": "Interactive Content - Media Gallery",
      "category": "Interactive Content",
      "blocks": [
        { "type": "item" },
        { "type": "item" },
        { "type": "item" },
        { "type": "item" }
      ]
    }
  ]
}
{% endschema %}
